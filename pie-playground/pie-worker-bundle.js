var t;!function(t){t[t.INTEGER=1]="INTEGER",t[t.RATIONAL=2]="RATIONAL",t[t.REAL=3]="REAL",t[t.COMPLEX=4]="COMPLEX"}(t||(t={}));class e{constructor(t){this.result=t}}class n extends e{constructor(t,e){super(t),this.result=t,this.value=e}isSigned(){return!!this.result&&("+"===this.value[0]||"-"===this.value[0])}build(){return l.build(this.value)}}class r extends e{constructor(t,e,n){super(t),this.result=t,this.numerator=e,this.denominator=n}build(){return u.build(this.numerator,this.denominator)}}class i extends e{constructor(t,e,n,r){super(t),this.result=t,this.integer=e,this.decimal=n,this.exponent=r}build(){if(this.integer?.includes("inf"))return this.integer.includes("-")?c.NEG_INFINITY:c.INFINITY;if(this.integer?.includes("nan"))return c.NAN;const t=(this.exponent?this.exponent.build():c.INEXACT_ZERO).coerce();let e=Number((this.integer?this.integer:"0")+"."+(this.decimal?this.decimal:"0"));return e*=Math.pow(10,t),c.build(e)}}class s extends e{constructor(t,e,n,r){super(t),this.result=t,this.real=e,this.sign=n,this.imaginary=r}build(){const t=this.real?this.real.build():l.EXACT_ZERO,e=this.imaginary.build();return this.sign&&"-"===this.sign?p.build(t,e.negate()):p.build(t,e)}}function o(t){const e=new RegExp("^([+-]?)(\\d+)$").exec(t);return e?new n(!0,e[0]):new n(!1)}function a(e,l){const u=o(e);if(u.result&&l>=t.INTEGER)return u;const c=function(t){if(1!==(t.match(/\//g)||[]).length)return new r(!1);const e=t.split("/");if(2!==e.length)return new r(!1);const[n,i]=e,s=o(n),a=o(i);return s.result&&a.result?new r(!0,n,i):new r(!1)}(e);if(c.result&&l>=t.RATIONAL)return c;const p=function(e){function n(t){if(function(t){return"+inf.0"===t||"-inf.0"===t||"+nan.0"===t||"-nan.0"===t}(t))return new i(!0,t);const e=(t.match(/\./g)||[]).length;if(e>1)return new i(!1);if(0===e){const e=o(t);return new i(e.result,e.value)}const[n,r]=t.split("."),s=o(n),a=o(r),l=s.result||""===n,u=a.result||""===r;return"+"===n||"-"===n?""===r?new i(!1):new i(!0,`${n}0`,t):s.result&&u||l&&a.result?a.result&&a.isSigned()?new i(!1):new i(!0,s.value,a.value):new i(!1)}return 0===(e.match(/[eE]/g)||[]).length?n(e):function(e){const r=e.indexOf("e"),s=e.indexOf("E");if(-1===r&&-1===s)return new i(!1);const o=-1===r?s:r,l=e.substring(0,o),u=e.substring(o+1);if(""===l||""==u)return new i(!1);const c=n(l);if(!c.result)return new i(!1);const p=a(u,t.REAL);return p.result?new i(!0,c.integer,c.decimal,p):new i(!1)}(e)}(e);if(p.result&&l>=t.REAL)return p;const h=function(e){if((e.match(/i/g)||[]).length<1)return new s(!1);if("i"!==e[e.length-1])return new s(!1);const n=e.search(/(?<!^)[+-]/);if(-1===n){const n=a(e.slice(0,-1),t.REAL);return n.result?new s(!0,void 0,void 0,n):new s(!1)}const r=e.slice(0,n);let i=e.slice(n+1,-1);"+"!==i[0]&&"-"!==i[0]&&(i="+"+i);const o=a(r,t.REAL),l=a(i,t.REAL);return o.result&&l.result?new s(!0,o,e[n],l):new s(!1)}(e);return h.result&&l>=t.COMPLEX?h:new n(!1)}class l{constructor(e){this.numberType=t.INTEGER,this.value=e}static build(t,e=!1){const n=BigInt(t);return 0n===n?l.EXACT_ZERO:new l(n)}promote(e){switch(e){case t.INTEGER:return this;case t.RATIONAL:return u.build(this.value,1n,!0);case t.REAL:return c.build(this.coerce(),!0);case t.COMPLEX:return p.build(this,l.EXACT_ZERO,!0)}}equals(t){return t instanceof l&&this.value===t.value}greaterThan(t){return this.value>t.value}negate(){return this===l.EXACT_ZERO?this:l.build(-this.value)}multiplicativeInverse(){if(this===l.EXACT_ZERO)throw new Error("Division by zero");return u.build(1n,this.value,!1)}add(t){return l.build(this.value+t.value)}multiply(t){return l.build(this.value*t.value)}getBigInt(){return this.value}coerce(){return this.value>Number.MAX_SAFE_INTEGER?1/0:this.value<Number.MIN_SAFE_INTEGER?-1/0:Number(this.value)}toString(){return this.value.toString()}}l.EXACT_ZERO=new l(0n);class u{constructor(e,n){this.numberType=t.RATIONAL,this.numerator=e,this.denominator=n}static build(t,e,n=!1){return u.simplify(BigInt(t),BigInt(e),n)}static simplify(t,e,n=!1){const r=(t,e)=>0n===e?t:r(e,t.valueOf()%e.valueOf()),i=r(t,e),s=t<0n?-1n:1n,o=e<0n?-1n:1n,a=s*o;return t*=s,1n!==(e*=o)||n?new u(a*t/i,e/i):l.build(a*t)}getNumerator(){return this.numerator}getDenominator(){return this.denominator}promote(e){switch(e){case t.RATIONAL:return this;case t.REAL:return c.build(this.coerce(),!0);case t.COMPLEX:return p.build(this,l.EXACT_ZERO,!0);default:throw new Error("Unable to demote rational")}}equals(t){return t instanceof u&&this.numerator===t.numerator&&this.denominator===t.denominator}greaterThan(t){return this.numerator*t.denominator>t.numerator*this.denominator}negate(){return u.build(-this.numerator,this.denominator)}multiplicativeInverse(){if(0n===this.numerator)throw new Error("Division by zero");return u.build(this.denominator,this.numerator)}add(t){const e=this.numerator*t.denominator+t.numerator*this.denominator,n=this.denominator*t.denominator;return u.build(e,n)}multiply(t){const e=this.numerator*t.numerator,n=this.denominator*t.denominator;return u.build(e,n)}coerce(){const t=this.numerator<0n?-this.numerator:this.numerator;let e=this.denominator;const n=Number(t/e);if(n>Number.MAX_VALUE)return this.numerator<0n?-1/0:1/0;let r=t%e;for(;r>Number.MAX_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER;)r/=2n,e/=2n;const i=Number(r)/Number(e);return this.numerator<0n?-(n+i):n+i}toString(){return`${this.numerator}/${this.denominator}`}}class c{static build(t,e=!1){return t===1/0?c.INFINITY:t===-1/0?c.NEG_INFINITY:isNaN(t)?c.NAN:0===t?c.INEXACT_ZERO:-0===t?c.INEXACT_NEG_ZERO:new c(t)}constructor(e){this.numberType=t.REAL,this.value=e}promote(e){switch(e){case t.REAL:return this;case t.COMPLEX:return p.build(this,l.EXACT_ZERO,!0);default:throw new Error("Unable to demote real")}}equals(t){return t instanceof c&&this.value===t.value}greaterThan(t){return this.value>t.value}negate(){return c.build(-this.value)}multiplicativeInverse(){if(this===c.INEXACT_ZERO||this===c.INEXACT_NEG_ZERO)throw new Error("Division by zero");return c.build(1/this.value)}add(t){return c.build(this.value+t.value)}multiply(t){return c.build(this.value*t.value)}coerce(){return this.value}toString(){return this===c.INFINITY?"+inf.0":this===c.NEG_INFINITY?"-inf.0":this===c.NAN?"+nan.0":this.value.toString()}}c.INEXACT_ZERO=new c(0),c.INEXACT_NEG_ZERO=new c(-0),c.INFINITY=new c(1/0),c.NEG_INFINITY=new c(-1/0),c.NAN=new c(NaN);class p{static build(t,e,n=!1){return p.simplify(new p(t,e),n)}constructor(e,n){this.numberType=t.COMPLEX,this.real=e,this.imaginary=n}static simplify(t,e){return!e&&m(t.imaginary,l.EXACT_ZERO)?t.real:t}promote(e){if(e===t.COMPLEX)return this;throw new Error("Unable to demote complex")}negate(){return p.build(this.real.negate(),this.imaginary.negate())}equals(t){return m(this.real,t.real)&&m(this.imaginary,t.imaginary)}greaterThan(t){return y(this.real,t.real)&&y(this.imaginary,t.imaginary)}multiplicativeInverse(){const t=g(w(this.real,this.real),w(this.imaginary,this.imaginary));return p.build(w(t.multiplicativeInverse(),this.real),w(t.multiplicativeInverse(),this.imaginary.negate()))}add(t){return p.build(g(this.real,t.real),g(this.imaginary,t.imaginary))}multiply(t){const e=(n=w(this.real,t.real),r=w(this.imaginary,t.imaginary),g(n,function(t){return t.negate()}(r)));var n,r;const i=g(w(this.real,t.imaginary),w(this.imaginary,t.real));return p.build(e,i)}getReal(){return this.real}getImaginary(){return this.imaginary}coerce(){throw new Error("Cannot coerce a complex number to a javascript number")}toPolar(){const e=this.real.promote(t.REAL),n=this.imaginary.promote(t.REAL),r=c.build(Math.sqrt(e.coerce()*e.coerce()+n.coerce()*n.coerce())),i=c.build(Math.atan2(n.coerce(),e.coerce()));return h.build(r,i)}toString(){return`${this.real}+${this.imaginary}i`}}class h{constructor(t,e){this.magnitude=t,this.angle=e}static build(t,e){return new h(t,e)}toCartesian(){const t=c.build(this.magnitude.coerce()*Math.cos(this.angle.coerce())),e=c.build(this.magnitude.coerce()*Math.sin(this.angle.coerce()));return p.build(t,e)}}function d(e){switch(e.numberType){case t.INTEGER:return e;case t.RATIONAL:return 1n===e.getDenominator()?l.build(e.getNumerator()):e;case t.REAL:return e;case t.COMPLEX:return p.build(d(e.getReal()),d(e.getImaginary()))}}function f(t,e){return t.numberType>e.numberType?[t,e.promote(t.numberType)]:t.numberType<e.numberType?[t.promote(e.numberType),e]:[t,e]}function m(t,e){const[n,r]=f(t,e);return n.equals(r)}function y(t,e){const[n,r]=f(t,e);return n.greaterThan(r)}function g(t,e){const[n,r]=f(t,e);return d(n.add(r))}function w(t,e){const[n,r]=f(t,e);return d(n.multiply(r))}c.build(Math.PI),c.build(Math.E),c.build(Math.SQRT2),c.build(Math.LN2),c.build(Math.LN10),c.build(Math.LOG2E),c.build(Math.LOG10E),c.build(Math.SQRT1_2);let v=class t{constructor(t,e){this.start=t,this.end=e}merge(e){return new t(this.start,e.end)}};class E{constructor(t,e){this.line=t,this.column=e}}var T;function I(t,e){return t.split("\n")[e.line-1]}function A(t){return"^".padStart(t.column," ")}!function(t){t[t.LEFT_PAREN=0]="LEFT_PAREN",t[t.RIGHT_PAREN=1]="RIGHT_PAREN",t[t.LEFT_BRACKET=2]="LEFT_BRACKET",t[t.RIGHT_BRACKET=3]="RIGHT_BRACKET",t[t.DOT=4]="DOT",t[t.HASH_SEMICOLON=5]="HASH_SEMICOLON",t[t.IDENTIFIER=6]="IDENTIFIER",t[t.NUMBER=7]="NUMBER",t[t.BOOLEAN=8]="BOOLEAN",t[t.STRING=9]="STRING",t[t.IF=10]="IF",t[t.LET=11]="LET",t[t.COND=12]="COND",t[t.ELSE=13]="ELSE",t[t.DEFINE=14]="DEFINE",t[t.LAMBDA=15]="LAMBDA",t[t.APOSTROPHE=16]="APOSTROPHE",t[t.BACKTICK=17]="BACKTICK",t[t.COMMA=18]="COMMA",t[t.COMMA_AT=19]="COMMA_AT",t[t.QUOTE=20]="QUOTE",t[t.QUASIQUOTE=21]="QUASIQUOTE",t[t.UNQUOTE=22]="UNQUOTE",t[t.UNQUOTE_SPLICING=23]="UNQUOTE_SPLICING",t[t.SET=24]="SET",t[t.BEGIN=25]="BEGIN",t[t.DELAY=26]="DELAY",t[t.IMPORT=27]="IMPORT",t[t.EXPORT=28]="EXPORT",t[t.DEFINE_SYNTAX=29]="DEFINE_SYNTAX",t[t.SYNTAX_RULES=30]="SYNTAX_RULES",t[t.HASH_VECTOR=31]="HASH_VECTOR",t[t.VECTOR=32]="VECTOR",t[t.EOF=33]="EOF"}(T||(T={}));class N extends SyntaxError{constructor(t,e){super(`Syntax error at (${e.line}:${e.column})\n${t}`),this.loc=e}toString(){return this.message}}let b=class extends N{constructor(t,e){super(I(t,e)+"\nUnexpected EOF",e),this.name="UnexpectedEOFError"}};class S extends N{constructor(t,e,n){super(I(t,e)+"\n"+A(e)+"\n"+`Unexpected '${n}'`,e),this.form=n,this.name="UnexpectedTokenError"}}class O extends N{constructor(t,e,n,r){super(I(t,e)+"\n"+A(e)+"\n"+`Expected '${r}' but got '${n}'`,e),this.form=n,this.expected=r,this.name="ExpectedTokenError"}}class _ extends N{constructor(t,e,n,r){super(I(t,e)+"\n"+A(e)+"\n"+`Syntax '${n}' not allowed at Scheme ยง${r}`,e),this.token=n,this.name="DisallowedTokenError"}}class P extends N{constructor(t,e,n){super(I(t,e)+"\n"+A(e)+"\n"+`Syntax '${n}' not supported yet`,e),this.token=n,this.name="UnsupportedTokenError"}}class C{constructor(t){this.elements=t,this.location=new v(this.firstPos(),this.lastPos())}static build(t){if(0===t.length)throw new Error("Illegal empty group. This should never happen.");if(1===t.length){const n=t[0];if(R(n))return n;if((e=n).type!==T.IDENTIFIER&&e.type!==T.NUMBER&&e.type!==T.STRING&&e.type!==T.BOOLEAN)throw new O("",n.pos,n,"<data>");return new C(t)}var e;if(2===t.length){const e=t[0];if(x(e)&&function(t){return t.type===T.APOSTROPHE||t.type===T.BACKTICK||t.type===T.HASH_VECTOR||t.type===T.COMMA||t.type===T.COMMA_AT}(e))return new C(t)}const n=t[0],r=t[t.length-1];if(x(n)&&x(r)&&(s=r,(i=n).type===T.LEFT_PAREN&&s.type===T.RIGHT_PAREN||i.type===T.LEFT_BRACKET&&s.type===T.RIGHT_BRACKET))return new C(t);var i,s;const o=new C(t);throw new O("",o.location.start,o,"matching parentheses")}first(){return this.elements[0]}firstToken(){const t=this.first();return x(t)?t:t.firstToken()}firstPos(){return this.firstToken().pos}last(){return this.elements[this.elements.length-1]}lastToken(){const t=this.last();return x(t)?t:t.lastToken()}lastPos(){return this.lastToken().pos}isParenthesized(){const t=this.first();return x(t)&&(t.type===T.LEFT_PAREN||t.type===T.LEFT_BRACKET)}isSingleIdentifier(){return!this.isParenthesized()&&1===this.length()}unwrap(){return this.isParenthesized()?this.elements.slice(1,this.elements.length-1):this.elements}length(){return this.unwrap().length}toString(){return this.elements.map(t=>t.toString()).join(" ")}}function x(t){return t instanceof k}function R(t){return t instanceof C}class k{constructor(t,e,n,r,i,s,o){this.type=t,this.lexeme=e,this.literal=n,this.start=r,this.end=i,this.pos=new E(s,o),this.endPos=new E(s,o+e.length-1)}convertToken(){switch(this.type){case T.APOSTROPHE:return new k(T.QUOTE,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);case T.BACKTICK:return new k(T.QUASIQUOTE,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);case T.HASH_VECTOR:return new k(T.VECTOR,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);case T.COMMA:return new k(T.UNQUOTE,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);case T.COMMA_AT:return new k(T.UNQUOTE_SPLICING,this.lexeme,this.literal,this.start,this.end,this.pos.line,this.pos.column);default:return this}}toString(){return`${this.lexeme}`}}class M extends SyntaxError{constructor(t,e,n){super(t),this.loc={line:e,column:n}}toString(){return this.message}}class L extends M{constructor(t,e,n){super(`Unexpected character '${n}' (${t}:${e})`,t,e),this.char=n,this.name="UnexpectedCharacterError"}}class D extends M{constructor(t,e){super(`Unexpected EOF (${t}:${e})`,t,e),this.name="UnexpectedEOFError"}}const U=new Map([[".",T.DOT],["if",T.IF],["let",T.LET],["cond",T.COND],["else",T.ELSE],["set!",T.SET],["begin",T.BEGIN],["delay",T.DELAY],["quote",T.QUOTE],["export",T.EXPORT],["import",T.IMPORT],["define",T.DEFINE],["lambda",T.LAMBDA],["define-syntax",T.DEFINE_SYNTAX],["syntax-rules",T.SYNTAX_RULES]]);class q{constructor(t){this.start=0,this.current=0,this.line=1,this.col=0,this.source=t,this.tokens=[]}isAtEnd(){return this.current>=this.source.length}advance(){return this.col++,this.source.charAt(this.current++)}jump(){this.start=this.current,this.col++,this.current++}addToken(t,e=null){const n=this.source.substring(this.start,this.current);this.tokens.push(new k(t,n,e,this.start,this.current,this.line,this.col))}scanTokens(){for(;!this.isAtEnd();)this.start=this.current,this.scanToken();return this.tokens.push(new k(T.EOF,"",null,this.start,this.current,this.line,this.col)),this.tokens}scanToken(){const t=this.advance();switch(t){case"(":this.addToken(T.LEFT_PAREN);break;case")":this.addToken(T.RIGHT_PAREN);break;case"[":this.addToken(T.LEFT_BRACKET);break;case"]":this.addToken(T.RIGHT_BRACKET);break;case"'":this.addToken(T.APOSTROPHE);break;case"`":this.addToken(T.BACKTICK);break;case",":if(this.match("@")){this.addToken(T.COMMA_AT);break}this.addToken(T.COMMA);break;case"#":if(this.match("t")||this.match("f"))this.booleanToken();else if(this.match("|"))this.comment();else if(this.match(";"))this.addToken(T.HASH_SEMICOLON);else{if("("!==this.peek()&&"["!==this.peek())throw new L(this.line,this.col,t);this.addToken(T.HASH_VECTOR)}break;case";":for(;"\n"!=this.peek()&&!this.isAtEnd();)this.advance();break;case" ":case"\r":case"\t":break;case"\n":this.line++,this.col=0;break;case'"':this.stringToken();break;case"|":this.identifierTokenLoose();break;default:if(this.isDigit(t)||"-"===t||"+"===t||"."===t||"i"===t||"n"===t)this.identifierNumberToken();else{if(!this.isValidIdentifier(t))throw new L(this.line,this.col,t);this.identifierToken()}}}comment(){for(;("|"!=this.peek()||"#"!=this.peekNext())&&!this.isAtEnd();)"\n"===this.peek()&&(this.line++,this.col=0),this.advance();if(this.isAtEnd())throw new D(this.line,this.col);this.jump(),this.jump()}identifierToken(){for(;this.isValidIdentifier(this.peek());)this.advance();this.addToken(this.checkKeyword())}identifierTokenLoose(){for(this.advance();"|"!=this.peek()&&!this.isAtEnd();)"\n"===this.peek()&&(this.line++,this.col=0),this.advance();if(this.isAtEnd())throw new D(this.line,this.col);this.advance(),this.addToken(this.checkKeyword())}identifierNumberToken(){for(;this.isValidIdentifier(this.peek());)this.advance();const e=this.source.substring(this.start,this.current);a(e,t.COMPLEX).result?this.addToken(T.NUMBER,e):this.addToken(this.checkKeyword())}checkKeyword(){const t=this.source.substring(this.start,this.current);return U.has(t)?U.get(t):T.IDENTIFIER}stringToken(){for(;'"'!=this.peek()&&!this.isAtEnd();)"\n"===this.peek()&&(this.line++,this.col=0),this.advance();if(this.isAtEnd())throw new D(this.line,this.col);this.advance();const t=this.source.substring(this.start+1,this.current-1);this.addToken(T.STRING,t)}booleanToken(){this.addToken(T.BOOLEAN,"t"===this.peekPrev())}match(t){return!this.isAtEnd()&&(this.source.charAt(this.current)==t&&(this.current++,!0))}peek(){return this.isAtEnd()?"\0":this.source.charAt(this.current)}peekNext(){return this.current+1>=this.source.length?"\0":this.source.charAt(this.current+1)}peekPrev(){return this.current-1<0?"\0":this.source.charAt(this.current-1)}isDigit(t){return t>="0"&&t<="9"}isSpecialSyntax(t){return"("===t||")"===t||"["===t||"]"===t||";"===t||"|"===t}isValidIdentifier(t){return!this.isWhitespace(t)&&!this.isSpecialSyntax(t)}isWhitespace(t){return" "===t||"\0"===t||"\n"===t||"\r"===t||"\t"===t}}var G,$;!function(t){class e{constructor(t,e){this.location=t,this.expressions=e}accept(t){return t.visitSequence(this)}equals(t){if(t instanceof e){if(this.expressions.length!==t.expressions.length)return!1;for(let e=0;e<this.expressions.length;e++)if(!this.expressions[e].equals(t.expressions[e]))return!1;return!0}return!1}}t.Sequence=e;class n{constructor(t,e){this.location=t,this.value=e}accept(t){return t.visitNumericLiteral(this)}equals(t){return t instanceof n&&this.value===t.value}}t.NumericLiteral=n;class r{constructor(t,e){this.location=t,this.value=e}accept(t){return t.visitBooleanLiteral(this)}equals(t){return t instanceof r&&this.value===t.value}}t.BooleanLiteral=r;class i{constructor(t,e){this.location=t,this.value=e}accept(t){return t.visitStringLiteral(this)}equals(t){return t instanceof i&&this.value===t.value}}t.StringLiteral=i;class s{constructor(t,e,n,r=void 0){this.location=t,this.params=n,this.rest=r,this.body=e}accept(t){return t.visitLambda(this)}equals(t){if(t instanceof s){if(this.params.length!==t.params.length)return!1;for(let e=0;e<this.params.length;e++)if(!this.params[e].equals(t.params[e]))return!1;if(this.rest&&t.rest){if(!this.rest.equals(t.rest))return!1}else if(this.rest||t.rest)return!1;return this.body.equals(t.body)}return!1}}t.Lambda=s;class o{constructor(t,e){this.location=t,this.name=e}accept(t){return t.visitIdentifier(this)}equals(t){return t instanceof o&&this.name===t.name}}t.Identifier=o;class a{constructor(t,e,n){this.location=t,this.name=e,this.value=n}accept(t){return t.visitDefinition(this)}equals(t){return t instanceof a&&(this.name.equals(t.name)&&this.value.equals(t.value))}}t.Definition=a;class l{constructor(t,e,n){this.location=t,this.operator=e,this.operands=n}accept(t){return t.visitApplication(this)}equals(t){if(t instanceof l){if(!this.operator.equals(t.operator))return!1;if(this.operands.length!==t.operands.length)return!1;for(let e=0;e<this.operands.length;e++)if(!this.operands[e].equals(t.operands[e]))return!1;return!0}return!1}}t.Application=l;class u{constructor(t,e,n,r){this.location=t,this.test=e,this.consequent=n,this.alternate=r}accept(t){return t.visitConditional(this)}equals(t){return t instanceof u&&(this.test.equals(t.test)&&this.consequent.equals(t.consequent)&&this.alternate.equals(t.alternate))}}t.Conditional=u;class c{constructor(t,e,n){this.location=t,this.car=e,this.cdr=n}accept(t){return t.visitPair(this)}equals(t){return t instanceof c&&(this.car.equals(t.car)&&this.cdr.equals(t.cdr))}}t.Pair=c;class p{constructor(t){this.location=t}accept(t){return t.visitNil(this)}equals(t){return t instanceof p}}t.Nil=p;class h{constructor(t,e){this.location=t,this.value=e}accept(t){return t.visitSymbol(this)}equals(t){return t instanceof h&&this.value===t.value}}t.Symbol=h;class d{constructor(t,e){this.location=t,this.value=e}accept(t){return t.visitSpliceMarker(this)}equals(t){return t instanceof d&&this.value.equals(t.value)}}t.SpliceMarker=d;class f{constructor(t,e,n){this.location=t,this.name=e,this.value=n}accept(t){return t.visitReassignment(this)}equals(t){return t instanceof f&&(this.name.equals(t.name)&&this.value.equals(t.value))}}t.Reassignment=f;class m{constructor(t,e,n){this.location=t,this.source=e,this.identifiers=n}accept(t){return t.visitImport(this)}equals(t){if(t instanceof m){if(!this.source.equals(t.source))return!1;if(this.identifiers.length!==t.identifiers.length)return!1;for(let e=0;e<this.identifiers.length;e++)if(!this.identifiers[e].equals(t.identifiers[e]))return!1;return!0}return!1}}t.Import=m;class y{constructor(t,e){this.location=t,this.definition=e}accept(t){return t.visitExport(this)}equals(t){return t instanceof y&&this.definition.equals(t.definition)}}t.Export=y;class g{constructor(t,e){this.location=t,this.elements=e}accept(t){return t.visitVector(this)}equals(t){if(t instanceof g){if(this.elements.length!==t.elements.length)return!1;for(let e=0;e<this.elements.length;e++)if(!this.elements[e].equals(t.elements[e]))return!1;return!0}return!1}}t.Vector=g;class w{constructor(t,e,n){this.location=t,this.name=e,this.transformer=n}accept(t){return t.visitDefineSyntax(this)}equals(t){return t instanceof w&&(this.name.equals(t.name)&&this.transformer.equals(t.transformer))}}t.DefineSyntax=w;class v{constructor(t,e,n){this.location=t,this.literals=e,this.rules=n}accept(t){return t.visitSyntaxRules(this)}equals(t){if(t instanceof v){if(this.literals.length!==t.literals.length)return!1;for(let e=0;e<this.literals.length;e++)if(!this.literals[e].equals(t.literals[e]))return!1;if(this.rules.length!==t.rules.length)return!1;for(let e=0;e<this.rules.length;e++)if(!this.rules[e][0].equals(t.rules[e][0])||!this.rules[e][1].equals(t.rules[e][1]))return!1;return!0}return!1}}t.SyntaxRules=v}(G||(G={})),function(t){class e{constructor(t,e,n,r,i=void 0){this.location=t,this.name=e,this.body=n,this.params=r,this.rest=i}accept(t){return t.visitFunctionDefinition(this)}equals(t){if(t instanceof e){if(this.params.length!==t.params.length)return!1;for(let e=0;e<this.params.length;e++)if(!this.params[e].equals(t.params[e]))return!1;if(this.rest&&t.rest){if(!this.rest.equals(t.rest))return!1}else if(this.rest||t.rest)return!1;return this.body.equals(t.body)}return!1}}t.FunctionDefinition=e;class n{constructor(t,e,n,r){this.location=t,this.identifiers=e,this.values=n,this.body=r}accept(t){return t.visitLet(this)}equals(t){if(t instanceof n){if(this.identifiers.length!==t.identifiers.length)return!1;for(let e=0;e<this.identifiers.length;e++)if(!this.identifiers[e].equals(t.identifiers[e]))return!1;if(this.values.length!==t.values.length)return!1;for(let e=0;e<this.values.length;e++)if(!this.values[e].equals(t.values[e]))return!1;return this.body.equals(t.body)}return!1}}t.Let=n;class r{constructor(t,e,n,r){this.location=t,this.predicates=e,this.consequents=n,this.catchall=r}accept(t){return t.visitCond(this)}equals(t){if(t instanceof r){if(this.predicates.length!==t.predicates.length)return!1;for(let e=0;e<this.predicates.length;e++)if(!this.predicates[e].equals(t.predicates[e]))return!1;if(this.consequents.length!==t.consequents.length)return!1;for(let e=0;e<this.consequents.length;e++)if(!this.consequents[e].equals(t.consequents[e]))return!1;return this.catchall&&t.catchall?this.catchall.equals(t.catchall):!this.catchall&&!t.catchall}return!1}}t.Cond=r;class i{constructor(t,e,n=void 0){this.location=t,this.elements=e,this.terminator=n}accept(t){return t.visitList(this)}equals(t){if(t instanceof i){if(this.elements.length!==t.elements.length)return!1;for(let e=0;e<this.elements.length;e++)if(!this.elements[e].equals(t.elements[e]))return!1;return this.terminator&&t.terminator?this.terminator.equals(t.terminator):!this.terminator&&!t.terminator}return!1}}t.List=i;class s{constructor(t,e){this.location=t,this.expressions=e}accept(t){return t.visitBegin(this)}equals(t){if(t instanceof s){if(this.expressions.length!==t.expressions.length)return!1;for(let e=0;e<this.expressions.length;e++)if(!this.expressions[e].equals(t.expressions[e]))return!1;return!0}return!1}}t.Begin=s;class o{constructor(t,e){this.location=t,this.expression=e}accept(t){return t.visitDelay(this)}equals(t){return t instanceof o&&this.expression.equals(t.expression)}}t.Delay=o}($||($={}));var B;!function(t){t[t.NONE=0]="NONE",t[t.QUOTE=1]="QUOTE",t[t.QUASIQUOTE=2]="QUASIQUOTE"}(B||(B={}));class H{constructor(t,e,n=1/0){this.current=0,this.quoteMode=B.NONE,this.source=t,this.tokens=e,this.chapter=n}advance(){return this.isAtEnd()||this.current++,this.previous()}isAtEnd(){return this.current>=this.tokens.length}previous(){return this.tokens[this.current-1]}peek(){return this.tokens[this.current]}validateChapter(t,e){if(this.chapter<e)throw new _(this.source,t.pos,t,this.chapter)}toLocation(t){return new v(t.pos,t.endPos)}destructureList(t,e=t=>{}){if(0===t.length)return[[],void 0];if(1===t.length)return e(t[0]),[[this.parseExpression(t[0])],void 0];const n=t.at(-2);if(x(n)&&n.type===T.DOT){const n=t.at(-1),r=t.slice(0,-2);return e(n),r.forEach(e),[r.map(this.parseExpression.bind(this)),this.parseExpression(n)]}const r=t;return r.forEach(e),[r.map(this.parseExpression.bind(this)),void 0]}grouping(t){const e=[];let n=!1;t&&(n=!0,e.push(t));do{const t=this.advance();switch(t.type){case T.LEFT_PAREN:case T.LEFT_BRACKET:const r=this.grouping(t);e.push(r);break;case T.RIGHT_PAREN:case T.RIGHT_BRACKET:if(!n)throw new S(this.source,t.pos,t);e.push(t),n=!1;break;case T.APOSTROPHE:case T.BACKTICK:case T.COMMA:case T.COMMA_AT:case T.HASH_VECTOR:let i;do{i=this.grouping()}while(!i);e.push(this.affect(t,i));break;case T.QUOTE:case T.QUASIQUOTE:case T.UNQUOTE:case T.UNQUOTE_SPLICING:case T.IDENTIFIER:case T.NUMBER:case T.BOOLEAN:case T.STRING:case T.DOT:case T.DEFINE:case T.IF:case T.ELSE:case T.COND:case T.LAMBDA:case T.LET:case T.SET:case T.BEGIN:case T.DELAY:case T.IMPORT:case T.EXPORT:case T.DEFINE_SYNTAX:case T.SYNTAX_RULES:e.push(t);break;case T.HASH_SEMICOLON:for(;!this.grouping(););break;case T.EOF:throw new b(this.source,t.pos);default:throw new S(this.source,t.pos,t)}}while(n);if(0!==e.length)try{return C.build(e)}catch(t){if(t instanceof O)throw new O(this.source,t.loc,t.form,t.expected);throw t}}affect(t,e){return C.build([t,e])}parseExpression(t){return x(t)?this.parseToken(t):t.isSingleIdentifier()?this.parseToken(t.unwrap()[0]):this.parseGroup(t)}parseToken(t){switch(t.type){case T.IDENTIFIER:return this.quoteMode===B.NONE?new G.Identifier(this.toLocation(t),t.lexeme):new G.Symbol(this.toLocation(t),t.lexeme);case T.NUMBER:return new G.NumericLiteral(this.toLocation(t),t.literal);case T.BOOLEAN:return new G.BooleanLiteral(this.toLocation(t),t.literal);case T.STRING:return new G.StringLiteral(this.toLocation(t),t.literal);default:if(this.quoteMode!==B.NONE||this.chapter>=5)return new G.Symbol(this.toLocation(t),t.lexeme);throw new S(this.source,t.pos,t)}}parseGroup(t){if(!t.isParenthesized())return this.parseAffectorGroup(t);switch(this.quoteMode){case B.NONE:return this.parseNormalGroup(t);case B.QUOTE:case B.QUASIQUOTE:return this.parseQuotedGroup(t)}}parseAffectorGroup(t){const[e,n]=t.unwrap();switch(e.type){case T.APOSTROPHE:case T.QUOTE:if(this.validateChapter(e,2),this.quoteMode!==B.NONE){const t=this.parseExpression(n),r=new G.Symbol(this.toLocation(e),"quote"),i=r.location.merge(t.location);return new $.List(i,[r,t])}this.quoteMode=B.QUOTE;const r=this.parseExpression(n);return this.quoteMode=B.NONE,r;case T.BACKTICK:case T.QUASIQUOTE:if(this.validateChapter(e,2),this.quoteMode!==B.NONE){const t=this.parseExpression(n),r=new G.Symbol(this.toLocation(e),"quasiquote"),i=r.location.merge(t.location);return new $.List(i,[r,t])}this.quoteMode=B.QUASIQUOTE;const i=this.parseExpression(n);return this.quoteMode=B.NONE,i;case T.COMMA:case T.UNQUOTE:this.validateChapter(e,2);const s=this.quoteMode;if(s===B.NONE)throw new P(this.source,e.pos,e);if(s===B.QUOTE){const t=this.parseExpression(n),r=new G.Symbol(this.toLocation(e),"unquote"),i=r.location.merge(t.location);return new $.List(i,[r,t])}this.quoteMode=B.NONE;const o=this.parseExpression(n);return this.quoteMode=s,o;case T.COMMA_AT:case T.UNQUOTE_SPLICING:this.validateChapter(e,2);const a=this.quoteMode;if(a===B.NONE)throw new S(this.source,e.pos,e);if(a===B.QUOTE){const t=this.parseExpression(n),r=new G.Symbol(this.toLocation(e),"unquote-splicing"),i=r.location.merge(t.location);return new $.List(i,[r,t])}this.quoteMode=B.NONE;const l=this.parseExpression(n);this.quoteMode=a;const u=this.toLocation(e).merge(l.location);return new G.SpliceMarker(u,l);case T.HASH_VECTOR:this.validateChapter(e,3);const c=this.quoteMode;this.quoteMode=B.QUOTE;const p=this.parseVector(t);return this.quoteMode=c,p;default:throw new S(this.source,e.pos,e)}}parseNormalGroup(t){if(0===t.length()){if(this.chapter>=5)return new G.Nil(t.location);throw new O(this.source,t.location.start,t,"non-empty group")}const e=t.unwrap()[0];if(x(e))switch(e.type){case T.LAMBDA:return this.validateChapter(e,1),this.parseLambda(t);case T.DEFINE:return this.validateChapter(e,1),this.parseDefinition(t);case T.IF:return this.validateChapter(e,1),this.parseConditional(t);case T.LET:return this.validateChapter(e,1),this.parseLet(t);case T.COND:return this.validateChapter(e,1),this.parseExtendedCond(t);case T.QUOTE:case T.APOSTROPHE:case T.QUASIQUOTE:case T.BACKTICK:case T.UNQUOTE:case T.COMMA:case T.UNQUOTE_SPLICING:case T.COMMA_AT:return this.validateChapter(e,2),this.parseAffectorGroup(t);case T.BEGIN:return this.validateChapter(e,3),this.parseBegin(t);case T.DELAY:return this.validateChapter(e,3),this.parseDelay(t);case T.SET:return this.validateChapter(e,3),this.parseSet(t);case T.DEFINE_SYNTAX:return this.validateChapter(e,5),this.parseDefineSyntax(t);case T.SYNTAX_RULES:throw new S(this.source,e.pos,e);case T.IMPORT:return this.validateChapter(e,1),this.parseImport(t);case T.EXPORT:return this.validateChapter(e,1),this.parseExport(t);case T.VECTOR:return this.validateChapter(e,3),this.parseAffectorGroup(t);default:return this.parseApplication(t)}return this.parseApplication(t)}parseQuotedGroup(t){if(0===t.length())return new G.Nil(t.location);if(1===t.length()){const e=[this.parseExpression(t.unwrap()[0])];return new $.List(t.location,e)}const e=t.unwrap(),[n,r]=this.destructureList(e);return new $.List(t.location,n,r)}parseLambda(t){if(t.length()<3)throw new O(this.source,t.location.start,t,"(lambda (<identifier>* . <rest-identifier>?) <body>+) | (lambda <rest-identifer> <body>+)");const e=t.unwrap(),n=e[1],r=e.slice(2);let i,s=[];if(x(n)){if(n.type!==T.IDENTIFIER)throw new O(this.source,n.pos,n,"<rest-identifier>");i=new G.Identifier(this.toLocation(n),n.lexeme)}else{const t=n.unwrap();[s,i]=this.destructureList(t,t=>{if(!x(t))throw new O(this.source,t.pos,t,"<identifier>");if(t.type!==T.IDENTIFIER)throw new O(this.source,t.pos,t,"<identifier>")})}const o=r.map(this.parseExpression.bind(this));if(o.length<1)throw new O(this.source,t.location.start,t,"(lambda ... <body>+)");if(1===o.length)return new G.Lambda(t.location,o[0],s,i);const a=o.at(0).location.merge(o.at(-1).location),l=new G.Sequence(a,o);return new G.Lambda(t.location,l,s,i)}parseDefinition(t){if(t.length()<3)throw new O(this.source,t.location.start,t,"(define <identifier> <expr>) | (define (<identifier> <formals>) <body>+)");const e=t.unwrap(),n=e[1],r=e.slice(2);let i,s,o=[],a=!1;if(R(n)){a=!0;const t=n.unwrap(),e=t[0],r=t.splice(1);if(!x(e))throw new O(this.source,e.location.start,e,"<identifier>");if(e.type!==T.IDENTIFIER)throw new O(this.source,e.pos,e,"<identifier>");i=new G.Identifier(this.toLocation(e),e.lexeme),[o,s]=this.destructureList(r,t=>{if(!x(t))throw new O(this.source,t.pos,t,"<identifier>");if(t.type!==T.IDENTIFIER)throw new O(this.source,t.pos,t,"<identifier>")})}else{if(n.type!==T.IDENTIFIER)throw new O(this.source,n.pos,n,"<identifier>");i=new G.Identifier(this.toLocation(n),n.lexeme),a=!1}if(r.length<1)throw new O(this.source,t.location.start,t,"(define ... <body>+)");if(a){const e=r.map(this.parseExpression.bind(this));if(1===e.length)return new $.FunctionDefinition(t.location,i,e[0],o,s);const n=e.at(0).location.merge(e.at(-1).location),a=new G.Sequence(n,e);return new $.FunctionDefinition(t.location,i,a,o,s)}if(r.length>1)throw new O(this.source,t.location.start,t,"(define <identifier> <expr>)");const l=this.parseExpression(r[0]);return new G.Definition(t.location,i,l)}parseConditional(t){if(t.length()<3||t.length()>4)throw new O(this.source,t.location.start,t,"(if <pred> <cons> <alt>?)");const e=t.unwrap(),n=e[1],r=e[2],i=t.length()>3?e[3]:void 0,s=this.parseExpression(n),o=this.parseExpression(r),a=i?this.parseExpression(i):new G.Identifier(t.location,"undefined");return new G.Conditional(t.location,s,o,a)}parseApplication(t){if(t.length()<1)throw new O(this.source,t.location.start,t,"(<func> <args>*)");const e=t.unwrap(),n=e[0],r=e.splice(1),i=this.parseExpression(n),s=[];for(const t of r)s.push(this.parseExpression(t));return new G.Application(t.location,i,s)}parseLet(t){if(this.chapter>=5){return t.unwrap().slice(1).forEach(t=>{this.parseExpression(t)}),new $.Let(t.location,[],[],new G.Identifier(t.location,"undefined"))}if(t.length()<3)throw new O(this.source,t.location.start,t,"(let ((<identifier> <value>)*) <body>+)");const e=t.unwrap(),n=e[1],r=e.slice(2);if(!R(n))throw new O(this.source,n.pos,n,"((<identifier> <value>)*)");const i=[],s=[],o=n.unwrap();for(const t of o){if(!R(t))throw new O(this.source,t.pos,t,"(<identifier> <value>)");if(2!==t.length())throw new O(this.source,t.location.start,t,"(<identifier> <value>)");const[e,n]=t.unwrap();if(!x(e))throw new O(this.source,e.location.start,e,"<identifier>");if(e.type!==T.IDENTIFIER)throw new O(this.source,e.pos,e,"<identifier>");i.push(new G.Identifier(this.toLocation(e),e.lexeme)),s.push(this.parseExpression(n))}const a=r.map(this.parseExpression.bind(this));if(a.length<1)throw new O(this.source,t.location.start,t,"(let ... <body>+)");if(1===a.length)return new $.Let(t.location,i,s,a[0]);const l=a.at(0).location.merge(a.at(-1).location),u=new G.Sequence(l,a);return new $.Let(t.location,i,s,u)}parseExtendedCond(t){if(this.chapter>=5){return t.unwrap().slice(1).forEach(t=>{this.parseExpression(t)}),new $.Cond(t.location,[],[],new G.Identifier(t.location,"undefined"))}if(t.length()<2)throw new O(this.source,t.location.start,t,"(cond (<pred> <body>*)* (else <val>)?)");const e=t.unwrap().splice(1),n=e.pop(),r=[],i=[];for(const t of e){if(!R(t))throw new O(this.source,t.pos,t,"(<pred> <body>*)");if(t.length()<1)throw new O(this.source,t.firstToken().pos,t.firstToken(),"(<pred> <body>*)");const[e,...n]=t.unwrap();if(x(e)&&e.type===T.ELSE)throw new O(this.source,e.pos,e,"<predicate>");const s=this.parseExpression(e),o=n.map(this.parseExpression.bind(this)),a=n.length<1?s.location:o.at(0).location.merge(o.at(-1).location),l=n.length<1?s:n.length<2?o[0]:new G.Sequence(a,o);r.push(s),i.push(l)}if(!R(n))throw new O(this.source,n.pos,n,"(<pred> <body>+) | (else <val>)");if(n.length()<2)throw new O(this.source,n.firstToken().pos,n.firstToken(),"(<pred> <body>+) | (else <val>)");const[s,...o]=n.unwrap();let a=!1;if(x(s)&&s.type===T.ELSE&&(a=!0,1!==o.length))throw new O(this.source,n.location.start,n,"(else <val>)");if(o.length<1)throw new O(this.source,n.location.start,n,"(<pred> <body>+)");const l=o.map(this.parseExpression.bind(this)),u=l.at(0).location.merge(l.at(-1).location),c=1===o.length?l[0]:new G.Sequence(u,l);if(a)return new $.Cond(t.location,r,i,c);const p=this.parseExpression(s);return r.push(p),i.push(c),new $.Cond(t.location,r,i)}parseSet(t){if(3!==t.length())throw new O(this.source,t.location.start,t,"(set! <identifier> <expr>)");const e=t.unwrap(),n=e[1],r=e[2];if(R(n))throw new O(this.source,n.location.start,n,"<identifier>");if(n.type!==T.IDENTIFIER)throw new O(this.source,n.pos,n,"<identifier>");const i=new G.Identifier(this.toLocation(n),n.lexeme),s=this.parseExpression(r);return new G.Reassignment(t.location,i,s)}parseBegin(t){if(t.length()<2)throw new O(this.source,t.location.start,t,"(begin <body>+)");const e=t.unwrap().slice(1),n=[];for(const t of e)n.push(this.parseExpression(t));return new $.Begin(t.location,n)}parseDelay(t){if(this.chapter>=5){return t.unwrap().slice(1).forEach(t=>{this.parseExpression(t)}),new $.Delay(t.location,new G.Identifier(t.location,"undefined"))}if(2!==t.length())throw new O(this.source,t.location.start,t,"(delay <expr>)");const e=t.unwrap()[1],n=this.parseExpression(e);return new $.Delay(t.location,n)}parseDefineSyntax(t){if(3!==t.length())throw new O(this.source,t.location.start,t,"(define-syntax <identifier> <transformer>)");const e=t.unwrap(),n=e[1],r=e[2];this.quoteMode=B.QUOTE;const i=this.parseExpression(n);if(this.quoteMode=B.NONE,!(i instanceof G.Symbol))throw new O(this.source,i.location.start,n,"<identifier>");if(!R(r))throw new O(this.source,r.pos,r,"<transformer>");if(r.length()<2)throw new O(this.source,r.firstToken().pos,r,"(syntax-rules ...)");const s=r.unwrap()[0];if(!x(r.unwrap()[0]))throw new O(this.source,r.firstToken().pos,s,"syntax-rules");if(s.type!==T.SYNTAX_RULES)throw new O(this.source,s.pos,s,"syntax-rules");const o=this.parseSyntaxRules(r);return new G.DefineSyntax(t.location,i,o)}isValidPattern(t){if(t instanceof $.List){if(void 0===t.terminator){if(t.elements.filter(t=>t instanceof G.Symbol&&"..."===t.value).length>1)return!1;const e=t.elements.findIndex(t=>t instanceof G.Symbol&&"..."===t.value);if(-1!=e&&0===e)return!1;for(const e of t.elements)if(!this.isValidPattern(e))return!1;return!0}{if(t.elements.filter(t=>t instanceof G.Symbol&&"..."===t.value).length>1)return!1;const e=t.elements.findIndex(t=>t instanceof G.Symbol&&"..."===t.value);if(-1!=e){if(0===e)return!1;if(e===t.elements.length-1)return!1}for(const e of t.elements)if(!this.isValidPattern(e))return!1;return this.isValidPattern(t.terminator)}}return t instanceof G.Symbol||t instanceof G.BooleanLiteral||t instanceof G.NumericLiteral||t instanceof G.StringLiteral||t instanceof G.Nil}isValidTemplate(t){if(t instanceof $.List){if(void 0===t.terminator){if(0===t.elements.length)return!1;if(2===t.elements.length&&t.elements[0]instanceof G.Symbol&&"..."===t.elements[0].value)return this.isValidTemplate(t.elements[1]);let e=!1;for(let n=0;n<t.elements.length;n++){const r=t.elements[n];if(r instanceof G.Symbol&&"..."===r.value){if(e){e=!1;continue}return!1}if(!this.isValidTemplate(r))return!1;e=!0}return!0}{if(0===t.elements.length)return!1;let e=!1;for(let n=0;n<t.elements.length;n++){const r=t.elements[n];if(r instanceof G.Symbol&&"..."===r.value){if(e){e=!1;continue}return!1}if(!this.isValidTemplate(r))return!1;e=!0}return this.isValidTemplate(t.terminator)}}return t instanceof G.Symbol||t instanceof G.BooleanLiteral||t instanceof G.NumericLiteral||t instanceof G.StringLiteral||t instanceof G.Nil}parseSyntaxRules(t){if(t.length()<3)throw new O(this.source,t.location.start,t,"(syntax-rules (<literal>*) <syntax-rule>+)");const e=t.unwrap(),n=e[1],r=e.slice(2),i=[];if(!R(n))throw new O(this.source,n.pos,n,"(<literal>*)");this.quoteMode=B.QUOTE;for(const t of n.unwrap()){if(!x(t))throw new O(this.source,t.location.start,t,"<literal>");const e=this.parseExpression(t);if(!(e instanceof G.Symbol))throw new O(this.source,t.pos,t,"<literal>");i.push(e)}const s=[];for(const t of r){if(!R(t))throw new O(this.source,t.pos,t,"(<pattern> <template>)");if(2!==t.length())throw new O(this.source,t.location.start,t,"(<pattern> <template>)");const[e,n]=t.unwrap(),r=this.parseExpression(e),i=this.parseExpression(n);if(!this.isValidPattern(r))throw new O(this.source,r.location.start,e,"<symbol> | <literal> | (<pattern>+) | (<pattern>+ ... <pattern>*) | (<pattern>+ ... <pattern>+ . <pattern>)");if(!this.isValidTemplate(i))throw new O(this.source,i.location.start,n,"<symbol> | <literal> | (<element>+) | (<element>+ . <template>) | (... <template>)");s.push([r,i])}return this.quoteMode=B.NONE,new G.SyntaxRules(t.location,i,s)}parseImport(t){if(3!==t.length())throw new O(this.source,t.firstToken().pos,t.firstToken(),'(import "<source>" (<identifier>*))');const e=t.unwrap(),n=e[1],r=e[2];if(!x(n))throw new O(this.source,n.location.start,n,'"<source>"');if(n.type!==T.STRING)throw new O(this.source,n.pos,n,'"<source>"');if(!R(r))throw new O(this.source,r.pos,r,"(<identifier>*)");const i=r.unwrap(),s=[];for(const t of i){if(!x(t))throw new O(this.source,t.location.start,t,"<identifier>");if(t.type!==T.IDENTIFIER)throw new O(this.source,t.pos,t,"<identifier>");s.push(new G.Identifier(this.toLocation(t),t.lexeme))}const o=new G.StringLiteral(this.toLocation(n),n.literal);return new G.Import(t.location,o,s)}parseExport(t){if(2!==t.length())throw new O(this.source,t.firstToken().pos,t.firstToken(),"(export (<definition>))");const e=t.unwrap()[1];if(!R(e))throw new O(this.source,e.pos,e,"(<definition>)");const n=this.parseExpression(e);if(!(n instanceof G.Definition||n instanceof $.FunctionDefinition))throw new O(this.source,e.location.start,e,"(<definition>)");return new G.Export(t.location,n)}parseVector(t){const e=t.unwrap()[1].unwrap().map(this.parseExpression.bind(this));return new G.Vector(t.location,e)}parse(t=!1){t&&(this.quoteMode=B.QUOTE,this.current=0);const e=[];for(;!this.isAtEnd()&&this.peek().type!==T.EOF;){const t=this.grouping();if(!t)continue;const n=this.parseExpression(t);e.push(n)}if(this.chapter>=5&&!t){return[...e.filter(t=>t instanceof G.Import),...this.parse(!0).filter(t=>!(t instanceof $.List&&t.elements&&t.elements[0]instanceof G.Symbol&&"import"===t.elements[0].value))]}return e}}class F{constructor(t,e,n,r,i){this.source=t,this.startLine=e,this.startColumn=n,this.endLine=r,this.endColumn=i}}class V{constructor(t,e,n){this.start=t,this.end=e,this.source=n}}class j{constructor(t,e){this.syntax=t,this.forInfo=e}locationToSrcLoc(){return new F(this.syntax.source,this.syntax.start.line,this.syntax.start.column,this.syntax.end.line,this.syntax.end.column)}toString(){return`${this.syntax.source}:${this.syntax.start.line}:${this.syntax.start.column}`}}function J(t){return new j(t.syntax,!1)}function z(t,e,n){return new Map([...t,[e,n]])}function Y(t,e){return e.valOf(Q(t))}function K(t){const e=new Map;for(const[n,r]of t)r instanceof it?e.set(n,["free",r.type.readBackType(t)]):r instanceof rt?e.set(n,["def",r.type.readBackType(t),At(t,r.type,r.value)]):r instanceof nt&&e.set(n,["claim",r.type.readBackType(t)]);return e}function W(t,e,n,r){const i=new Bn("typeOut");return Hn([[new Bn("_"),()=>function(t,e,n){return t.has(n)?new $n(e,new Un([`The name "${n}" is already in use in the context.`])):new Gn(!0)}(t,n,e)],[i,()=>r.isType(t,new Map)]],()=>new Gn(z(t,e,new nt(Y(t,i.value)))))}function X(t,e,n,r){const i=new Bn("typeOut"),s=new Bn("exprOut");return Hn([[i,()=>function(t,e,n){for(const[r,i]of t)if(r===n){if(i instanceof rt)return new $n(e,new Un([`The name "${n}" is already defined.`]));if(i instanceof nt)return new Gn(i.type)}return new $n(e,new Un([`No claim: ${n}`]))}(t,n,e)],[s,()=>r.check(t,new Map,i.value)]],()=>new Gn(function(t,e,n,r){return z(t,e,new rt(n,r))}(function(t,e){return t.delete(e),t}(t,e),e,i.value,Y(t,s.value))))}function Q(t){if(0===t.size)return new Map;const e=t.entries(),n=new Map;for(const[t,r]of e)r instanceof rt?n.set(t,r.value):r instanceof it?n.set(t,new Ee(r.type,new St(t))):r instanceof st&&n.set(t,r.type);return n}function Z(t,e,n){for(const[e,r]of t)if(r instanceof st&&e===n)return new Gn(r);return new $n(e,new Un([`No inductive type found for ${n} at ${e}`]))}const tt=new Map;class et{}let nt=class extends et{constructor(t){super(),this.type=t}};class rt extends et{constructor(t,e){super(),this.type=t,this.value=e}}class it extends et{constructor(t){super(),this.type=t}}class st extends et{constructor(t,e){super(),this.name=t,this.type=e}}class ot extends et{constructor(t,e,n){super(),this.name=t,this.constructorType=e,this.type=n}}function at(t,e,n){if(0===t.size)throw new Error(`The context ${JSON.stringify(t)} is empty, but we are looking for ${n}`);for(const[e,r]of t.entries())if(!(r instanceof nt)&&n===e)return new Gn(r instanceof st?new Te:r.type);throw new Error(`Unknown variable ${n}`)}function lt(t,e,n){if(t.has(e)){for(const[r]of t)if(r===e)return z(t,e,new it(n));throw new Error(`\n      ${e} is already bound in ${JSON.stringify(t)}\n    `)}return z(t,e,new it(n))}function ut(t,e,n){return new Map([...t,[e,n]])}function ct(t,e){const n=t.now();if(n instanceof oe)return n.body.valOfClosure(e);if(n instanceof Ee){const t=n.type.now();if(t instanceof se)return new Ee(t.resultType.valOfClosure(e),new Wt(n.neutral,new Nt(t.argType,e)))}throw new Error(`doApp: invalid input ${[n,e.now()]}`)}function pt(t,e,n,r){const i=t.now();if(i instanceof re)return n;if(i instanceof ie)return ct(r,pt(i.smaller,e,n,r));if(i instanceof Ee){if(i.type.now()instanceof ne)return new Ee(e,new Pt(i.neutral,new Nt(e,n),new Nt(new se("n",new ne,new jn(t=>e)),r)))}throw new Error(`invalid input for iterNat ${[t,e,n,r]}`)}function ht(t,e,n,r){const i=t.now();if(i instanceof re)return n;if(i instanceof ie)return ct(ct(r,i.smaller),ht(i.smaller,e,n,r));if(i instanceof Ee){if(i.type.now()instanceof ne)return new Ee(e,new Ct(i.neutral,new Nt(e,n),new Nt(new se("n-1",new ne,new jn(t=>new se("ih",e,new jn(t=>e)))),r)))}throw new Error(`invalid input for recNat ${[t,e,n,r]}`)}function dt(t,e,n,r){const i=t.now();if(i instanceof re)return n;if(i instanceof ie)return ct(ct(r,i.smaller),dt(i.smaller,e,n,r));if(i instanceof Ee){if(i.type.now()instanceof ne)return new Ee(ct(e,t),new xt(i.neutral,new Nt(new se("x",new ne,new jn(t=>new Te)),e),new Nt(ct(e,new re),n),new Nt(new se("n-1",new ne,new jn(t=>new se("ih",ct(e,t),new jn(n=>ct(e,new ie(t)))))),r)))}throw new Error(`invalid input for indNat ${[t,e,n,r]}`)}function ft(t){const e=t.now();if(e instanceof le)return e.car;if(e instanceof Ee){const t=e.type.now();if(t instanceof ae){const n=t,r=e.neutral;return new Ee(n.carType,new Rt(r))}}throw new Error(`invalid input for car ${t}`)}function mt(t){const e=t.now();if(e instanceof le)return e.cdr;if(e instanceof Ee){const n=e.type.now();if(n instanceof ae){const r=n,i=e.neutral;return new Ee(r.cdrType.valOfClosure(ft(t)),new kt(i))}}throw new Error(`invalid input for cdr ${t}`)}function yt(t,e,n,r){const i=t.now();if(i instanceof ce)return n;if(i instanceof pe)return ct(ct(ct(r,i.head),i.tail),yt(i.tail,e,n,r));if(i instanceof Ee){const s=i.type.now();if(s instanceof ue){const o=s.entryType,a=i.neutral,l=new se("xs",new ue(o),new jn(t=>new Te));return new Ee(ct(e,t),new Lt(a,new Nt(l,e),new Nt(ct(e,new ce),n),new Nt(new se("h",o,new jn(t=>new se("t",new ue(o),new jn(n=>new se("ih",ct(e,n),new jn(r=>ct(e,new pe(t,n)))))))),r)))}}throw new Error(`invalid input for indList ${[i,e,n,r]}`)}function gt(t,e,n,r){const i=t.now();if(i instanceof ce)return n;if(i instanceof pe){const t=i.head,s=i.tail;return ct(ct(ct(r,t),s),gt(s,e,n,r))}if(i instanceof Ee){const t=i.type.now();if(t instanceof ue){const s=t.entryType,o=i.neutral;return new Ee(e,new Mt(o,new Nt(e,n),new Nt(new se("h",s,new jn(t=>new se("t",new ue(s),new jn(t=>new se("ih",e,new jn(t=>e)))))),r)))}}throw new Error(`invalid input for recList ${[i,e,n,r]}`)}function wt(t){const e=t.now();if(e instanceof ye)return e.tail;if(e instanceof Ee&&e.type.now()instanceof fe&&e.type.now().length.now()instanceof ie){const t=e.type.now();if(t instanceof fe){if(t.length.now()instanceof ie)return new Ee(new fe(e.type.now().entryType,e.type.now().length.now().smaller),new jt(e.neutral))}}throw new Error(`invalid input for tail ${t.prettyPrint()}`)}function vt(t,e){return new se("k",new ne,new jn(n=>new se("e",t,new jn(r=>new se("es",new fe(t,n),new jn(t=>new se("ih",ct(ct(e,n),t),new jn(i=>ct(ct(e,new ie(n)),new ye(r,t))))))))))}function Et(t,e,n,r,i){const s=t.now(),o=e.now();if(s instanceof re&&o instanceof me)return r;if(s instanceof ie&&o instanceof ye)return ct(ct(ct(ct(i,s.smaller),o.head),wt(e)),Et(s.smaller,o.tail,n,r,i));if(s instanceof Ee&&o instanceof Ee&&s.type.now()instanceof ne&&o.type.now()instanceof fe){const a=o.type.now().entryType;return new Ee(ct(ct(n,t),e),new zt(s.neutral,o.neutral,new Nt(new se("k",new ne,new jn(t=>new se("es",new fe(a,t),new jn(t=>new Te)))),n),new Nt(ct(ct(n,new re),new me),r),new Nt(vt(o.type.now().entryType,n),i)))}if(It(s,t)&&o instanceof Ee&&o.type.now()instanceof fe){const s=o.type.now().entryType;return new Ee(ct(ct(n,t),e),new Jt(new Nt(new ne,t),o.neutral,new Nt(new se("k",new ne,new jn(t=>new se("es",new fe(s,t),new jn(t=>new Te)))),n),new Nt(ct(ct(n,new ne),new me),r),new Nt(vt(s,n),i)))}throw new Error(`invalid input for indVec ${[t,e,n,r,i]}`)}function Tt(t,e,n,r,i,s){const o=e.now();if(o instanceof _e){if(o.type!=t)throw new Error(`doEliminator: wrong eliminator used. Got constructor of type: ${o.type}; Expected: ${t}`);const e=o.index;if(e>=0&&e<r.length){let a=r[e];for(let t=0;t<o.args.length;t++){a=ct(a,o.args[t].now())}for(let e=0;e<o.recursive_args.length;e++){const l=o.recursive_args[e].now();a=ct(a,l);a=ct(a,Tt(t,l,n,r,i,s))}return a}}else if(o instanceof Ee){const a=o.type.now();if(a instanceof Se&&a.name===t)return new Ee(ct(n,e),new Kt(t,o.neutral,new Nt(s||new se("x",a,new jn(t=>new Te)),n),r.map((t,e)=>new Nt(i&&i[e]?i[e]:a,t))))}throw new Error(`doEliminator: invalid input for ${t}: ${[e,n,r]}`)}function It(t,e){const n=t.now(),r=e.now();return n instanceof re&&r instanceof re||n instanceof ie&&r instanceof ie&&It(n.smaller,r.smaller)}function At(t,e,n){const r=e.now(),i=n.now();if(r instanceof Te)return n.readBackType(t);if(r instanceof ne&&i instanceof re)return new Me;if(r instanceof ne&&i instanceof ie)return new Le(At(t,new ne,i.smaller));if(r instanceof se){const e=Yn(t,i instanceof oe?i.argName:r.argName);return new Be(e,At(lt(t,e,r.argType),r.resultType.valOfClosure(new Ee(r.argType,new St(e))),ct(i,new Ee(r.argType,new St(e)))))}if(r instanceof ae){const e=ft(n),i=mt(n);return new je(At(t,r.carType,e),At(t,r.cdrType.valOfClosure(e),i))}if(r instanceof Ie&&i instanceof ee)return new Fe(i.name);if(r instanceof Ae)return new tn;if(r instanceof ue&&i instanceof ce)return new Ke;if(r instanceof ue&&i instanceof pe)return new je(At(t,r.entryType,i.head),At(t,new ue(r.entryType),i.tail));if(r instanceof be&&i instanceof Ee)return new xe(new en,i.neutral.readBackNeutral(t));if(r instanceof he&&i instanceof de)return new sn(At(t,r.type,i.value));if(r instanceof fe&&r.length.now()instanceof re&&i instanceof me)return new dn;if(r instanceof fe&&r.length.now()instanceof ie&&i instanceof ye)return r.length.now(),new hn(At(t,r.entryType,i.head),At(t,new fe(r.entryType,r.length.now().smaller),i.tail));if(r instanceof ge&&i instanceof we)return new wn(At(t,r.leftType,i.value));if(r instanceof ge&&i instanceof ve)return new vn(At(t,r.rightType,i.value));if(r instanceof Se&&i instanceof _e){let e;for(const[n,r]of t)if(n===i.name&&r instanceof ot){e=r;break}if(!e)throw new Error(`Constructor ${i.name} not found in context`);const n=e.constructorType,s=n.resultType;let o=Q(t);for(let t=0;t<s.parameters.length;t++){const e=s.parameters[t];if(e instanceof An){o=ut(o,e.name,r.parameters[t].now())}}for(let t=0;t<s.indices.length;t++){const e=s.indices[t];if(e instanceof An){o=ut(o,e.name,r.indices[t].now())}}const a=e.type,l=[];a.indices.forEach(t=>{l.push(...Xn(t))});const u=[];for(let e=0;e<i.args.length;e++){const r=At(t,n.argTypes[e].valOf(o).now(),i.args[e]);if(u.push(r),e<l.length){o=ut(o,l[e],i.args[e].now())}}const c=[],p=i.args.length;for(let e=0;e<i.recursive_args.length;e++){const r=At(t,n.rec_argTypes[e].valOf(o).now(),i.recursive_args[e]);c.push(r);const s=p+e;if(s<l.length){o=ut(o,l[s],i.recursive_args[e].now())}}return new Sn(i.name,i.index,i.type,u,c)}if(i instanceof Ee)return i.neutral.readBackNeutral(t);throw new Error(`Cannot read back ${i.prettyPrint()} : ${r.prettyPrint()}`)}class Nt{constructor(t,e){this.type=t,this.value=e}}let bt=class{constructor(){}toString(){return this.prettyPrint()}};class St extends bt{constructor(t){super(),this.name=t}readBackNeutral(t){return new An(this.name)}prettyPrint(){return`N-${this.name}`}}let Ot=class extends bt{constructor(t,e){super(),this.where=t,this.type=e}readBackNeutral(t){return new Tn(this.where,this.type.readBackType(t))}prettyPrint(){return"N-TODO"}},_t=class extends bt{constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}readBackNeutral(t){return new De(this.target.readBackNeutral(t),new xe(this.base.type.readBackType(t),At(t,this.base.type,this.base.value)),At(t,this.step.type,this.step.value))}prettyPrint(){return"N-WhichNat"}},Pt=class extends bt{constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}readBackNeutral(t){return new Ue(this.target.readBackNeutral(t),new xe(this.base.type.readBackType(t),At(t,this.base.type,this.base.value)),At(t,this.step.type,this.step.value))}prettyPrint(){return"N-IterNat"}},Ct=class extends bt{constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}readBackNeutral(t){return new qe(this.target.readBackNeutral(t),new xe(this.base.type.readBackType(t),At(t,this.base.type,this.base.value)),At(t,this.step.type,this.step.value))}prettyPrint(){return"N-RecNat"}},xt=class extends bt{constructor(t,e,n,r){super(),this.target=t,this.motive=e,this.base=n,this.step=r}readBackNeutral(t){return new Ge(this.target.readBackNeutral(t),At(t,this.motive.type,this.motive.value),At(t,this.base.type,this.base.value),At(t,this.step.type,this.step.value))}prettyPrint(){return"N-IndNat"}},Rt=class extends bt{constructor(t){super(),this.target=t}readBackNeutral(t){return new Je(this.target.readBackNeutral(t))}prettyPrint(){return"N-Car"}},kt=class extends bt{constructor(t){super(),this.target=t}readBackNeutral(t){return new ze(this.target.readBackNeutral(t))}prettyPrint(){return"N-Cdr"}},Mt=class extends bt{constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}readBackNeutral(t){return new Xe(this.target.readBackNeutral(t),new xe(this.base.type.readBackType(t),At(t,this.base.type,this.base.value)),At(t,this.step.type,this.step.value))}prettyPrint(){return"N-RecList"}},Lt=class extends bt{constructor(t,e,n,r){super(),this.target=t,this.motive=e,this.base=n,this.step=r}readBackNeutral(t){return new Qe(this.target.readBackNeutral(t),At(t,this.motive.type,this.motive.value),At(t,this.base.type,this.base.value),At(t,this.step.type,this.step.value))}prettyPrint(){return"N-IndList"}},Dt=class extends bt{constructor(t,e){super(),this.target=t,this.motive=e}readBackNeutral(t){return new nn(new xe(new en,this.target.readBackNeutral(t)),At(t,this.motive.type,this.motive.value))}prettyPrint(){return"N-IndAbsurd"}},Ut=class extends bt{constructor(t,e,n){super(),this.target=t,this.motive=e,this.base=n}readBackNeutral(t){return new on(this.target.readBackNeutral(t),At(t,this.motive.type,this.motive.value),At(t,this.base.type,this.base.value))}prettyPrint(){return"N-Replace"}};class qt extends bt{constructor(t,e){super(),this.target1=t,this.target2=e}readBackNeutral(t){return new an(this.target1.readBackNeutral(t),At(t,this.target2.type,this.target2.value))}prettyPrint(){return"N-Trans1"}}class Gt extends bt{constructor(t,e){super(),this.target1=t,this.target2=e}readBackNeutral(t){return new an(At(t,this.target1.type,this.target1.value),this.target2.readBackNeutral(t))}prettyPrint(){return"N-Trans2"}}class $t extends bt{constructor(t,e){super(),this.target1=t,this.target2=e}readBackNeutral(t){return new an(this.target1.readBackNeutral(t),this.target2.readBackNeutral(t))}prettyPrint(){return"N-Trans12"}}let Bt=class extends bt{constructor(t,e){super(),this.target=t,this.func=e}readBackNeutral(t){const e=this.func.type;if(e instanceof se){const n=e.resultType;return new ln(this.target.readBackNeutral(t),n.valOfClosure(new be).readBackType(t),At(t,this.func.type,this.func.value))}throw new Error("Cong applied to non-Pi type.")}prettyPrint(){return"N-Cong"}},Ht=class extends bt{constructor(t){super(),this.target=t}readBackNeutral(t){return new un(this.target.readBackNeutral(t))}prettyPrint(){return"N-Symm"}},Ft=class extends bt{constructor(t,e,n){super(),this.target=t,this.motive=e,this.base=n}readBackNeutral(t){return new cn(this.target.readBackNeutral(t),At(t,this.motive.type,this.motive.value),At(t,this.base.type,this.base.value))}prettyPrint(){return"N-IndEqual"}},Vt=class extends bt{constructor(t){super(),this.target=t}readBackNeutral(t){return new fn(this.target.readBackNeutral(t))}prettyPrint(){return"N-Head"}},jt=class extends bt{constructor(t){super(),this.target=t}readBackNeutral(t){return new mn(this.target.readBackNeutral(t))}prettyPrint(){return"N-Tail"}};class Jt extends bt{constructor(t,e,n,r,i){super(),this.length=t,this.target=e,this.motive=n,this.base=r,this.step=i}readBackNeutral(t){return new yn(At(t,this.length.type,this.length.value),this.target.readBackNeutral(t),At(t,this.motive.type,this.motive.value),At(t,this.base.type,this.base.value),At(t,this.step.type,this.step.value))}prettyPrint(){return"N-IndVec2"}}class zt extends bt{constructor(t,e,n,r,i){super(),this.length=t,this.target=e,this.motive=n,this.base=r,this.step=i}readBackNeutral(t){return new yn(this.length.readBackNeutral(t),this.target.readBackNeutral(t),At(t,this.motive.type,this.motive.value),At(t,this.base.type,this.base.value),At(t,this.step.type,this.step.value))}prettyPrint(){return"N-IndVec12"}}let Yt=class extends bt{constructor(t,e,n,r){super(),this.target=t,this.motive=e,this.baseLeft=n,this.baseRight=r}readBackNeutral(t){return new En(this.target.readBackNeutral(t),At(t,this.motive.type,this.motive.value),At(t,this.baseLeft.type,this.baseLeft.value),At(t,this.baseRight.type,this.baseRight.value))}prettyPrint(){return"N-IndEither"}};class Kt extends bt{constructor(t,e,n,r){super(),this.typeName=t,this.target=e,this.motive=n,this.methods=r}readBackNeutral(t){return new _n(this.typeName,this.target.readBackNeutral(t),At(t,this.motive.type,this.motive.value),this.methods.map(e=>At(t,e.type,e.value)))}prettyPrint(){return`N-GenericEliminator-${this.typeName}`}}let Wt=class extends bt{constructor(t,e){super(),this.operator=t,this.operand=e}readBackNeutral(t){return new In(this.operator.readBackNeutral(t),At(t,this.operand.type,this.operand.value))}prettyPrint(){return"N-Application"}};class Xt{now(){return this}}class Qt{constructor(t,e){this.env=t,this.expr=e}undelay(){return this.expr.valOf(this.env).now()}toString(){return`DelayClosure(${this.env}, ${this.expr})`}}class Zt{constructor(t){this.content=t}get(){return this.content}set(t){this.content=t}}class te extends Xt{constructor(t){super(),this.val=t}now(){const t=this.val.get();if(t instanceof Qt){const e=t.undelay();return this.val.set(e),e}return t}readBackType(t){return this.now().readBackType(t)}prettyPrint(){return this.now().prettyPrint()}toString(){return`Delay(${this.val})`}}let ee=class extends Xt{constructor(t){super(),this.name=t}readBackType(t){throw new Error("No readBackType for Quote.")}prettyPrint(){return`'${this.name}`}toString(){return this.prettyPrint()}},ne=class extends Xt{constructor(){super()}readBackType(t){return new ke}prettyPrint(){return"Nat"}toString(){return this.prettyPrint()}},re=class extends Xt{constructor(){super()}readBackType(t){throw new Error("No readBackType for Zero.")}prettyPrint(){return"zero"}toString(){return this.prettyPrint()}},ie=class extends Xt{constructor(t){super(),this.smaller=t}readBackType(t){throw new Error("No readBackType for Add1.")}prettyPrint(){return`(add1 ${this.smaller.prettyPrint()})`}toString(){return this.prettyPrint()}},se=class extends Xt{constructor(t,e,n){super(),this.argName=t,this.argType=e,this.resultType=n}readBackType(t){const e=this.argType.readBackType(t),n=Yn(t,this.argName),r=lt(t,n,this.argType);return new $e(n,e,this.resultType.valOfClosure(new Ee(this.argType,new St(n))).readBackType(r))}prettyPrint(){return`(ฮ ${this.argName} ${this.argType.prettyPrint()} ${this.resultType.prettyPrint()})`}toString(){return this.prettyPrint()}},oe=class extends Xt{constructor(t,e){super(),this.argName=t,this.body=e}readBackType(t){throw new Error("No readBackType for Lambda.")}prettyPrint(){return`(lambda ${this.argName} ${this.body.prettyPrint()})`}toString(){return this.prettyPrint()}},ae=class extends Xt{constructor(t,e,n){super(),this.carName=t,this.carType=e,this.cdrType=n}readBackType(t){const e=this.carType.readBackType(t),n=Yn(t,this.carName),r=lt(t,n,this.carType);return new Ve(n,e,this.cdrType.valOfClosure(new Ee(this.carType,new St(n))).readBackType(r))}prettyPrint(){return`(ฮฃ ${this.carName} ${this.carType.prettyPrint()} ${this.cdrType.prettyPrint()})`}toString(){return this.prettyPrint()}},le=class extends Xt{constructor(t,e){super(),this.car=t,this.cdr=e}readBackType(t){throw new Error("No readBackType for Cons.")}prettyPrint(){return`(cons ${this.car.prettyPrint()} ${this.cdr.prettyPrint()})`}toString(){return this.prettyPrint()}},ue=class extends Xt{constructor(t){super(),this.entryType=t}readBackType(t){return new We(this.entryType.readBackType(t))}prettyPrint(){return`(List ${this.entryType.prettyPrint()})`}toString(){return this.prettyPrint()}},ce=class extends Xt{constructor(){super()}readBackType(t){throw new Error("No readBackType for Nil.")}prettyPrint(){return"nil"}toString(){return this.prettyPrint()}},pe=class extends Xt{constructor(t,e){super(),this.head=t,this.tail=e}readBackType(t){throw new Error("No readBackType for ListCons.")}prettyPrint(){return`(:: ${this.head.prettyPrint()} ${this.tail.prettyPrint()})`}toString(){return this.prettyPrint()}},he=class extends Xt{constructor(t,e,n){super(),this.type=t,this.from=e,this.to=n}readBackType(t){return new rn(this.type.readBackType(t),At(t,this.type,this.from),At(t,this.type,this.to))}prettyPrint(){return`(= ${this.type.prettyPrint()} ${this.from.prettyPrint()} ${this.to.prettyPrint()})`}toString(){return this.prettyPrint()}},de=class extends Xt{constructor(t){super(),this.value=t}readBackType(t){throw new Error("No readBackType for Same.")}prettyPrint(){return`(same ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}},fe=class extends Xt{constructor(t,e){super(),this.entryType=t,this.length=e}readBackType(t){return new pn(this.entryType.readBackType(t),At(t,new ne,this.length))}prettyPrint(){return`(Vec ${this.entryType.prettyPrint()} ${this.length.prettyPrint()})`}},me=class extends Xt{constructor(){super()}readBackType(t){throw new Error("No readBackType for VecNil.")}prettyPrint(){return"vecnil"}toString(){return this.prettyPrint()}},ye=class extends Xt{constructor(t,e){super(),this.head=t,this.tail=e}readBackType(t){throw new Error("No readBackType for VecCons.")}prettyPrint(){return`(vec:: ${this.head.prettyPrint()} ${this.tail.prettyPrint()})`}toString(){return this.prettyPrint()}},ge=class extends Xt{constructor(t,e){super(),this.leftType=t,this.rightType=e}readBackType(t){return new gn(this.leftType.readBackType(t),this.rightType.readBackType(t))}prettyPrint(){return`(Either ${this.leftType.prettyPrint()} ${this.rightType.prettyPrint()})`}toString(){return this.prettyPrint()}},we=class extends Xt{constructor(t){super(),this.value=t}readBackType(t){throw new Error("No readBackType for Left.")}prettyPrint(){return`(left ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}},ve=class extends Xt{constructor(t){super(),this.value=t}readBackType(t){throw new Error("No readBackType for Right.")}prettyPrint(){return`(right ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}};class Ee extends Xt{constructor(t,e){super(),this.type=t,this.neutral=e}readBackType(t){return this.neutral.readBackNeutral(t)}prettyPrint(){return`(Neutral ${this.type.prettyPrint()} ${this.neutral.prettyPrint()})`}toString(){return this.prettyPrint()}}let Te=class extends Xt{constructor(){super()}readBackType(t){return new Re}prettyPrint(){return"U"}toString(){return this.prettyPrint()}},Ie=class extends Xt{constructor(){super()}readBackType(t){return new He}prettyPrint(){return"Atom"}toString(){return this.prettyPrint()}},Ae=class extends Xt{constructor(){super()}readBackType(t){return new Ze}prettyPrint(){return"Trivial"}toString(){return this.prettyPrint()}},Ne=class extends Xt{constructor(){super()}readBackType(t){throw new Error("No readBackType for Sole.")}prettyPrint(){return"sole"}toString(){return this.prettyPrint()}},be=class extends Xt{constructor(){super()}readBackType(t){return new en}prettyPrint(){return"Absurd"}toString(){return this.prettyPrint()}},Se=class extends Xt{constructor(t,e,n){super(),this.name=t,this.parameters=e,this.indices=n}readBackType(t){return new Nn(this.name,this.parameters.map(e=>e.readBackType(t)),this.indices.map(e=>{if(!(e instanceof te)){const n=e.now();return n instanceof Ee?n.neutral.readBackNeutral(t):At(t,new ne,n)}{const n=e.val.get();if(!(n instanceof Qt)){const e=n;return e instanceof Ee?e.neutral.readBackNeutral(t):At(t,new ne,e)}try{const n=e.now();return n instanceof Ee?n.neutral.readBackNeutral(t):At(t,new ne,n)}catch(t){return n.expr}}}))}prettyPrint(){return`InductiveType ${this.name}`}toString(){return this.prettyPrint()}},Oe=class extends Xt{constructor(t,e,n){super(),this.name=t,this.parameterTypes=e,this.indexTypes=n}readBackType(t){return new bn(this.name,this.parameterTypes.map(e=>e.readBackType(t)),this.indexTypes.map(e=>e.readBackType(t)))}prettyPrint(){return`InductiveType ${this.name}`}toString(){return this.prettyPrint()}},_e=class extends Xt{constructor(t,e,n,r,i){super(),this.name=t,this.type=e,this.args=n,this.index=r,this.recursive_args=i}readBackType(t){throw new Error("No readBackType for Constructor.")}prettyPrint(){const t=this.args.map(t=>t.prettyPrint()).join(" ");return`(${this.name}${t.length>0?" "+t:""})`}toString(){return this.prettyPrint()}},Pe=class extends Xt{constructor(t,e,n,r,i,s,o=0,a=[]){super(),this.name=t,this.index=e,this.type=n,this.argTypes=r,this.rec_argTypes=i,this.resultType=s,this.numTypeParams=o,this.argNames=a}readBackType(t){throw Error("Method not implemented")}prettyPrint(){return`ConstructorType (${this.argTypes.map(t=>t.prettyPrint()).join(" ")})`}};class Ce{toLazy(t){return new te(new Zt(new Qt(t,this)))}}let xe=class extends Ce{constructor(t,e){super(),this.type=t,this.expr=e}valOf(t){return this.expr.valOf(t)}prettyPrint(){return`(the ${this.type.prettyPrint()} ${this.expr.prettyPrint()})`}toString(){return this.prettyPrint()}},Re=class extends Ce{valOf(t){return new Te}prettyPrint(){return"U"}toString(){return this.prettyPrint()}},ke=class extends Ce{valOf(t){return new ne}prettyPrint(){return"Nat"}toString(){return this.prettyPrint()}},Me=class extends Ce{valOf(t){return new re}prettyPrint(){return"0"}toString(){return this.prettyPrint()}},Le=class extends Ce{constructor(t){super(),this.n=t}valOf(t){return new ie(this.n.toLazy(t))}prettyPrint(){const t=Number(this.n.prettyPrint());return isNaN(t)?`(add1 ${this.n.prettyPrint()})`:`${t+1}`}toString(){return this.prettyPrint()}},De=class extends Ce{constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}valOf(t){return function(t,e,n,r){const i=t.now();if(i instanceof re)return n;if(i instanceof ie)return ct(r,i.smaller);if(i instanceof Ee&&i.type.now()instanceof ne)return new Ee(e,new _t(i.neutral,new Nt(e,n),new Nt(new se("n",new ne,new jn(t=>e)),r)));throw new Error(`invalid input for whichNat ${[t,e,n,r]}`)}(this.target.toLazy(t),this.base.type.toLazy(t),this.base.expr.toLazy(t),this.step.toLazy(t))}prettyPrint(){return`(which-Nat ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}},Ue=class extends Ce{constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}valOf(t){return pt(this.target.toLazy(t),this.base.type.toLazy(t),this.base.expr.toLazy(t),this.step.toLazy(t))}prettyPrint(){return`(iter-Nat ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}},qe=class extends Ce{constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}valOf(t){return ht(this.target.toLazy(t),this.base.type.toLazy(t),this.base.expr.toLazy(t),this.step.toLazy(t))}prettyPrint(){return`(rec-Nat ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}},Ge=class extends Ce{constructor(t,e,n,r){super(),this.target=t,this.motive=e,this.base=n,this.step=r}valOf(t){return dt(this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t),this.step.toLazy(t))}prettyPrint(){return`(ind-Nat ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}},$e=class extends Ce{constructor(t,e,n){super(),this.name=t,this.type=e,this.body=n}valOf(t){const e=this.type.toLazy(t);return new se(this.name,e,new Vn(t,this.name,this.body))}prettyPrint(){return`(ฮ (${this.name} ${this.type.prettyPrint()}) \n          ${this.body.prettyPrint()})`}toString(){return this.prettyPrint()}},Be=class extends Ce{constructor(t,e){super(),this.param=t,this.body=e}valOf(t){return new oe(this.param,new Vn(t,this.param,this.body))}prettyPrint(){return`(ฮป (${this.param}) ${this.body.prettyPrint()})`}toString(){return this.prettyPrint()}},He=class extends Ce{valOf(t){return new Ie}prettyPrint(){return"Atom"}toString(){return this.prettyPrint()}},Fe=class extends Ce{constructor(t){super(),this.sym=t}valOf(t){return new ee(this.sym)}prettyPrint(){return`'${this.sym}`}toString(){return this.prettyPrint()}},Ve=class extends Ce{constructor(t,e,n){super(),this.name=t,this.type=e,this.body=n}valOf(t){const e=this.type.toLazy(t);return new ae(this.name,e,new Vn(t,this.name,this.body))}prettyPrint(){return`(ฮฃ (${this.name} ${this.type.prettyPrint()}) \n              ${this.body.prettyPrint()})`}toString(){return this.prettyPrint()}},je=class extends Ce{constructor(t,e){super(),this.first=t,this.second=e}valOf(t){const e=this.first.toLazy(t),n=this.second.toLazy(t);return new le(e,n)}prettyPrint(){return`(cons ${this.first.prettyPrint()} ${this.second.prettyPrint()})`}toString(){return this.prettyPrint()}},Je=class extends Ce{constructor(t){super(),this.pair=t}valOf(t){return ft(this.pair.toLazy(t))}prettyPrint(){return`(car ${this.pair.prettyPrint()})`}toString(){return this.prettyPrint()}},ze=class extends Ce{constructor(t){super(),this.pair=t}valOf(t){return mt(this.pair.toLazy(t))}prettyPrint(){return`(cdr ${this.pair.prettyPrint()})`}toString(){return this.prettyPrint()}},Ye=class extends Ce{constructor(t,e){super(),this.head=t,this.tail=e}valOf(t){const e=this.head.toLazy(t),n=this.tail.toLazy(t);return new pe(e,n)}prettyPrint(){return`(:: ${this.head.prettyPrint()} ${this.tail.prettyPrint()})`}toString(){return this.prettyPrint()}},Ke=class extends Ce{valOf(t){return new ce}prettyPrint(){return"nil"}toString(){return this.prettyPrint()}},We=class extends Ce{constructor(t){super(),this.elemType=t}valOf(t){return new ue(this.elemType.toLazy(t))}prettyPrint(){return`(List ${this.elemType.prettyPrint()})`}toString(){return this.prettyPrint()}},Xe=class extends Ce{constructor(t,e,n){super(),this.target=t,this.base=e,this.step=n}valOf(t){return gt(this.target.toLazy(t),this.base.type.toLazy(t),this.base.expr.toLazy(t),this.step.toLazy(t))}prettyPrint(){return`(rec-List ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}},Qe=class extends Ce{constructor(t,e,n,r){super(),this.target=t,this.motive=e,this.base=n,this.step=r}valOf(t){return yt(this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t),this.step.toLazy(t))}prettyPrint(){return`(ind-List ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}},Ze=class extends Ce{valOf(t){return new Ae}prettyPrint(){return"Trivial"}toString(){return this.prettyPrint()}},tn=class extends Ce{valOf(t){return new Ne}prettyPrint(){return"sole"}toString(){return this.prettyPrint()}},en=class extends Ce{valOf(t){return new be}prettyPrint(){return"Absurd"}toString(){return this.prettyPrint()}},nn=class extends Ce{constructor(t,e){super(),this.target=t,this.motive=e}valOf(t){return function(t,e){const n=t.now();if(n instanceof Ee&&n.type.now()instanceof be)return new Ee(e,new Dt(n.neutral,new Nt(new Te,e)));throw new Error(`invalid input for indAbsurd ${[t,e]}`)}(this.target.toLazy(t),this.motive.toLazy(t))}prettyPrint(){return`(ind-Absurd \n              ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()})`}toString(){return this.prettyPrint()}},rn=class extends Ce{constructor(t,e,n){super(),this.type=t,this.left=e,this.right=n}valOf(t){return new he(this.type.toLazy(t),this.left.toLazy(t),this.right.toLazy(t))}prettyPrint(){return`(= ${this.type.prettyPrint()} \n              ${this.left.prettyPrint()} \n              ${this.right.prettyPrint()})`}toString(){return this.prettyPrint()}},sn=class extends Ce{constructor(t){super(),this.type=t}valOf(t){return new de(this.type.toLazy(t))}prettyPrint(){return`(same ${this.type.prettyPrint()})`}toString(){return this.prettyPrint()}},on=class extends Ce{constructor(t,e,n){super(),this.target=t,this.motive=e,this.base=n}valOf(t){return function(t,e,n){const r=t.now();if(r instanceof de)return n;if(r instanceof Ee){const t=r.type.now();if(t instanceof he){const i=r.neutral,s=t.type,o=t.from,a=t.to;return new Ee(ct(e,a),new Ut(i,new Nt(new se("x",s,new jn(t=>new Te)),e),new Nt(ct(e,o),n)))}}throw new Error(`invalid input for replace ${[t,e,n]}`)}(this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t))}prettyPrint(){return`(replace ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()})`}toString(){return this.prettyPrint()}},an=class extends Ce{constructor(t,e){super(),this.left=t,this.right=e}valOf(t){return function(t,e){const n=t.now(),r=e.now();if(n instanceof de&&r instanceof de)return new de(n.value);if(n instanceof de&&r instanceof Ee){const t=r.type.now();if(t instanceof he){const e=n.value,i=t.to,s=t.type,o=r.neutral;return new Ee(new he(s,e,i),new Gt(new Nt(new he(s,e,e),new de(e)),o))}}else if(n instanceof Ee&&r instanceof de){const t=n.type.now();if(t instanceof he){const e=t.from,i=r.value,s=t.type,o=n.neutral;return new Ee(new he(s,e,i),new qt(o,new Nt(new he(s,i,i),new de(i))))}}else if(n instanceof Ee&&r instanceof Ee){const t=n.type.now(),e=r.type.now();if(t instanceof he&&e instanceof he){const i=t.from,s=e.to,o=t.type,a=n.neutral,l=r.neutral;return new Ee(new he(o,i,s),new $t(a,l))}}throw new Error(`invalid input for do-trans: ${[t,e]}`)}(this.left.toLazy(t),this.right.toLazy(t))}prettyPrint(){return`(trans ${this.left.prettyPrint()} ${this.right.prettyPrint()})`}toString(){return this.prettyPrint()}},ln=class extends Ce{constructor(t,e,n){super(),this.target=t,this.base=e,this.fun=n}valOf(t){return function(t,e,n){const r=t.now();if(r instanceof de)return new de(ct(n,r.value));if(r instanceof Ee){const t=r.type.now();if(t instanceof he){const i=t.type,s=t.from,o=t.to,a=r.neutral;return new Ee(new he(e,ct(n,s),ct(n,o)),new Bt(a,new Nt(new se("x",i,new jn(t=>e)),n)))}}throw new Error(`invalid input for cong ${[t,e,n]}`)}(this.target.toLazy(t),this.base.toLazy(t),this.fun.toLazy(t))}prettyPrint(){return`(cong ${this.target.prettyPrint()} ${this.fun.prettyPrint()})`}toString(){return this.prettyPrint()}},un=class extends Ce{constructor(t){super(),this.equality=t}valOf(t){return function(t){const e=t.now();if(e instanceof de)return new de(e.value);if(e instanceof Ee){const t=e.type.now();if(t instanceof he)return new Ee(new he(t.type,t.to,t.from),new Ht(e.neutral))}throw new Error(`invalid input for symm ${t}`)}(this.equality.toLazy(t))}prettyPrint(){return`(symm ${this.equality.prettyPrint()})`}toString(){return this.prettyPrint()}},cn=class extends Ce{constructor(t,e,n){super(),this.target=t,this.motive=e,this.base=n}valOf(t){return function(t,e,n){const r=t.now();if(r instanceof de)return n;if(r instanceof Ee){const i=r.type.now();if(i instanceof he){const s=i.type,o=i.from,a=i.to,l=r.neutral;return new Ee(ct(ct(e,a),t),new Ft(l,new Nt(new se("to",s,new jn(t=>new se("p",new he(s,o,t),new jn(t=>new Te)))),e),new Nt(ct(ct(e,o),new de(o)),n)))}}throw new Error(`invalid input for indEqual ${[t,e,n]}`)}(this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t))}prettyPrint(){return`(ind-= ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()})`}toString(){return this.prettyPrint()}},pn=class extends Ce{constructor(t,e){super(),this.type=t,this.length=e}valOf(t){return new fe(this.type.toLazy(t),this.length.toLazy(t))}prettyPrint(){return`(Vec ${this.type.prettyPrint()} ${this.length.prettyPrint()})`}toString(){return this.prettyPrint()}},hn=class extends Ce{constructor(t,e){super(),this.head=t,this.tail=e}valOf(t){return new ye(this.head.toLazy(t),this.tail.toLazy(t))}prettyPrint(){return`(vec:: ${this.head.prettyPrint()} ${this.tail.prettyPrint()})`}toString(){return this.prettyPrint()}},dn=class extends Ce{valOf(t){return new me}prettyPrint(){return"vecnil"}toString(){return this.prettyPrint()}},fn=class extends Ce{constructor(t){super(),this.vec=t}valOf(t){return function(t){const e=t.now();if(e instanceof ye)return e.head;if(e instanceof Ee){const t=e.type.now();if(t instanceof fe&&t.length.now()instanceof ie)return new Ee(t.entryType,new Vt(e.neutral))}throw new Error(`invalid input for head ${t}`)}(this.vec.toLazy(t))}prettyPrint(){return`(head ${this.vec.prettyPrint()})`}toString(){return this.prettyPrint()}},mn=class extends Ce{constructor(t){super(),this.vec=t}valOf(t){return wt(this.vec.toLazy(t))}prettyPrint(){return`(tail ${this.vec.prettyPrint()})`}toString(){return this.prettyPrint()}},yn=class extends Ce{constructor(t,e,n,r,i){super(),this.length=t,this.target=e,this.motive=n,this.base=r,this.step=i}valOf(t){return Et(this.length.toLazy(t),this.target.toLazy(t),this.motive.toLazy(t),this.base.toLazy(t),this.step.toLazy(t))}prettyPrint(){return`ind-Vec ${this.length.prettyPrint()}\n              ${this.target.prettyPrint()}\n              ${this.motive.prettyPrint()}\n              ${this.base.prettyPrint()}\n              ${this.step.prettyPrint()}`}toString(){return this.prettyPrint()}},gn=class extends Ce{constructor(t,e){super(),this.left=t,this.right=e}valOf(t){return new ge(this.left.toLazy(t),this.right.toLazy(t))}prettyPrint(){return`(Either ${this.left.prettyPrint()} ${this.right.prettyPrint()})`}toString(){return this.prettyPrint()}},wn=class extends Ce{constructor(t){super(),this.value=t}valOf(t){return new we(this.value.toLazy(t))}prettyPrint(){return`(left ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}},vn=class extends Ce{constructor(t){super(),this.value=t}valOf(t){return new ve(this.value.toLazy(t))}prettyPrint(){return`(right ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}},En=class extends Ce{constructor(t,e,n,r){super(),this.target=t,this.motive=e,this.baseLeft=n,this.baseRight=r}valOf(t){return function(t,e,n,r){const i=t.now();if(i instanceof we)return ct(n,i.value);if(i instanceof ve)return ct(r,i.value);if(i instanceof Ee){const s=i.type.now();if(s instanceof ge){const o=s.leftType,a=s.rightType,l=new se("x",new ge(o,a),new jn(t=>new Te));return new Ee(ct(e,t),new Yt(i.neutral,new Nt(l,e),new Nt(new se("x",o,new jn(t=>ct(e,new we(t)))),n),new Nt(new se("x",a,new jn(t=>ct(e,new ve(t)))),r)))}}throw new Error(`invalid input for indEither: ${[t,e,n,r]}`)}(this.target.toLazy(t),this.motive.toLazy(t),this.baseLeft.toLazy(t),this.baseRight.toLazy(t))}prettyPrint(){return`(ind-Either ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.baseLeft.prettyPrint()} \n              ${this.baseRight.prettyPrint()})`}toString(){return this.prettyPrint()}},Tn=class extends Ce{constructor(t,e){super(),this.loc=t,this.type=e}valOf(t){return new Ee(this.type.toLazy(t),new Ot(this.loc,this.type.toLazy(t)))}prettyPrint(){return`TODO ${this.type.prettyPrint()}`}toString(){return this.prettyPrint()}},In=class extends Ce{constructor(t,e){super(),this.fun=t,this.arg=e}valOf(t){return ct(this.fun.toLazy(t),this.arg.toLazy(t))}prettyPrint(){return`(${this.fun.prettyPrint()} ${this.arg.prettyPrint()})`}toString(){return this.prettyPrint()}};class An extends Ce{constructor(t){super(),this.name=t}valOf(t){if(Jn(this.name))return function(t,e){if(t.has(e))return t.get(e);throw new Error(`Variable ${e} not found in environment`)}(t,this.name);throw new Error(`${this.name} is not a valid variable name`)}prettyPrint(){return this.name}toString(){return this.prettyPrint()}}let Nn=class extends Ce{valOf(t){return new Se(this.typeName,this.parameters.map(e=>e.toLazy(t)),this.indices.map(e=>e.toLazy(t)))}constructor(t,e,n){super(),this.typeName=t,this.parameters=e,this.indices=n}prettyPrint(){return`${this.typeName}${this.parameters.length>0?" "+this.parameters.map(t=>t.prettyPrint()).join(" "):""}${this.indices.length>0?" "+this.indices.map(t=>t.prettyPrint()).join(" "):""}`}toString(){return this.prettyPrint()}},bn=class extends Ce{valOf(t){return new Oe(this.typeName,this.parameterTypes.map(e=>e.toLazy(t)),this.indexTypes.map(e=>e.toLazy(t)))}constructor(t,e,n){super(),this.typeName=t,this.parameterTypes=e,this.indexTypes=n}prettyPrint(){return`${this.typeName}${this.parameterTypes.length>0?" "+this.parameterTypes.map(t=>t.prettyPrint()).join(" "):""}${this.indexTypes.length>0?" "+this.indexTypes.map(t=>t.prettyPrint()).join(" "):""}`}};class Sn extends Ce{constructor(t,e,n,r,i){super(),this.name=t,this.index=e,this.type=n,this.args=r,this.recursive_args=i}valOf(t){return new _e(this.name,this.type,this.args.map(e=>e.toLazy(t)),this.index,this.recursive_args.map(e=>e.toLazy(t)))}prettyPrint(){const t=this.args.map(t=>t.prettyPrint()).join(" ");return`(${this.name}${t.length>0?" "+t:""})`}}class On extends Ce{constructor(t,e,n,r,i,s){super(),this.name=t,this.index=e,this.type=n,this.argTypes=r,this.rec_argTypes=i,this.resultType=s}valOf(t){return new Pe(this.name,this.index,this.type,this.argTypes.map(e=>e.toLazy(t)),this.rec_argTypes.map(e=>e.toLazy(t)),this.resultType.toLazy(t))}prettyPrint(){return`ConstructorType ${this.name} : ${this.argTypes.map(t=>t.prettyPrint()).join(" -> ")} -> ${this.resultType.prettyPrint()}`}}class _n extends Ce{constructor(t,e,n,r,i,s){super(),this.typeName=t,this.target=e,this.motive=n,this.methods=r,this.methodTypes=i,this.motiveType=s}valOf(t){return Tt(this.typeName,this.target.toLazy(t),this.motive.toLazy(t),this.methods.map(e=>e.toLazy(t)),this.methodTypes?this.methodTypes.map(e=>e.toLazy(t)):void 0,this.motiveType?this.motiveType.toLazy(t):void 0)}prettyPrint(){const t=this.methods.map(t=>t.prettyPrint()).join(" ");return`(elim-${this.typeName} ${this.target.prettyPrint()} ${this.motive.prettyPrint()} ${t})`}}const Pn={0:"โ",1:"โ",2:"โ",3:"โ",4:"โ",5:"โ",6:"โ",7:"โ",8:"โ",9:"โ"},Cn={"โ":"0","โ":"1","โ":"2","โ":"3","โ":"4","โ":"5","โ":"6","โ":"7","โ":"8","โ":"9"};function xn(t,e){if(t.some(t=>t===e)){return Rn(t,function(t){const[e,n]=Mn(t,t.length-1);return[e,n]}(e))}return e}function Rn(t,e){const n=function([t,e]){const n=function(t){const e=t.toString().split("").map(t=>Pn[t]||t).join("");return e}(e);return t+n}(e);return t.map(t=>t.toString()).includes(n.toString())?Rn(t,function(t){return[t[0],t[1]+1]}(e)):n}function kn(t){const e=t.split("").map(t=>Cn[t]||t).join("");return parseInt(e,10)||1}function Mn(t,e){return e<0?[t,0]:(n=t[e],Object.keys(Cn).includes(n)?Mn(t,e-1):[t.substring(0,e+1),kn(t.substring(e+1))]);var n}class Ln{constructor(t,e){this.location=t,this.varName=e}prettyPrint(){return`${this.varName}`}}class Dn{constructor(t,e){this.binder=t,this.type=e}prettyPrint(){return`${this.binder.prettyPrint()} : ${this.type.prettyPrint()}`}findNames(){return this.binder.varName}}class Un{constructor(t){this.message=t}toString(){return this.message.map(t=>"string"==typeof t?t:t.prettyPrint()).join(" ")}}class qn{}class Gn extends qn{constructor(t){super(),this.result=t}}class $n extends qn{constructor(t,e){super(),this.where=t,this.message=e}}class Bn{constructor(t,e=null){this.name=t,this.value=e}}function Hn(t,e){for(const[e,n]of t){const t=n();if(!(t instanceof Gn))throw new Error(`Error message: ${t.message.message} at ${t.where}`);e.value=t.result}return e()}class Fn{constructor(){}}class Vn extends Fn{constructor(t,e,n){super(),this.env=t,this.varName=e,this.expr=n}valOfClosure(t){return this.expr.valOf(ut(this.env,this.varName,t))}prettyPrint(){return`(CLOS ${this.varName} ${this.expr.prettyPrint()})`}toString(){return this.prettyPrint()}}class jn extends Fn{constructor(t){super(),this.proc=t}valOfClosure(t){return this.proc(t)}prettyPrint(){return this.proc.toString()}toString(){return this.prettyPrint()}}function Jn(t){return!("U"===(e=t)||"Nat"===e||"zero"===e||"add1"===e||"which-Nat"===e||"iter-Nat"===e||"rec-Nat"===e||"ind-Nat"===e||"->"===e||"โ"===e||"ฮ"===e||"ฮป"===e||"Pi"===e||"โ"===e||"lambda"===e||"quote"===e||"Atom"===e||"car"===e||"cdr"===e||"cons"===e||"ฮฃ"===e||"Sigma"===e||"Pair"===e||"Trivial"===e||"sole"===e||"List"===e||"::"===e||"nil"===e||"rec-List"===e||"ind-List"===e||"Absurd"===e||"ind-Absurd"===e||"="===e||"same"===e||"replace"===e||"trans"===e||"cong"===e||"symm"===e||"ind-="===e||"Vec"===e||"vecnil"===e||"vec::"===e||"head"===e||"tail"===e||"ind-Vec"===e||"Either"===e||"left"===e||"right"===e||"ind-Either"===e||"TODO"===e||"the"===e)&&isNaN(Number(t));var e}function zn(t){return Array.from(t.keys())}function Yn(t,e){return xn(zn(t),e)}function Kn(t,e,n){return xn(zn(t).concat(e.findNames()),n)}function Wn(t){return[t.binder.varName].concat(t.type.findNames())}function Xn(t){const e=[];return Qn(t,e),e}function Qn(t,e){if(t instanceof te){const n=t.val.get();if(n instanceof Qt)return void Zn(n.expr,e);t=n}const n=t.now();n instanceof Ee&&n.neutral instanceof St?e.includes(n.neutral.name)||e.push(n.neutral.name):n instanceof ie?Qn(n.smaller,e):n instanceof Se&&(n.parameters.forEach(t=>Qn(t,e)),n.indices.forEach(t=>Qn(t,e)))}function Zn(t,e){t instanceof An?e.includes(t.name)||e.push(t.name):t instanceof Le?Zn(t.n,e):t instanceof Nn&&(t.parameters.forEach(t=>Zn(t,e)),t.indices.forEach(t=>Zn(t,e)))}function tr(t,e){return ir(0,new Map,new Map,t,e)}const er=-1;function nr(t,e,n){return t.set(e,n)}function rr(t,e){return e.has(t)?e.get(t):er}function ir(t,e,n,r,i){if(r instanceof An&&i instanceof An){const t=r.name,s=i.name;if(Jn(t)&&Jn(s)){const r=rr(t,e),i=rr(s,n);return r!==er&&i!==er?r===i:r===er&&i===er&&t===s}return!1}if(r instanceof Fe&&i instanceof Fe)return r.sym===i.sym;if(r instanceof $e&&i instanceof $e)return ir(t,e,n,r.type,i.type)&&ir(t+1,nr(e,r.name,t),nr(n,i.name,t),r.body,i.body);if(r instanceof Ve&&i instanceof Ve)return ir(t,e,n,r.type,i.type)&&ir(t+1,nr(e,r.name,t),nr(n,i.name,t),r.body,i.body);if(r instanceof Be&&i instanceof Be)return ir(t+1,nr(e,r.param,t),nr(n,i.param,t),r.body,i.body);if(r instanceof xe&&i instanceof xe&&r.type instanceof en&&i.type instanceof en)return!0;if(r instanceof In&&i instanceof In)return ir(t,e,n,r.fun,i.fun)&&ir(t,e,n,r.arg,i.arg);if(r instanceof Re&&i instanceof Re||r instanceof ke&&i instanceof ke||r instanceof Me&&i instanceof Me||r instanceof He&&i instanceof He||r instanceof en&&i instanceof en||r instanceof tn&&i instanceof tn||r instanceof Ke&&i instanceof Ke||r instanceof dn&&i instanceof dn||r instanceof Ze&&i instanceof Ze)return!0;if(r instanceof xe&&i instanceof xe)return ir(t,e,n,r.type,i.type)&&ir(t,e,n,r.expr,i.expr);if(r instanceof We&&i instanceof We)return ir(t,e,n,r.elemType,i.elemType);if(r instanceof Le&&i instanceof Le)return ir(t,e,n,r.n,i.n);if(r instanceof De&&i instanceof De)return ir(t,e,n,r.target,i.target)&&ir(t,e,n,r.base,i.base)&&ir(t,e,n,r.step,i.step);if(r instanceof Ue&&i instanceof Ue)return ir(t,e,n,r.target,i.target)&&ir(t,e,n,r.base,i.base)&&ir(t,e,n,r.step,i.step);if(r instanceof qe&&i instanceof qe)return ir(t,e,n,r.target,i.target)&&ir(t,e,n,r.base,i.base)&&ir(t,e,n,r.step,i.step);if(r instanceof Ge&&i instanceof Ge)return ir(t,e,n,r.target,i.target)&&ir(t,e,n,r.motive,i.motive)&&ir(t,e,n,r.base,i.base)&&ir(t,e,n,r.step,i.step);if(r instanceof je&&i instanceof je)return ir(t,e,n,r.first,i.first)&&ir(t,e,n,r.second,i.second);if(r instanceof Je&&i instanceof Je)return ir(t,e,n,r.pair,i.pair);if(r instanceof ze&&i instanceof ze)return ir(t,e,n,r.pair,i.pair);if(r instanceof Ye&&i instanceof Ye)return ir(t,e,n,r.head,i.head)&&ir(t,e,n,r.tail,i.tail);if(r instanceof Xe&&i instanceof Xe)return ir(t,e,n,r.target,i.target)&&ir(t,e,n,r.base,i.base)&&ir(t,e,n,r.step,i.step);if(r instanceof Qe&&i instanceof Qe)return ir(t,e,n,r.target,i.target)&&ir(t,e,n,r.motive,i.motive)&&ir(t,e,n,r.base,i.base)&&ir(t,e,n,r.step,i.step);if(r instanceof nn&&i instanceof nn)return ir(t,e,n,r.target,i.target)&&ir(t,e,n,r.motive,i.motive);if(r instanceof rn&&i instanceof rn)return ir(t,e,n,r.type,i.type)&&ir(t,e,n,r.left,i.left)&&ir(t,e,n,r.right,i.right);if(r instanceof sn&&i instanceof sn)return ir(t,e,n,r.type,i.type);if(r instanceof on&&i instanceof on)return ir(t,e,n,r.target,i.target)&&ir(t,e,n,r.motive,i.motive)&&ir(t,e,n,r.base,i.base);if(r instanceof an&&i instanceof an)return ir(t,e,n,r.left,i.left)&&ir(t,e,n,r.right,i.right);if(r instanceof ln&&i instanceof ln)return ir(t,e,n,r.target,i.target)&&ir(t,e,n,r.base,i.base)&&ir(t,e,n,r.fun,i.fun);if(r instanceof un&&i instanceof un)return ir(t,e,n,r.equality,i.equality);if(r instanceof cn&&i instanceof cn)return ir(t,e,n,r.target,i.target)&&ir(t,e,n,r.motive,i.motive)&&ir(t,e,n,r.base,i.base);if(r instanceof pn&&i instanceof pn)return ir(t,e,n,r.type,i.type)&&ir(t,e,n,r.length,i.length);if(r instanceof hn&&i instanceof hn)return ir(t,e,n,r.head,i.head)&&ir(t,e,n,r.tail,i.tail);if(r instanceof fn&&i instanceof fn)return ir(t,e,n,r.vec,i.vec);if(r instanceof mn&&i instanceof mn)return ir(t,e,n,r.vec,i.vec);if(r instanceof yn&&i instanceof yn)return ir(t,e,n,r.length,i.length)&&ir(t,e,n,r.target,i.target)&&ir(t,e,n,r.motive,i.motive)&&ir(t,e,n,r.base,i.base)&&ir(t,e,n,r.step,i.step);if(r instanceof gn&&i instanceof gn)return ir(t,e,n,r.left,i.left)&&ir(t,e,n,r.right,i.right);if(r instanceof wn&&i instanceof wn)return ir(t,e,n,r.value,i.value);if(r instanceof vn&&i instanceof vn)return ir(t,e,n,r.value,i.value);if(r instanceof En&&i instanceof En)return ir(t,e,n,r.target,i.target)&&ir(t,e,n,r.motive,i.motive)&&ir(t,e,n,r.baseLeft,i.baseLeft)&&ir(t,e,n,r.baseRight,i.baseRight);if(r instanceof Tn&&i instanceof Tn)return function(t,e){return t.startLine===e.startLine&&t.startColumn===e.startColumn&&t.endLine===e.endLine&&t.endColumn===e.endColumn}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(r.loc,i.loc)&&ir(t,e,n,r.type,i.type);if(r instanceof Nn&&i instanceof Nn){if(r.typeName!==i.typeName)return!1;if(r.parameters.length!==i.parameters.length)return!1;if(r.indices.length!==i.indices.length)return!1;for(let s=0;s<r.parameters.length;s++)if(!ir(t,e,n,r.parameters[s],i.parameters[s]))return!1;for(let s=0;s<r.indices.length;s++)if(!ir(t,e,n,r.indices[s],i.indices[s]))return!1;return!0}return!1}let sr,or;function ar(t,e,n,r){var i,s;if(!(null==t?void 0:t.baseUrl)){const t={geminiUrl:sr,vertexUrl:or};return e?null!==(i=t.vertexUrl)&&void 0!==i?i:n:null!==(s=t.geminiUrl)&&void 0!==s?s:r}return t.baseUrl}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class lr{}function ur(t,e){return t.replace(/\{([^}]+)\}/g,(t,n)=>{if(Object.prototype.hasOwnProperty.call(e,n)){const t=e[n];return null!=t?String(t):""}throw new Error(`Key '${n}' not found in valueMap.`)})}function cr(t,e,n){for(let r=0;r<e.length-1;r++){const i=e[r];if(i.endsWith("[]")){const s=i.slice(0,-2);if(!(s in t)){if(!Array.isArray(n))throw new Error(`Value must be a list given an array path ${i}`);t[s]=Array.from({length:n.length},()=>({}))}if(Array.isArray(t[s])){const i=t[s];if(Array.isArray(n))for(let t=0;t<i.length;t++){cr(i[t],e.slice(r+1),n[t])}else for(const t of i)cr(t,e.slice(r+1),n)}return}if(i.endsWith("[0]")){const s=i.slice(0,-3);s in t||(t[s]=[{}]);return void cr(t[s][0],e.slice(r+1),n)}t[i]&&"object"==typeof t[i]||(t[i]={}),t=t[i]}const r=e[e.length-1],i=t[r];if(void 0!==i){if(!n||"object"==typeof n&&0===Object.keys(n).length)return;if(n===i)return;if("object"!=typeof i||"object"!=typeof n||null===i||null===n)throw new Error(`Cannot set value for an existing key. Key: ${r}`);Object.assign(i,n)}else if("_self"!==r||"object"!=typeof n||null===n||Array.isArray(n))t[r]=n;else{const e=n;Object.assign(t,e)}}function pr(t,e,n=void 0){try{if(1===e.length&&"_self"===e[0])return t;for(let r=0;r<e.length;r++){if("object"!=typeof t||null===t)return n;const i=e[r];if(i.endsWith("[]")){const s=i.slice(0,-2);if(s in t){const i=t[s];return Array.isArray(i)?i.map(t=>pr(t,e.slice(r+1),n)):n}return n}t=t[i]}return t}catch(t){if(t instanceof TypeError)return n;throw t}}function hr(t,e,n,r,i){if(r>=e.length)return;if("object"!=typeof t||null===t)return;const s=e[r];if(s.endsWith("[]")){const o=s.slice(0,-2),a=t;if(o in a&&Array.isArray(a[o]))for(const t of a[o])hr(t,e,n,r+1,i)}else if("*"===s){if("object"==typeof t&&null!==t&&!Array.isArray(t)){const e=t,s=Object.keys(e).filter(t=>!t.startsWith("_")&&!i.has(t)),o={};for(const t of s)o[t]=e[t];for(const[t,i]of Object.entries(o)){const s=[];for(const e of n.slice(r))"*"===e?s.push(t):s.push(e);cr(e,s,i)}for(const t of s)delete e[t]}}else{s in t&&hr(t[s],e,n,r+1,i)}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function dr(t){if("string"!=typeof t)throw new Error("fromImageBytes must be a string");return t}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function fr(t){const e={},n=pr(t,["name"]);null!=n&&cr(e,["name"],n);const r=pr(t,["metadata"]);null!=r&&cr(e,["metadata"],r);const i=pr(t,["done"]);null!=i&&cr(e,["done"],i);const s=pr(t,["error"]);null!=s&&cr(e,["error"],s);const o=pr(t,["response","generateVideoResponse"]);return null!=o&&cr(e,["response"],function(t){const e={},n=pr(t,["generatedSamples"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["video"]);null!=n&&cr(e,["video"],function(t){const e={},n=pr(t,["uri"]);null!=n&&cr(e,["uri"],n);const r=pr(t,["encodedVideo"]);null!=r&&cr(e,["videoBytes"],dr(r));const i=pr(t,["encoding"]);null!=i&&cr(e,["mimeType"],i);return e}(n));return e}(t))),cr(e,["generatedVideos"],t)}const r=pr(t,["raiMediaFilteredCount"]);null!=r&&cr(e,["raiMediaFilteredCount"],r);const i=pr(t,["raiMediaFilteredReasons"]);null!=i&&cr(e,["raiMediaFilteredReasons"],i);return e}(o)),e}function mr(t){const e={},n=pr(t,["name"]);null!=n&&cr(e,["name"],n);const r=pr(t,["metadata"]);null!=r&&cr(e,["metadata"],r);const i=pr(t,["done"]);null!=i&&cr(e,["done"],i);const s=pr(t,["error"]);null!=s&&cr(e,["error"],s);const o=pr(t,["response"]);return null!=o&&cr(e,["response"],function(t){const e={},n=pr(t,["videos"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["_self"]);null!=n&&cr(e,["video"],function(t){const e={},n=pr(t,["gcsUri"]);null!=n&&cr(e,["uri"],n);const r=pr(t,["bytesBase64Encoded"]);null!=r&&cr(e,["videoBytes"],dr(r));const i=pr(t,["mimeType"]);null!=i&&cr(e,["mimeType"],i);return e}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(n));return e}(t))),cr(e,["generatedVideos"],t)}const r=pr(t,["raiMediaFilteredCount"]);null!=r&&cr(e,["raiMediaFilteredCount"],r);const i=pr(t,["raiMediaFilteredReasons"]);null!=i&&cr(e,["raiMediaFilteredReasons"],i);return e}(o)),e}var yr,gr,wr,vr,Er,Tr,Ir,Ar,Nr,br,Sr,Or,_r,Pr,Cr,xr,Rr,kr,Mr,Lr,Dr,Ur,qr,Gr,$r,Br,Hr,Fr,Vr,jr,Jr,zr,Yr,Kr,Wr,Xr,Qr,Zr,ti,ei,ni,ri,ii,si,oi,ai,li,ui,ci,pi,hi;!function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"}(yr||(yr={})),function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"}(gr||(gr={})),function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"}(wr||(wr={})),function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"}(vr||(vr={})),function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"}(Er||(Er={})),function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"}(Tr||(Tr={})),function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"}(Ir||(Ir={})),function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"}(Ar||(Ar={})),function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"}(Nr||(Nr={})),function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"}(br||(br={})),function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",t.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",t.NO_IMAGE="NO_IMAGE"}(Sr||(Sr={})),function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"}(Or||(Or={})),function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"}(_r||(_r={})),function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",t.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",t.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"}(Pr||(Pr={})),function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK"}(Cr||(Cr={})),function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"}(xr||(xr={})),function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"}(Rr||(Rr={})),function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"}(kr||(kr={})),function(t){t.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",t.TUNING_MODE_FULL="TUNING_MODE_FULL",t.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"}(Mr||(Mr={})),function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"}(Lr||(Lr={})),function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"}(Dr||(Dr={})),function(t){t.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",t.TUNING_TASK_I2V="TUNING_TASK_I2V",t.TUNING_TASK_T2V="TUNING_TASK_T2V"}(Ur||(Ur={})),function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"}(qr||(qr={})),function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"}(Gr||(Gr={})),function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"}($r||($r={})),function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"}(Br||(Br={})),function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE",t.VALIDATED="VALIDATED"}(Hr||(Hr={})),function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"}(Fr||(Fr={})),function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"}(Vr||(Vr={})),function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"}(jr||(jr={})),function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"}(Jr||(Jr={})),function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"}(zr||(zr={})),function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"}(Yr||(Yr={})),function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"}(Kr||(Kr={})),function(t){t.FOREGROUND="FOREGROUND",t.BACKGROUND="BACKGROUND",t.PROMPT="PROMPT",t.SEMANTIC="SEMANTIC",t.INTERACTIVE="INTERACTIVE"}(Wr||(Wr={})),function(t){t.ASSET="ASSET",t.STYLE="STYLE"}(Xr||(Xr={})),function(t){t.INSERT="INSERT",t.REMOVE="REMOVE",t.REMOVE_STATIC="REMOVE_STATIC",t.OUTPAINT="OUTPAINT"}(Qr||(Qr={})),function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"}(Zr||(Zr={})),function(t){t.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",t.PREFERENCE_TUNING="PREFERENCE_TUNING"}(ti||(ti={})),function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"}(ei||(ei={})),function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"}(ni||(ni={})),function(t){t.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.RESPONSE_REJECTED="RESPONSE_REJECTED",t.NEED_MORE_INPUT="NEED_MORE_INPUT"}(ri||(ri={})),function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"}(ii||(ii={})),function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"}(si||(si={})),function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"}(oi||(oi={})),function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"}(ai||(ai={})),function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"}(li||(li={})),function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"}(ui||(ui={})),function(t){t.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",t.QUALITY="QUALITY",t.DIVERSITY="DIVERSITY",t.VOCALIZATION="VOCALIZATION"}(ci||(ci={})),function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"}(pi||(pi={}));class di{constructor(t){const e={};for(const n of t.headers.entries())e[n[0]]=n[1];this.headers=e,this.responseInternal=t}json(){return this.responseInternal.json()}}class fi{get text(){var t,e,n,r,i,s,o,a;if(0===(null===(r=null===(n=null===(e=null===(t=this.candidates)||void 0===t?void 0:t[0])||void 0===e?void 0:e.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length))return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let l="",u=!1;const c=[];for(const t of null!==(a=null===(o=null===(s=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===s?void 0:s.content)||void 0===o?void 0:o.parts)&&void 0!==a?a:[]){for(const[e,n]of Object.entries(t))"text"===e||"thought"===e||null===n&&void 0===n||c.push(e);if("string"==typeof t.text){if("boolean"==typeof t.thought&&t.thought)continue;u=!0,l+=t.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?l:void 0}get data(){var t,e,n,r,i,s,o,a;if(0===(null===(r=null===(n=null===(e=null===(t=this.candidates)||void 0===t?void 0:t[0])||void 0===e?void 0:e.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length))return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let l="";const u=[];for(const t of null!==(a=null===(o=null===(s=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===s?void 0:s.content)||void 0===o?void 0:o.parts)&&void 0!==a?a:[]){for(const[e,n]of Object.entries(t))"inlineData"===e||null===n&&void 0===n||u.push(e);t.inlineData&&"string"==typeof t.inlineData.data&&(l+=atob(t.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),l.length>0?btoa(l):void 0}get functionCalls(){var t,e,n,r,i,s,o,a;if(0===(null===(r=null===(n=null===(e=null===(t=this.candidates)||void 0===t?void 0:t[0])||void 0===e?void 0:e.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length))return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const l=null===(a=null===(o=null===(s=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===s?void 0:s.content)||void 0===o?void 0:o.parts)||void 0===a?void 0:a.filter(t=>t.functionCall).map(t=>t.functionCall).filter(t=>void 0!==t);return 0!==(null==l?void 0:l.length)?l:void 0}get executableCode(){var t,e,n,r,i,s,o,a,l;if(0===(null===(r=null===(n=null===(e=null===(t=this.candidates)||void 0===t?void 0:t[0])||void 0===e?void 0:e.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length))return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const u=null===(a=null===(o=null===(s=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===s?void 0:s.content)||void 0===o?void 0:o.parts)||void 0===a?void 0:a.filter(t=>t.executableCode).map(t=>t.executableCode).filter(t=>void 0!==t);return 0!==(null==u?void 0:u.length)?null===(l=null==u?void 0:u[0])||void 0===l?void 0:l.code:void 0}get codeExecutionResult(){var t,e,n,r,i,s,o,a,l;if(0===(null===(r=null===(n=null===(e=null===(t=this.candidates)||void 0===t?void 0:t[0])||void 0===e?void 0:e.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length))return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const u=null===(a=null===(o=null===(s=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===s?void 0:s.content)||void 0===o?void 0:o.parts)||void 0===a?void 0:a.filter(t=>t.codeExecutionResult).map(t=>t.codeExecutionResult).filter(t=>void 0!==t);return 0!==(null==u?void 0:u.length)?null===(l=null==u?void 0:u[0])||void 0===l?void 0:l.output:void 0}}class mi{}class yi{}class gi{}class wi{}class vi{}class Ei{}class Ti{}class Ii{}class Ai{}class Ni{}class bi{_fromAPIResponse({apiResponse:t,isVertexAI:e}){const n=new bi;let r;const i=t;return r=e?mr(i):fr(i),Object.assign(n,r),n}}class Si{}class Oi{}class _i{}class Pi{}class Ci{}class xi{}class Ri{}class ki{get text(){var t,e,n;let r="",i=!1;const s=[];for(const o of null!==(n=null===(e=null===(t=this.serverContent)||void 0===t?void 0:t.modelTurn)||void 0===e?void 0:e.parts)&&void 0!==n?n:[]){for(const[t,e]of Object.entries(o))"text"!==t&&"thought"!==t&&null!==e&&s.push(t);if("string"==typeof o.text){if("boolean"==typeof o.thought&&o.thought)continue;i=!0,r+=o.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?r:void 0}get data(){var t,e,n;let r="";const i=[];for(const s of null!==(n=null===(e=null===(t=this.serverContent)||void 0===t?void 0:t.modelTurn)||void 0===e?void 0:e.parts)&&void 0!==n?n:[]){for(const[t,e]of Object.entries(s))"inlineData"!==t&&null!==e&&i.push(t);s.inlineData&&"string"==typeof s.inlineData.data&&(r+=atob(s.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}}class Mi{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Li(t,e){if(!e||"string"!=typeof e)throw new Error("model is required and must be a string");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}return`publishers/google/models/${e}`}return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Di(t,e){const n=Li(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function Ui(t){return Array.isArray(t)?t.map(t=>qi(t)):[qi(t)]}function qi(t){if("object"==typeof t&&null!==t)return t;throw new Error("Could not parse input as Blob. Unsupported blob type: "+typeof t)}function Gi(t){const e=qi(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function $i(t){const e=qi(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Bi(t){if(null==t)throw new Error("PartUnion is required");if("object"==typeof t)return t;if("string"==typeof t)return{text:t};throw new Error("Unsupported part type: "+typeof t)}function Hi(t){if(null==t||Array.isArray(t)&&0===t.length)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(t=>Bi(t)):[Bi(t)]}function Fi(t){return null!=t&&"object"==typeof t&&"parts"in t&&Array.isArray(t.parts)}function Vi(t){return null!=t&&"object"==typeof t&&"functionCall"in t}function ji(t){return null!=t&&"object"==typeof t&&"functionResponse"in t}function Ji(t){if(null==t)throw new Error("ContentUnion is required");return Fi(t)?t:{role:"user",parts:Hi(t)}}function zi(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const e=Ji(t);return e.parts&&e.parts.length>0&&void 0!==e.parts[0].text?[e.parts[0].text]:[]});if(t.isVertexAI()){const t=Ji(e);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>Ji(t)):[Ji(e)]}function Yi(t){if(null==t||Array.isArray(t)&&0===t.length)throw new Error("contents are required");if(!Array.isArray(t)){if(Vi(t)||ji(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Ji(t)]}const e=[],n=[],r=Fi(t[0]);for(const i of t){const t=Fi(i);if(t!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(t)e.push(i);else{if(Vi(i)||ji(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(i)}}return r||e.push({role:"user",parts:Hi(n)}),e}function Ki(t){const e={},n=["items"],r=["anyOf"],i=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");const s=t.anyOf;null!=s&&2==s.length&&("null"===s[0].type?(e.nullable=!0,t=s[1]):"null"===s[1].type&&(e.nullable=!0,t=s[0])),t.type instanceof Array&&function(t,e){t.includes("null")&&(e.nullable=!0);const n=t.filter(t=>"null"!==t);if(1===n.length)e.type=Object.values(vr).includes(n[0].toUpperCase())?n[0].toUpperCase():vr.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const t of n)e.anyOf.push({type:Object.values(vr).includes(t.toUpperCase())?t.toUpperCase():vr.TYPE_UNSPECIFIED})}}(t.type,e);for(const[s,o]of Object.entries(t))if(null!=o)if("type"==s){if("null"===o)throw new Error("type: null can not be the only possible type for the field.");if(o instanceof Array)continue;e.type=Object.values(vr).includes(o.toUpperCase())?o.toUpperCase():vr.TYPE_UNSPECIFIED}else if(n.includes(s))e[s]=Ki(o);else if(r.includes(s)){const t=[];for(const n of o)"null"!=n.type?t.push(Ki(n)):e.nullable=!0;e[s]=t}else if(i.includes(s)){const t={};for(const[e,n]of Object.entries(o))t[e]=Ki(n);e[s]=t}else{if("additionalProperties"===s)continue;e[s]=o}return e}function Wi(t){return Ki(t)}function Xi(t){if("object"==typeof t)return t;if("string"==typeof t)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error("Unsupported speechConfig type: "+typeof t)}function Qi(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function Zi(t){if(t.functionDeclarations)for(const e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Ki(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Ki(e.response));return t}function ts(t){if(null==t)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");const e=[];for(const n of t)e.push(n);return e}function es(t,e){if("string"!=typeof e)throw new Error("name must be a string");return function(t,e,n,r=1){const i=!e.startsWith(`${n}/`)&&e.split("/").length===r;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:i?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:i?`${n}/${e}`:e}(t,e,"cachedContents")}function ns(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function rs(t){return dr(t)}function is(t){var e;let n;var r;if(null!=(r=t)&&"object"==typeof r&&"name"in r&&(n=t.name),!(function(t){return null!=t&&"object"==typeof t&&"uri"in t}(t)&&(n=t.uri,void 0===n)||function(t){return null!=t&&"object"==typeof t&&"video"in t}(t)&&(n=null===(e=t.video)||void 0===e?void 0:e.uri,void 0===n))){if("string"==typeof t&&(n=t),void 0===n)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const t=n.split("files/")[1].match(/[a-z0-9]+/);if(null===t)throw new Error(`Could not extract file name from URI ${n}`);n=t[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function ss(t,e){let n;return n=t.isVertexAI()?e?"publishers/google/models":"models":e?"models":"tunedModels",n}function os(t){for(const e of["models","tunedModels","publisherModels"])if(as(t,e))return t[e];return[]}function as(t,e){return null!==t&&"object"==typeof t&&e in t}function ls(t,e={}){const n=t,r={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};n.outputSchema&&(r.responseJsonSchema=n.outputSchema),e.behavior&&(r.behavior=e.behavior);return{functionDeclarations:[r]}}function us(t,e){let n;if("string"==typeof e)if(t.isVertexAI())if(e.startsWith("gs://"))n={format:"jsonl",gcsUri:[e]};else{if(!e.startsWith("bq://"))throw new Error(`Unsupported string source for Vertex AI: ${e}`);n={format:"bigquery",bigqueryUri:e}}else{if(!e.startsWith("files/"))throw new Error(`Unsupported string source for Gemini API: ${e}`);n={fileName:e}}else if(Array.isArray(e)){if(t.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:e}}else n=e;const r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(t.isVertexAI()){if(i>0||1!==r)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||1!==i)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function cs(t){if("object"!=typeof t||null===t)return{};const e=t,n=e.inlinedResponses;if("object"!=typeof n||null===n)return t;const r=n.inlinedResponses;if(!Array.isArray(r)||0===r.length)return t;let i=!1;for(const t of r){if("object"!=typeof t||null===t)continue;const e=t.response;if("object"!=typeof e||null===e)continue;if(void 0!==e.embedding){i=!0;break}}return i&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),t}function ps(t,e){const n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function hs(t){return"BATCH_STATE_UNSPECIFIED"===t?"JOB_STATE_UNSPECIFIED":"BATCH_STATE_PENDING"===t?"JOB_STATE_PENDING":"BATCH_STATE_RUNNING"===t?"JOB_STATE_RUNNING":"BATCH_STATE_SUCCEEDED"===t?"JOB_STATE_SUCCEEDED":"BATCH_STATE_FAILED"===t?"JOB_STATE_FAILED":"BATCH_STATE_CANCELLED"===t?"JOB_STATE_CANCELLED":"BATCH_STATE_EXPIRED"===t?"JOB_STATE_EXPIRED":t}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ds(t){const e={},n=pr(t,["responsesFile"]);null!=n&&cr(e,["fileName"],n);const r=pr(t,["inlinedResponses","inlinedResponses"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["response"]);null!=n&&cr(e,["response"],function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["candidates"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["content"]);null!=n&&cr(e,["content"],n);const r=pr(t,["citationMetadata"]);null!=r&&cr(e,["citationMetadata"],function(t){const e={},n=pr(t,["citationSources"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["citations"],t)}return e}(r));const i=pr(t,["tokenCount"]);null!=i&&cr(e,["tokenCount"],i);const s=pr(t,["finishReason"]);null!=s&&cr(e,["finishReason"],s);const o=pr(t,["avgLogprobs"]);null!=o&&cr(e,["avgLogprobs"],o);const a=pr(t,["groundingMetadata"]);null!=a&&cr(e,["groundingMetadata"],a);const l=pr(t,["index"]);null!=l&&cr(e,["index"],l);const u=pr(t,["logprobsResult"]);null!=u&&cr(e,["logprobsResult"],u);const c=pr(t,["safetyRatings"]);if(null!=c){let t=c;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["safetyRatings"],t)}const p=pr(t,["urlContextMetadata"]);null!=p&&cr(e,["urlContextMetadata"],p);return e}(t))),cr(e,["candidates"],t)}const i=pr(t,["modelVersion"]);null!=i&&cr(e,["modelVersion"],i);const s=pr(t,["promptFeedback"]);null!=s&&cr(e,["promptFeedback"],s);const o=pr(t,["responseId"]);null!=o&&cr(e,["responseId"],o);const a=pr(t,["usageMetadata"]);null!=a&&cr(e,["usageMetadata"],a);return e}(n));const r=pr(t,["error"]);null!=r&&cr(e,["error"],r);return e}(t))),cr(e,["inlinedResponses"],t)}const i=pr(t,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["inlinedEmbedContentResponses"],t)}return e}function fs(t){const e={},n=pr(t,["name"]);null!=n&&cr(e,["name"],n);const r=pr(t,["metadata","displayName"]);null!=r&&cr(e,["displayName"],r);const i=pr(t,["metadata","state"]);null!=i&&cr(e,["state"],hs(i));const s=pr(t,["metadata","createTime"]);null!=s&&cr(e,["createTime"],s);const o=pr(t,["metadata","endTime"]);null!=o&&cr(e,["endTime"],o);const a=pr(t,["metadata","updateTime"]);null!=a&&cr(e,["updateTime"],a);const l=pr(t,["metadata","model"]);null!=l&&cr(e,["model"],l);const u=pr(t,["metadata","output"]);return null!=u&&cr(e,["dest"],ds(cs(u))),e}function ms(t){const e={},n=pr(t,["name"]);null!=n&&cr(e,["name"],n);const r=pr(t,["displayName"]);null!=r&&cr(e,["displayName"],r);const i=pr(t,["state"]);null!=i&&cr(e,["state"],hs(i));const s=pr(t,["error"]);null!=s&&cr(e,["error"],s);const o=pr(t,["createTime"]);null!=o&&cr(e,["createTime"],o);const a=pr(t,["startTime"]);null!=a&&cr(e,["startTime"],a);const l=pr(t,["endTime"]);null!=l&&cr(e,["endTime"],l);const u=pr(t,["updateTime"]);null!=u&&cr(e,["updateTime"],u);const c=pr(t,["model"]);null!=c&&cr(e,["model"],c);const p=pr(t,["inputConfig"]);null!=p&&cr(e,["src"],function(t){const e={},n=pr(t,["instancesFormat"]);null!=n&&cr(e,["format"],n);const r=pr(t,["gcsSource","uris"]);null!=r&&cr(e,["gcsUri"],r);const i=pr(t,["bigquerySource","inputUri"]);null!=i&&cr(e,["bigqueryUri"],i);return e}(p));const h=pr(t,["outputConfig"]);return null!=h&&cr(e,["dest"],function(t){const e={},n=pr(t,["predictionsFormat"]);null!=n&&cr(e,["format"],n);const r=pr(t,["gcsDestination","outputUriPrefix"]);null!=r&&cr(e,["gcsUri"],r);const i=pr(t,["bigqueryDestination","outputUri"]);return null!=i&&cr(e,["bigqueryUri"],i),e}(cs(h))),e}function ys(t,e){const n={};if(void 0!==pr(e,["format"]))throw new Error("format parameter is not supported in Gemini API.");if(void 0!==pr(e,["gcsUri"]))throw new Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==pr(e,["bigqueryUri"]))throw new Error("bigqueryUri parameter is not supported in Gemini API.");const r=pr(e,["fileName"]);null!=r&&cr(n,["fileName"],r);const i=pr(e,["inlinedRequests"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>function(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["request","model"],Li(t,r));const i=pr(e,["contents"]);if(null!=i){let t=Yi(i);Array.isArray(t)&&(t=t.map(t=>gs(t))),cr(n,["request","contents"],t)}const s=pr(e,["metadata"]);null!=s&&cr(n,["metadata"],s);const o=pr(e,["config"]);null!=o&&cr(n,["request","generationConfig"],function(t,e,n){const r={},i=pr(e,["systemInstruction"]);void 0!==n&&null!=i&&cr(n,["systemInstruction"],gs(Ji(i)));const s=pr(e,["temperature"]);null!=s&&cr(r,["temperature"],s);const o=pr(e,["topP"]);null!=o&&cr(r,["topP"],o);const a=pr(e,["topK"]);null!=a&&cr(r,["topK"],a);const l=pr(e,["candidateCount"]);null!=l&&cr(r,["candidateCount"],l);const u=pr(e,["maxOutputTokens"]);null!=u&&cr(r,["maxOutputTokens"],u);const c=pr(e,["stopSequences"]);null!=c&&cr(r,["stopSequences"],c);const p=pr(e,["responseLogprobs"]);null!=p&&cr(r,["responseLogprobs"],p);const h=pr(e,["logprobs"]);null!=h&&cr(r,["logprobs"],h);const d=pr(e,["presencePenalty"]);null!=d&&cr(r,["presencePenalty"],d);const f=pr(e,["frequencyPenalty"]);null!=f&&cr(r,["frequencyPenalty"],f);const m=pr(e,["seed"]);null!=m&&cr(r,["seed"],m);const y=pr(e,["responseMimeType"]);null!=y&&cr(r,["responseMimeType"],y);const g=pr(e,["responseSchema"]);null!=g&&cr(r,["responseSchema"],Wi(g));const w=pr(e,["responseJsonSchema"]);null!=w&&cr(r,["responseJsonSchema"],w);if(void 0!==pr(e,["routingConfig"]))throw new Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==pr(e,["modelSelectionConfig"]))throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const v=pr(e,["safetySettings"]);if(void 0!==n&&null!=v){let t=v;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["category"]);null!=n&&cr(e,["category"],n);if(void 0!==pr(t,["method"]))throw new Error("method parameter is not supported in Gemini API.");const r=pr(t,["threshold"]);null!=r&&cr(e,["threshold"],r);return e}(t))),cr(n,["safetySettings"],t)}const E=pr(e,["tools"]);if(void 0!==n&&null!=E){let t=ts(E);Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["functionDeclarations"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["functionDeclarations"],t)}if(void 0!==pr(t,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const r=pr(t,["googleSearchRetrieval"]);null!=r&&cr(e,["googleSearchRetrieval"],r);const i=pr(t,["googleMaps"]);null!=i&&cr(e,["googleMaps"],function(t){const e={};if(void 0!==pr(t,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=pr(t,["enableWidget"]);null!=n&&cr(e,["enableWidget"],n);return e}(i));const s=pr(t,["computerUse"]);null!=s&&cr(e,["computerUse"],s);const o=pr(t,["codeExecution"]);null!=o&&cr(e,["codeExecution"],o);if(void 0!==pr(t,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=pr(t,["googleSearch"]);null!=a&&cr(e,["googleSearch"],function(t){const e={};if(void 0!==pr(t,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");const n=pr(t,["timeRangeFilter"]);null!=n&&cr(e,["timeRangeFilter"],n);return e}(a));const l=pr(t,["urlContext"]);null!=l&&cr(e,["urlContext"],l);return e}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(Zi(t)))),cr(n,["tools"],t)}const T=pr(e,["toolConfig"]);void 0!==n&&null!=T&&cr(n,["toolConfig"],T);if(void 0!==pr(e,["labels"]))throw new Error("labels parameter is not supported in Gemini API.");const I=pr(e,["cachedContent"]);void 0!==n&&null!=I&&cr(n,["cachedContent"],es(t,I));const A=pr(e,["responseModalities"]);null!=A&&cr(r,["responseModalities"],A);const N=pr(e,["mediaResolution"]);null!=N&&cr(r,["mediaResolution"],N);const b=pr(e,["speechConfig"]);null!=b&&cr(r,["speechConfig"],Xi(b));if(void 0!==pr(e,["audioTimestamp"]))throw new Error("audioTimestamp parameter is not supported in Gemini API.");const S=pr(e,["thinkingConfig"]);null!=S&&cr(r,["thinkingConfig"],S);const O=pr(e,["imageConfig"]);null!=O&&cr(r,["imageConfig"],O);return r}(t,o,pr(n,["request"],{})));return n}(t,e))),cr(n,["requests","requests"],e)}return n}function gs(t){const e={},n=pr(t,["parts"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["functionCall"]);null!=n&&cr(e,["functionCall"],n);const r=pr(t,["codeExecutionResult"]);null!=r&&cr(e,["codeExecutionResult"],r);const i=pr(t,["executableCode"]);null!=i&&cr(e,["executableCode"],i);const s=pr(t,["fileData"]);null!=s&&cr(e,["fileData"],function(t){const e={};if(void 0!==pr(t,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=pr(t,["fileUri"]);null!=n&&cr(e,["fileUri"],n);const r=pr(t,["mimeType"]);null!=r&&cr(e,["mimeType"],r);return e}(s));const o=pr(t,["functionResponse"]);null!=o&&cr(e,["functionResponse"],o);const a=pr(t,["inlineData"]);null!=a&&cr(e,["inlineData"],function(t){const e={},n=pr(t,["data"]);if(null!=n&&cr(e,["data"],n),void 0!==pr(t,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const r=pr(t,["mimeType"]);return null!=r&&cr(e,["mimeType"],r),e}(a));const l=pr(t,["text"]);null!=l&&cr(e,["text"],l);const u=pr(t,["thought"]);null!=u&&cr(e,["thought"],u);const c=pr(t,["thoughtSignature"]);null!=c&&cr(e,["thoughtSignature"],c);const p=pr(t,["videoMetadata"]);null!=p&&cr(e,["videoMetadata"],p);return e}(t))),cr(e,["parts"],t)}const r=pr(t,["role"]);return null!=r&&cr(e,["role"],r),e}function ws(t,e){const n=pr(t,["displayName"]);void 0!==e&&null!=n&&cr(e,["displayName"],n);const r=pr(t,["dest"]);return void 0!==e&&null!=r&&cr(e,["outputConfig"],function(t){const e={},n=pr(t,["format"]);null!=n&&cr(e,["predictionsFormat"],n);const r=pr(t,["gcsUri"]);null!=r&&cr(e,["gcsDestination","outputUriPrefix"],r);const i=pr(t,["bigqueryUri"]);if(null!=i&&cr(e,["bigqueryDestination","outputUri"],i),void 0!==pr(t,["fileName"]))throw new Error("fileName parameter is not supported in Vertex AI.");if(void 0!==pr(t,["inlinedResponses"]))throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==pr(t,["inlinedEmbedContentResponses"]))throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}(function(t){if("string"!=typeof t)return t;const e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}(r))),{}}function vs(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["src"]);null!=i&&cr(n,["batch","inputConfig"],ys(t,us(t,i)));const s=pr(e,["config"]);return null!=s&&function(t,e){const n=pr(t,["displayName"]);if(void 0!==e&&null!=n&&cr(e,["batch","displayName"],n),void 0!==pr(t,["dest"]))throw new Error("dest parameter is not supported in Gemini API.")}(s,n),n}function Es(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["model"],Li(t,r));const i=pr(e,["src"]);null!=i&&cr(n,["inputConfig"],function(t){const e={},n=pr(t,["format"]);null!=n&&cr(e,["instancesFormat"],n);const r=pr(t,["gcsUri"]);null!=r&&cr(e,["gcsSource","uris"],r);const i=pr(t,["bigqueryUri"]);if(null!=i&&cr(e,["bigquerySource","inputUri"],i),void 0!==pr(t,["fileName"]))throw new Error("fileName parameter is not supported in Vertex AI.");if(void 0!==pr(t,["inlinedRequests"]))throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}(us(t,i)));const s=pr(e,["config"]);return null!=s&&ws(s,n),n}function Ts(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["src"]);null!=i&&cr(n,["batch","inputConfig"],function(t,e){const n={},r=pr(e,["fileName"]);null!=r&&cr(n,["file_name"],r);const i=pr(e,["inlinedRequests"]);null!=i&&cr(n,["requests"],function(t,e){const n={},r=pr(e,["contents"]);if(null!=r){let e=zi(t,r);Array.isArray(e)&&(e=e.map(t=>t)),cr(n,["requests[]","request","content"],e)}const i=pr(e,["config"]);null!=i&&(cr(n,["_self"],function(t,e){const n={},r=pr(t,["taskType"]);void 0!==e&&null!=r&&cr(e,["requests[]","taskType"],r);const i=pr(t,["title"]);void 0!==e&&null!=i&&cr(e,["requests[]","title"],i);const s=pr(t,["outputDimensionality"]);void 0!==e&&null!=s&&cr(e,["requests[]","outputDimensionality"],s);if(void 0!==pr(t,["mimeType"]))throw new Error("mimeType parameter is not supported in Gemini API.");if(void 0!==pr(t,["autoTruncate"]))throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}(i,n)),function(t,e){for(const[n,r]of Object.entries(e)){const e=n.split("."),i=r.split("."),s=new Set;let o=-1;for(let t=0;t<e.length;t++)if("*"===e[t]){o=t;break}if(-1!==o&&i.length>o)for(let t=o;t<i.length;t++){const e=i[t];"*"===e||e.endsWith("[]")||e.endsWith("[0]")||s.add(e)}hr(t,e,i,0,s)}}(n,{"requests[].*":"requests[].request.*"}));return n}(t,i));return n}(t,i));const s=pr(e,["config"]);return null!=s&&function(t,e){const n=pr(t,["displayName"]);void 0!==e&&null!=n&&cr(e,["batch","displayName"],n)}(s,n),n}function Is(t){const e={},n=pr(t,["config"]);return null!=n&&function(t,e){const n=pr(t,["pageSize"]);void 0!==e&&null!=n&&cr(e,["_query","pageSize"],n);const r=pr(t,["pageToken"]);if(void 0!==e&&null!=r&&cr(e,["_query","pageToken"],r),void 0!==pr(t,["filter"]))throw new Error("filter parameter is not supported in Gemini API.")}(n,e),e}function As(t){const e={},n=pr(t,["config"]);return null!=n&&function(t,e){const n=pr(t,["pageSize"]);void 0!==e&&null!=n&&cr(e,["_query","pageSize"],n);const r=pr(t,["pageToken"]);void 0!==e&&null!=r&&cr(e,["_query","pageToken"],r);const i=pr(t,["filter"]);void 0!==e&&null!=i&&cr(e,["_query","filter"],i)}(n,e),e}!function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents",t.PAGED_ITEM_RAG_STORES="ragStores",t.PAGED_ITEM_DOCUMENTS="documents"}(hi||(hi={}));class Ns{constructor(t,e,n,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=e,this.init(t,n,r)}init(t,e,n){var r,i;this.nameInternal=t,this.pageInternal=e[this.nameInternal]||[],this.sdkHttpResponseInternal=null==e?void 0:e.sdkHttpResponse,this.idxInternal=0;let s={config:{}};s=n&&0!==Object.keys(n).length?"object"==typeof n?Object.assign({},n):n:{config:{}},s.config&&(s.config.pageToken=e.nextPageToken),this.paramsInternal=s,this.pageInternalSize=null!==(i=null===(r=s.config)||void 0===r?void 0:r.pageSize)&&void 0!==i?i:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength){if(!this.hasNextPage())return{value:void 0,done:!0};await this.nextPage()}const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return void 0!==(null===(t=this.params.config)||void 0===t?void 0:t.pageToken)}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class bs extends lr{constructor(t){super(),this.apiClient=t,this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)},this.list=async(t={})=>new Ns(hi.PAGED_ITEM_BATCH_JOBS,t=>this.listInternal(t),await this.listInternal(t),t)}createInlinedGenerateContentRequest(t){const e=vs(this.apiClient,t),n=ur("{model}:batchGenerateContent",e._url),r=e.batch.inputConfig.requests,i=r.requests,s=[];for(const t of i){const e=Object.assign({},t);if(e.systemInstruction){const t=e.systemInstruction;delete e.systemInstruction;const n=e.request;n.systemInstruction=t,e.request=n}s.push(e)}return r.requests=s,delete e.config,delete e._url,delete e._query,{path:n,body:e}}getGcsUri(t){return"string"==typeof t?t.startsWith("gs://")?t:void 0:!Array.isArray(t)&&t.gcsUri&&t.gcsUri.length>0?t.gcsUri[0]:void 0}getBigqueryUri(t){return"string"==typeof t?t.startsWith("bq://")?t:void 0:Array.isArray(t)?void 0:t.bigqueryUri}formatDestination(t,e){const n=e?Object.assign({},e):{},r=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${r}`),void 0===n.dest){const e=this.getGcsUri(t),i=this.getBigqueryUri(t);if(e)e.endsWith(".jsonl")?n.dest=`${e.slice(0,-6)}/dest`:n.dest=`${e}_dest_${r}`;else{if(!i)throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.");n.dest=`${i}_dest_${r}`}}return n}async createInternal(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=Es(this.apiClient,t);return o=ur("batchPredictionJobs",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),s.then(t=>ms(t))}{const e=vs(this.apiClient,t);return o=ur("{model}:batchGenerateContent",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"POST",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json()),s.then(t=>fs(t))}}async createEmbeddingsInternal(t){var e,n;let r,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=Ts(this.apiClient,t);return i=ur("{model}:asyncBatchEmbedContent",o._url),s=o._query,delete o._url,delete o._query,r=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),r.then(t=>fs(t))}}async get(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=function(t,e){const n={},r=pr(e,["name"]);return null!=r&&cr(n,["_url","name"],ps(t,r)),n}(this.apiClient,t);return o=ur("batchPredictionJobs/{name}",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),s.then(t=>ms(t))}{const e=function(t,e){const n={},r=pr(e,["name"]);return null!=r&&cr(n,["_url","name"],ps(t,r)),n}(this.apiClient,t);return o=ur("batches/{name}",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"GET",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json()),s.then(t=>fs(t))}}async cancel(t){var e,n,r,i;let s="",o={};if(this.apiClient.isVertexAI()){const r=function(t,e){const n={},r=pr(e,["name"]);return null!=r&&cr(n,["_url","name"],ps(t,r)),n}(this.apiClient,t);s=ur("batchPredictionJobs/{name}:cancel",r._url),o=r._query,delete r._url,delete r._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal})}else{const e=function(t,e){const n={},r=pr(e,["name"]);return null!=r&&cr(n,["_url","name"],ps(t,r)),n}(this.apiClient,t);s=ur("batches/{name}:cancel",e._url),o=e._query,delete e._url,delete e._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(e),httpMethod:"POST",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal})}}async listInternal(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=As(t);return o=ur("batchPredictionJobs",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["nextPageToken"]);null!=r&&cr(e,["nextPageToken"],r);const i=pr(t,["batchPredictionJobs"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>ms(t))),cr(e,["batchJobs"],t)}return e}(t),n=new Ri;return Object.assign(n,e),n})}{const e=Is(t);return o=ur("batches",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"GET",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["nextPageToken"]);null!=r&&cr(e,["nextPageToken"],r);const i=pr(t,["operations"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>fs(t))),cr(e,["batchJobs"],t)}return e}(t),n=new Ri;return Object.assign(n,e),n})}}async delete(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=function(t,e){const n={},r=pr(e,["name"]);return null!=r&&cr(n,["_url","name"],ps(t,r)),n}(this.apiClient,t);return o=ur("batchPredictionJobs/{name}",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["name"]);null!=r&&cr(e,["name"],r);const i=pr(t,["done"]);null!=i&&cr(e,["done"],i);const s=pr(t,["error"]);return null!=s&&cr(e,["error"],s),e}(t))}{const e=function(t,e){const n={},r=pr(e,["name"]);return null!=r&&cr(n,["_url","name"],ps(t,r)),n}(this.apiClient,t);return o=ur("batches/{name}",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"DELETE",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["name"]);null!=r&&cr(e,["name"],r);const i=pr(t,["done"]);null!=i&&cr(e,["done"],i);const s=pr(t,["error"]);return null!=s&&cr(e,["error"],s),e}(t))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ss(t){const e={},n=pr(t,["parts"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["functionCall"]);null!=n&&cr(e,["functionCall"],n);const r=pr(t,["codeExecutionResult"]);null!=r&&cr(e,["codeExecutionResult"],r);const i=pr(t,["executableCode"]);null!=i&&cr(e,["executableCode"],i);const s=pr(t,["fileData"]);null!=s&&cr(e,["fileData"],function(t){const e={};if(void 0!==pr(t,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=pr(t,["fileUri"]);null!=n&&cr(e,["fileUri"],n);const r=pr(t,["mimeType"]);null!=r&&cr(e,["mimeType"],r);return e}(s));const o=pr(t,["functionResponse"]);null!=o&&cr(e,["functionResponse"],o);const a=pr(t,["inlineData"]);null!=a&&cr(e,["inlineData"],function(t){const e={},n=pr(t,["data"]);if(null!=n&&cr(e,["data"],n),void 0!==pr(t,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const r=pr(t,["mimeType"]);return null!=r&&cr(e,["mimeType"],r),e}(a));const l=pr(t,["text"]);null!=l&&cr(e,["text"],l);const u=pr(t,["thought"]);null!=u&&cr(e,["thought"],u);const c=pr(t,["thoughtSignature"]);null!=c&&cr(e,["thoughtSignature"],c);const p=pr(t,["videoMetadata"]);null!=p&&cr(e,["videoMetadata"],p);return e}(t))),cr(e,["parts"],t)}const r=pr(t,["role"]);return null!=r&&cr(e,["role"],r),e}function Os(t,e){const n=pr(t,["ttl"]);void 0!==e&&null!=n&&cr(e,["ttl"],n);const r=pr(t,["expireTime"]);void 0!==e&&null!=r&&cr(e,["expireTime"],r);const i=pr(t,["displayName"]);void 0!==e&&null!=i&&cr(e,["displayName"],i);const s=pr(t,["contents"]);if(void 0!==e&&null!=s){let t=Yi(s);Array.isArray(t)&&(t=t.map(t=>Ss(t))),cr(e,["contents"],t)}const o=pr(t,["systemInstruction"]);void 0!==e&&null!=o&&cr(e,["systemInstruction"],Ss(Ji(o)));const a=pr(t,["tools"]);if(void 0!==e&&null!=a){let t=a;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["functionDeclarations"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["functionDeclarations"],t)}if(void 0!==pr(t,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const r=pr(t,["googleSearchRetrieval"]);null!=r&&cr(e,["googleSearchRetrieval"],r);const i=pr(t,["googleMaps"]);null!=i&&cr(e,["googleMaps"],function(t){const e={};if(void 0!==pr(t,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=pr(t,["enableWidget"]);null!=n&&cr(e,["enableWidget"],n);return e}(i));const s=pr(t,["computerUse"]);null!=s&&cr(e,["computerUse"],s);const o=pr(t,["codeExecution"]);null!=o&&cr(e,["codeExecution"],o);if(void 0!==pr(t,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=pr(t,["googleSearch"]);null!=a&&cr(e,["googleSearch"],function(t){const e={};if(void 0!==pr(t,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");const n=pr(t,["timeRangeFilter"]);null!=n&&cr(e,["timeRangeFilter"],n);return e}(a));const l=pr(t,["urlContext"]);null!=l&&cr(e,["urlContext"],l);return e}(t))),cr(e,["tools"],t)}const l=pr(t,["toolConfig"]);if(void 0!==e&&null!=l&&cr(e,["toolConfig"],l),void 0!==pr(t,["kmsKeyName"]))throw new Error("kmsKeyName parameter is not supported in Gemini API.");return{}}function _s(t,e){const n=pr(t,["ttl"]);void 0!==e&&null!=n&&cr(e,["ttl"],n);const r=pr(t,["expireTime"]);void 0!==e&&null!=r&&cr(e,["expireTime"],r);const i=pr(t,["displayName"]);void 0!==e&&null!=i&&cr(e,["displayName"],i);const s=pr(t,["contents"]);if(void 0!==e&&null!=s){let t=Yi(s);Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["contents"],t)}const o=pr(t,["systemInstruction"]);void 0!==e&&null!=o&&cr(e,["systemInstruction"],Ji(o));const a=pr(t,["tools"]);if(void 0!==e&&null!=a){let t=a;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["functionDeclarations"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>function(t){const e={};if(void 0!==pr(t,["behavior"]))throw new Error("behavior parameter is not supported in Vertex AI.");const n=pr(t,["description"]);null!=n&&cr(e,["description"],n);const r=pr(t,["name"]);null!=r&&cr(e,["name"],r);const i=pr(t,["parameters"]);null!=i&&cr(e,["parameters"],i);const s=pr(t,["parametersJsonSchema"]);null!=s&&cr(e,["parametersJsonSchema"],s);const o=pr(t,["response"]);null!=o&&cr(e,["response"],o);const a=pr(t,["responseJsonSchema"]);null!=a&&cr(e,["responseJsonSchema"],a);return e}(t))),cr(e,["functionDeclarations"],t)}const r=pr(t,["retrieval"]);null!=r&&cr(e,["retrieval"],r);const i=pr(t,["googleSearchRetrieval"]);null!=i&&cr(e,["googleSearchRetrieval"],i);const s=pr(t,["googleMaps"]);null!=s&&cr(e,["googleMaps"],s);const o=pr(t,["computerUse"]);null!=o&&cr(e,["computerUse"],o);const a=pr(t,["codeExecution"]);null!=a&&cr(e,["codeExecution"],a);const l=pr(t,["enterpriseWebSearch"]);null!=l&&cr(e,["enterpriseWebSearch"],l);const u=pr(t,["googleSearch"]);null!=u&&cr(e,["googleSearch"],u);const c=pr(t,["urlContext"]);null!=c&&cr(e,["urlContext"],c);return e}(t))),cr(e,["tools"],t)}const l=pr(t,["toolConfig"]);void 0!==e&&null!=l&&cr(e,["toolConfig"],l);const u=pr(t,["kmsKeyName"]);return void 0!==e&&null!=u&&cr(e,["encryption_spec","kmsKeyName"],u),{}}function Ps(t){const e={},n=pr(t,["config"]);return null!=n&&function(t,e){const n=pr(t,["pageSize"]);void 0!==e&&null!=n&&cr(e,["_query","pageSize"],n);const r=pr(t,["pageToken"]);void 0!==e&&null!=r&&cr(e,["_query","pageToken"],r)}(n,e),e}function Cs(t){const e={},n=pr(t,["config"]);return null!=n&&function(t,e){const n=pr(t,["pageSize"]);void 0!==e&&null!=n&&cr(e,["_query","pageSize"],n);const r=pr(t,["pageToken"]);void 0!==e&&null!=r&&cr(e,["_query","pageToken"],r)}(n,e),e}function xs(t,e){const n={},r=pr(e,["name"]);null!=r&&cr(n,["_url","name"],es(t,r));const i=pr(e,["config"]);return null!=i&&function(t,e){const n=pr(t,["ttl"]);void 0!==e&&null!=n&&cr(e,["ttl"],n);const r=pr(t,["expireTime"]);void 0!==e&&null!=r&&cr(e,["expireTime"],r)}(i,n),n}function Rs(t,e){const n={},r=pr(e,["name"]);null!=r&&cr(n,["_url","name"],es(t,r));const i=pr(e,["config"]);return null!=i&&function(t,e){const n=pr(t,["ttl"]);void 0!==e&&null!=n&&cr(e,["ttl"],n);const r=pr(t,["expireTime"]);void 0!==e&&null!=r&&cr(e,["expireTime"],r)}(i,n),n}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ks extends lr{constructor(t){super(),this.apiClient=t,this.list=async(t={})=>new Ns(hi.PAGED_ITEM_CACHED_CONTENTS,t=>this.listInternal(t),await this.listInternal(t),t)}async create(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=function(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["model"],Di(t,r));const i=pr(e,["config"]);return null!=i&&_s(i,n),n}(this.apiClient,t);return o=ur("cachedContents",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),s.then(t=>t)}{const e=function(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["model"],Di(t,r));const i=pr(e,["config"]);return null!=i&&Os(i,n),n}(this.apiClient,t);return o=ur("cachedContents",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"POST",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json()),s.then(t=>t)}}async get(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=function(t,e){const n={},r=pr(e,["name"]);return null!=r&&cr(n,["_url","name"],es(t,r)),n}(this.apiClient,t);return o=ur("{name}",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),s.then(t=>t)}{const e=function(t,e){const n={},r=pr(e,["name"]);return null!=r&&cr(n,["_url","name"],es(t,r)),n}(this.apiClient,t);return o=ur("{name}",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"GET",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json()),s.then(t=>t)}}async delete(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=function(t,e){const n={},r=pr(e,["name"]);return null!=r&&cr(n,["_url","name"],es(t,r)),n}(this.apiClient,t);return o=ur("{name}",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);return null!=n&&cr(e,["sdkHttpResponse"],n),e}(t),n=new Oi;return Object.assign(n,e),n})}{const e=function(t,e){const n={},r=pr(e,["name"]);return null!=r&&cr(n,["_url","name"],es(t,r)),n}(this.apiClient,t);return o=ur("{name}",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"DELETE",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);return null!=n&&cr(e,["sdkHttpResponse"],n),e}(t),n=new Oi;return Object.assign(n,e),n})}}async update(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=Rs(this.apiClient,t);return o=ur("{name}",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"PATCH",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),s.then(t=>t)}{const e=xs(this.apiClient,t);return o=ur("{name}",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"PATCH",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json()),s.then(t=>t)}}async listInternal(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=Cs(t);return o=ur("cachedContents",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["nextPageToken"]);null!=r&&cr(e,["nextPageToken"],r);const i=pr(t,["cachedContents"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["cachedContents"],t)}return e}(t),n=new _i;return Object.assign(n,e),n})}{const e=Ps(t);return o=ur("cachedContents",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"GET",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["nextPageToken"]);null!=r&&cr(e,["nextPageToken"],r);const i=pr(t,["cachedContents"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["cachedContents"],t)}return e}(t),n=new _i;return Object.assign(n,e),n})}}}function Ms(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ls(t){return this instanceof Ls?(this.v=t,this):new Ls(t)}function Ds(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),s=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(t){return function(e){return Promise.resolve(e).then(t,u)}}),r[Symbol.asyncIterator]=function(){return this},r;function o(t,e){i[t]&&(r[t]=function(e){return new Promise(function(n,r){s.push([t,e,n,r])>1||a(t,e)})},e&&(r[t]=e(r[t])))}function a(t,e){try{(n=i[t](e)).value instanceof Ls?Promise.resolve(n.value.v).then(l,u):c(s[0][2],n)}catch(t){c(s[0][3],t)}var n}function l(t){a("next",t)}function u(t){a("throw",t)}function c(t,e){t(e),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Us(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=Ms(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise(function(r,i){(function(t,e,n,r){Promise.resolve(r).then(function(e){t({value:e,done:n})},e)})(r,i,(e=t[n](e)).done,e.value)})}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
function qs(t){var e;if(null==t.candidates||0===t.candidates.length)return!1;const n=null===(e=t.candidates[0])||void 0===e?void 0:e.content;return void 0!==n&&Gs(n)}function Gs(t){if(void 0===t.parts||0===t.parts.length)return!1;for(const e of t.parts)if(void 0===e||0===Object.keys(e).length)return!1;return!0}function $s(t){if(void 0===t||0===t.length)return[];const e=[],n=t.length;let r=0;for(;r<n;)if("user"===t[r].role)e.push(t[r]),r++;else{const i=[];let s=!0;for(;r<n&&"model"===t[r].role;)i.push(t[r]),s&&!Gs(t[r])&&(s=!1),r++;s?e.push(...i):e.pop()}return e}"function"==typeof SuppressedError&&SuppressedError;class Bs{constructor(t,e){this.modelsModule=t,this.apiClient=e}create(t){return new Hs(this.apiClient,this.modelsModule,t.model,t.config,structuredClone(t.history))}}class Hs{constructor(t,e,n,r={},i=[]){this.apiClient=t,this.modelsModule=e,this.model=n,this.config=r,this.history=i,this.sendPromise=Promise.resolve(),function(t){if(0!==t.length)for(const e of t)if("user"!==e.role&&"model"!==e.role)throw new Error(`Role must be user or model, but got ${e.role}.`)}(i)}async sendMessage(t){var e;await this.sendPromise;const n=Ji(t.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:null!==(e=t.config)&&void 0!==e?e:this.config});return this.sendPromise=(async()=>{var t,e,i;const s=await r,o=null===(e=null===(t=s.candidates)||void 0===t?void 0:t[0])||void 0===e?void 0:e.content,a=s.automaticFunctionCallingHistory,l=this.getHistory(!0).length;let u=[];null!=a&&(u=null!==(i=a.slice(l))&&void 0!==i?i:[]);const c=o?[o]:[];this.recordHistory(n,c,u)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(t){var e;await this.sendPromise;const n=Ji(t.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:null!==(e=t.config)&&void 0!==e?e:this.config});this.sendPromise=r.then(()=>{}).catch(()=>{});const i=await r;return this.processStreamResponse(i,n)}getHistory(t=!1){const e=t?$s(this.history):this.history;return structuredClone(e)}processStreamResponse(t,e){var n,r;return Ds(this,arguments,function*(){var i,s,o,a;const l=[];try{for(var u,c=!0,p=Us(t);!(i=(u=yield Ls(p.next())).done);c=!0){a=u.value,c=!1;const t=a;if(qs(t)){const e=null===(r=null===(n=t.candidates)||void 0===n?void 0:n[0])||void 0===r?void 0:r.content;void 0!==e&&l.push(e)}yield yield Ls(t)}}catch(t){s={error:t}}finally{try{c||i||!(o=p.return)||(yield Ls(o.call(p)))}finally{if(s)throw s.error}}this.recordHistory(e,l)})}recordHistory(t,e,n){let r=[];e.length>0&&e.every(t=>void 0!==t.role)?r=e:r.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...$s(n)):this.history.push(t),this.history.push(...r)}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Fs extends Error{constructor(t){super(t.message),this.name="ApiError",this.status=t.status,Object.setPrototypeOf(this,Fs.prototype)}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Vs(t){const e={},n=pr(t,["config"]);return null!=n&&function(t,e){const n=pr(t,["pageSize"]);void 0!==e&&null!=n&&cr(e,["_query","pageSize"],n);const r=pr(t,["pageToken"]);void 0!==e&&null!=r&&cr(e,["_query","pageToken"],r)}(n,e),e}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */
class js extends lr{constructor(t){super(),this.apiClient=t,this.list=async(t={})=>new Ns(hi.PAGED_ITEM_FILES,t=>this.listInternal(t),await this.listInternal(t),t)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(t=>t)}async download(t){await this.apiClient.downloadFile(t)}async listInternal(t){var e,n;let r,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=Vs(t);return i=ur("files",o._url),s=o._query,delete o._url,delete o._query,r=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),r.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["nextPageToken"]);null!=r&&cr(e,["nextPageToken"],r);const i=pr(t,["files"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["files"],t)}return e}(t),n=new Pi;return Object.assign(n,e),n})}}async createInternal(t){var e,n;let r,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=function(t){const e={},n=pr(t,["file"]);return null!=n&&cr(e,["file"],n),e}(t);return i=ur("upload/v1beta/files",o._url),s=o._query,delete o._url,delete o._query,r=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),r.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);return null!=n&&cr(e,["sdkHttpResponse"],n),e}(t),n=new Ci;return Object.assign(n,e),n})}}async get(t){var e,n;let r,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=function(t){const e={},n=pr(t,["name"]);return null!=n&&cr(e,["_url","file"],is(n)),e}(t);return i=ur("files/{file}",o._url),s=o._query,delete o._url,delete o._query,r=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),r.then(t=>t)}}async delete(t){var e,n;let r,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=function(t){const e={},n=pr(t,["name"]);return null!=n&&cr(e,["_url","file"],is(n)),e}(t);return i=ur("files/{file}",o._url),s=o._query,delete o._url,delete o._query,r=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),r.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);return null!=n&&cr(e,["sdkHttpResponse"],n),e}(t),n=new xi;return Object.assign(n,e),n})}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Js(t){const e={},n=pr(t,["data"]);if(null!=n&&cr(e,["data"],n),void 0!==pr(t,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const r=pr(t,["mimeType"]);return null!=r&&cr(e,["mimeType"],r),e}function zs(t){const e={},n=pr(t,["parts"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["functionCall"]);null!=n&&cr(e,["functionCall"],n);const r=pr(t,["codeExecutionResult"]);null!=r&&cr(e,["codeExecutionResult"],r);const i=pr(t,["executableCode"]);null!=i&&cr(e,["executableCode"],i);const s=pr(t,["fileData"]);null!=s&&cr(e,["fileData"],function(t){const e={};if(void 0!==pr(t,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=pr(t,["fileUri"]);null!=n&&cr(e,["fileUri"],n);const r=pr(t,["mimeType"]);null!=r&&cr(e,["mimeType"],r);return e}(s));const o=pr(t,["functionResponse"]);null!=o&&cr(e,["functionResponse"],o);const a=pr(t,["inlineData"]);null!=a&&cr(e,["inlineData"],Js(a));const l=pr(t,["text"]);null!=l&&cr(e,["text"],l);const u=pr(t,["thought"]);null!=u&&cr(e,["thought"],u);const c=pr(t,["thoughtSignature"]);null!=c&&cr(e,["thoughtSignature"],c);const p=pr(t,["videoMetadata"]);null!=p&&cr(e,["videoMetadata"],p);return e}(t))),cr(e,["parts"],t)}const r=pr(t,["role"]);return null!=r&&cr(e,["role"],r),e}function Ys(t,e){const n=pr(t,["generationConfig"]);void 0!==e&&null!=n&&cr(e,["setup","generationConfig"],n);const r=pr(t,["responseModalities"]);void 0!==e&&null!=r&&cr(e,["setup","generationConfig","responseModalities"],r);const i=pr(t,["temperature"]);void 0!==e&&null!=i&&cr(e,["setup","generationConfig","temperature"],i);const s=pr(t,["topP"]);void 0!==e&&null!=s&&cr(e,["setup","generationConfig","topP"],s);const o=pr(t,["topK"]);void 0!==e&&null!=o&&cr(e,["setup","generationConfig","topK"],o);const a=pr(t,["maxOutputTokens"]);void 0!==e&&null!=a&&cr(e,["setup","generationConfig","maxOutputTokens"],a);const l=pr(t,["mediaResolution"]);void 0!==e&&null!=l&&cr(e,["setup","generationConfig","mediaResolution"],l);const u=pr(t,["seed"]);void 0!==e&&null!=u&&cr(e,["setup","generationConfig","seed"],u);const c=pr(t,["speechConfig"]);void 0!==e&&null!=c&&cr(e,["setup","generationConfig","speechConfig"],Qi(c));const p=pr(t,["thinkingConfig"]);void 0!==e&&null!=p&&cr(e,["setup","generationConfig","thinkingConfig"],p);const h=pr(t,["enableAffectiveDialog"]);void 0!==e&&null!=h&&cr(e,["setup","generationConfig","enableAffectiveDialog"],h);const d=pr(t,["systemInstruction"]);void 0!==e&&null!=d&&cr(e,["setup","systemInstruction"],zs(Ji(d)));const f=pr(t,["tools"]);if(void 0!==e&&null!=f){let t=ts(f);Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["functionDeclarations"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["functionDeclarations"],t)}if(void 0!==pr(t,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const r=pr(t,["googleSearchRetrieval"]);null!=r&&cr(e,["googleSearchRetrieval"],r);const i=pr(t,["googleMaps"]);null!=i&&cr(e,["googleMaps"],function(t){const e={};if(void 0!==pr(t,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=pr(t,["enableWidget"]);return null!=n&&cr(e,["enableWidget"],n),e}(i));const s=pr(t,["computerUse"]);null!=s&&cr(e,["computerUse"],s);const o=pr(t,["codeExecution"]);null!=o&&cr(e,["codeExecution"],o);if(void 0!==pr(t,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=pr(t,["googleSearch"]);null!=a&&cr(e,["googleSearch"],function(t){const e={};if(void 0!==pr(t,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");const n=pr(t,["timeRangeFilter"]);return null!=n&&cr(e,["timeRangeFilter"],n),e}(a));const l=pr(t,["urlContext"]);null!=l&&cr(e,["urlContext"],l);return e}(Zi(t)))),cr(e,["setup","tools"],t)}const m=pr(t,["sessionResumption"]);void 0!==e&&null!=m&&cr(e,["setup","sessionResumption"],function(t){const e={},n=pr(t,["handle"]);null!=n&&cr(e,["handle"],n);if(void 0!==pr(t,["transparent"]))throw new Error("transparent parameter is not supported in Gemini API.");return e}(m));const y=pr(t,["inputAudioTranscription"]);void 0!==e&&null!=y&&cr(e,["setup","inputAudioTranscription"],y);const g=pr(t,["outputAudioTranscription"]);void 0!==e&&null!=g&&cr(e,["setup","outputAudioTranscription"],g);const w=pr(t,["realtimeInputConfig"]);void 0!==e&&null!=w&&cr(e,["setup","realtimeInputConfig"],w);const v=pr(t,["contextWindowCompression"]);void 0!==e&&null!=v&&cr(e,["setup","contextWindowCompression"],v);const E=pr(t,["proactivity"]);return void 0!==e&&null!=E&&cr(e,["setup","proactivity"],E),{}}function Ks(t,e){const n=pr(t,["generationConfig"]);void 0!==e&&null!=n&&cr(e,["setup","generationConfig"],function(t){const e={},n=pr(t,["modelSelectionConfig"]);null!=n&&cr(e,["modelConfig"],n);const r=pr(t,["audioTimestamp"]);null!=r&&cr(e,["audioTimestamp"],r);const i=pr(t,["candidateCount"]);null!=i&&cr(e,["candidateCount"],i);const s=pr(t,["enableAffectiveDialog"]);null!=s&&cr(e,["enableAffectiveDialog"],s);const o=pr(t,["frequencyPenalty"]);null!=o&&cr(e,["frequencyPenalty"],o);const a=pr(t,["logprobs"]);null!=a&&cr(e,["logprobs"],a);const l=pr(t,["maxOutputTokens"]);null!=l&&cr(e,["maxOutputTokens"],l);const u=pr(t,["mediaResolution"]);null!=u&&cr(e,["mediaResolution"],u);const c=pr(t,["presencePenalty"]);null!=c&&cr(e,["presencePenalty"],c);const p=pr(t,["responseJsonSchema"]);null!=p&&cr(e,["responseJsonSchema"],p);const h=pr(t,["responseLogprobs"]);null!=h&&cr(e,["responseLogprobs"],h);const d=pr(t,["responseMimeType"]);null!=d&&cr(e,["responseMimeType"],d);const f=pr(t,["responseModalities"]);null!=f&&cr(e,["responseModalities"],f);const m=pr(t,["responseSchema"]);null!=m&&cr(e,["responseSchema"],m);const y=pr(t,["routingConfig"]);null!=y&&cr(e,["routingConfig"],y);const g=pr(t,["seed"]);null!=g&&cr(e,["seed"],g);const w=pr(t,["speechConfig"]);null!=w&&cr(e,["speechConfig"],Zs(w));const v=pr(t,["stopSequences"]);null!=v&&cr(e,["stopSequences"],v);const E=pr(t,["temperature"]);null!=E&&cr(e,["temperature"],E);const T=pr(t,["thinkingConfig"]);null!=T&&cr(e,["thinkingConfig"],T);const I=pr(t,["topK"]);null!=I&&cr(e,["topK"],I);const A=pr(t,["topP"]);if(null!=A&&cr(e,["topP"],A),void 0!==pr(t,["enableEnhancedCivicAnswers"]))throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}(n));const r=pr(t,["responseModalities"]);void 0!==e&&null!=r&&cr(e,["setup","generationConfig","responseModalities"],r);const i=pr(t,["temperature"]);void 0!==e&&null!=i&&cr(e,["setup","generationConfig","temperature"],i);const s=pr(t,["topP"]);void 0!==e&&null!=s&&cr(e,["setup","generationConfig","topP"],s);const o=pr(t,["topK"]);void 0!==e&&null!=o&&cr(e,["setup","generationConfig","topK"],o);const a=pr(t,["maxOutputTokens"]);void 0!==e&&null!=a&&cr(e,["setup","generationConfig","maxOutputTokens"],a);const l=pr(t,["mediaResolution"]);void 0!==e&&null!=l&&cr(e,["setup","generationConfig","mediaResolution"],l);const u=pr(t,["seed"]);void 0!==e&&null!=u&&cr(e,["setup","generationConfig","seed"],u);const c=pr(t,["speechConfig"]);void 0!==e&&null!=c&&cr(e,["setup","generationConfig","speechConfig"],Zs(Qi(c)));const p=pr(t,["thinkingConfig"]);void 0!==e&&null!=p&&cr(e,["setup","generationConfig","thinkingConfig"],p);const h=pr(t,["enableAffectiveDialog"]);void 0!==e&&null!=h&&cr(e,["setup","generationConfig","enableAffectiveDialog"],h);const d=pr(t,["systemInstruction"]);void 0!==e&&null!=d&&cr(e,["setup","systemInstruction"],Ji(d));const f=pr(t,["tools"]);if(void 0!==e&&null!=f){let t=ts(f);Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["functionDeclarations"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>function(t){const e={};if(void 0!==pr(t,["behavior"]))throw new Error("behavior parameter is not supported in Vertex AI.");const n=pr(t,["description"]);null!=n&&cr(e,["description"],n);const r=pr(t,["name"]);null!=r&&cr(e,["name"],r);const i=pr(t,["parameters"]);null!=i&&cr(e,["parameters"],i);const s=pr(t,["parametersJsonSchema"]);null!=s&&cr(e,["parametersJsonSchema"],s);const o=pr(t,["response"]);null!=o&&cr(e,["response"],o);const a=pr(t,["responseJsonSchema"]);return null!=a&&cr(e,["responseJsonSchema"],a),e}(t))),cr(e,["functionDeclarations"],t)}const r=pr(t,["retrieval"]);null!=r&&cr(e,["retrieval"],r);const i=pr(t,["googleSearchRetrieval"]);null!=i&&cr(e,["googleSearchRetrieval"],i);const s=pr(t,["googleMaps"]);null!=s&&cr(e,["googleMaps"],s);const o=pr(t,["computerUse"]);null!=o&&cr(e,["computerUse"],o);const a=pr(t,["codeExecution"]);null!=a&&cr(e,["codeExecution"],a);const l=pr(t,["enterpriseWebSearch"]);null!=l&&cr(e,["enterpriseWebSearch"],l);const u=pr(t,["googleSearch"]);null!=u&&cr(e,["googleSearch"],u);const c=pr(t,["urlContext"]);null!=c&&cr(e,["urlContext"],c);return e}(Zi(t)))),cr(e,["setup","tools"],t)}const m=pr(t,["sessionResumption"]);void 0!==e&&null!=m&&cr(e,["setup","sessionResumption"],m);const y=pr(t,["inputAudioTranscription"]);void 0!==e&&null!=y&&cr(e,["setup","inputAudioTranscription"],y);const g=pr(t,["outputAudioTranscription"]);void 0!==e&&null!=g&&cr(e,["setup","outputAudioTranscription"],g);const w=pr(t,["realtimeInputConfig"]);void 0!==e&&null!=w&&cr(e,["setup","realtimeInputConfig"],w);const v=pr(t,["contextWindowCompression"]);void 0!==e&&null!=v&&cr(e,["setup","contextWindowCompression"],v);const E=pr(t,["proactivity"]);return void 0!==e&&null!=E&&cr(e,["setup","proactivity"],E),{}}function Ws(t){const e={},n=pr(t,["media"]);if(null!=n){let t=Ui(n);Array.isArray(t)&&(t=t.map(t=>Js(t))),cr(e,["mediaChunks"],t)}const r=pr(t,["audio"]);null!=r&&cr(e,["audio"],Js($i(r)));const i=pr(t,["audioStreamEnd"]);null!=i&&cr(e,["audioStreamEnd"],i);const s=pr(t,["video"]);null!=s&&cr(e,["video"],Js(Gi(s)));const o=pr(t,["text"]);null!=o&&cr(e,["text"],o);const a=pr(t,["activityStart"]);null!=a&&cr(e,["activityStart"],a);const l=pr(t,["activityEnd"]);return null!=l&&cr(e,["activityEnd"],l),e}function Xs(t){const e={},n=pr(t,["media"]);if(null!=n){let t=Ui(n);Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["mediaChunks"],t)}const r=pr(t,["audio"]);null!=r&&cr(e,["audio"],$i(r));const i=pr(t,["audioStreamEnd"]);null!=i&&cr(e,["audioStreamEnd"],i);const s=pr(t,["video"]);null!=s&&cr(e,["video"],Gi(s));const o=pr(t,["text"]);null!=o&&cr(e,["text"],o);const a=pr(t,["activityStart"]);null!=a&&cr(e,["activityStart"],a);const l=pr(t,["activityEnd"]);return null!=l&&cr(e,["activityEnd"],l),e}function Qs(t){const e={},n=pr(t,["setupComplete"]);null!=n&&cr(e,["setupComplete"],n);const r=pr(t,["serverContent"]);null!=r&&cr(e,["serverContent"],r);const i=pr(t,["toolCall"]);null!=i&&cr(e,["toolCall"],i);const s=pr(t,["toolCallCancellation"]);null!=s&&cr(e,["toolCallCancellation"],s);const o=pr(t,["usageMetadata"]);null!=o&&cr(e,["usageMetadata"],function(t){const e={},n=pr(t,["promptTokenCount"]);null!=n&&cr(e,["promptTokenCount"],n);const r=pr(t,["cachedContentTokenCount"]);null!=r&&cr(e,["cachedContentTokenCount"],r);const i=pr(t,["candidatesTokenCount"]);null!=i&&cr(e,["responseTokenCount"],i);const s=pr(t,["toolUsePromptTokenCount"]);null!=s&&cr(e,["toolUsePromptTokenCount"],s);const o=pr(t,["thoughtsTokenCount"]);null!=o&&cr(e,["thoughtsTokenCount"],o);const a=pr(t,["totalTokenCount"]);null!=a&&cr(e,["totalTokenCount"],a);const l=pr(t,["promptTokensDetails"]);if(null!=l){let t=l;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["promptTokensDetails"],t)}const u=pr(t,["cacheTokensDetails"]);if(null!=u){let t=u;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["cacheTokensDetails"],t)}const c=pr(t,["candidatesTokensDetails"]);if(null!=c){let t=c;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["responseTokensDetails"],t)}const p=pr(t,["toolUsePromptTokensDetails"]);if(null!=p){let t=p;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["toolUsePromptTokensDetails"],t)}const h=pr(t,["trafficType"]);null!=h&&cr(e,["trafficType"],h);return e}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(o));const a=pr(t,["goAway"]);null!=a&&cr(e,["goAway"],a);const l=pr(t,["sessionResumptionUpdate"]);return null!=l&&cr(e,["sessionResumptionUpdate"],l),e}function Zs(t){const e={},n=pr(t,["languageCode"]);null!=n&&cr(e,["languageCode"],n);const r=pr(t,["voiceConfig"]);if(null!=r&&cr(e,["voiceConfig"],r),void 0!==pr(t,["multiSpeakerVoiceConfig"]))throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function to(t){const e={},n=pr(t,["content"]);null!=n&&cr(e,["content"],n);const r=pr(t,["citationMetadata"]);null!=r&&cr(e,["citationMetadata"],function(t){const e={},n=pr(t,["citationSources"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["citations"],t)}return e}(r));const i=pr(t,["tokenCount"]);null!=i&&cr(e,["tokenCount"],i);const s=pr(t,["finishReason"]);null!=s&&cr(e,["finishReason"],s);const o=pr(t,["avgLogprobs"]);null!=o&&cr(e,["avgLogprobs"],o);const a=pr(t,["groundingMetadata"]);null!=a&&cr(e,["groundingMetadata"],a);const l=pr(t,["index"]);null!=l&&cr(e,["index"],l);const u=pr(t,["logprobsResult"]);null!=u&&cr(e,["logprobsResult"],u);const c=pr(t,["safetyRatings"]);if(null!=c){let t=c;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["safetyRatings"],t)}const p=pr(t,["urlContextMetadata"]);return null!=p&&cr(e,["urlContextMetadata"],p),e}function eo(t){const e={},n=pr(t,["values"]);null!=n&&cr(e,["values"],n);const r=pr(t,["statistics"]);return null!=r&&cr(e,["statistics"],function(t){const e={},n=pr(t,["truncated"]);null!=n&&cr(e,["truncated"],n);const r=pr(t,["token_count"]);null!=r&&cr(e,["tokenCount"],r);return e}(r)),e}function no(t){const e={},n=pr(t,["parts"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["functionCall"]);null!=n&&cr(e,["functionCall"],n);const r=pr(t,["codeExecutionResult"]);null!=r&&cr(e,["codeExecutionResult"],r);const i=pr(t,["executableCode"]);null!=i&&cr(e,["executableCode"],i);const s=pr(t,["fileData"]);null!=s&&cr(e,["fileData"],function(t){const e={};if(void 0!==pr(t,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=pr(t,["fileUri"]);null!=n&&cr(e,["fileUri"],n);const r=pr(t,["mimeType"]);null!=r&&cr(e,["mimeType"],r);return e}(s));const o=pr(t,["functionResponse"]);null!=o&&cr(e,["functionResponse"],o);const a=pr(t,["inlineData"]);null!=a&&cr(e,["inlineData"],function(t){const e={},n=pr(t,["data"]);if(null!=n&&cr(e,["data"],n),void 0!==pr(t,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const r=pr(t,["mimeType"]);return null!=r&&cr(e,["mimeType"],r),e}(a));const l=pr(t,["text"]);null!=l&&cr(e,["text"],l);const u=pr(t,["thought"]);null!=u&&cr(e,["thought"],u);const c=pr(t,["thoughtSignature"]);null!=c&&cr(e,["thoughtSignature"],c);const p=pr(t,["videoMetadata"]);null!=p&&cr(e,["videoMetadata"],p);return e}(t))),cr(e,["parts"],t)}const r=pr(t,["role"]);return null!=r&&cr(e,["role"],r),e}function ro(t,e){const n=pr(t,["systemInstruction"]);void 0!==e&&null!=n&&cr(e,["systemInstruction"],Ji(n));const r=pr(t,["tools"]);if(void 0!==e&&null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>Uo(t))),cr(e,["tools"],t)}const i=pr(t,["generationConfig"]);return void 0!==e&&null!=i&&cr(e,["generationConfig"],function(t){const e={},n=pr(t,["modelSelectionConfig"]);null!=n&&cr(e,["modelConfig"],n);const r=pr(t,["audioTimestamp"]);null!=r&&cr(e,["audioTimestamp"],r);const i=pr(t,["candidateCount"]);null!=i&&cr(e,["candidateCount"],i);const s=pr(t,["enableAffectiveDialog"]);null!=s&&cr(e,["enableAffectiveDialog"],s);const o=pr(t,["frequencyPenalty"]);null!=o&&cr(e,["frequencyPenalty"],o);const a=pr(t,["logprobs"]);null!=a&&cr(e,["logprobs"],a);const l=pr(t,["maxOutputTokens"]);null!=l&&cr(e,["maxOutputTokens"],l);const u=pr(t,["mediaResolution"]);null!=u&&cr(e,["mediaResolution"],u);const c=pr(t,["presencePenalty"]);null!=c&&cr(e,["presencePenalty"],c);const p=pr(t,["responseJsonSchema"]);null!=p&&cr(e,["responseJsonSchema"],p);const h=pr(t,["responseLogprobs"]);null!=h&&cr(e,["responseLogprobs"],h);const d=pr(t,["responseMimeType"]);null!=d&&cr(e,["responseMimeType"],d);const f=pr(t,["responseModalities"]);null!=f&&cr(e,["responseModalities"],f);const m=pr(t,["responseSchema"]);null!=m&&cr(e,["responseSchema"],m);const y=pr(t,["routingConfig"]);null!=y&&cr(e,["routingConfig"],y);const g=pr(t,["seed"]);null!=g&&cr(e,["seed"],g);const w=pr(t,["speechConfig"]);null!=w&&cr(e,["speechConfig"],Do(w));const v=pr(t,["stopSequences"]);null!=v&&cr(e,["stopSequences"],v);const E=pr(t,["temperature"]);null!=E&&cr(e,["temperature"],E);const T=pr(t,["thinkingConfig"]);null!=T&&cr(e,["thinkingConfig"],T);const I=pr(t,["topK"]);null!=I&&cr(e,["topK"],I);const A=pr(t,["topP"]);null!=A&&cr(e,["topP"],A);if(void 0!==pr(t,["enableEnhancedCivicAnswers"]))throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}(i)),{}}function io(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["contents"]);if(null!=i){let t=Yi(i);Array.isArray(t)&&(t=t.map(t=>no(t))),cr(n,["contents"],t)}const s=pr(e,["config"]);return null!=s&&function(t){if(void 0!==pr(t,["systemInstruction"]))throw new Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==pr(t,["tools"]))throw new Error("tools parameter is not supported in Gemini API.");if(void 0!==pr(t,["generationConfig"]))throw new Error("generationConfig parameter is not supported in Gemini API.")}(s),n}function so(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["prompt"]);null!=i&&cr(n,["instances[0]","prompt"],i);const s=pr(e,["referenceImages"]);if(null!=s){let t=s;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["referenceImage"]);null!=n&&cr(e,["referenceImage"],So(n));const r=pr(t,["referenceId"]);null!=r&&cr(e,["referenceId"],r);const i=pr(t,["referenceType"]);null!=i&&cr(e,["referenceType"],i);const s=pr(t,["maskImageConfig"]);null!=s&&cr(e,["maskImageConfig"],function(t){const e={},n=pr(t,["maskMode"]);null!=n&&cr(e,["maskMode"],n);const r=pr(t,["segmentationClasses"]);null!=r&&cr(e,["maskClasses"],r);const i=pr(t,["maskDilation"]);null!=i&&cr(e,["dilation"],i);return e}(s));const o=pr(t,["controlImageConfig"]);null!=o&&cr(e,["controlImageConfig"],function(t){const e={},n=pr(t,["controlType"]);null!=n&&cr(e,["controlType"],n);const r=pr(t,["enableControlImageComputation"]);return null!=r&&cr(e,["computeControl"],r),e}(o));const a=pr(t,["styleImageConfig"]);null!=a&&cr(e,["styleImageConfig"],a);const l=pr(t,["subjectImageConfig"]);null!=l&&cr(e,["subjectImageConfig"],l);return e}(t))),cr(n,["instances[0]","referenceImages"],t)}const o=pr(e,["config"]);return null!=o&&function(t,e){const n=pr(t,["outputGcsUri"]);void 0!==e&&null!=n&&cr(e,["parameters","storageUri"],n);const r=pr(t,["negativePrompt"]);void 0!==e&&null!=r&&cr(e,["parameters","negativePrompt"],r);const i=pr(t,["numberOfImages"]);void 0!==e&&null!=i&&cr(e,["parameters","sampleCount"],i);const s=pr(t,["aspectRatio"]);void 0!==e&&null!=s&&cr(e,["parameters","aspectRatio"],s);const o=pr(t,["guidanceScale"]);void 0!==e&&null!=o&&cr(e,["parameters","guidanceScale"],o);const a=pr(t,["seed"]);void 0!==e&&null!=a&&cr(e,["parameters","seed"],a);const l=pr(t,["safetyFilterLevel"]);void 0!==e&&null!=l&&cr(e,["parameters","safetySetting"],l);const u=pr(t,["personGeneration"]);void 0!==e&&null!=u&&cr(e,["parameters","personGeneration"],u);const c=pr(t,["includeSafetyAttributes"]);void 0!==e&&null!=c&&cr(e,["parameters","includeSafetyAttributes"],c);const p=pr(t,["includeRaiReason"]);void 0!==e&&null!=p&&cr(e,["parameters","includeRaiReason"],p);const h=pr(t,["language"]);void 0!==e&&null!=h&&cr(e,["parameters","language"],h);const d=pr(t,["outputMimeType"]);void 0!==e&&null!=d&&cr(e,["parameters","outputOptions","mimeType"],d);const f=pr(t,["outputCompressionQuality"]);void 0!==e&&null!=f&&cr(e,["parameters","outputOptions","compressionQuality"],f);const m=pr(t,["addWatermark"]);void 0!==e&&null!=m&&cr(e,["parameters","addWatermark"],m);const y=pr(t,["labels"]);void 0!==e&&null!=y&&cr(e,["labels"],y);const g=pr(t,["editMode"]);void 0!==e&&null!=g&&cr(e,["parameters","editMode"],g);const w=pr(t,["baseSteps"]);void 0!==e&&null!=w&&cr(e,["parameters","editConfig","baseSteps"],w)}(o,n),n}function oo(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["contents"]);if(null!=i){let e=zi(t,i);Array.isArray(e)&&(e=e.map(t=>t)),cr(n,["requests[]","content"],e)}const s=pr(e,["config"]);null!=s&&function(t,e){const n=pr(t,["taskType"]);void 0!==e&&null!=n&&cr(e,["requests[]","taskType"],n);const r=pr(t,["title"]);void 0!==e&&null!=r&&cr(e,["requests[]","title"],r);const i=pr(t,["outputDimensionality"]);if(void 0!==e&&null!=i&&cr(e,["requests[]","outputDimensionality"],i),void 0!==pr(t,["mimeType"]))throw new Error("mimeType parameter is not supported in Gemini API.");if(void 0!==pr(t,["autoTruncate"]))throw new Error("autoTruncate parameter is not supported in Gemini API.")}(s,n);const o=pr(e,["model"]);return void 0!==o&&cr(n,["requests[]","model"],Li(t,o)),n}function ao(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["contents"]);if(null!=i){let e=zi(t,i);Array.isArray(e)&&(e=e.map(t=>t)),cr(n,["instances[]","content"],e)}const s=pr(e,["config"]);return null!=s&&function(t,e){const n=pr(t,["taskType"]);void 0!==e&&null!=n&&cr(e,["instances[]","task_type"],n);const r=pr(t,["title"]);void 0!==e&&null!=r&&cr(e,["instances[]","title"],r);const i=pr(t,["outputDimensionality"]);void 0!==e&&null!=i&&cr(e,["parameters","outputDimensionality"],i);const s=pr(t,["mimeType"]);void 0!==e&&null!=s&&cr(e,["instances[]","mimeType"],s);const o=pr(t,["autoTruncate"]);void 0!==e&&null!=o&&cr(e,["parameters","autoTruncate"],o)}(s,n),n}function lo(t,e,n){const r={},i=pr(e,["systemInstruction"]);void 0!==n&&null!=i&&cr(n,["systemInstruction"],no(Ji(i)));const s=pr(e,["temperature"]);null!=s&&cr(r,["temperature"],s);const o=pr(e,["topP"]);null!=o&&cr(r,["topP"],o);const a=pr(e,["topK"]);null!=a&&cr(r,["topK"],a);const l=pr(e,["candidateCount"]);null!=l&&cr(r,["candidateCount"],l);const u=pr(e,["maxOutputTokens"]);null!=u&&cr(r,["maxOutputTokens"],u);const c=pr(e,["stopSequences"]);null!=c&&cr(r,["stopSequences"],c);const p=pr(e,["responseLogprobs"]);null!=p&&cr(r,["responseLogprobs"],p);const h=pr(e,["logprobs"]);null!=h&&cr(r,["logprobs"],h);const d=pr(e,["presencePenalty"]);null!=d&&cr(r,["presencePenalty"],d);const f=pr(e,["frequencyPenalty"]);null!=f&&cr(r,["frequencyPenalty"],f);const m=pr(e,["seed"]);null!=m&&cr(r,["seed"],m);const y=pr(e,["responseMimeType"]);null!=y&&cr(r,["responseMimeType"],y);const g=pr(e,["responseSchema"]);null!=g&&cr(r,["responseSchema"],Wi(g));const w=pr(e,["responseJsonSchema"]);if(null!=w&&cr(r,["responseJsonSchema"],w),void 0!==pr(e,["routingConfig"]))throw new Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==pr(e,["modelSelectionConfig"]))throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const v=pr(e,["safetySettings"]);if(void 0!==n&&null!=v){let t=v;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["category"]);null!=n&&cr(e,["category"],n);if(void 0!==pr(t,["method"]))throw new Error("method parameter is not supported in Gemini API.");const r=pr(t,["threshold"]);null!=r&&cr(e,["threshold"],r);return e}(t))),cr(n,["safetySettings"],t)}const E=pr(e,["tools"]);if(void 0!==n&&null!=E){let t=ts(E);Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["functionDeclarations"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["functionDeclarations"],t)}if(void 0!==pr(t,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const r=pr(t,["googleSearchRetrieval"]);null!=r&&cr(e,["googleSearchRetrieval"],r);const i=pr(t,["googleMaps"]);null!=i&&cr(e,["googleMaps"],function(t){const e={};if(void 0!==pr(t,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=pr(t,["enableWidget"]);null!=n&&cr(e,["enableWidget"],n);return e}(i));const s=pr(t,["computerUse"]);null!=s&&cr(e,["computerUse"],s);const o=pr(t,["codeExecution"]);null!=o&&cr(e,["codeExecution"],o);if(void 0!==pr(t,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=pr(t,["googleSearch"]);null!=a&&cr(e,["googleSearch"],function(t){const e={};if(void 0!==pr(t,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");const n=pr(t,["timeRangeFilter"]);null!=n&&cr(e,["timeRangeFilter"],n);return e}(a));const l=pr(t,["urlContext"]);null!=l&&cr(e,["urlContext"],l);return e}(Zi(t)))),cr(n,["tools"],t)}const T=pr(e,["toolConfig"]);if(void 0!==n&&null!=T&&cr(n,["toolConfig"],T),void 0!==pr(e,["labels"]))throw new Error("labels parameter is not supported in Gemini API.");const I=pr(e,["cachedContent"]);void 0!==n&&null!=I&&cr(n,["cachedContent"],es(t,I));const A=pr(e,["responseModalities"]);null!=A&&cr(r,["responseModalities"],A);const N=pr(e,["mediaResolution"]);null!=N&&cr(r,["mediaResolution"],N);const b=pr(e,["speechConfig"]);if(null!=b&&cr(r,["speechConfig"],Xi(b)),void 0!==pr(e,["audioTimestamp"]))throw new Error("audioTimestamp parameter is not supported in Gemini API.");const S=pr(e,["thinkingConfig"]);null!=S&&cr(r,["thinkingConfig"],S);const O=pr(e,["imageConfig"]);return null!=O&&cr(r,["imageConfig"],O),r}function uo(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["contents"]);if(null!=i){let t=Yi(i);Array.isArray(t)&&(t=t.map(t=>no(t))),cr(n,["contents"],t)}const s=pr(e,["config"]);return null!=s&&cr(n,["generationConfig"],lo(t,s,n)),n}function co(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["contents"]);if(null!=i){let t=Yi(i);Array.isArray(t)&&(t=t.map(t=>t)),cr(n,["contents"],t)}const s=pr(e,["config"]);return null!=s&&cr(n,["generationConfig"],function(t,e,n){const r={},i=pr(e,["systemInstruction"]);void 0!==n&&null!=i&&cr(n,["systemInstruction"],Ji(i));const s=pr(e,["temperature"]);null!=s&&cr(r,["temperature"],s);const o=pr(e,["topP"]);null!=o&&cr(r,["topP"],o);const a=pr(e,["topK"]);null!=a&&cr(r,["topK"],a);const l=pr(e,["candidateCount"]);null!=l&&cr(r,["candidateCount"],l);const u=pr(e,["maxOutputTokens"]);null!=u&&cr(r,["maxOutputTokens"],u);const c=pr(e,["stopSequences"]);null!=c&&cr(r,["stopSequences"],c);const p=pr(e,["responseLogprobs"]);null!=p&&cr(r,["responseLogprobs"],p);const h=pr(e,["logprobs"]);null!=h&&cr(r,["logprobs"],h);const d=pr(e,["presencePenalty"]);null!=d&&cr(r,["presencePenalty"],d);const f=pr(e,["frequencyPenalty"]);null!=f&&cr(r,["frequencyPenalty"],f);const m=pr(e,["seed"]);null!=m&&cr(r,["seed"],m);const y=pr(e,["responseMimeType"]);null!=y&&cr(r,["responseMimeType"],y);const g=pr(e,["responseSchema"]);null!=g&&cr(r,["responseSchema"],Wi(g));const w=pr(e,["responseJsonSchema"]);null!=w&&cr(r,["responseJsonSchema"],w);const v=pr(e,["routingConfig"]);null!=v&&cr(r,["routingConfig"],v);const E=pr(e,["modelSelectionConfig"]);null!=E&&cr(r,["modelConfig"],E);const T=pr(e,["safetySettings"]);if(void 0!==n&&null!=T){let t=T;Array.isArray(t)&&(t=t.map(t=>t)),cr(n,["safetySettings"],t)}const I=pr(e,["tools"]);if(void 0!==n&&null!=I){let t=ts(I);Array.isArray(t)&&(t=t.map(t=>Uo(Zi(t)))),cr(n,["tools"],t)}const A=pr(e,["toolConfig"]);void 0!==n&&null!=A&&cr(n,["toolConfig"],A);const N=pr(e,["labels"]);void 0!==n&&null!=N&&cr(n,["labels"],N);const b=pr(e,["cachedContent"]);void 0!==n&&null!=b&&cr(n,["cachedContent"],es(t,b));const S=pr(e,["responseModalities"]);null!=S&&cr(r,["responseModalities"],S);const O=pr(e,["mediaResolution"]);null!=O&&cr(r,["mediaResolution"],O);const _=pr(e,["speechConfig"]);null!=_&&cr(r,["speechConfig"],Do(Xi(_)));const P=pr(e,["audioTimestamp"]);null!=P&&cr(r,["audioTimestamp"],P);const C=pr(e,["thinkingConfig"]);null!=C&&cr(r,["thinkingConfig"],C);const x=pr(e,["imageConfig"]);return null!=x&&cr(r,["imageConfig"],x),r}(t,s,n)),n}function po(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["candidates"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>to(t))),cr(e,["candidates"],t)}const i=pr(t,["modelVersion"]);null!=i&&cr(e,["modelVersion"],i);const s=pr(t,["promptFeedback"]);null!=s&&cr(e,["promptFeedback"],s);const o=pr(t,["responseId"]);null!=o&&cr(e,["responseId"],o);const a=pr(t,["usageMetadata"]);return null!=a&&cr(e,["usageMetadata"],a),e}function ho(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["candidates"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["candidates"],t)}const i=pr(t,["createTime"]);null!=i&&cr(e,["createTime"],i);const s=pr(t,["modelVersion"]);null!=s&&cr(e,["modelVersion"],s);const o=pr(t,["promptFeedback"]);null!=o&&cr(e,["promptFeedback"],o);const a=pr(t,["responseId"]);null!=a&&cr(e,["responseId"],a);const l=pr(t,["usageMetadata"]);return null!=l&&cr(e,["usageMetadata"],l),e}function fo(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["prompt"]);null!=i&&cr(n,["instances[0]","prompt"],i);const s=pr(e,["config"]);return null!=s&&function(t,e){if(void 0!==pr(t,["outputGcsUri"]))throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==pr(t,["negativePrompt"]))throw new Error("negativePrompt parameter is not supported in Gemini API.");const n=pr(t,["numberOfImages"]);void 0!==e&&null!=n&&cr(e,["parameters","sampleCount"],n);const r=pr(t,["aspectRatio"]);void 0!==e&&null!=r&&cr(e,["parameters","aspectRatio"],r);const i=pr(t,["guidanceScale"]);if(void 0!==e&&null!=i&&cr(e,["parameters","guidanceScale"],i),void 0!==pr(t,["seed"]))throw new Error("seed parameter is not supported in Gemini API.");const s=pr(t,["safetyFilterLevel"]);void 0!==e&&null!=s&&cr(e,["parameters","safetySetting"],s);const o=pr(t,["personGeneration"]);void 0!==e&&null!=o&&cr(e,["parameters","personGeneration"],o);const a=pr(t,["includeSafetyAttributes"]);void 0!==e&&null!=a&&cr(e,["parameters","includeSafetyAttributes"],a);const l=pr(t,["includeRaiReason"]);void 0!==e&&null!=l&&cr(e,["parameters","includeRaiReason"],l);const u=pr(t,["language"]);void 0!==e&&null!=u&&cr(e,["parameters","language"],u);const c=pr(t,["outputMimeType"]);void 0!==e&&null!=c&&cr(e,["parameters","outputOptions","mimeType"],c);const p=pr(t,["outputCompressionQuality"]);if(void 0!==e&&null!=p&&cr(e,["parameters","outputOptions","compressionQuality"],p),void 0!==pr(t,["addWatermark"]))throw new Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==pr(t,["labels"]))throw new Error("labels parameter is not supported in Gemini API.");const h=pr(t,["imageSize"]);if(void 0!==e&&null!=h&&cr(e,["parameters","sampleImageSize"],h),void 0!==pr(t,["enhancePrompt"]))throw new Error("enhancePrompt parameter is not supported in Gemini API.")}(s,n),n}function mo(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["prompt"]);null!=i&&cr(n,["instances[0]","prompt"],i);const s=pr(e,["config"]);return null!=s&&function(t,e){const n=pr(t,["outputGcsUri"]);void 0!==e&&null!=n&&cr(e,["parameters","storageUri"],n);const r=pr(t,["negativePrompt"]);void 0!==e&&null!=r&&cr(e,["parameters","negativePrompt"],r);const i=pr(t,["numberOfImages"]);void 0!==e&&null!=i&&cr(e,["parameters","sampleCount"],i);const s=pr(t,["aspectRatio"]);void 0!==e&&null!=s&&cr(e,["parameters","aspectRatio"],s);const o=pr(t,["guidanceScale"]);void 0!==e&&null!=o&&cr(e,["parameters","guidanceScale"],o);const a=pr(t,["seed"]);void 0!==e&&null!=a&&cr(e,["parameters","seed"],a);const l=pr(t,["safetyFilterLevel"]);void 0!==e&&null!=l&&cr(e,["parameters","safetySetting"],l);const u=pr(t,["personGeneration"]);void 0!==e&&null!=u&&cr(e,["parameters","personGeneration"],u);const c=pr(t,["includeSafetyAttributes"]);void 0!==e&&null!=c&&cr(e,["parameters","includeSafetyAttributes"],c);const p=pr(t,["includeRaiReason"]);void 0!==e&&null!=p&&cr(e,["parameters","includeRaiReason"],p);const h=pr(t,["language"]);void 0!==e&&null!=h&&cr(e,["parameters","language"],h);const d=pr(t,["outputMimeType"]);void 0!==e&&null!=d&&cr(e,["parameters","outputOptions","mimeType"],d);const f=pr(t,["outputCompressionQuality"]);void 0!==e&&null!=f&&cr(e,["parameters","outputOptions","compressionQuality"],f);const m=pr(t,["addWatermark"]);void 0!==e&&null!=m&&cr(e,["parameters","addWatermark"],m);const y=pr(t,["labels"]);void 0!==e&&null!=y&&cr(e,["labels"],y);const g=pr(t,["imageSize"]);void 0!==e&&null!=g&&cr(e,["parameters","sampleImageSize"],g);const w=pr(t,["enhancePrompt"]);void 0!==e&&null!=w&&cr(e,["parameters","enhancePrompt"],w)}(s,n),n}function yo(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["predictions"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["_self"]);null!=n&&cr(e,["image"],function(t){const e={},n=pr(t,["bytesBase64Encoded"]);null!=n&&cr(e,["imageBytes"],rs(n));const r=pr(t,["mimeType"]);null!=r&&cr(e,["mimeType"],r);return e}(n));const r=pr(t,["raiFilteredReason"]);null!=r&&cr(e,["raiFilteredReason"],r);const i=pr(t,["_self"]);null!=i&&cr(e,["safetyAttributes"],Ro(i));return e}(t))),cr(e,["generatedImages"],t)}const i=pr(t,["positivePromptSafetyAttributes"]);return null!=i&&cr(e,["positivePromptSafetyAttributes"],Ro(i)),e}function go(t,e){const n=pr(t,["numberOfVideos"]);if(void 0!==e&&null!=n&&cr(e,["parameters","sampleCount"],n),void 0!==pr(t,["outputGcsUri"]))throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==pr(t,["fps"]))throw new Error("fps parameter is not supported in Gemini API.");const r=pr(t,["durationSeconds"]);if(void 0!==e&&null!=r&&cr(e,["parameters","durationSeconds"],r),void 0!==pr(t,["seed"]))throw new Error("seed parameter is not supported in Gemini API.");const i=pr(t,["aspectRatio"]);void 0!==e&&null!=i&&cr(e,["parameters","aspectRatio"],i);const s=pr(t,["resolution"]);void 0!==e&&null!=s&&cr(e,["parameters","resolution"],s);const o=pr(t,["personGeneration"]);if(void 0!==e&&null!=o&&cr(e,["parameters","personGeneration"],o),void 0!==pr(t,["pubsubTopic"]))throw new Error("pubsubTopic parameter is not supported in Gemini API.");const a=pr(t,["negativePrompt"]);void 0!==e&&null!=a&&cr(e,["parameters","negativePrompt"],a);const l=pr(t,["enhancePrompt"]);if(void 0!==e&&null!=l&&cr(e,["parameters","enhancePrompt"],l),void 0!==pr(t,["generateAudio"]))throw new Error("generateAudio parameter is not supported in Gemini API.");const u=pr(t,["lastFrame"]);void 0!==e&&null!=u&&cr(e,["instances[0]","lastFrame"],bo(u));const c=pr(t,["referenceImages"]);if(void 0!==e&&null!=c){let t=c;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["image"]);null!=n&&cr(e,["image"],bo(n));const r=pr(t,["referenceType"]);null!=r&&cr(e,["referenceType"],r);return e}(t))),cr(e,["instances[0]","referenceImages"],t)}if(void 0!==pr(t,["mask"]))throw new Error("mask parameter is not supported in Gemini API.");if(void 0!==pr(t,["compressionQuality"]))throw new Error("compressionQuality parameter is not supported in Gemini API.");return{}}function wo(t,e){const n=pr(t,["numberOfVideos"]);void 0!==e&&null!=n&&cr(e,["parameters","sampleCount"],n);const r=pr(t,["outputGcsUri"]);void 0!==e&&null!=r&&cr(e,["parameters","storageUri"],r);const i=pr(t,["fps"]);void 0!==e&&null!=i&&cr(e,["parameters","fps"],i);const s=pr(t,["durationSeconds"]);void 0!==e&&null!=s&&cr(e,["parameters","durationSeconds"],s);const o=pr(t,["seed"]);void 0!==e&&null!=o&&cr(e,["parameters","seed"],o);const a=pr(t,["aspectRatio"]);void 0!==e&&null!=a&&cr(e,["parameters","aspectRatio"],a);const l=pr(t,["resolution"]);void 0!==e&&null!=l&&cr(e,["parameters","resolution"],l);const u=pr(t,["personGeneration"]);void 0!==e&&null!=u&&cr(e,["parameters","personGeneration"],u);const c=pr(t,["pubsubTopic"]);void 0!==e&&null!=c&&cr(e,["parameters","pubsubTopic"],c);const p=pr(t,["negativePrompt"]);void 0!==e&&null!=p&&cr(e,["parameters","negativePrompt"],p);const h=pr(t,["enhancePrompt"]);void 0!==e&&null!=h&&cr(e,["parameters","enhancePrompt"],h);const d=pr(t,["generateAudio"]);void 0!==e&&null!=d&&cr(e,["parameters","generateAudio"],d);const f=pr(t,["lastFrame"]);void 0!==e&&null!=f&&cr(e,["instances[0]","lastFrame"],So(f));const m=pr(t,["referenceImages"]);if(void 0!==e&&null!=m){let t=m;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["image"]);null!=n&&cr(e,["image"],So(n));const r=pr(t,["referenceType"]);null!=r&&cr(e,["referenceType"],r);return e}(t))),cr(e,["instances[0]","referenceImages"],t)}const y=pr(t,["mask"]);void 0!==e&&null!=y&&cr(e,["instances[0]","mask"],function(t){const e={},n=pr(t,["image"]);null!=n&&cr(e,["_self"],So(n));const r=pr(t,["maskMode"]);null!=r&&cr(e,["maskMode"],r);return e}(y));const g=pr(t,["compressionQuality"]);return void 0!==e&&null!=g&&cr(e,["parameters","compressionQuality"],g),{}}function vo(t){const e={},n=pr(t,["name"]);null!=n&&cr(e,["name"],n);const r=pr(t,["metadata"]);null!=r&&cr(e,["metadata"],r);const i=pr(t,["done"]);null!=i&&cr(e,["done"],i);const s=pr(t,["error"]);null!=s&&cr(e,["error"],s);const o=pr(t,["response","generateVideoResponse"]);return null!=o&&cr(e,["response"],function(t){const e={},n=pr(t,["generatedSamples"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["video"]);null!=n&&cr(e,["video"],function(t){const e={},n=pr(t,["uri"]);null!=n&&cr(e,["uri"],n);const r=pr(t,["encodedVideo"]);null!=r&&cr(e,["videoBytes"],rs(r));const i=pr(t,["encoding"]);null!=i&&cr(e,["mimeType"],i);return e}(n));return e}(t))),cr(e,["generatedVideos"],t)}const r=pr(t,["raiMediaFilteredCount"]);null!=r&&cr(e,["raiMediaFilteredCount"],r);const i=pr(t,["raiMediaFilteredReasons"]);null!=i&&cr(e,["raiMediaFilteredReasons"],i);return e}(o)),e}function Eo(t){const e={},n=pr(t,["name"]);null!=n&&cr(e,["name"],n);const r=pr(t,["metadata"]);null!=r&&cr(e,["metadata"],r);const i=pr(t,["done"]);null!=i&&cr(e,["done"],i);const s=pr(t,["error"]);null!=s&&cr(e,["error"],s);const o=pr(t,["response"]);return null!=o&&cr(e,["response"],function(t){const e={},n=pr(t,["videos"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["_self"]);null!=n&&cr(e,["video"],function(t){const e={},n=pr(t,["gcsUri"]);null!=n&&cr(e,["uri"],n);const r=pr(t,["bytesBase64Encoded"]);null!=r&&cr(e,["videoBytes"],rs(r));const i=pr(t,["mimeType"]);null!=i&&cr(e,["mimeType"],i);return e}(n));return e}(t))),cr(e,["generatedVideos"],t)}const r=pr(t,["raiMediaFilteredCount"]);null!=r&&cr(e,["raiMediaFilteredCount"],r);const i=pr(t,["raiMediaFilteredReasons"]);null!=i&&cr(e,["raiMediaFilteredReasons"],i);return e}(o)),e}function To(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["prompt"]);null!=i&&cr(n,["instances[0]","prompt"],i);const s=pr(e,["image"]);null!=s&&cr(n,["instances[0]","image"],bo(s));const o=pr(e,["video"]);null!=o&&cr(n,["instances[0]","video"],Bo(o));const a=pr(e,["source"]);null!=a&&function(t,e){const n={},r=pr(t,["prompt"]);void 0!==e&&null!=r&&cr(e,["instances[0]","prompt"],r);const i=pr(t,["image"]);void 0!==e&&null!=i&&cr(e,["instances[0]","image"],bo(i));const s=pr(t,["video"]);void 0!==e&&null!=s&&cr(e,["instances[0]","video"],Bo(s))}(a,n);const l=pr(e,["config"]);return null!=l&&go(l,n),n}function Io(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["prompt"]);null!=i&&cr(n,["instances[0]","prompt"],i);const s=pr(e,["image"]);null!=s&&cr(n,["instances[0]","image"],So(s));const o=pr(e,["video"]);null!=o&&cr(n,["instances[0]","video"],Ho(o));const a=pr(e,["source"]);null!=a&&function(t,e){const n={},r=pr(t,["prompt"]);void 0!==e&&null!=r&&cr(e,["instances[0]","prompt"],r);const i=pr(t,["image"]);void 0!==e&&null!=i&&cr(e,["instances[0]","image"],So(i));const s=pr(t,["video"]);void 0!==e&&null!=s&&cr(e,["instances[0]","video"],Ho(s))}(a,n);const l=pr(e,["config"]);return null!=l&&wo(l,n),n}function Ao(t){const e={},n=pr(t,["_self"]);null!=n&&cr(e,["image"],No(n));const r=pr(t,["raiFilteredReason"]);null!=r&&cr(e,["raiFilteredReason"],r);const i=pr(t,["_self"]);null!=i&&cr(e,["safetyAttributes"],ko(i));const s=pr(t,["prompt"]);return null!=s&&cr(e,["enhancedPrompt"],s),e}function No(t){const e={},n=pr(t,["gcsUri"]);null!=n&&cr(e,["gcsUri"],n);const r=pr(t,["bytesBase64Encoded"]);null!=r&&cr(e,["imageBytes"],rs(r));const i=pr(t,["mimeType"]);return null!=i&&cr(e,["mimeType"],i),e}function bo(t){const e={};if(void 0!==pr(t,["gcsUri"]))throw new Error("gcsUri parameter is not supported in Gemini API.");const n=pr(t,["imageBytes"]);null!=n&&cr(e,["bytesBase64Encoded"],rs(n));const r=pr(t,["mimeType"]);return null!=r&&cr(e,["mimeType"],r),e}function So(t){const e={},n=pr(t,["gcsUri"]);null!=n&&cr(e,["gcsUri"],n);const r=pr(t,["imageBytes"]);null!=r&&cr(e,["bytesBase64Encoded"],rs(r));const i=pr(t,["mimeType"]);return null!=i&&cr(e,["mimeType"],i),e}function Oo(t,e){const n={},r=pr(e,["config"]);return null!=r&&function(t,e,n){const r=pr(e,["pageSize"]);void 0!==n&&null!=r&&cr(n,["_query","pageSize"],r);const i=pr(e,["pageToken"]);void 0!==n&&null!=i&&cr(n,["_query","pageToken"],i);const s=pr(e,["filter"]);void 0!==n&&null!=s&&cr(n,["_query","filter"],s);const o=pr(e,["queryBase"]);void 0!==n&&null!=o&&cr(n,["_url","models_url"],ss(t,o))}(t,r,n),n}function _o(t,e){const n={},r=pr(e,["config"]);return null!=r&&function(t,e,n){const r=pr(e,["pageSize"]);void 0!==n&&null!=r&&cr(n,["_query","pageSize"],r);const i=pr(e,["pageToken"]);void 0!==n&&null!=i&&cr(n,["_query","pageToken"],i);const s=pr(e,["filter"]);void 0!==n&&null!=s&&cr(n,["_query","filter"],s);const o=pr(e,["queryBase"]);void 0!==n&&null!=o&&cr(n,["_url","models_url"],ss(t,o))}(t,r,n),n}function Po(t){const e={},n=pr(t,["name"]);null!=n&&cr(e,["name"],n);const r=pr(t,["displayName"]);null!=r&&cr(e,["displayName"],r);const i=pr(t,["description"]);null!=i&&cr(e,["description"],i);const s=pr(t,["version"]);null!=s&&cr(e,["version"],s);const o=pr(t,["_self"]);null!=o&&cr(e,["tunedModelInfo"],function(t){const e={},n=pr(t,["baseModel"]);null!=n&&cr(e,["baseModel"],n);const r=pr(t,["createTime"]);null!=r&&cr(e,["createTime"],r);const i=pr(t,["updateTime"]);null!=i&&cr(e,["updateTime"],i);return e}(o));const a=pr(t,["inputTokenLimit"]);null!=a&&cr(e,["inputTokenLimit"],a);const l=pr(t,["outputTokenLimit"]);null!=l&&cr(e,["outputTokenLimit"],l);const u=pr(t,["supportedGenerationMethods"]);return null!=u&&cr(e,["supportedActions"],u),e}function Co(t){const e={},n=pr(t,["name"]);null!=n&&cr(e,["name"],n);const r=pr(t,["displayName"]);null!=r&&cr(e,["displayName"],r);const i=pr(t,["description"]);null!=i&&cr(e,["description"],i);const s=pr(t,["versionId"]);null!=s&&cr(e,["version"],s);const o=pr(t,["deployedModels"]);if(null!=o){let t=o;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["endpoint"]);null!=n&&cr(e,["name"],n);const r=pr(t,["deployedModelId"]);return null!=r&&cr(e,["deployedModelId"],r),e}(t))),cr(e,["endpoints"],t)}const a=pr(t,["labels"]);null!=a&&cr(e,["labels"],a);const l=pr(t,["_self"]);null!=l&&cr(e,["tunedModelInfo"],function(t){const e={},n=pr(t,["labels","google-vertex-llm-tuning-base-model-id"]);null!=n&&cr(e,["baseModel"],n);const r=pr(t,["createTime"]);null!=r&&cr(e,["createTime"],r);const i=pr(t,["updateTime"]);null!=i&&cr(e,["updateTime"],i);return e}(l));const u=pr(t,["defaultCheckpointId"]);null!=u&&cr(e,["defaultCheckpointId"],u);const c=pr(t,["checkpoints"]);if(null!=c){let t=c;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["checkpoints"],t)}return e}function xo(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["source"]);null!=i&&function(t,e){const n={},r=pr(t,["prompt"]);void 0!==e&&null!=r&&cr(e,["instances[0]","prompt"],r);const i=pr(t,["personImage"]);void 0!==e&&null!=i&&cr(e,["instances[0]","personImage","image"],So(i));const s=pr(t,["productImages"]);if(void 0!==e&&null!=s){let t=s;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["productImage"]);return null!=n&&cr(e,["image"],So(n)),e}(t))),cr(e,["instances[0]","productImages"],t)}}(i,n);const s=pr(e,["config"]);return null!=s&&function(t,e){const n=pr(t,["numberOfImages"]);void 0!==e&&null!=n&&cr(e,["parameters","sampleCount"],n);const r=pr(t,["baseSteps"]);void 0!==e&&null!=r&&cr(e,["parameters","editConfig","baseSteps"],r);const i=pr(t,["outputGcsUri"]);void 0!==e&&null!=i&&cr(e,["parameters","storageUri"],i);const s=pr(t,["seed"]);void 0!==e&&null!=s&&cr(e,["parameters","seed"],s);const o=pr(t,["safetyFilterLevel"]);void 0!==e&&null!=o&&cr(e,["parameters","safetySetting"],o);const a=pr(t,["personGeneration"]);void 0!==e&&null!=a&&cr(e,["parameters","personGeneration"],a);const l=pr(t,["addWatermark"]);void 0!==e&&null!=l&&cr(e,["parameters","addWatermark"],l);const u=pr(t,["outputMimeType"]);void 0!==e&&null!=u&&cr(e,["parameters","outputOptions","mimeType"],u);const c=pr(t,["outputCompressionQuality"]);void 0!==e&&null!=c&&cr(e,["parameters","outputOptions","compressionQuality"],c);const p=pr(t,["enhancePrompt"]);void 0!==e&&null!=p&&cr(e,["parameters","enhancePrompt"],p);const h=pr(t,["labels"]);void 0!==e&&null!=h&&cr(e,["labels"],h)}(s,n),n}function Ro(t){const e={},n=pr(t,["safetyAttributes","categories"]);null!=n&&cr(e,["categories"],n);const r=pr(t,["safetyAttributes","scores"]);null!=r&&cr(e,["scores"],r);const i=pr(t,["contentType"]);return null!=i&&cr(e,["contentType"],i),e}function ko(t){const e={},n=pr(t,["safetyAttributes","categories"]);null!=n&&cr(e,["categories"],n);const r=pr(t,["safetyAttributes","scores"]);null!=r&&cr(e,["scores"],r);const i=pr(t,["contentType"]);return null!=i&&cr(e,["contentType"],i),e}function Mo(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["source"]);null!=i&&function(t,e){const n={},r=pr(t,["prompt"]);void 0!==e&&null!=r&&cr(e,["instances[0]","prompt"],r);const i=pr(t,["image"]);void 0!==e&&null!=i&&cr(e,["instances[0]","image"],So(i));const s=pr(t,["scribbleImage"]);void 0!==e&&null!=s&&cr(e,["instances[0]","scribble"],function(t){const e={},n=pr(t,["image"]);return null!=n&&cr(e,["image"],So(n)),e}(s))}(i,n);const s=pr(e,["config"]);return null!=s&&function(t,e){const n=pr(t,["mode"]);void 0!==e&&null!=n&&cr(e,["parameters","mode"],n);const r=pr(t,["maxPredictions"]);void 0!==e&&null!=r&&cr(e,["parameters","maxPredictions"],r);const i=pr(t,["confidenceThreshold"]);void 0!==e&&null!=i&&cr(e,["parameters","confidenceThreshold"],i);const s=pr(t,["maskDilation"]);void 0!==e&&null!=s&&cr(e,["parameters","maskDilation"],s);const o=pr(t,["binaryColorThreshold"]);void 0!==e&&null!=o&&cr(e,["parameters","binaryColorThreshold"],o);const a=pr(t,["labels"]);void 0!==e&&null!=a&&cr(e,["labels"],a)}(s,n),n}function Lo(t){const e={},n=pr(t,["predictions"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["_self"]);null!=n&&cr(e,["mask"],No(n));const r=pr(t,["labels"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["labels"],t)}return e}(t))),cr(e,["generatedMasks"],t)}return e}function Do(t){const e={},n=pr(t,["languageCode"]);null!=n&&cr(e,["languageCode"],n);const r=pr(t,["voiceConfig"]);if(null!=r&&cr(e,["voiceConfig"],r),void 0!==pr(t,["multiSpeakerVoiceConfig"]))throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function Uo(t){const e={},n=pr(t,["functionDeclarations"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>function(t){const e={};if(void 0!==pr(t,["behavior"]))throw new Error("behavior parameter is not supported in Vertex AI.");const n=pr(t,["description"]);null!=n&&cr(e,["description"],n);const r=pr(t,["name"]);null!=r&&cr(e,["name"],r);const i=pr(t,["parameters"]);null!=i&&cr(e,["parameters"],i);const s=pr(t,["parametersJsonSchema"]);null!=s&&cr(e,["parametersJsonSchema"],s);const o=pr(t,["response"]);null!=o&&cr(e,["response"],o);const a=pr(t,["responseJsonSchema"]);return null!=a&&cr(e,["responseJsonSchema"],a),e}(t))),cr(e,["functionDeclarations"],t)}const r=pr(t,["retrieval"]);null!=r&&cr(e,["retrieval"],r);const i=pr(t,["googleSearchRetrieval"]);null!=i&&cr(e,["googleSearchRetrieval"],i);const s=pr(t,["googleMaps"]);null!=s&&cr(e,["googleMaps"],s);const o=pr(t,["computerUse"]);null!=o&&cr(e,["computerUse"],o);const a=pr(t,["codeExecution"]);null!=a&&cr(e,["codeExecution"],a);const l=pr(t,["enterpriseWebSearch"]);null!=l&&cr(e,["enterpriseWebSearch"],l);const u=pr(t,["googleSearch"]);null!=u&&cr(e,["googleSearch"],u);const c=pr(t,["urlContext"]);return null!=c&&cr(e,["urlContext"],c),e}function qo(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","name"],Li(t,r));const i=pr(e,["config"]);return null!=i&&function(t,e){const n=pr(t,["displayName"]);void 0!==e&&null!=n&&cr(e,["displayName"],n);const r=pr(t,["description"]);void 0!==e&&null!=r&&cr(e,["description"],r);const i=pr(t,["defaultCheckpointId"]);void 0!==e&&null!=i&&cr(e,["defaultCheckpointId"],i)}(i,n),n}function Go(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["config"]);return null!=i&&function(t,e){const n=pr(t,["displayName"]);void 0!==e&&null!=n&&cr(e,["displayName"],n);const r=pr(t,["description"]);void 0!==e&&null!=r&&cr(e,["description"],r);const i=pr(t,["defaultCheckpointId"]);void 0!==e&&null!=i&&cr(e,["defaultCheckpointId"],i)}(i,n),n}function $o(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["image"]);null!=i&&cr(n,["instances[0]","image"],So(i));const s=pr(e,["upscaleFactor"]);null!=s&&cr(n,["parameters","upscaleConfig","upscaleFactor"],s);const o=pr(e,["config"]);return null!=o&&function(t,e){const n=pr(t,["outputGcsUri"]);void 0!==e&&null!=n&&cr(e,["parameters","storageUri"],n);const r=pr(t,["safetyFilterLevel"]);void 0!==e&&null!=r&&cr(e,["parameters","safetySetting"],r);const i=pr(t,["personGeneration"]);void 0!==e&&null!=i&&cr(e,["parameters","personGeneration"],i);const s=pr(t,["includeRaiReason"]);void 0!==e&&null!=s&&cr(e,["parameters","includeRaiReason"],s);const o=pr(t,["outputMimeType"]);void 0!==e&&null!=o&&cr(e,["parameters","outputOptions","mimeType"],o);const a=pr(t,["outputCompressionQuality"]);void 0!==e&&null!=a&&cr(e,["parameters","outputOptions","compressionQuality"],a);const l=pr(t,["enhanceInputImage"]);void 0!==e&&null!=l&&cr(e,["parameters","upscaleConfig","enhanceInputImage"],l);const u=pr(t,["imagePreservationFactor"]);void 0!==e&&null!=u&&cr(e,["parameters","upscaleConfig","imagePreservationFactor"],u);const c=pr(t,["labels"]);void 0!==e&&null!=c&&cr(e,["labels"],c);const p=pr(t,["numberOfImages"]);void 0!==e&&null!=p&&cr(e,["parameters","sampleCount"],p);const h=pr(t,["mode"]);void 0!==e&&null!=h&&cr(e,["parameters","mode"],h)}(o,n),n}function Bo(t){const e={},n=pr(t,["uri"]);null!=n&&cr(e,["uri"],n);const r=pr(t,["videoBytes"]);null!=r&&cr(e,["encodedVideo"],rs(r));const i=pr(t,["mimeType"]);return null!=i&&cr(e,["encoding"],i),e}function Ho(t){const e={},n=pr(t,["uri"]);null!=n&&cr(e,["gcsUri"],n);const r=pr(t,["videoBytes"]);null!=r&&cr(e,["bytesBase64Encoded"],rs(r));const i=pr(t,["mimeType"]);return null!=i&&cr(e,["mimeType"],i),e}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Fo="x-goog-api-client",Vo=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class jo{constructor(t){var e,n;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const r={};this.clientOptions.vertexai?(r.apiVersion=null!==(e=this.clientOptions.apiVersion)&&void 0!==e?e:"v1beta1",r.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(r.apiVersion=null!==(n=this.clientOptions.apiVersion)&&void 0!==n?n:"v1beta",r.baseUrl="https://generativelanguage.googleapis.com/"),r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,t.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&"global"!==this.clientOptions.location?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:(this.clientOptions.project=void 0,this.clientOptions.location=void 0)}isVertexAI(){var t;return null!==(t=this.clientOptions.vertexai)&&void 0!==t&&t}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||void 0===t.baseUrl||void 0===t.apiVersion)throw new Error("HTTP options are not correctly set.");const e=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&""!==t.apiVersion&&e.push(t.apiVersion),e.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),e=new URL(t);return e.protocol="http:"==e.protocol?"ws":"wss",e.toString()}setBaseUrl(t){if(!this.clientOptions.httpOptions)throw new Error("HTTP options are not correctly set.");this.clientOptions.httpOptions.baseUrl=t}constructUrl(t,e,n){const r=[this.getRequestUrlInternal(e)];n&&r.push(this.getBaseResourcePath()),""!==t&&r.push(t);return new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(t){return!this.clientOptions.apiKey&&(!!this.clientOptions.vertexai&&(!t.path.startsWith("projects/")&&("GET"!==t.httpMethod||!t.path.startsWith("publishers/google/models"))))}async request(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.shouldPrependVertexProjectPath(t),r=this.constructUrl(t.path,e,n);if(t.queryParams)for(const[e,n]of Object.entries(t.queryParams))r.searchParams.append(e,String(n));let i={};if("GET"===t.httpMethod){if(t.body&&"{}"!==t.body)throw new Error("Request body should be empty for GET request, but got non empty request body")}else i.body=t.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,e,r.toString(),t.abortSignal),this.unaryApiCall(r,i,t.httpMethod)}patchHttpOptions(t,e){const n=JSON.parse(JSON.stringify(t));for(const[t,r]of Object.entries(e))"object"==typeof r?n[t]=Object.assign(Object.assign({},n[t]),r):void 0!==r&&(n[t]=r);return n}async requestStream(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.shouldPrependVertexProjectPath(t),r=this.constructUrl(t.path,e,n);r.searchParams.has("alt")&&"sse"===r.searchParams.get("alt")||r.searchParams.set("alt","sse");let i={};return i.body=t.body,i=await this.includeExtraHttpOptionsToRequestInit(i,e,r.toString(),t.abortSignal),this.streamApiCall(r,i,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,e,n,r){if(e&&e.timeout||r){const n=new AbortController,i=n.signal;if(e.timeout&&(null==e?void 0:e.timeout)>0){const t=setTimeout(()=>n.abort(),e.timeout);t&&"function"==typeof t.unref&&t.unref()}r&&r.addEventListener("abort",()=>{n.abort()}),t.signal=i}return e&&null!==e.extraBody&&function(t,e){if(!e||0===Object.keys(e).length)return;if(t.body instanceof Blob)return void console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");let n={};if("string"==typeof t.body&&t.body.length>0)try{const e=JSON.parse(t.body);if("object"!=typeof e||null===e||Array.isArray(e))return void console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");n=e}catch(t){return void console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.")}function r(t,e){const n=Object.assign({},t);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const i=e[t],s=n[t];i&&"object"==typeof i&&!Array.isArray(i)&&s&&"object"==typeof s&&!Array.isArray(s)?n[t]=r(s,i):(s&&i&&typeof s!=typeof i&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${t}". Original type: ${typeof s}, New type: ${typeof i}. Overwriting.`),n[t]=i)}return n}const i=r(n,e);t.body=JSON.stringify(i)}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(t,e.extraBody),t.headers=await this.getHeadersInternal(e,n),t}async unaryApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async t=>(await Jo(t),new di(t))).catch(t=>{throw t instanceof Error?t:new Error(JSON.stringify(t))})}async streamApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async t=>(await Jo(t),this.processStreamResponse(t))).catch(t=>{throw t instanceof Error?t:new Error(JSON.stringify(t))})}processStreamResponse(t){var e;return Ds(this,arguments,function*(){const n=null===(e=null==t?void 0:t.body)||void 0===e?void 0:e.getReader(),r=new TextDecoder("utf-8");if(!n)throw new Error("Response body is empty");try{let e="";for(;;){const{done:i,value:s}=yield Ls(n.read());if(i){if(e.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const o=r.decode(s,{stream:!0});try{const t=JSON.parse(o);if("error"in t){const e=JSON.parse(JSON.stringify(t.error)),n=e.status,r=e.code,i=`got status: ${n}. ${JSON.stringify(t)}`;if(r>=400&&r<600){throw new Fs({message:i,status:r})}}}catch(t){if("ApiError"===t.name)throw t}e+=o;let a=e.match(Vo);for(;a;){const n=a[1];try{const r=new Response(n,{headers:null==t?void 0:t.headers,status:null==t?void 0:t.status,statusText:null==t?void 0:t.statusText});yield yield Ls(new di(r)),e=e.slice(a[0].length),a=e.match(Vo)}catch(t){throw new Error(`exception parsing stream chunk ${n}. ${t}`)}}}}finally{n.releaseLock()}})}async apiCall(t,e){return fetch(t,e).catch(t=>{throw new Error(`exception ${t} sending request`)})}getDefaultHeaders(){const t={},e="google-genai-sdk/1.28.0 "+this.clientOptions.userAgentExtra;return t["User-Agent"]=e,t[Fo]=e,t["Content-Type"]="application/json",t}async getHeadersInternal(t,e){const n=new Headers;if(t&&t.headers){for(const[e,r]of Object.entries(t.headers))n.append(e,r);t.timeout&&t.timeout>0&&n.append("X-Server-Timeout",String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,e),n}async uploadFile(t,e){var n,r;const i={};null!=e&&(i.mimeType=e.mimeType,i.name=e.name,i.displayName=e.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const s=this.clientOptions.uploader,o=await s.stat(t);i.sizeBytes=String(o.size);const a=null!==(n=null==e?void 0:e.mimeType)&&void 0!==n?n:o.type;if(void 0===a||""===a)throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=a;let l="";"string"==typeof t&&(l=t.replace(/[/\\]+$/,""),l=null!==(r=l.split(/[/\\]/).pop())&&void 0!==r?r:"");const u=await this.fetchUploadUrl(i,l,e);return s.upload(t,u,this)}async downloadFile(t){const e=this.clientOptions.downloader;await e.download(t,this)}async fetchUploadUrl(t,e,n){var r;let i={};i=(null==n?void 0:n.httpOptions)?n.httpOptions:{apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${t.mimeType}`},e?{"X-Goog-Upload-File-Name":e}:{})};const s={file:t},o=await this.request({path:ur("upload/v1beta/files",s._url),body:JSON.stringify(s),httpMethod:"POST",httpOptions:i});if(!o||!(null==o?void 0:o.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const a=null===(r=null==o?void 0:o.headers)||void 0===r?void 0:r["x-goog-upload-url"];if(void 0===a)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return a}}async function Jo(t){var e;if(void 0===t)throw new Error("response is undefined");if(!t.ok){const n=t.status;let r;r=(null===(e=t.headers.get("content-type"))||void 0===e?void 0:e.includes("application/json"))?await t.json():{error:{message:await t.text(),code:t.status,status:t.statusText}};const i=JSON.stringify(r);if(n>=400&&n<600){throw new Fs({message:i,status:n})}throw new Error(i)}}function zo(t){for(const e of t){if(Ko(e))return!0;if("object"==typeof e&&"inputSchema"in e)return!0}return false}function Yo(t){var e;const n=null!==(e=t[Fo])&&void 0!==e?e:"";t[Fo]=(n+" mcp_used/unknown").trimStart()}function Ko(t){return null!==t&&"object"==typeof t&&t instanceof Xo}function Wo(t,e=100){return Ds(this,arguments,function*(){let n,r=0;for(;r<e;){const e=yield Ls(t.listTools({cursor:n}));for(const t of e.tools)yield yield Ls(t),r++;if(!e.nextCursor)break;n=e.nextCursor}})}class Xo{constructor(t=[],e){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=t,this.config=e}static create(t,e){return new Xo(t,e)}async initialize(){var t,e,n,r;if(this.mcpTools.length>0)return;const i={},s=[];for(const u of this.mcpClients)try{for(var o,a=!0,l=(e=void 0,Us(Wo(u)));!(t=(o=await l.next()).done);a=!0){r=o.value,a=!1;const t=r;s.push(t);const e=t.name;if(i[e])throw new Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);i[e]=u}}catch(t){e={error:t}}finally{try{a||t||!(n=l.return)||await n.call(l)}finally{if(e)throw e.error}}this.mcpTools=s,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),function(t,e={}){const n=[],r=new Set;for(const i of t){const t=i.name;if(r.has(t))throw new Error(`Duplicate function name ${t} found in MCP tools. Please ensure function names are unique.`);r.add(t);const s=ls(i,e);s.functionDeclarations&&n.push(...s.functionDeclarations)}return{functionDeclarations:n}}(this.mcpTools,this.config)}async callTool(t){await this.initialize();const e=[];for(const n of t)if(n.name in this.functionNameToMcpClient){const t=this.functionNameToMcpClient[n.name];let r;this.config.timeout&&(r={timeout:this.config.timeout});const i=await t.callTool({name:n.name,arguments:n.args},void 0,r);e.push({functionResponse:{name:n.name,response:i.isError?{error:i}:i}})}return e}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Qo{constructor(t,e,n){this.apiClient=t,this.auth=e,this.webSocketFactory=n}async connect(t){var e,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const r=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),s=function(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(this.apiClient.getDefaultHeaders()),o=`${r}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${this.apiClient.getApiKey()}`;let a=()=>{};const l=new Promise(t=>{a=t}),u=t.callbacks,c=(this.apiClient,{onopen:function(){a({})},onmessage:t=>{!async function(t,e,n){const r=new Mi;let i;i=n.data instanceof Blob?JSON.parse(await n.data.text()):JSON.parse(n.data),Object.assign(r,i),e(r)}(0,u.onmessage,t)},onerror:null!==(e=null==u?void 0:u.onerror)&&void 0!==e?e:function(t){},onclose:null!==(n=null==u?void 0:u.onclose)&&void 0!==n?n:function(t){}}),p=this.webSocketFactory.create(o,function(t){const e={};return t.forEach((t,n)=>{e[n]=t}),e}(s),c);p.connect(),await l;const h={setup:{model:Li(this.apiClient,t.model)}};return p.send(JSON.stringify(h)),new Zo(p,this.apiClient)}}class Zo{constructor(t,e){this.conn=t,this.apiClient=e}async setWeightedPrompts(t){if(!t.weightedPrompts||0===Object.keys(t.weightedPrompts).length)throw new Error("Weighted prompts must be set and contain at least one entry.");const e=function(t){const e={},n=pr(t,["weightedPrompts"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["weightedPrompts"],t)}return e}(t);this.conn.send(JSON.stringify({clientContent:e}))}async setMusicGenerationConfig(t){t.musicGenerationConfig||(t.musicGenerationConfig={});const e=function(t){const e={},n=pr(t,["musicGenerationConfig"]);return null!=n&&cr(e,["musicGenerationConfig"],n),e}(t);this.conn.send(JSON.stringify(e))}sendPlaybackControl(t){const e={playbackControl:t};this.conn.send(JSON.stringify(e))}play(){this.sendPlaybackControl(pi.PLAY)}pause(){this.sendPlaybackControl(pi.PAUSE)}stop(){this.sendPlaybackControl(pi.STOP)}resetContext(){this.sendPlaybackControl(pi.RESET_CONTEXT)}close(){this.conn.close()}}class ta{constructor(t,e,n){this.apiClient=t,this.auth=e,this.webSocketFactory=n,this.music=new Qo(this.apiClient,this.auth,this.webSocketFactory)}async connect(t){var e,n,r,i,s,o;if(t.config&&t.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const a=this.apiClient.getWebsocketBaseUrl(),l=this.apiClient.getApiVersion();let u;const c=this.apiClient.getHeaders();t.config&&t.config.tools&&zo(t.config.tools)&&Yo(c);const p=function(t){const e=new Headers;for(const[n,r]of Object.entries(t))e.append(n,r);return e}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(c);if(this.apiClient.isVertexAI())u=`${a}/ws/google.cloud.aiplatform.${l}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p,u);else{const t=this.apiClient.getApiKey();let e="BidiGenerateContent",n="key";(null==t?void 0:t.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),"v1alpha"!==l&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),e="BidiGenerateContentConstrained",n="access_token"),u=`${a}/ws/google.ai.generativelanguage.${l}.GenerativeService.${e}?${n}=${t}`}let h=()=>{};const d=new Promise(t=>{h=t}),f=t.callbacks,m=this.apiClient,y={onopen:function(){var t;null===(t=null==f?void 0:f.onopen)||void 0===t||t.call(f),h({})},onmessage:t=>{!async function(t,e,n){const r=new ki;let i;i=n.data instanceof Blob?await n.data.text():n.data instanceof ArrayBuffer?(new TextDecoder).decode(n.data):n.data;const s=JSON.parse(i);if(t.isVertexAI()){const t=Qs(s);Object.assign(r,t)}else{const t=s;Object.assign(r,t)}e(r)}(m,f.onmessage,t)},onerror:null!==(e=null==f?void 0:f.onerror)&&void 0!==e?e:function(t){},onclose:null!==(n=null==f?void 0:f.onclose)&&void 0!==n?n:function(t){}},g=this.webSocketFactory.create(u,function(t){const e={};return t.forEach((t,n)=>{e[n]=t}),e}(p),y);g.connect(),await d;let w=Li(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&w.startsWith("publishers/")){w=`projects/${this.apiClient.getProject()}/locations/${this.apiClient.getLocation()}/`+w}let v={};this.apiClient.isVertexAI()&&void 0===(null===(r=t.config)||void 0===r?void 0:r.responseModalities)&&(void 0===t.config?t.config={responseModalities:[Rr.AUDIO]}:t.config.responseModalities=[Rr.AUDIO]),(null===(i=t.config)||void 0===i?void 0:i.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const E=null!==(o=null===(s=t.config)||void 0===s?void 0:s.tools)&&void 0!==o?o:[],T=[];for(const t of E)if(this.isCallableTool(t)){const e=t;T.push(await e.tool())}else T.push(t);T.length>0&&(t.config.tools=T);const I={model:w,config:t.config,callbacks:t.callbacks};return v=this.apiClient.isVertexAI()?function(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["setup","model"],Li(t,r));const i=pr(e,["config"]);return null!=i&&cr(n,["config"],Ks(i,n)),n}(this.apiClient,I):function(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["setup","model"],Li(t,r));const i=pr(e,["config"]);return null!=i&&cr(n,["config"],Ys(i,n)),n}(this.apiClient,I),delete v.config,g.send(JSON.stringify(v)),new na(g,this.apiClient)}isCallableTool(t){return"callTool"in t&&"function"==typeof t.callTool}}const ea={turnComplete:!0};class na{constructor(t,e){this.conn=t,this.apiClient=e}tLiveClientContent(t,e){if(null!==e.turns&&void 0!==e.turns){let n=[];try{n=Yi(e.turns),t.isVertexAI()||(n=n.map(t=>no(t)))}catch(t){throw new Error(`Failed to parse client content "turns", type: '${typeof e.turns}'`)}return{clientContent:{turns:n,turnComplete:e.turnComplete}}}return{clientContent:{turnComplete:e.turnComplete}}}tLiveClienttToolResponse(t,e){let n=[];if(null==e.functionResponses)throw new Error("functionResponses is required.");if(n=Array.isArray(e.functionResponses)?e.functionResponses:[e.functionResponses],0===n.length)throw new Error("functionResponses is required.");for(const e of n){if("object"!=typeof e||null===e||!("name"in e)||!("response"in e))throw new Error(`Could not parse function response, type '${typeof e}'.`);if(!t.isVertexAI()&&!("id"in e))throw new Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:n}}}sendClientContent(t){t=Object.assign(Object.assign({},ea),t);const e=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(e))}sendRealtimeInput(t){let e={};e=this.apiClient.isVertexAI()?{realtimeInput:Xs(t)}:{realtimeInput:Ws(t)},this.conn.send(JSON.stringify(e))}sendToolResponse(t){if(null==t.functionResponses)throw new Error("Tool response parameters are required.");const e=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(e))}close(){this.conn.close()}}function ra(t){var e,n,r;if(null===(e=null==t?void 0:t.automaticFunctionCalling)||void 0===e?void 0:e.disable)return!0;let i=!1;for(const e of null!==(n=null==t?void 0:t.tools)&&void 0!==n?n:[])if(ia(e)){i=!0;break}if(!i)return!0;const s=null===(r=null==t?void 0:t.automaticFunctionCalling)||void 0===r?void 0:r.maximumRemoteCalls;return!!(s&&(s<0||!Number.isInteger(s))||0==s)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",s),!0)}function ia(t){return"callTool"in t&&"function"==typeof t.callTool}function sa(t){var e;return!(null===(e=null==t?void 0:t.automaticFunctionCalling)||void 0===e?void 0:e.ignoreCallHistory)}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class oa extends lr{constructor(t){super(),this.apiClient=t,this.generateContent=async t=>{var e,n,r,i,s;const o=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!function(t){var e,n,r;return null!==(r=null===(n=null===(e=t.config)||void 0===e?void 0:e.tools)||void 0===n?void 0:n.some(t=>ia(t)))&&void 0!==r&&r}(t)||ra(t.config))return await this.generateContentInternal(o);if(function(t){var e,n,r;return null!==(r=null===(n=null===(e=t.config)||void 0===e?void 0:e.tools)||void 0===n?void 0:n.some(t=>!ia(t)))&&void 0!==r&&r}(t))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let a,l;const u=Yi(o.contents),c=null!==(r=null===(n=null===(e=o.config)||void 0===e?void 0:e.automaticFunctionCalling)||void 0===n?void 0:n.maximumRemoteCalls)&&void 0!==r?r:10;let p=0;for(;p<c&&(a=await this.generateContentInternal(o),a.functionCalls&&0!==a.functionCalls.length);){const e=a.candidates[0].content,n=[];for(const e of null!==(s=null===(i=t.config)||void 0===i?void 0:i.tools)&&void 0!==s?s:[])if(ia(e)){const t=e,r=await t.callTool(a.functionCalls);n.push(...r)}p++,l={role:"user",parts:n},o.contents=Yi(o.contents),o.contents.push(e),o.contents.push(l),sa(o.config)&&(u.push(e),u.push(l))}return sa(o.config)&&(a.automaticFunctionCallingHistory=u),a},this.generateContentStream=async t=>{if(this.maybeMoveToResponseJsonSchem(t),ra(t.config)){const e=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(e)}return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(t=>{var e;let n;const r=[];if(null==t?void 0:t.generatedImages)for(const i of t.generatedImages)i&&(null==i?void 0:i.safetyAttributes)&&"Positive Prompt"===(null===(e=null==i?void 0:i.safetyAttributes)||void 0===e?void 0:e.contentType)?n=null==i?void 0:i.safetyAttributes:r.push(i);let i;return i=n?{generatedImages:r,positivePromptSafetyAttributes:n,sdkHttpResponse:t.sdkHttpResponse}:{generatedImages:r,sdkHttpResponse:t.sdkHttpResponse},i}),this.list=async t=>{var e;const n={config:Object.assign(Object.assign({},{queryBase:!0}),null==t?void 0:t.config)};if(this.apiClient.isVertexAI()&&!n.config.queryBase){if(null===(e=n.config)||void 0===e?void 0:e.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");n.config.filter="labels.tune-type:*"}return new Ns(hi.PAGED_ITEM_MODELS,t=>this.listInternal(t),await this.listInternal(n),n)},this.editImage=async t=>{const e={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(e.referenceImages=t.referenceImages.map(t=>t.toReferenceImageAPI())),await this.editImageInternal(e)},this.upscaleImage=async t=>{let e={numberOfImages:1,mode:"upscale"};t.config&&(e=Object.assign(Object.assign({},e),t.config));const n={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:e};return await this.upscaleImageInternal(n)},this.generateVideos=async t=>{var e,n,r,i,s,o;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||((null===(e=t.video)||void 0===e?void 0:e.uri)&&(null===(n=t.video)||void 0===n?void 0:n.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:(null===(i=null===(r=t.source)||void 0===r?void 0:r.video)||void 0===i?void 0:i.uri)&&(null===(o=null===(s=t.source)||void 0===s?void 0:s.video)||void 0===o?void 0:o.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(t){t.config&&t.config.responseSchema&&(t.config.responseJsonSchema||Object.keys(t.config.responseSchema).includes("$schema")&&(t.config.responseJsonSchema=t.config.responseSchema,delete t.config.responseSchema))}async processParamsMaybeAddMcpUsage(t){var e,n,r;const i=null===(e=t.config)||void 0===e?void 0:e.tools;if(!i)return t;const s=await Promise.all(i.map(async t=>{if(ia(t)){const e=t;return await e.tool()}return t})),o={model:t.model,contents:t.contents,config:Object.assign(Object.assign({},t.config),{tools:s})};if(o.config.tools=s,t.config&&t.config.tools&&zo(t.config.tools)){const e=null!==(r=null===(n=t.config.httpOptions)||void 0===n?void 0:n.headers)&&void 0!==r?r:{};let i=Object.assign({},e);0===Object.keys(i).length&&(i=this.apiClient.getDefaultHeaders()),Yo(i),o.config.httpOptions=Object.assign(Object.assign({},t.config.httpOptions),{headers:i})}return o}async initAfcToolsMap(t){var e,n,r;const i=new Map;for(const s of null!==(n=null===(e=t.config)||void 0===e?void 0:e.tools)&&void 0!==n?n:[])if(ia(s)){const t=s,e=await t.tool();for(const n of null!==(r=e.functionDeclarations)&&void 0!==r?r:[]){if(!n.name)throw new Error("Function declaration name is required.");if(i.has(n.name))throw new Error(`Duplicate tool declaration name: ${n.name}`);i.set(n.name,t)}}return i}async processAfcStream(t){var e,n,r;const i=null!==(r=null===(n=null===(e=t.config)||void 0===e?void 0:e.automaticFunctionCalling)||void 0===n?void 0:n.maximumRemoteCalls)&&void 0!==r?r:10;let s=!1,o=0;return function(t,e,n){var r,a;return Ds(this,arguments,function*(){for(var l,u,c,p;o<i;){s&&(o++,s=!1);const m=yield Ls(t.processParamsMaybeAddMcpUsage(n)),y=yield Ls(t.generateContentStreamInternal(m)),g=[],w=[];try{for(var h,d=!0,f=(u=void 0,Us(y));!(l=(h=yield Ls(f.next())).done);d=!0){p=h.value,d=!1;const t=p;if(yield yield Ls(t),t.candidates&&(null===(r=t.candidates[0])||void 0===r?void 0:r.content)){w.push(t.candidates[0].content);for(const n of null!==(a=t.candidates[0].content.parts)&&void 0!==a?a:[])if(o<i&&n.functionCall){if(!n.functionCall.name)throw new Error("Function call name was not returned by the model.");if(!e.has(n.functionCall.name))throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${e.keys()}, mising tool: ${n.functionCall.name}`);{const t=yield Ls(e.get(n.functionCall.name).callTool([n.functionCall]));g.push(...t)}}}}}catch(t){u={error:t}}finally{try{d||l||!(c=f.return)||(yield Ls(c.call(f)))}finally{if(u)throw u.error}}if(!(g.length>0))break;{s=!0;const t=new fi;t.candidates=[{content:{role:"user",parts:g}}],yield yield Ls(t);const e=[];e.push(...w),e.push({role:"user",parts:g});const r=Yi(n.contents).concat(e);n.contents=r}}})}(this,await this.initAfcToolsMap(t),t)}async generateContentInternal(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=co(this.apiClient,t);return o=ur("{model}:generateContent",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=ho(t),n=new fi;return Object.assign(n,e),n})}{const e=uo(this.apiClient,t);return o=ur("{model}:generateContent",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"POST",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=po(t),n=new fi;return Object.assign(n,e),n})}}async generateContentStreamInternal(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=co(this.apiClient,t);o=ur("{model}:streamGenerateContent?alt=sse",r._url),a=r._query,delete r._url,delete r._query;return s=this.apiClient.requestStream({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}),s.then(function(t){return Ds(this,arguments,function*(){var e,n,r,i;try{for(var s,o=!0,a=Us(t);!(e=(s=yield Ls(a.next())).done);o=!0){i=s.value,o=!1;const t=i,e=ho(yield Ls(t.json()));e.sdkHttpResponse={headers:t.headers};const n=new fi;Object.assign(n,e),yield yield Ls(n)}}catch(t){n={error:t}}finally{try{o||e||!(r=a.return)||(yield Ls(r.call(a)))}finally{if(n)throw n.error}}})})}{const e=uo(this.apiClient,t);o=ur("{model}:streamGenerateContent?alt=sse",e._url),a=e._query,delete e._url,delete e._query;return s=this.apiClient.requestStream({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"POST",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}),s.then(function(t){return Ds(this,arguments,function*(){var e,n,r,i;try{for(var s,o=!0,a=Us(t);!(e=(s=yield Ls(a.next())).done);o=!0){i=s.value,o=!1;const t=i,e=po(yield Ls(t.json()));e.sdkHttpResponse={headers:t.headers};const n=new fi;Object.assign(n,e),yield yield Ls(n)}}catch(t){n={error:t}}finally{try{o||e||!(r=a.return)||(yield Ls(r.call(a)))}finally{if(n)throw n.error}}})})}}async embedContent(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=ao(this.apiClient,t);return o=ur("{model}:predict",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["predictions[]","embeddings"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>eo(t))),cr(e,["embeddings"],t)}const i=pr(t,["metadata"]);return null!=i&&cr(e,["metadata"],i),e}(t),n=new mi;return Object.assign(n,e),n})}{const e=oo(this.apiClient,t);return o=ur("{model}:batchEmbedContents",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"POST",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["embeddings"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["embeddings"],t)}const i=pr(t,["metadata"]);return null!=i&&cr(e,["metadata"],i),e}(t),n=new mi;return Object.assign(n,e),n})}}async generateImagesInternal(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=mo(this.apiClient,t);return o=ur("{model}:predict",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["predictions"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>Ao(t))),cr(e,["generatedImages"],t)}const i=pr(t,["positivePromptSafetyAttributes"]);return null!=i&&cr(e,["positivePromptSafetyAttributes"],ko(i)),e}(t),n=new yi;return Object.assign(n,e),n})}{const e=fo(this.apiClient,t);return o=ur("{model}:predict",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"POST",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=yo(t),n=new yi;return Object.assign(n,e),n})}}async editImageInternal(t){var e,n;let r,i="",s={};if(this.apiClient.isVertexAI()){const o=so(this.apiClient,t);return i=ur("{model}:predict",o._url),s=o._query,delete o._url,delete o._query,r=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),r.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["predictions"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>Ao(t))),cr(e,["generatedImages"],t)}return e}(t),n=new gi;return Object.assign(n,e),n})}throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(t){var e,n;let r,i="",s={};if(this.apiClient.isVertexAI()){const o=$o(this.apiClient,t);return i=ur("{model}:predict",o._url),s=o._query,delete o._url,delete o._query,r=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),r.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["predictions"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>Ao(t))),cr(e,["generatedImages"],t)}return e}(t),n=new wi;return Object.assign(n,e),n})}throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(t){var e,n;let r,i="",s={};if(this.apiClient.isVertexAI()){const o=xo(this.apiClient,t);return i=ur("{model}:predict",o._url),s=o._query,delete o._url,delete o._query,r=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),r.then(t=>{const e=function(t){const e={},n=pr(t,["predictions"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>Ao(t))),cr(e,["generatedImages"],t)}return e}(t),n=new vi;return Object.assign(n,e),n})}throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(t){var e,n;let r,i="",s={};if(this.apiClient.isVertexAI()){const o=Mo(this.apiClient,t);return i=ur("{model}:predict",o._url),s=o._query,delete o._url,delete o._query,r=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),r.then(t=>{const e=Lo(t),n=new Ei;return Object.assign(n,e),n})}throw new Error("This method is only supported by the Vertex AI.")}async get(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=function(t,e){const n={},r=pr(e,["model"]);return null!=r&&cr(n,["_url","name"],Li(t,r)),n}(this.apiClient,t);return o=ur("{name}",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),s.then(t=>Co(t))}{const e=function(t,e){const n={},r=pr(e,["model"]);return null!=r&&cr(n,["_url","name"],Li(t,r)),n}(this.apiClient,t);return o=ur("{name}",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"GET",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json()),s.then(t=>Po(t))}}async listInternal(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=_o(this.apiClient,t);return o=ur("{models_url}",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["nextPageToken"]);null!=r&&cr(e,["nextPageToken"],r);const i=pr(t,["_self"]);if(null!=i){let t=os(i);Array.isArray(t)&&(t=t.map(t=>Co(t))),cr(e,["models"],t)}return e}(t),n=new Ti;return Object.assign(n,e),n})}{const e=Oo(this.apiClient,t);return o=ur("{models_url}",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"GET",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["nextPageToken"]);null!=r&&cr(e,["nextPageToken"],r);const i=pr(t,["_self"]);if(null!=i){let t=os(i);Array.isArray(t)&&(t=t.map(t=>Po(t))),cr(e,["models"],t)}return e}(t),n=new Ti;return Object.assign(n,e),n})}}async update(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=Go(this.apiClient,t);return o=ur("{model}",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"PATCH",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),s.then(t=>Co(t))}{const e=qo(this.apiClient,t);return o=ur("{name}",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"PATCH",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json()),s.then(t=>Po(t))}}async delete(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=function(t,e){const n={},r=pr(e,["model"]);return null!=r&&cr(n,["_url","name"],Li(t,r)),n}(this.apiClient,t);return o=ur("{name}",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);return null!=n&&cr(e,["sdkHttpResponse"],n),e}(t),n=new Ii;return Object.assign(n,e),n})}{const e=function(t,e){const n={},r=pr(e,["model"]);return null!=r&&cr(n,["_url","name"],Li(t,r)),n}(this.apiClient,t);return o=ur("{name}",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"DELETE",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);return null!=n&&cr(e,["sdkHttpResponse"],n),e}(t),n=new Ii;return Object.assign(n,e),n})}}async countTokens(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=function(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["contents"]);if(null!=i){let t=Yi(i);Array.isArray(t)&&(t=t.map(t=>t)),cr(n,["contents"],t)}const s=pr(e,["config"]);return null!=s&&ro(s,n),n}(this.apiClient,t);return o=ur("{model}:countTokens",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["totalTokens"]);return null!=r&&cr(e,["totalTokens"],r),e}(t),n=new Ai;return Object.assign(n,e),n})}{const e=io(this.apiClient,t);return o=ur("{model}:countTokens",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"POST",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["totalTokens"]);null!=r&&cr(e,["totalTokens"],r);const i=pr(t,["cachedContentTokenCount"]);return null!=i&&cr(e,["cachedContentTokenCount"],i),e}(t),n=new Ai;return Object.assign(n,e),n})}}async computeTokens(t){var e,n;let r,i="",s={};if(this.apiClient.isVertexAI()){const o=function(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["_url","model"],Li(t,r));const i=pr(e,["contents"]);if(null!=i){let t=Yi(i);Array.isArray(t)&&(t=t.map(t=>t)),cr(n,["contents"],t)}return n}(this.apiClient,t);return i=ur("{model}:computeTokens",o._url),s=o._query,delete o._url,delete o._query,r=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),r.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["tokensInfo"]);if(null!=r){let t=r;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["tokensInfo"],t)}return e}(t),n=new Ni;return Object.assign(n,e),n})}throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=Io(this.apiClient,t);return o=ur("{model}:predictLongRunning",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),s.then(t=>{const e=Eo(t),n=new bi;return Object.assign(n,e),n})}{const e=To(this.apiClient,t);return o=ur("{model}:predictLongRunning",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"POST",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json()),s.then(t=>{const e=vo(t),n=new bi;return Object.assign(n,e),n})}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class aa extends lr{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){const e=t.operation,n=t.config;if(void 0===e.name||""===e.name)throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const t=e.name.split("/operations/")[0];let r;n&&"httpOptions"in n&&(r=n.httpOptions);const i=await this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:t,config:{httpOptions:r}});return e._fromAPIResponse({apiResponse:i,isVertexAI:!0})}{const t=await this.getVideosOperationInternal({operationName:e.name,config:n});return e._fromAPIResponse({apiResponse:t,isVertexAI:!1})}}async get(t){const e=t.operation,n=t.config;if(void 0===e.name||""===e.name)throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const t=e.name.split("/operations/")[0];let r;n&&"httpOptions"in n&&(r=n.httpOptions);const i=await this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:t,config:{httpOptions:r}});return e._fromAPIResponse({apiResponse:i,isVertexAI:!0})}{const t=await this.getVideosOperationInternal({operationName:e.name,config:n});return e._fromAPIResponse({apiResponse:t,isVertexAI:!1})}}async getVideosOperationInternal(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=function(t){const e={},n=pr(t,["operationName"]);return null!=n&&cr(e,["_url","operationName"],n),e}(t);return o=ur("{operationName}",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),s}{const e=function(t){const e={},n=pr(t,["operationName"]);return null!=n&&cr(e,["_url","operationName"],n),e}(t);return o=ur("{operationName}",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"GET",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json()),s}}async fetchPredictVideosOperationInternal(t){var e,n;let r,i="",s={};if(this.apiClient.isVertexAI()){const o=function(t){const e={},n=pr(t,["operationName"]);null!=n&&cr(e,["operationName"],n);const r=pr(t,["resourceName"]);return null!=r&&cr(e,["_url","resourceName"],r),e}(t);return i=ur("{resourceName}:fetchPredictOperation",o._url),s=o._query,delete o._url,delete o._query,r=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),r}throw new Error("This method is only supported by the Vertex AI.")}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function la(t){const e={},n=pr(t,["parts"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["functionCall"]);null!=n&&cr(e,["functionCall"],n);const r=pr(t,["codeExecutionResult"]);null!=r&&cr(e,["codeExecutionResult"],r);const i=pr(t,["executableCode"]);null!=i&&cr(e,["executableCode"],i);const s=pr(t,["fileData"]);null!=s&&cr(e,["fileData"],function(t){const e={};if(void 0!==pr(t,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const n=pr(t,["fileUri"]);null!=n&&cr(e,["fileUri"],n);const r=pr(t,["mimeType"]);null!=r&&cr(e,["mimeType"],r);return e}(s));const o=pr(t,["functionResponse"]);null!=o&&cr(e,["functionResponse"],o);const a=pr(t,["inlineData"]);null!=a&&cr(e,["inlineData"],function(t){const e={},n=pr(t,["data"]);if(null!=n&&cr(e,["data"],n),void 0!==pr(t,["displayName"]))throw new Error("displayName parameter is not supported in Gemini API.");const r=pr(t,["mimeType"]);return null!=r&&cr(e,["mimeType"],r),e}(a));const l=pr(t,["text"]);null!=l&&cr(e,["text"],l);const u=pr(t,["thought"]);null!=u&&cr(e,["thought"],u);const c=pr(t,["thoughtSignature"]);null!=c&&cr(e,["thoughtSignature"],c);const p=pr(t,["videoMetadata"]);null!=p&&cr(e,["videoMetadata"],p);return e}(t))),cr(e,["parts"],t)}const r=pr(t,["role"]);return null!=r&&cr(e,["role"],r),e}function ua(t,e,n){const r=pr(e,["expireTime"]);void 0!==n&&null!=r&&cr(n,["expireTime"],r);const i=pr(e,["newSessionExpireTime"]);void 0!==n&&null!=i&&cr(n,["newSessionExpireTime"],i);const s=pr(e,["uses"]);void 0!==n&&null!=s&&cr(n,["uses"],s);const o=pr(e,["liveConnectConstraints"]);void 0!==n&&null!=o&&cr(n,["bidiGenerateContentSetup"],function(t,e){const n={},r=pr(e,["model"]);null!=r&&cr(n,["setup","model"],Li(t,r));const i=pr(e,["config"]);null!=i&&cr(n,["config"],function(t,e){const n={},r=pr(t,["generationConfig"]);void 0!==e&&null!=r&&cr(e,["setup","generationConfig"],r);const i=pr(t,["responseModalities"]);void 0!==e&&null!=i&&cr(e,["setup","generationConfig","responseModalities"],i);const s=pr(t,["temperature"]);void 0!==e&&null!=s&&cr(e,["setup","generationConfig","temperature"],s);const o=pr(t,["topP"]);void 0!==e&&null!=o&&cr(e,["setup","generationConfig","topP"],o);const a=pr(t,["topK"]);void 0!==e&&null!=a&&cr(e,["setup","generationConfig","topK"],a);const l=pr(t,["maxOutputTokens"]);void 0!==e&&null!=l&&cr(e,["setup","generationConfig","maxOutputTokens"],l);const u=pr(t,["mediaResolution"]);void 0!==e&&null!=u&&cr(e,["setup","generationConfig","mediaResolution"],u);const c=pr(t,["seed"]);void 0!==e&&null!=c&&cr(e,["setup","generationConfig","seed"],c);const p=pr(t,["speechConfig"]);void 0!==e&&null!=p&&cr(e,["setup","generationConfig","speechConfig"],Qi(p));const h=pr(t,["thinkingConfig"]);void 0!==e&&null!=h&&cr(e,["setup","generationConfig","thinkingConfig"],h);const d=pr(t,["enableAffectiveDialog"]);void 0!==e&&null!=d&&cr(e,["setup","generationConfig","enableAffectiveDialog"],d);const f=pr(t,["systemInstruction"]);void 0!==e&&null!=f&&cr(e,["setup","systemInstruction"],la(Ji(f)));const m=pr(t,["tools"]);if(void 0!==e&&null!=m){let t=ts(m);Array.isArray(t)&&(t=t.map(t=>function(t){const e={},n=pr(t,["functionDeclarations"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["functionDeclarations"],t)}if(void 0!==pr(t,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");const r=pr(t,["googleSearchRetrieval"]);null!=r&&cr(e,["googleSearchRetrieval"],r);const i=pr(t,["googleMaps"]);null!=i&&cr(e,["googleMaps"],function(t){const e={};if(void 0!==pr(t,["authConfig"]))throw new Error("authConfig parameter is not supported in Gemini API.");const n=pr(t,["enableWidget"]);null!=n&&cr(e,["enableWidget"],n);return e}(i));const s=pr(t,["computerUse"]);null!=s&&cr(e,["computerUse"],s);const o=pr(t,["codeExecution"]);null!=o&&cr(e,["codeExecution"],o);if(void 0!==pr(t,["enterpriseWebSearch"]))throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=pr(t,["googleSearch"]);null!=a&&cr(e,["googleSearch"],function(t){const e={};if(void 0!==pr(t,["excludeDomains"]))throw new Error("excludeDomains parameter is not supported in Gemini API.");const n=pr(t,["timeRangeFilter"]);null!=n&&cr(e,["timeRangeFilter"],n);return e}(a));const l=pr(t,["urlContext"]);null!=l&&cr(e,["urlContext"],l);return e}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */(Zi(t)))),cr(e,["setup","tools"],t)}const y=pr(t,["sessionResumption"]);void 0!==e&&null!=y&&cr(e,["setup","sessionResumption"],function(t){const e={},n=pr(t,["handle"]);null!=n&&cr(e,["handle"],n);if(void 0!==pr(t,["transparent"]))throw new Error("transparent parameter is not supported in Gemini API.");return e}(y));const g=pr(t,["inputAudioTranscription"]);void 0!==e&&null!=g&&cr(e,["setup","inputAudioTranscription"],g);const w=pr(t,["outputAudioTranscription"]);void 0!==e&&null!=w&&cr(e,["setup","outputAudioTranscription"],w);const v=pr(t,["realtimeInputConfig"]);void 0!==e&&null!=v&&cr(e,["setup","realtimeInputConfig"],v);const E=pr(t,["contextWindowCompression"]);void 0!==e&&null!=E&&cr(e,["setup","contextWindowCompression"],E);const T=pr(t,["proactivity"]);void 0!==e&&null!=T&&cr(e,["setup","proactivity"],T);return n}(i,n));return n}(t,o));const a=pr(e,["lockAdditionalFields"]);return void 0!==n&&null!=a&&cr(n,["fieldMask"],a),{}}function ca(t,e){let n=null;const r=t.bidiGenerateContentSetup;if("object"==typeof r&&null!==r&&"setup"in r){const e=r.setup;"object"==typeof e&&null!==e?(t.bidiGenerateContentSetup=e,n=e):delete t.bidiGenerateContentSetup}else void 0!==r&&delete t.bidiGenerateContentSetup;const i=t.fieldMask;if(n){const r=function(t){const e=[];for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const r=t[n];if("object"==typeof r&&null!=r&&Object.keys(r).length>0){const t=Object.keys(r).map(t=>`${n}.${t}`);e.push(...t)}else e.push(n)}return e.join(",")}(n);if(Array.isArray(null==e?void 0:e.lockAdditionalFields)&&0===(null==e?void 0:e.lockAdditionalFields.length))r?t.fieldMask=r:delete t.fieldMask;else if((null==e?void 0:e.lockAdditionalFields)&&e.lockAdditionalFields.length>0&&null!==i&&Array.isArray(i)&&i.length>0){const e=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let n=[];i.length>0&&(n=i.map(t=>e.includes(t)?`generationConfig.${t}`:t));const s=[];r&&s.push(r),n.length>0&&s.push(...n),s.length>0?t.fieldMask=s.join(","):delete t.fieldMask}else delete t.fieldMask}else null!==i&&Array.isArray(i)&&i.length>0?t.fieldMask=i.join(","):delete t.fieldMask;return t}class pa extends lr{constructor(t){super(),this.apiClient=t}async create(t){var e,n;let r,i="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const o=function(t,e){const n={},r=pr(e,["config"]);return null!=r&&cr(n,["config"],ua(t,r,n)),n}(this.apiClient,t);i=ur("auth_tokens",o._url),s=o._query,delete o.config,delete o._url,delete o._query;const a=ca(o,t.config);return r=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json()),r.then(t=>t)}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ha(t,e){const n={},r=pr(t,["baseModel"]);null!=r&&cr(n,["baseModel"],r);const i=pr(t,["preTunedModel"]);null!=i&&cr(n,["preTunedModel"],i);const s=pr(t,["trainingDataset"]);null!=s&&function(t){const e={};if(void 0!==pr(t,["gcsUri"]))throw new Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==pr(t,["vertexDatasetResource"]))throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const n=pr(t,["examples"]);if(null!=n){let t=n;Array.isArray(t)&&(t=t.map(t=>t)),cr(e,["examples","examples"],t)}}(s);const o=pr(t,["config"]);return null!=o&&function(t,e){const n={};if(void 0!==pr(t,["validationDataset"]))throw new Error("validationDataset parameter is not supported in Gemini API.");const r=pr(t,["tunedModelDisplayName"]);if(void 0!==e&&null!=r&&cr(e,["displayName"],r),void 0!==pr(t,["description"]))throw new Error("description parameter is not supported in Gemini API.");const i=pr(t,["epochCount"]);void 0!==e&&null!=i&&cr(e,["tuningTask","hyperparameters","epochCount"],i);const s=pr(t,["learningRateMultiplier"]);if(null!=s&&cr(n,["tuningTask","hyperparameters","learningRateMultiplier"],s),void 0!==pr(t,["exportLastCheckpointOnly"]))throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==pr(t,["preTunedModelCheckpointId"]))throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==pr(t,["adapterSize"]))throw new Error("adapterSize parameter is not supported in Gemini API.");const o=pr(t,["batchSize"]);void 0!==e&&null!=o&&cr(e,["tuningTask","hyperparameters","batchSize"],o);const a=pr(t,["learningRate"]);if(void 0!==e&&null!=a&&cr(e,["tuningTask","hyperparameters","learningRate"],a),void 0!==pr(t,["labels"]))throw new Error("labels parameter is not supported in Gemini API.");if(void 0!==pr(t,["beta"]))throw new Error("beta parameter is not supported in Gemini API.")}(o,n),n}function da(t,e){const n={},r=pr(t,["baseModel"]);null!=r&&cr(n,["baseModel"],r);const i=pr(t,["preTunedModel"]);null!=i&&cr(n,["preTunedModel"],i);const s=pr(t,["trainingDataset"]);null!=s&&function(t,e,n){const r={};let i=pr(n,["config","method"]);void 0===i&&(i="SUPERVISED_FINE_TUNING");if("SUPERVISED_FINE_TUNING"===i){const n=pr(t,["gcsUri"]);void 0!==e&&null!=n&&cr(e,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===i){const n=pr(t,["gcsUri"]);void 0!==e&&null!=n&&cr(e,["preferenceOptimizationSpec","trainingDatasetUri"],n)}let s=pr(n,["config","method"]);void 0===s&&(s="SUPERVISED_FINE_TUNING");if("SUPERVISED_FINE_TUNING"===s){const n=pr(t,["vertexDatasetResource"]);void 0!==e&&null!=n&&cr(e,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===s){const n=pr(t,["vertexDatasetResource"]);void 0!==e&&null!=n&&cr(e,["preferenceOptimizationSpec","trainingDatasetUri"],n)}if(void 0!==pr(t,["examples"]))throw new Error("examples parameter is not supported in Vertex AI.")}(s,n,e);const o=pr(t,["config"]);return null!=o&&function(t,e,n){let r=pr(n,["config","method"]);if(void 0===r&&(r="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===r){const n=pr(t,["validationDataset"]);void 0!==e&&null!=n&&cr(e,["supervisedTuningSpec"],wa(n))}else if("PREFERENCE_TUNING"===r){const n=pr(t,["validationDataset"]);void 0!==e&&null!=n&&cr(e,["preferenceOptimizationSpec"],wa(n))}const i=pr(t,["tunedModelDisplayName"]);void 0!==e&&null!=i&&cr(e,["tunedModelDisplayName"],i);const s=pr(t,["description"]);void 0!==e&&null!=s&&cr(e,["description"],s);let o=pr(n,["config","method"]);if(void 0===o&&(o="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===o){const n=pr(t,["epochCount"]);void 0!==e&&null!=n&&cr(e,["supervisedTuningSpec","hyperParameters","epochCount"],n)}else if("PREFERENCE_TUNING"===o){const n=pr(t,["epochCount"]);void 0!==e&&null!=n&&cr(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],n)}let a=pr(n,["config","method"]);if(void 0===a&&(a="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===a){const n=pr(t,["learningRateMultiplier"]);void 0!==e&&null!=n&&cr(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],n)}else if("PREFERENCE_TUNING"===a){const n=pr(t,["learningRateMultiplier"]);void 0!==e&&null!=n&&cr(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],n)}let l=pr(n,["config","method"]);if(void 0===l&&(l="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===l){const n=pr(t,["exportLastCheckpointOnly"]);void 0!==e&&null!=n&&cr(e,["supervisedTuningSpec","exportLastCheckpointOnly"],n)}else if("PREFERENCE_TUNING"===l){const n=pr(t,["exportLastCheckpointOnly"]);void 0!==e&&null!=n&&cr(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],n)}let u=pr(n,["config","method"]);if(void 0===u&&(u="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===u){const n=pr(t,["adapterSize"]);void 0!==e&&null!=n&&cr(e,["supervisedTuningSpec","hyperParameters","adapterSize"],n)}else if("PREFERENCE_TUNING"===u){const n=pr(t,["adapterSize"]);void 0!==e&&null!=n&&cr(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],n)}if(void 0!==pr(t,["batchSize"]))throw new Error("batchSize parameter is not supported in Vertex AI.");if(void 0!==pr(t,["learningRate"]))throw new Error("learningRate parameter is not supported in Vertex AI.");const c=pr(t,["labels"]);void 0!==e&&null!=c&&cr(e,["labels"],c);const p=pr(t,["beta"]);void 0!==e&&null!=p&&cr(e,["preferenceOptimizationSpec","hyperParameters","beta"],p)}(o,n,e),n}function fa(t,e){const n={},r=pr(t,["config"]);return null!=r&&function(t,e){const n=pr(t,["pageSize"]);void 0!==e&&null!=n&&cr(e,["_query","pageSize"],n);const r=pr(t,["pageToken"]);void 0!==e&&null!=r&&cr(e,["_query","pageToken"],r);const i=pr(t,["filter"]);void 0!==e&&null!=i&&cr(e,["_query","filter"],i)}(r,n),n}function ma(t,e){const n={},r=pr(t,["config"]);return null!=r&&function(t,e){const n=pr(t,["pageSize"]);void 0!==e&&null!=n&&cr(e,["_query","pageSize"],n);const r=pr(t,["pageToken"]);void 0!==e&&null!=r&&cr(e,["_query","pageToken"],r);const i=pr(t,["filter"]);void 0!==e&&null!=i&&cr(e,["_query","filter"],i)}(r,n),n}function ya(t,e){const n={},r=pr(t,["sdkHttpResponse"]);null!=r&&cr(n,["sdkHttpResponse"],r);const i=pr(t,["name"]);null!=i&&cr(n,["name"],i);const s=pr(t,["state"]);null!=s&&cr(n,["state"],ns(s));const o=pr(t,["createTime"]);null!=o&&cr(n,["createTime"],o);const a=pr(t,["tuningTask","startTime"]);null!=a&&cr(n,["startTime"],a);const l=pr(t,["tuningTask","completeTime"]);null!=l&&cr(n,["endTime"],l);const u=pr(t,["updateTime"]);null!=u&&cr(n,["updateTime"],u);const c=pr(t,["description"]);null!=c&&cr(n,["description"],c);const p=pr(t,["baseModel"]);null!=p&&cr(n,["baseModel"],p);const h=pr(t,["_self"]);return null!=h&&cr(n,["tunedModel"],function(t){const e={},n=pr(t,["name"]);null!=n&&cr(e,["model"],n);const r=pr(t,["name"]);return null!=r&&cr(e,["endpoint"],r),e}(h)),n}function ga(t,e){const n={},r=pr(t,["sdkHttpResponse"]);null!=r&&cr(n,["sdkHttpResponse"],r);const i=pr(t,["name"]);null!=i&&cr(n,["name"],i);const s=pr(t,["state"]);null!=s&&cr(n,["state"],ns(s));const o=pr(t,["createTime"]);null!=o&&cr(n,["createTime"],o);const a=pr(t,["startTime"]);null!=a&&cr(n,["startTime"],a);const l=pr(t,["endTime"]);null!=l&&cr(n,["endTime"],l);const u=pr(t,["updateTime"]);null!=u&&cr(n,["updateTime"],u);const c=pr(t,["error"]);null!=c&&cr(n,["error"],c);const p=pr(t,["description"]);null!=p&&cr(n,["description"],p);const h=pr(t,["baseModel"]);null!=h&&cr(n,["baseModel"],h);const d=pr(t,["tunedModel"]);null!=d&&cr(n,["tunedModel"],d);const f=pr(t,["preTunedModel"]);null!=f&&cr(n,["preTunedModel"],f);const m=pr(t,["supervisedTuningSpec"]);null!=m&&cr(n,["supervisedTuningSpec"],m);const y=pr(t,["preferenceOptimizationSpec"]);null!=y&&cr(n,["preferenceOptimizationSpec"],y);const g=pr(t,["tuningDataStats"]);null!=g&&cr(n,["tuningDataStats"],g);const w=pr(t,["encryptionSpec"]);null!=w&&cr(n,["encryptionSpec"],w);const v=pr(t,["partnerModelTuningSpec"]);null!=v&&cr(n,["partnerModelTuningSpec"],v);const E=pr(t,["customBaseModel"]);null!=E&&cr(n,["customBaseModel"],E);const T=pr(t,["experiment"]);null!=T&&cr(n,["experiment"],T);const I=pr(t,["labels"]);null!=I&&cr(n,["labels"],I);const A=pr(t,["outputUri"]);null!=A&&cr(n,["outputUri"],A);const N=pr(t,["pipelineJob"]);null!=N&&cr(n,["pipelineJob"],N);const b=pr(t,["serviceAccount"]);null!=b&&cr(n,["serviceAccount"],b);const S=pr(t,["tunedModelDisplayName"]);null!=S&&cr(n,["tunedModelDisplayName"],S);const O=pr(t,["veoTuningSpec"]);return null!=O&&cr(n,["veoTuningSpec"],O),n}function wa(t,e){const n={},r=pr(t,["gcsUri"]);null!=r&&cr(n,["validationDatasetUri"],r);const i=pr(t,["vertexDatasetResource"]);return null!=i&&cr(n,["validationDatasetUri"],i),n}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class va extends lr{constructor(t){super(),this.apiClient=t,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new Ns(hi.PAGED_ITEM_TUNING_JOBS,t=>this.listInternal(t),await this.listInternal(t),t),this.tune=async t=>{var e;if(this.apiClient.isVertexAI()){if(t.baseModel.startsWith("projects/")){const n={tunedModelName:t.baseModel};(null===(e=t.config)||void 0===e?void 0:e.preTunedModelCheckpointId)&&(n.checkpointId=t.config.preTunedModelCheckpointId);const r=Object.assign(Object.assign({},t),{preTunedModel:n});return r.baseModel=void 0,await this.tuneInternal(r)}{const e=Object.assign({},t);return await this.tuneInternal(e)}}{const e=Object.assign({},t),n=await this.tuneMldevInternal(e);let r="";void 0!==n.metadata&&void 0!==n.metadata.tunedModel?r=n.metadata.tunedModel:void 0!==n.name&&n.name.includes("/operations/")&&(r=n.name.split("/operations/")[0]);return{name:r,state:Dr.JOB_STATE_QUEUED}}}}async getInternal(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=function(t){const e={},n=pr(t,["name"]);return null!=n&&cr(e,["_url","name"],n),e}(t);return o=ur("{name}",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>ga(t))}{const e=function(t){const e={},n=pr(t,["name"]);return null!=n&&cr(e,["_url","name"],n),e}(t);return o=ur("{name}",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"GET",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>ya(t))}}async listInternal(t){var e,n,r,i;let s,o="",a={};if(this.apiClient.isVertexAI()){const r=ma(t);return o=ur("tuningJobs",r._url),a=r._query,delete r._url,delete r._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["nextPageToken"]);null!=r&&cr(e,["nextPageToken"],r);const i=pr(t,["tuningJobs"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>ga(t))),cr(e,["tuningJobs"],t)}return e}(t),n=new Si;return Object.assign(n,e),n})}{const e=fa(t);return o=ur("tunedModels",e._url),a=e._query,delete e._url,delete e._query,s=this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(e),httpMethod:"GET",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),s.then(t=>{const e=function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["nextPageToken"]);null!=r&&cr(e,["nextPageToken"],r);const i=pr(t,["tunedModels"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>ya(t))),cr(e,["tuningJobs"],t)}return e}(t),n=new Si;return Object.assign(n,e),n})}}async cancel(t){var e,n,r,i;let s="",o={};if(this.apiClient.isVertexAI()){const r=function(t){const e={},n=pr(t,["name"]);return null!=n&&cr(e,["_url","name"],n),e}(t);s=ur("{name}:cancel",r._url),o=r._query,delete r._url,delete r._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal})}else{const e=function(t){const e={},n=pr(t,["name"]);return null!=n&&cr(e,["_url","name"],n),e}(t);s=ur("{name}:cancel",e._url),o=e._query,delete e._url,delete e._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(e),httpMethod:"POST",httpOptions:null===(r=t.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=t.config)||void 0===i?void 0:i.abortSignal})}}async tuneInternal(t){var e,n;let r,i="",s={};if(this.apiClient.isVertexAI()){const o=da(t,t);return i=ur("tuningJobs",o._url),s=o._query,delete o._url,delete o._query,r=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),r.then(t=>ga(t))}throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var e,n;let r,i="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=ha(t);return i=ur("tunedModels",o._url),s=o._query,delete o._url,delete o._query,r=this.apiClient.request({path:i,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(e=t.config)||void 0===e?void 0:e.httpOptions,abortSignal:null===(n=t.config)||void 0===n?void 0:n.abortSignal}).then(t=>t.json().then(e=>{const n=e;return n.sdkHttpResponse={headers:t.headers},n})),r.then(t=>function(t){const e={},n=pr(t,["sdkHttpResponse"]);null!=n&&cr(e,["sdkHttpResponse"],n);const r=pr(t,["name"]);null!=r&&cr(e,["name"],r);const i=pr(t,["metadata"]);null!=i&&cr(e,["metadata"],i);const s=pr(t,["done"]);null!=s&&cr(e,["done"],s);const o=pr(t,["error"]);return null!=o&&cr(e,["error"],o),e}(t))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ea{async download(t,e){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const Ta="x-goog-upload-status";function Ia(t){return new Promise(e=>setTimeout(e,t))}class Aa{async upload(t,e,n){if("string"==typeof t)throw new Error("File path is not supported in browser uploader.");return await async function(t,e,n){var r,i,s;let o=0,a=0,l=new di(new Response),u="upload";for(o=t.size;a<o;){const s=Math.min(8388608,o-a),c=t.slice(a,a+s);a+s>=o&&(u+=", finalize");let p=0,h=1e3;for(;p<3&&(l=await n.request({path:"",body:c,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(a),"Content-Length":String(s)}}}),!(null===(r=null==l?void 0:l.headers)||void 0===r?void 0:r[Ta]));)p++,await Ia(h),h*=2;if(a+=s,"active"!==(null===(i=null==l?void 0:l.headers)||void 0===i?void 0:i[Ta]))break;if(o<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const c=await(null==l?void 0:l.json());if("final"!==(null===(s=null==l?void 0:l.headers)||void 0===s?void 0:s[Ta]))throw new Error("Failed to upload file: Upload status is not finalized.");return c.file}(t,e,n)}async stat(t){if("string"==typeof t)throw new Error("File path is not supported in browser uploader.");return await async function(t){return{size:t.size,type:t.type}}(t)}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Na{create(t,e,n){return new ba(t,e,n)}}class ba{constructor(t,e,n){this.url=t,this.headers=e,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(void 0===this.ws)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(void 0===this.ws)throw new Error("WebSocket is not connected");this.ws.close()}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Sa="x-goog-api-key";class Oa{constructor(t){this.apiKey=t}async addAuthHeaders(t,e){if(null===t.get(Sa)){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");t.append(Sa,this.apiKey)}}}
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */require("./lib/main").config(Object.assign({},require("./lib/env-options"),require("./lib/cli-options")(process.argv)));const _a=process.env.GOOGLE_API_KEY;if(!_a)throw new Error("GOOGLE_API_KEY environment variable is not set. Please create a .env file in the project root with: GOOGLE_API_KEY=your_key_here");function Pa(t,e){if(Array.isArray(e)&&"TODO"===e[0]){const[t,n,r,i]=e;r.valOf(new Map)}}function Ca(t,e){t.forInfo&&Pa(0,e)}function xa(t,e){const n=t.get(e);return n||e}function Ra(t,e,n){return new Map([[e,n],...t])}function ka(t,e,n,r){const i=n.readBackType(t),s=r.readBackType(t);return tr(i,s)?new Gn(void 0):new $n(e,new Un([`Expected ${s} but got ${i}`]))}function Ma(t,e,n,r,i){return tr(At(t,n,r),At(t,n,i))?new Gn(void 0):new $n(e,new Un([`The terms ${r.prettyPrint()} and ${i.prettyPrint()} are not the same ${n.prettyPrint()}.`]))}function La(t){return Da(t.split(""))}function Da(t){return 0===t.length||(e=t[0],!(!/^[a-zA-Z]$/.test(e)&&"-"!==t[0])&&Da(t.slice(1)));var e}function Ua(t,e,n){return new Ml(t.location,t,e,n)}new class{constructor(t){var e;if(null==t.apiKey)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=null!==(e=t.vertexai)&&void 0!==e&&e,this.apiKey=t.apiKey;const n=ar(t.httpOptions,t.vertexai,void 0,void 0);n&&(t.httpOptions?t.httpOptions.baseUrl=n:t.httpOptions={baseUrl:n}),this.apiVersion=t.apiVersion;const r=new Oa(this.apiKey);this.apiClient=new jo({auth:r,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:t.httpOptions,userAgentExtra:"gl-node/web",uploader:new Aa,downloader:new Ea}),this.models=new oa(this.apiClient),this.live=new ta(this.apiClient,r,new Na),this.batches=new bs(this.apiClient),this.chats=new Bs(this.models,this.apiClient),this.caches=new ks(this.apiClient),this.files=new js(this.apiClient),this.operations=new aa(this.apiClient),this.authTokens=new pa(this.apiClient),this.tunings=new va(this.apiClient)}}({apiKey:_a});class qa{static synthNat(t,e){return new Gn(new xe(new Re,new ke))}static synthUniverse(t,e,n){return new $n(n,new Un(["U is a type, but it does not have a type."]))}static synthArrow(t,e,n,r,i,s){if(0===s.length){const n=Kn(t,i,"x"),s=new Bn("Aout"),o=new Bn("Bout");return Hn([[s,()=>r.check(t,e,new Te)],[o,()=>i.check(lt(t,n,Y(t,s.value)),e,new Te)]],()=>new Gn(new xe(new Re,new $e(n,s.value,o.value))))}{const[o,...a]=s,l=Kn(t,Ua(i,o,a),"x"),u=new Bn("Aout"),c=new Bn("tout");return Hn([[u,()=>r.check(t,e,new Te)],[c,()=>new Ka(J(n),i,o,a).check(lt(t,l,Y(t,u.value)),e,new Te)]],()=>new Gn(new xe(new Re,new $e(l,u.value,c.value))))}}static synthPi(t,e,n,r,i){if(1===r.length){const[n,s]=[r[0].binder,r[0].type],o=Yn(t,n.varName),a=(n.location,new Bn("Aout")),l=new Bn("Bout");return Hn([[a,()=>s.check(t,e,new Te)],[l,()=>i.check(lt(t,o,Y(t,a.value)),Ra(e,n.varName,o),new Te)]],()=>(Pa(0,["binding-site",a.value]),new Gn(new xe(new Re,new $e(o,a.value,l.value)))))}if(r.length>1){const[s,...o]=r,[a,l]=[s.binder,s.type],u=(a.location,a.varName),c=Yn(t,u),p=new Bn("Aout"),h=new Bn("Bout");return Hn([[p,()=>l.check(t,e,new Te)],[h,()=>new Wa(J(n),o,i).check(lt(t,c,Y(t,p.value)),Ra(e,u,c),new Te)]],()=>(Pa(0,["binding-site",p.value]),new Gn(new xe(new Re,new $e(c,p.value,h.value)))))}throw new Error("Invalid number of binders in Pi type")}static synthZero(t,e){return new Gn(new xe(new ke,new Me))}static synthAdd1(t,e,n){const r=new Bn("nout");return Hn([[r,()=>n.check(t,e,new ne)]],()=>new Gn(new xe(new ke,new Le(r.value))))}static synthWhichNat(t,e,n,r,i){const s=new Bn("tgtout"),o=new Bn("bout"),a=new Bn("sout"),l=Yn(t,"n_minus_1");return Hn([[s,()=>n.check(t,e,new ne)],[o,()=>r.synth(t,e)],[a,()=>i.check(t,e,new se(l,new ne,new Vn(Q(t),l,o.value.type)))]],()=>new Gn(new xe(o.value.type,new De(s.value,new xe(o.value.type,o.value.expr),a.value))))}static synthIterNat(t,e,n,r,i){const s=new Bn("tgtout"),o=new Bn("bout"),a=new Bn("sout");return Hn([[s,()=>n.check(t,e,new ne)],[o,()=>r.synth(t,e)],[a,()=>i.check(t,e,(()=>{const e=Yn(t,"old");return Y(t,new $e(e,o.value.type,o.value.type))})())]],()=>new Gn(new xe(o.value.type,new Ue(s.value,new xe(o.value.type,o.value.expr),a.value))))}static synthRecNat(t,e,n,r,i){const s=new Bn("tgtout"),o=new Bn("bout"),a=new Bn("sout");return Hn([[s,()=>n.check(t,e,new ne)],[o,()=>r.synth(t,e)],[a,()=>i.check(t,e,(()=>{const e=Yn(t,"n_minus_1"),n=Yn(t,"old");return Y(t,new $e(e,new ke,new $e(n,o.value.type,o.value.type)))})())]],()=>new Gn(new xe(o.value.type,new qe(s.value,new xe(o.value.type,o.value.expr),a.value))))}static synthIndNat(t,e,n,r,i,s){const o=new Bn("tgtout"),a=new Bn("motout"),l=new Bn("motval"),u=new Bn("bout"),c=new Bn("sout");return Hn([[o,()=>n.check(t,e,new ne)],[a,()=>r.check(t,e,new se("n",new ne,new jn(t=>new Te)))],[l,()=>new Gn(Y(t,a.value))],[u,()=>i.check(t,e,ct(l.value,new re))],[c,()=>s.check(t,e,new se("n-1",new ne,new jn(t=>new se("x",ct(l.value,t),new jn(e=>ct(l.value,new ie(t)))))))]],()=>new Gn(new xe(new In(a.value,o.value),new Ge(o.value,a.value,u.value,c.value))))}static synthAtom(t,e){return new Gn(new xe(new Re,new He))}static synthPair(t,e,n,r){const i=Yn(t,"a"),s=new Bn("Aout"),o=new Bn("Dout");return Hn([[s,()=>n.check(t,e,new Te)],[o,()=>r.check(lt(t,i,Y(t,s.value)),e,new Te)]],()=>new Gn(new xe(new Re,new Ve(i,s.value,o.value))))}static synthSigma(t,e,n,r,i){if(1===r.length){const[n,s]=[r[0].binder,r[0].type],o=Yn(t,n.varName),a=(n.location,new Bn("Aout")),l=new Bn("Dout");return Hn([[a,()=>s.check(t,e,new Te)],[l,()=>i.check(lt(t,o,Y(t,a.value)),Ra(e,n.varName,o),new Te)]],()=>(Pa(0,["binding-site",a.value]),new Gn(new xe(new Re,new Ve(o,a.value,l.value)))))}if(r.length>1){const[s,...o]=r,[a,l]=[s.binder,s.type],u=(a.location,a.varName),c=Yn(t,u),p=new Bn("Aout"),h=new Bn("Dout");return Hn([[p,()=>l.check(t,e,new Te)],[h,()=>new Qa(J(n),o,i).check(lt(t,c,Y(t,p.value)),Ra(e,u,c),new Te)]],()=>(Pa(0,["binding-site",p.value]),new Gn(new xe(new Re,new Ve(c,p.value,h.value)))))}throw new Error("Invalid number of binders in Sigma type")}static synthCar(t,e,n,r){const i=new Bn("p_rst");return Hn([[i,()=>r.synth(t,e)]],()=>{const e=Y(t,i.value.type);return e instanceof ae?new Gn(new xe(e.carType.readBackType(t),new Je(i.value.expr))):new $n(n,new Un([`car requires a Pair type, but was used as a: ${e}.`]))})}static synthCdr(t,e,n,r){const i=new Bn("pout");return Hn([[i,()=>r.synth(t,e)]],()=>{const e=Y(t,i.value.type);if(e instanceof ae){const[n,r,s]=[e.carName,e.carType,e.cdrType];return new Gn(new xe(s.valOfClosure(ft(Y(t,i.value.expr))).readBackType(t),new ze(i.value.expr)))}return new $n(n,new Un([`cdr requires a Pair type, but was used as a: ${e}.`]))})}static synthQuote(t,e,n,r){return La(r)?new Gn(new xe(new He,new Fe(r))):new $n(n,new Un([`Invalid atom: ${r}. Atoms consist of letters and hyphens.`]))}static synthTrivial(t,e){return new Gn(new xe(new Re,new Ze))}static synthSole(t,e){return new Gn(new xe(new Ze,new tn))}static synthIndList(t,e,n,r,i,s,o){const a=new Bn("tgtout"),l=new Bn("motout"),u=new Bn("motval"),c=new Bn("bout"),p=new Bn("sout");return Hn([[a,()=>r.synth(t,e)]],()=>{const[r,h]=[a.value.type,a.value.expr],d=Y(t,r);if(d instanceof ue){const n=d.entryType;return Hn([[l,()=>i.check(t,e,new se("xs",new ue(n),new Vn(Q(t),"xs",new Re)))],[u,()=>new Gn(Y(t,l.value))],[c,()=>s.check(t,e,ct(u.value,new ce))],[p,()=>o.check(t,e,new se("e",n,new jn(t=>new se("es",new ue(n),new jn(e=>new se("ih",ct(u.value,e),new jn(n=>ct(u.value,new pe(t,e)))))))))]],()=>new Gn(new xe(new In(l.value,h),new Qe(h,l.value,c.value,p.value))))}return new $n(n,new Un([`Not a List: ${d.readBackType(t)}.`]))})}static synthRecList(t,e,n,r,i,s){const o=new Bn("tgtout");return Hn([[o,()=>r.synth(t,e)]],()=>{const[r,a]=[o.value.type,o.value.expr],l=Y(t,r);if(l instanceof ue){const n=l.entryType,r=new Bn("bout"),o=new Bn("btval"),u=new Bn("sout");return Hn([[r,()=>i.synth(t,e)],[o,()=>new Gn(Y(t,r.value.type))],[u,()=>s.check(t,e,new se("e",n,new jn(t=>new se("es",new ue(n),new jn(t=>new se("ih",o.value,new jn(t=>o.value)))))))]],()=>new Gn(new xe(r.value.type,new Xe(a,new xe(r.value.type,r.value.expr),u.value))))}return new $n(n,new Un([`Not a List: ${l.readBackType(t)}.`]))})}static synthList(t,e,n){const r=new Bn("Eout");return Hn([[r,()=>n.entryType.check(t,e,new Te)]],()=>new Gn(new xe(new Re,new We(r.value))))}static synthListCons(t,e,n,r){const i=new Bn("eout"),s=new Bn("esout");return Hn([[i,()=>n.synth(t,e)],[s,()=>r.check(t,e,Y(t,new We(i.value.type)))]],()=>new Gn(new xe(new We(i.value.type),new Ye(i.value.expr,s.value))))}static synthAbsurd(t,e,n){return new Gn(new xe(new Re,new en))}static synthIndAbsurd(t,e,n){const r=new Bn("tgtout"),i=new Bn("motout");return Hn([[r,()=>n.target.check(t,e,new be)],[i,()=>n.motive.check(t,e,new Te)]],()=>new Gn(new xe(i.value,new nn(r.value,i.value))))}static synthEqual(t,e,n,r,i){const s=new Bn("Aout"),o=new Bn("Av"),a=new Bn("from_out"),l=new Bn("to_out");return Hn([[s,()=>n.check(t,e,new Te)],[o,()=>new Gn(Y(t,s.value))],[a,()=>r.check(t,e,o.value)],[l,()=>i.check(t,e,o.value)]],()=>new Gn(new xe(new Re,new rn(s.value,a.value,l.value))))}static synthReplace(t,e,n,r,i,s){const o=new Bn("tgt_rst"),a=new Bn("motout"),l=new Bn("bout");return Hn([[o,()=>r.synth(t,e)]],()=>{const r=Y(t,o.value.type);if(r instanceof he){const[n,u,c]=[r.type,r.from,r.to];return Hn([[a,()=>i.check(t,e,new se("x",n,new jn(t=>new Te)))],[l,()=>s.check(t,e,ct(Y(t,a.value),u))]],()=>new Gn(new xe(ct(Y(t,a.value),c).readBackType(t),new on(o.value.expr,a.value,l.value))))}return new $n(n,new Un([`Expected an expression with = type, but the type was: ${o.value.type}.`]))})}static synthTrans(t,e,n,r,i){const s=new Bn("p1_rst"),o=new Bn("p2_rst");return Hn([[s,()=>r.synth(t,e)],[o,()=>i.synth(t,e)]],()=>{const e=Y(t,s.value.type),r=Y(t,o.value.type);if(e instanceof he&&r instanceof he){const[i,a,l]=[e.type,e.from,e.to],[u,c,p]=[r.type,r.from,r.to];return Hn([[new Bn("_"),()=>ka(t,n,i,u)],[new Bn("_"),()=>Ma(t,n,i,l,c)]],()=>new Gn(new xe(new he(i,a,p).readBackType(t),new an(s.value.expr,o.value.expr))))}return new $n(n,new Un([`Expected =, got ${e} and ${r}.`]))})}static synthCong(t,e,n,r,i){const s=new Bn("bout"),o=new Bn("f_rst");return Hn([[s,()=>r.synth(t,e)],[o,()=>i.synth(t,e)]],()=>{const e=Y(t,s.value.type),r=Y(t,o.value.type);if(e instanceof he){const[i,a,l]=[e.type,e.from,e.to];if(r instanceof se){const[e,u,c]=[r.argName,r.argType,r.resultType],p=new Bn("ph"),h=new Bn("Cv"),d=new Bn("fv");return Hn([[p,()=>ka(t,n,i,u)],[h,()=>new Gn(c.valOfClosure(a))],[d,()=>new Gn(Y(t,o.value.expr))]],()=>new Gn(new xe(new rn(h.value.readBackType(t),At(t,h.value,ct(d.value,a)),At(t,h.value,ct(d.value,l))),new ln(s.value.expr,h.value.readBackType(t),o.value.expr))))}return new $n(n,new Un([`Expected a function type, got ${r.readBackType(t)}.`]))}return new $n(n,new Un([`Expected an = type, got ${e.readBackType(t)}.`]))})}static synthSymm(t,e,n,r){const i=new Bn("eout");return Hn([[i,()=>r.synth(t,e)]],()=>{const e=Y(t,i.value.type);if(e instanceof he){const[n,r,s]=[e.type,e.from,e.to];return new Gn(new xe(new he(n,s,r).readBackType(t),new un(i.value.expr)))}return new $n(n,new Un([`Expected an = type, got ${e.readBackType(t)}.`]))})}static synthIndEqual(t,e,n,r,i,s){const o=new Bn("tgtout"),a=new Bn("motout"),l=new Bn("motv"),u=new Bn("baseout");return Hn([[o,()=>r.synth(t,e)]],()=>{const r=Y(t,o.value.type);if(r instanceof he){const[n,c,p]=[r.type,r.from,r.to];return Hn([[a,()=>i.check(t,e,new se("to",n,new jn(t=>new se("p",new he(n,c,t),new jn(t=>new Te)))))],[l,()=>new Gn(Y(t,a.value))],[u,()=>s.check(t,e,ct(ct(l.value,c),new de(c)))]],()=>new Gn(new xe(ct(ct(l.value,p),Y(t,o.value.expr)).readBackType(t),new cn(o.value.expr,a.value,u.value))))}return new $n(n,new Un([`Expected evidence of equality, got ${r.readBackType(t)}.`]))})}static synthVec(t,e,n,r){const i=new Bn("tout"),s=new Bn("lenout");return Hn([[i,()=>n.check(t,e,new Te)],[s,()=>r.check(t,e,new ne)]],()=>new Gn(new xe(new Re,new pn(i.value,s.value))))}static synthHead(t,e,n,r){const i=new Bn("vout");return Hn([[i,()=>r.synth(t,e)]],()=>{const e=Y(t,i.value.type).now();if(e instanceof fe){const[r,s]=[e.entryType,e.length];return s.now()instanceof ie?new Gn(new xe(r.readBackType(t),new fn(i.value.expr))):new $n(n,new Un([`Expected a Vec with add1 at the top of the length, got ${At(t,new ne,s)}.`]))}return new $n(n,new Un([`Expected a Vec, got ${e.readBackType(t)}.`]))})}static synthTail(t,e,n,r){const i=new Bn("vout");return Hn([[i,()=>r.synth(t,e)]],()=>{const e=Y(t,i.value.type).now();if(e instanceof fe){const[r,s]=[e.entryType,e.length],o=s.now();if(o instanceof ie){const e=o.smaller;return new Gn(new xe(new pn(r.readBackType(t),At(t,new ne,e)),new mn(i.value.expr)))}return new $n(n,new Un([`Expected a Vec with add1 at the top of the length, got ${At(t,new ne,s)}.`]))}return new $n(n,new Un([`Expected a Vec, got ${e.readBackType(t)}.`]))})}static synthIndVec(t,e,n,r,i,s,o,a){const l=new Bn("lenout"),u=new Bn("lenv"),c=new Bn("vecout"),p=new Bn("motout"),h=new Bn("motval"),d=new Bn("bout"),f=new Bn("sout");return Hn([[l,()=>r.check(t,e,new ne)],[u,()=>new Gn(Y(t,l.value))],[c,()=>i.synth(t,e)]],()=>{const r=Y(t,c.value.type);if(r instanceof fe){const[i,m]=[r.entryType,r.length];return Hn([[new Bn("_"),()=>Ma(t,n,new ne,u.value,m)],[p,()=>s.check(t,e,new se("k",new ne,new jn(t=>new se("es",new fe(i,t),new jn(t=>new Te)))))],[h,()=>new Gn(Y(t,p.value))],[d,()=>o.check(t,e,ct(ct(h.value,new re),new me))],[f,()=>a.check(t,e,vt(i,h.value))]],()=>new Gn(new xe(new In(new In(p.value,l.value),c.value.expr),new yn(l.value,c.value.expr,p.value,d.value,f.value))))}return new $n(n,new Un([`Expected a Vec, got ${r.readBackType(t)}.`]))})}static synthEither(t,e,n,r){const i=new Bn("Lout"),s=new Bn("Rout");return Hn([[i,()=>n.check(t,e,new Te)],[s,()=>r.check(t,e,new Te)]],()=>new Gn(new xe(new Re,new gn(i.value,s.value))))}static synthIndEither(t,e,n,r,i,s,o){const a=new Bn("tgtout"),l=new Bn("motout"),u=new Bn("motval"),c=new Bn("lout"),p=new Bn("rout");return Hn([[a,()=>r.synth(t,e)]],()=>{const r=Y(t,a.value.type);if(r instanceof ge){const[n,h]=[r.leftType,r.rightType];return Hn([[l,()=>i.check(t,e,new se("x",new ge(n,h),new jn(t=>new Te)))],[u,()=>new Gn(Y(t,l.value))],[c,()=>s.check(t,e,new se("x",n,new jn(t=>ct(u.value,new we(t)))))],[p,()=>o.check(t,e,new se("x",h,new jn(t=>ct(u.value,new ve(t)))))]],()=>new Gn(new xe(new In(l.value,a.value.expr),new En(a.value.expr,l.value,c.value,p.value))))}return new $n(n,new Un([`Expected an Either, but got a ${r.readBackType(t)}.`]))})}static synthThe(t,e,n,r){const i=new Bn("t_out"),s=new Bn("e_out");return Hn([[i,()=>n.isType(t,e)],[s,()=>r.check(t,e,Y(t,i.value))]],()=>new Gn(new xe(i.value,s.value)))}static synthApplication(t,e,n,r,i,s){if(0===s.length){const s=new Bn("fout");return Hn([[s,()=>r.synth(t,e)]],()=>{const r=Y(t,s.value.type);if(r instanceof se){const[n,o,a]=[r.argName,r.argType,r.resultType],l=new Bn("argout");return Hn([[l,()=>i.check(t,e,o)]],()=>new Gn(new xe(a.valOfClosure(Y(t,l.value)).readBackType(t),new In(s.value.expr,l.value))))}return new $n(n,new Un([`Not a function type: ${r.readBackType(t)}.`]))})}{const o=new Bn("appout");return Hn([[o,()=>new Ml(J(n),r,i,s.slice(0,s.length-1)).synth(t,e)]],()=>{const r=Y(t,o.value.type);if(r instanceof se){const[n,i,a]=[r.argName,r.argType,r.resultType],l=new Bn("fout");return Hn([[l,()=>s[s.length-1].check(t,e,i)]],()=>new Gn(new xe(a.valOfClosure(Y(t,l.value)).readBackType(t),new In(o.value.expr,l.value))))}return new $n(n,new Un([`Not a function type: ${r.readBackType(t)}.`]))})}}static synthName(t,e,n,r){const i=xa(e,r),s=new Bn("x_tv");return Hn([[s,()=>at(t,0,i)]],()=>{const e=t.get(i);if(e instanceof rt&&Pa(0,"definition"),e instanceof st){const n=e.type;return new Gn(new xe(new Re,new Nn(n.name,n.parameterTypes.map(e=>e.readBackType(t)),n.indexTypes.map(e=>e.readBackType(t)))))}return new Gn(new xe(s.value.readBackType(t),new An(i)))})}static synthNumber(t,e,n,r){if(0===r)return new Gn(new xe(new ke,new Me));if(r>0){const i=new Bn("n_1_out");return Hn([[i,()=>new ul(n,r-1).check(t,e,new ne)]],()=>new Gn(new xe(new ke,new Le(i.value))))}return new $n(n,new Un([`Expected a positive number, got ${r}.`]))}static synthGeneralEliminator(t,e,n){const r=Z(t,n.location,n.typeName);if(r instanceof $n)return r;const i=r.result.type,s=n.target.synth(t,e);if(s instanceof $n)return s;const o=s.result,a=Y(t,o.type);if(!(a instanceof Se)||a.name!==n.typeName)return new $n(n.location,new Un([`Expected type ${n.typeName}, got ${a.readBackType(t)}`]));let l=i.indexTypes;const u=(e,n)=>{if(e>=l.length)return new se("target",new Se(a.name,a.parameters,n),new jn(t=>new Te));const r=l[e];return new se(Yn(t,"idx"),r,new jn(t=>u(e+1,[...n,t])))},c=u(0,[]),p=n.motive.check(t,e,c);if(p instanceof $n)return p;const h=p.result,d=Y(t,h),f=c.readBackType(t),m=this.getConstructorTypesForDatatype(t,n.typeName);if(n.methods.length!==m.length)return new $n(n.location,new Un([`Expected ${m.length} methods, got ${n.methods.length}`]));const y=[],g=[];for(let r=0;r<n.methods.length;r++){const i=this.generateMethodTypeForConstructor(t,m[r],d,a.parameters);g.push(i.readBackType(t));const s=n.methods[r].check(t,e,i);if(s instanceof $n)return s;y.push(s.result)}let w=d;for(const t of a.indices)w=ct(w,t);w=ct(w,Y(t,o.expr));const v=new _n(n.typeName,o.expr,h,y,g,f);return new Gn(new xe(w.readBackType(t),v))}static getConstructorTypesForDatatype(t,e){const n=[];for(const[r,i]of t)if(i instanceof ot){i.constructorType.type===e&&n.push(i.constructorType)}return n.sort((t,e)=>t.index-e.index)}static generateMethodTypeForConstructor(t,e,n,r){let i=new Map(Q(t));const s=new Set;[...e.argTypes,...e.rec_argTypes].forEach(t=>{t instanceof An&&s.add(t.name)});const o=Array.from(s);for(let t=0;t<o.length&&t<r.length;t++)i.set(o[t],r[t]);const a=[...e.argTypes.map(t=>t.valOf(i)),...e.rec_argTypes.map(t=>t.valOf(i))],l=(r,i)=>{if(r>=a.length){let r;const s=new _e(e.name,e.type,i,e.index,[]),o=function(t){if(t instanceof Se)return t.indices;return[]}(Y(t,e.resultType));r=n;for(const t of o)r=ct(r,t);r=ct(r,s);const l=e.argTypes.length;for(let t=e.rec_argTypes.length-1;t>=0;t--){const e=l+t,s=i[e],o=a[e];let u=n;if(o instanceof Se)for(const t of o.indices)u=ct(u,t);u=ct(u,s);const c=r;r=new se(`ih${t}`,u,new jn(t=>c))}return r}return new se(`arg${r}`,a[r],new jn(t=>l(r+1,[...i,t])))};return l(0,[])}}class Ga{constructor(t){this.location=t}isType(t,e){const n=new Bn("ok"),r=this.getType(t,e);return Hn([[n,()=>r]],()=>(Ca(this.location,["is-type",n.value]),new Gn(n.value)))}getType(t,e){const n=this.check(t,e,new Te);if(n instanceof Gn)return n;if(n instanceof $n){if(this instanceof Za&&Jn(this.name)){const e=new Bn("other-tv");return Hn([[e,()=>at(t,this.location,this.name)]],()=>new $n(this.location,new Un([`Expected U, but given ${e.value.readBackType(t)}`])))}return new $n(this.location,new Un(["not a type"]))}throw new Error("Invalid checkType")}check(t,e,n){const r=new Bn("ok"),i=this.checkOut(t,e,n);return Hn([[r,()=>i]],()=>new Gn(r.value))}synth(t,e){const n=new Bn("ok");return Hn([[n,()=>this.synthHelper(t,e)]],()=>(Ca(this.location,["is-type",n.value.type]),new Gn(n.value)))}checkOut(t,e,n){const r=new Bn("theT");return Hn([[r,()=>this.synth(t,e)],[new Bn("_"),()=>ka(t,this.location,Y(t,r.value.type),n)]],()=>new Gn(r.value.expr))}}class $a extends Ga{constructor(t,e,n){super(t),this.location=t,this.type=e,this.value=n}synthHelper(t,e){return qa.synthThe(t,e,this.type,this.value)}findNames(){return this.type.findNames().concat(this.value.findNames())}prettyPrint(){return`(the ${this.type.prettyPrint()} ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}}class Ba extends Ga{constructor(t){super(t),this.location=t}synthHelper(t,e){return qa.synthUniverse(t,e,this.location)}findNames(){return[]}getType(t,e){return new Gn(new Re)}prettyPrint(){return"U"}toString(){return this.prettyPrint()}}class Ha extends Ga{constructor(t){super(t),this.location=t}synthHelper(t,e){return qa.synthNat(t,e)}findNames(){return[]}getType(t,e){return new Gn(new ke)}prettyPrint(){return"Nat"}toString(){return this.prettyPrint()}}class Fa extends Ga{constructor(t){super(t),this.location=t}synthHelper(t,e){return qa.synthZero(t,e)}findNames(){return[]}prettyPrint(){return"zero"}toString(){return this.prettyPrint()}}class Va extends Ga{constructor(t,e){super(t),this.location=t,this.base=e}synthHelper(t,e){return qa.synthAdd1(t,e,this.base)}findNames(){return this.base.findNames()}prettyPrint(){return`(add1 ${this.base.prettyPrint()})`}toString(){return this.prettyPrint()}}class ja extends Ga{constructor(t,e,n,r){super(t),this.location=t,this.target=e,this.base=n,this.step=r}synthHelper(t,e){return qa.synthWhichNat(t,e,this.target,this.base,this.step)}findNames(){return this.target.findNames().concat(this.base.findNames()).concat(this.step.findNames())}prettyPrint(){return`(which-nat ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}}class Ja extends Ga{constructor(t,e,n,r){super(t),this.location=t,this.target=e,this.base=n,this.step=r}synthHelper(t,e){return qa.synthIterNat(t,e,this.target,this.base,this.step)}findNames(){return this.target.findNames().concat(this.base.findNames()).concat(this.step.findNames())}prettyPrint(){return`(iter-nat ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}}class za extends Ga{constructor(t,e,n,r){super(t),this.location=t,this.target=e,this.base=n,this.step=r}synthHelper(t,e){return qa.synthRecNat(t,e,this.target,this.base,this.step)}findNames(){return this.target.findNames().concat(this.base.findNames()).concat(this.step.findNames())}prettyPrint(){return`(rec-nat ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}}class Ya extends Ga{constructor(t,e,n,r,i){super(t),this.location=t,this.target=e,this.motive=n,this.base=r,this.step=i}synthHelper(t,e){return qa.synthIndNat(t,e,this.target,this.motive,this.base,this.step)}findNames(){return this.target.findNames().concat(this.motive.findNames()).concat(this.base.findNames()).concat(this.step.findNames())}prettyPrint(){return`(ind-nat ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}}class Ka extends Ga{constructor(t,e,n,r){super(t),this.location=t,this.arg1=e,this.arg2=n,this.args=r}synthHelper(t,e){return qa.synthArrow(t,e,this.location,this.arg1,this.arg2,this.args)}findNames(){return this.arg1.findNames().concat(this.arg2.findNames()).concat(this.args.flatMap(t=>t.findNames()))}getType(t,e){const[n,r,i]=[this.arg1,this.arg2,this.args];if(0===i.length){const i=Kn(t,r,"x"),s=new Bn("Aout"),o=new Bn("Bout");return Hn([[s,()=>n.isType(t,e)],[o,()=>r.isType(lt(t,i,Y(t,s.value)),e)]],()=>new Gn(new $e(i,s.value,o.value)))}{const[s,...o]=i,a=Kn(t,Ua(r,s,o),"x"),l=new Bn("Aout"),u=new Bn("tout");return Hn([[l,()=>n.isType(t,e)],[u,()=>new Ka(J(this.location),r,s,o).isType(lt(t,a,Y(t,l.value)),e)]],()=>new Gn(new $e(a,l.value,u.value)))}}prettyPrint(){return`(-> ${this.arg1.prettyPrint()} ${this.arg2.prettyPrint()} ${this.args.map(t=>t.prettyPrint()).join(" ")})`}toString(){return this.prettyPrint()}}class Wa extends Ga{constructor(t,e,n){super(t),this.location=t,this.binders=e,this.body=n}synthHelper(t,e){return qa.synthPi(t,e,this.location,this.binders,this.body)}findNames(){return this.binders.flatMap(t=>Wn(t)).concat(this.body.findNames())}getType(t,e){const[n,r]=[this.binders,this.body];if(1===n.length){const[i,s]=[n[0].binder,n[0].type],o=Yn(t,i.varName),a=(i.location,new Bn("Aout")),l=new Bn("Aoutv"),u=new Bn("Bout");return Hn([[a,()=>s.isType(t,e)],[l,()=>new Gn(Y(t,a.value))],[u,()=>r.isType(lt(t,o,l.value),Ra(e,i.varName,o))]],()=>(Pa(0,["binding-site",a.value]),new Gn(new $e(o,a.value,u.value))))}if(n.length>1){const[i,...s]=n,[o,a]=[i.binder.varName,i.type],l=Yn(t,o),u=(i.binder.location,new Bn("Aout")),c=new Bn("Aoutv"),p=new Bn("Bout");return Hn([[u,()=>a.isType(t,e)],[c,()=>new Gn(Y(t,u.value))],[p,()=>new Wa(J(this.location),s,r).isType(lt(t,l,c.value),Ra(e,i.binder.varName,l))]],()=>(Pa(0,["binding-site",u.value]),new Gn(new $e(l,u.value,p.value))))}throw new Error("Invalid number of binders in Pi type")}prettyPrint(){return`(ฮ ${this.binders.map(t=>`(${t.binder.varName} ${t.type.prettyPrint()})`).join(" ")} \n            ${this.body.prettyPrint()})`}toString(){return this.prettyPrint()}}class Xa extends Ga{constructor(t,e,n){super(t),this.location=t,this.binders=e,this.body=n}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return this.binders.map(t=>t.varName).concat(this.body.findNames())}checkOut(t,e,n){if(1===this.binders.length){const r=this.body,i=this.binders[0],s=i.varName,o=i.location,a=n.now();if(a instanceof se){const n=a.argType,i=a.resultType,o=xa(e,s),l=new Bn("bout");return Hn([[l,()=>r.check(lt(t,o,n),Ra(e,s,o),i.valOfClosure(new Ee(n,new St(o))))]],()=>(Pa(0,["binding-site",n.readBackType(t)]),new Gn(new Be(o,l.value))))}return new $n(o,new Un([`Not a function type: ${a.readBackType(t)}.`]))}return new Xa(this.location,[this.binders[0]],new Xa(J(this.location),this.binders.slice(1),this.body)).check(t,e,n)}prettyPrint(){return`(lambda ${this.binders.map(t=>t.varName).join(" ")} ${this.body.prettyPrint()})`}toString(){return this.prettyPrint()}}class Qa extends Ga{constructor(t,e,n){super(t),this.location=t,this.binders=e,this.body=n}synthHelper(t,e){return qa.synthSigma(t,e,this.location,this.binders,this.body)}findNames(){return this.binders.flatMap(t=>Wn(t)).concat(this.body.findNames())}getType(t,e){const[n,r]=[this.binders,this.body];if(1===n.length){const[i,s]=[n[0].binder,n[0].type],o=i.varName,a=Yn(t,o),l=(i.location,new Bn("Aout")),u=new Bn("Aoutv"),c=new Bn("Dout");return Hn([[l,()=>s.isType(t,e)],[u,()=>new Gn(Y(t,l.value))],[c,()=>r.isType(lt(t,a,u.value),Ra(e,o,a))]],()=>(Pa(0,["binding-site",l.value]),new Gn(new Ve(a,l.value,c.value))))}if(n.length>1){const[[i,s],...o]=[[n[0].binder,n[0].type],n[1],...n.slice(2)],a=i.varName,l=Yn(t,a),u=(i.location,new Bn("Aout")),c=new Bn("Aoutv"),p=new Bn("Dout");return Hn([[u,()=>s.isType(t,e)],[c,()=>new Gn(Y(t,u.value))],[p,()=>new Qa(this.location,o,r).isType(lt(t,a,c.value),Ra(e,a,l))]],()=>(Pa(0,["binding-site",u.value]),new Gn(new Ve(l,u.value,p.value))))}throw new Error("Invalid number of binders in Sigma type")}prettyPrint(){return`(ฮฃ ${this.binders.map(t=>`(${t.binder.varName} ${t.type.prettyPrint()})`).join(" ")} \n            ${this.body.prettyPrint()})`}toString(){return this.prettyPrint()}}class Za extends Ga{constructor(t,e){super(t),this.location=t,this.name=e}synthHelper(t,e){return qa.synthName(t,e,this.location,this.name)}findNames(){return[this.name]}prettyPrint(){return this.name}toString(){return this.prettyPrint()}}class tl extends Ga{constructor(t){super(t),this.location=t}synthHelper(t,e){return qa.synthAtom(t,e)}findNames(){return[]}getType(t,e){return new Gn(new He)}prettyPrint(){return"Atom"}toString(){return this.prettyPrint()}}class el extends Ga{constructor(t,e){super(t),this.location=t,this.name=e}synthHelper(t,e){return qa.synthQuote(t,e,this.location,this.name)}findNames(){return[]}prettyPrint(){return`'${this.name}`}toString(){return this.prettyPrint()}}class nl extends Ga{constructor(t,e,n){super(t),this.location=t,this.first=e,this.second=n}synthHelper(t,e){return qa.synthPair(t,e,this.first,this.second)}findNames(){return this.first.findNames().concat(this.second.findNames())}getType(t,e){const n=new Bn("Aout"),r=new Bn("Dout"),i=Kn(t,this.second,"x");return Hn([[n,()=>this.first.isType(t,e)],[r,()=>this.second.isType(lt(t,i,Y(t,n.value)),e)]],()=>new Gn(new Ve(i,n.value,r.value)))}prettyPrint(){return`(Pair ${this.first.prettyPrint()} ${this.second.prettyPrint()})`}toString(){return this.prettyPrint()}}class rl extends Ga{constructor(t,e,n){super(t),this.location=t,this.first=e,this.second=n}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return this.first.findNames().concat(this.second.findNames())}checkOut(t,e,n){const r=n.now();if(r instanceof ae){const n=r.carType,i=r.cdrType,s=new Bn("aout"),o=new Bn("dout");return Hn([[s,()=>this.first.check(t,e,n)],[o,()=>this.second.check(t,e,i.valOfClosure(Y(t,s.value)))]],()=>new Gn(new je(s.value,o.value)))}return new $n(this.location,new Un([`cons requires a Pair or ฮฃ type, but was used as a: ${r.readBackType(t)}.`]))}prettyPrint(){return`(cons ${this.first.prettyPrint()} ${this.second.prettyPrint()})`}toString(){return this.prettyPrint()}}class il extends Ga{constructor(t,e){super(t),this.location=t,this.pair=e}synthHelper(t,e){return qa.synthCar(t,e,this.location,this.pair)}findNames(){return this.pair.findNames()}prettyPrint(){return`(car ${this.pair.prettyPrint()})`}toString(){return this.prettyPrint()}}class sl extends Ga{constructor(t,e){super(t),this.location=t,this.pair=e}synthHelper(t,e){return qa.synthCdr(t,e,this.location,this.pair)}findNames(){return this.pair.findNames()}prettyPrint(){return`(cdr ${this.pair.prettyPrint()})`}toString(){return this.prettyPrint()}}class ol extends Ga{constructor(t){super(t),this.location=t}synthHelper(t,e){return qa.synthTrivial(t,e)}findNames(){return[]}getType(t,e){return new Gn(new Ze)}prettyPrint(){return"Trivial"}toString(){return this.prettyPrint()}}class al extends Ga{constructor(t){super(t),this.location=t}synthHelper(t,e){return qa.synthSole(t,e)}findNames(){return[]}prettyPrint(){return"Sole"}}class ll extends Ga{constructor(t){super(t),this.location=t}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return[]}checkOut(t,e,n){const r=n.now();return r instanceof ue?new Gn(new Ke):new $n(this.location,new Un([`nil requires a List type, but was used as a: ${r.readBackType(t)}.`]))}prettyPrint(){return"nil"}toString(){return this.prettyPrint()}}let ul=class extends Ga{constructor(t,e){super(t),this.location=t,this.value=e}synthHelper(t,e){return qa.synthNumber(t,e,this.location,this.value)}findNames(){return[]}prettyPrint(){return`${this.value}`}toString(){return this.prettyPrint()}};class cl extends Ga{constructor(t,e){super(t),this.location=t,this.entryType=e}synthHelper(t,e){return qa.synthList(t,e,this)}findNames(){return this.entryType.findNames()}getType(t,e){const n=new Bn("Eout");return Hn([[n,()=>this.entryType.isType(t,e)]],()=>new Gn(new We(n.value)))}prettyPrint(){return`(List ${this.entryType.prettyPrint()})`}toString(){return this.prettyPrint()}}class pl extends Ga{constructor(t,e,n){super(t),this.location=t,this.x=e,this.xs=n}synthHelper(t,e){return qa.synthListCons(t,e,this.x,this.xs)}findNames(){return this.x.findNames().concat(this.xs.findNames())}prettyPrint(){return`(:: ${this.x.prettyPrint()} ${this.xs.prettyPrint()})`}toString(){return this.prettyPrint()}}class hl extends Ga{constructor(t,e,n,r){super(t),this.location=t,this.target=e,this.base=n,this.step=r}synthHelper(t,e){return qa.synthRecList(t,e,this.location,this.target,this.base,this.step)}findNames(){return this.target.findNames().concat(this.base.findNames()).concat(this.step.findNames())}prettyPrint(){return`(rec-list ${this.target.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}}class dl extends Ga{constructor(t,e,n,r,i){super(t),this.location=t,this.target=e,this.motive=n,this.base=r,this.step=i}synthHelper(t,e){return qa.synthIndList(t,e,this.location,this.target,this.motive,this.base,this.step)}findNames(){return this.target.findNames().concat(this.motive.findNames()).concat(this.base.findNames()).concat(this.step.findNames())}prettyPrint(){return`(ind-list ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()} \n              ${this.step.prettyPrint()})`}toString(){return this.prettyPrint()}}class fl extends Ga{constructor(t){super(t),this.location=t}synthHelper(t,e){return qa.synthAbsurd(t,e,this)}findNames(){return[]}getType(t,e){return new Gn(new en)}prettyPrint(){return"Absurd"}toString(){return this.prettyPrint()}}class ml extends Ga{constructor(t,e,n){super(t),this.location=t,this.target=e,this.motive=n}synthHelper(t,e){return qa.synthIndAbsurd(t,e,this)}findNames(){return this.target.findNames().concat(this.motive.findNames())}prettyPrint(){return`(ind-Absurd \n              ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()})`}toString(){return this.prettyPrint()}}class yl extends Ga{constructor(t,e,n,r){super(t),this.location=t,this.type=e,this.left=n,this.right=r}synthHelper(t,e){return qa.synthEqual(t,e,this.type,this.left,this.right)}findNames(){return this.type.findNames().concat(this.left.findNames()).concat(this.right.findNames())}getType(t,e){const[n,r,i]=[this.type,this.left,this.right],s=new Bn("Aout"),o=new Bn("Av"),a=new Bn("from_out"),l=new Bn("to_out");return Hn([[s,()=>n.isType(t,e)],[o,()=>new Gn(Y(t,s.value))],[a,()=>r.check(t,e,o.value)],[l,()=>i.check(t,e,o.value)]],()=>new Gn(new rn(s.value,a.value,l.value)))}prettyPrint(){return`(= ${this.type.prettyPrint()} \n              ${this.left.prettyPrint()} \n              ${this.right.prettyPrint()})`}toString(){return this.prettyPrint()}}class gl extends Ga{constructor(t,e){super(t),this.location=t,this.type=e}findNames(){return this.type.findNames()}synthHelper(t,e){throw new Error("Method not implemented.")}checkOut(t,e,n){const r=n.now();if(r instanceof he){const n=r.type,i=r.from,s=r.to,o=new Bn("cout"),a=new Bn("val");return Hn([[o,()=>this.type.check(t,e,n)],[a,()=>new Gn(Y(t,o.value))],[new Bn("_"),()=>Ma(t,this.type.location,n,i,a.value)],[new Bn("_"),()=>Ma(t,this.type.location,n,s,a.value)]],()=>new Gn(new sn(o.value)))}return new $n(this.location,new Un([`same requires an Equal type, but encounter: ${r.readBackType(t)}.`]))}prettyPrint(){return`(same ${this.type.prettyPrint()})`}toString(){return this.prettyPrint()}}class wl extends Ga{constructor(t,e,n,r){super(t),this.location=t,this.target=e,this.motive=n,this.base=r}synthHelper(t,e){return qa.synthReplace(t,e,this.location,this.target,this.motive,this.base)}findNames(){return this.target.findNames().concat(this.motive.findNames()).concat(this.base.findNames())}prettyPrint(){return`(replace ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()})`}toString(){return this.prettyPrint()}}class vl extends Ga{synthHelper(t,e){return qa.synthTrans(t,e,this.location,this.left,this.right)}constructor(t,e,n){super(t),this.location=t,this.left=e,this.right=n}findNames(){return this.left.findNames().concat(this.right.findNames())}prettyPrint(){return`(trans ${this.left.prettyPrint()} ${this.right.prettyPrint()})`}toString(){return this.prettyPrint()}}class El extends Ga{constructor(t,e,n){super(t),this.location=t,this.target=e,this.fun=n}synthHelper(t,e){return qa.synthCong(t,e,this.location,this.target,this.fun)}findNames(){return this.target.findNames().concat(this.fun.findNames())}prettyPrint(){return`(cong ${this.target.prettyPrint()} ${this.fun.prettyPrint()})`}toString(){return this.prettyPrint()}}class Tl extends Ga{constructor(t,e){super(t),this.location=t,this.equality=e}synthHelper(t,e){return qa.synthSymm(t,e,this.location,this.equality)}findNames(){return this.equality.findNames()}prettyPrint(){return`(symm ${this.equality.prettyPrint()})`}toString(){return this.prettyPrint()}}class Il extends Ga{constructor(t,e,n,r){super(t),this.location=t,this.target=e,this.motive=n,this.base=r}synthHelper(t,e){return qa.synthIndEqual(t,e,this.location,this.target,this.motive,this.base)}findNames(){return this.target.findNames().concat(this.motive.findNames()).concat(this.base.findNames())}prettyPrint(){return`(ind-= ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.base.prettyPrint()})`}toString(){return this.prettyPrint()}}class Al extends Ga{constructor(t,e,n){super(t),this.location=t,this.type=e,this.length=n}synthHelper(t,e){return qa.synthVec(t,e,this.type,this.length)}findNames(){return this.type.findNames().concat(this.length.findNames())}getType(t,e){const n=new Bn("Eout"),r=new Bn("lenout");return Hn([[n,()=>this.type.isType(t,e)],[r,()=>this.length.check(t,e,new ne)]],()=>new Gn(new pn(n.value,r.value)))}prettyPrint(){return`(Vec ${this.type.prettyPrint()} ${this.length.prettyPrint()})`}toString(){return this.prettyPrint()}}class Nl extends Ga{constructor(t){super(t),this.location=t}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return[]}checkOut(t,e,n){const r=n.now();if(r instanceof fe){return r.length.now()instanceof re?new Gn(new dn):new $n(this.location,new Un([`vecnil requires a Vec type with length ZERO, but was used as a: \n          ${At(t,new ne,r.length)}.`]))}return new $n(this.location,new Un([`vecnil requires a Vec type, but was used as a: ${r.readBackType(t)}.`]))}prettyPrint(){return"vecnil"}toString(){return this.prettyPrint()}}class bl extends Ga{constructor(t,e,n){super(t),this.location=t,this.x=e,this.xs=n}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return this.x.findNames().concat(this.xs.findNames())}checkOut(t,e,n){const r=n.now();if(r instanceof fe){const n=r.length.now();if(n instanceof ie){const i=new Bn("hout"),s=new Bn("tout"),o=n.smaller;return Hn([[i,()=>this.x.check(t,e,r.entryType)],[s,()=>this.xs.check(t,e,new fe(r.entryType,o))]],()=>new Gn(new hn(i.value,s.value)))}return new $n(this.location,new Un([`vec:: requires a Vec type with length Add1, but was used with a: \n          ${At(t,new ne,r.length)}.`]))}return new $n(this.location,new Un([`vec:: requires a Vec type, but was used as a: ${r.readBackType(t)}.`]))}prettyPrint(){return`(vec:: ${this.x.prettyPrint()} ${this.xs.prettyPrint()})`}toString(){return this.prettyPrint()}}class Sl extends Ga{constructor(t,e){super(t),this.location=t,this.vec=e}synthHelper(t,e){return qa.synthHead(t,e,this.location,this.vec)}findNames(){return this.vec.findNames()}prettyPrint(){return`(head ${this.vec.prettyPrint()})`}toString(){return this.prettyPrint()}}class Ol extends Ga{constructor(t,e){super(t),this.location=t,this.vec=e}synthHelper(t,e){return qa.synthTail(t,e,this.location,this.vec)}findNames(){return this.vec.findNames()}prettyPrint(){return`(tail ${this.vec.prettyPrint()})`}toString(){return this.prettyPrint()}}class _l extends Ga{constructor(t,e,n,r,i,s){super(t),this.location=t,this.length=e,this.target=n,this.motive=r,this.base=i,this.step=s}synthHelper(t,e){return qa.synthIndVec(t,e,this.location,this.length,this.target,this.motive,this.base,this.step)}findNames(){return this.length.findNames().concat(this.target.findNames()).concat(this.motive.findNames()).concat(this.base.findNames()).concat(this.step.findNames())}prettyPrint(){return`ind-Vec ${this.length.prettyPrint()}\n              ${this.target.prettyPrint()}\n              ${this.motive.prettyPrint()}\n              ${this.base.prettyPrint()}\n              ${this.step.prettyPrint()}`}toString(){return this.prettyPrint()}}class Pl extends Ga{constructor(t,e,n){super(t),this.location=t,this.left=e,this.right=n}synthHelper(t,e){return qa.synthEither(t,e,this.left,this.right)}findNames(){return this.left.findNames().concat(this.right.findNames())}getType(t,e){const n=new Bn("Lout"),r=new Bn("Rout");return Hn([[n,()=>this.left.isType(t,e)],[r,()=>this.right.isType(t,e)]],()=>new Gn(new gn(n.value,r.value)))}prettyPrint(){return`(Either ${this.left.prettyPrint()} ${this.right.prettyPrint()})`}toString(){return this.prettyPrint()}}class Cl extends Ga{constructor(t,e){super(t),this.location=t,this.value=e}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return this.value.findNames()}checkOut(t,e,n){const r=n.now();if(r instanceof ge){const n=new Bn("lout");return Hn([[n,()=>this.value.check(t,e,r.leftType)]],()=>new Gn(new wn(n.value)))}return new $n(this.location,new Un([`left requires an Either type, but was used as a: ${r.readBackType(t)}.`]))}prettyPrint(){return`(left ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}}class xl extends Ga{constructor(t,e){super(t),this.location=t,this.value=e}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return this.value.findNames()}checkOut(t,e,n){const r=n.now();if(r instanceof ge){const n=new Bn("rout");return Hn([[n,()=>this.value.check(t,e,r.rightType)]],()=>new Gn(new vn(n.value)))}return new $n(this.location,new Un([`right requires an Either type, but was used as a: ${r.readBackType(t)}.`]))}prettyPrint(){return`(right ${this.value.prettyPrint()})`}toString(){return this.prettyPrint()}}class Rl extends Ga{constructor(t,e,n,r,i){super(t),this.location=t,this.target=e,this.motive=n,this.baseLeft=r,this.baseRight=i}synthHelper(t,e){return qa.synthIndEither(t,e,this.location,this.target,this.motive,this.baseLeft,this.baseRight)}findNames(){return this.target.findNames().concat(this.motive.findNames()).concat(this.baseLeft.findNames()).concat(this.baseRight.findNames())}prettyPrint(){return`(ind-Either ${this.target.prettyPrint()} \n              ${this.motive.prettyPrint()} \n              ${this.baseLeft.prettyPrint()} \n              ${this.baseRight.prettyPrint()})`}toString(){return this.prettyPrint()}}class kl extends Ga{constructor(t){super(t),this.location=t}synthHelper(t,e){throw new Error("Method not implemented.")}findNames(){return[]}checkOut(t,e,n){const r=n.readBackType(t);return Ca(this.location,["TODO",K(t),r,e]),new Gn(new Tn(this.location.locationToSrcLoc(),r))}prettyPrint(){return"TODO"}toString(){return this.prettyPrint()}}class Ml extends Ga{constructor(t,e,n,r){super(t),this.location=t,this.func=e,this.arg=n,this.args=r}synthHelper(t,e){return qa.synthApplication(t,e,this.location,this.func,this.arg,this.args)}findNames(){return this.func.findNames().concat(this.arg.findNames()).concat(this.args.flatMap(t=>t.findNames()))}prettyPrint(){return`(${this.func.prettyPrint()} ${this.arg.prettyPrint()} ${this.args.map(t=>t.prettyPrint()).join(" ")})`}toString(){return this.prettyPrint()}getType(t,e){if(this.func instanceof Za){const n=this.func.name;if(t.get(n)instanceof st){const r=[this.arg,...this.args];return new Dl(this.location,n,[],r).getType(t,e)}}return super.getType(t,e)}}class Ll extends Ga{constructor(t,e,n,r){super(t),this.location=t,this.name=e,this.paramType=n,this.indicesType=r}findNames(){throw new Error("Method not implemented.")}prettyPrint(){throw new Error("Method not implemented.")}synthHelper(t,e){throw new Error("Method not implemented.")}getType(t,e){let n=t,r=e,i=[],s=[];for(let t=0;t<this.paramType.length;t++){const e=Yn(n,this.paramType[t].binder.varName),s=this.paramType[t].type.isType(n,r);if(r=Ra(r,this.paramType[t].binder.varName,e),s instanceof $n)return s;n=lt(n,e,Y(n,s.result)),i.push(s.result)}for(let t=0;t<this.indicesType.length;t++){const e=Yn(n,this.indicesType[t].binder.varName),i=this.indicesType[t].type.isType(n,r);if(r=Ra(r,this.indicesType[t].binder.varName,e),i instanceof $n)return i;n=lt(n,e,Y(n,i.result)),s.push(i.result)}return new Gn(new bn(this.name,i,s))}}class Dl extends Ga{findNames(){throw new Error("Method not implemented.")}prettyPrint(){throw new Error("Method not implemented.")}synthHelper(t,e){throw new Error("Method not implemented.")}constructor(t,e,n,r){super(t),this.location=t,this.name=e,this.params=n,this.indices=r}getType(t,e){const n=Z(t,this.location,this.name);if(n instanceof $n)return n;const r=n.result.type;if(this.params.length!==r.parameterTypes.length||this.indices.length!==r.indexTypes.length)return new $n(this.location,new Un(["Parameter/index count mismatch for type "+this.name]));const i=[];for(let n=0;n<this.params.length;n++){const s=this.params[n].check(t,e,r.parameterTypes[n].now());if(s instanceof $n)return s;i.push(s.result)}const s=[];for(let n=0;n<this.indices.length;n++){const i=this.indices[n].check(t,e,r.indexTypes[n].now());if(i instanceof $n)return i;s.push(i.result)}return new Gn(new Nn(this.name,i,s))}checkOut(t,e,n){let r=n.now(),i=[],s=[];if(!(r instanceof Oe))return new $n(this.location,new Un(["target type is not user defined inductive type, or use the wrong type"]));const o=r;let a=o.parameterTypes,l=o.indexTypes;if(this.params.length!=a.length||this.indices.length!=l.length)return new $n(this.location,new Un(["the number of parameters/indices is inconsistent in constructor"]));for(let n=0;n<this.params.length;n++){const r=this.params[n].check(t,e,a[n].now());if(r instanceof $n)return $n;i.push(r.result)}for(let n=0;n<this.indices.length;n++){const r=this.indices[n].check(t,e,l[n].now());if(r instanceof $n)return $n;s.push(r.result)}return new Gn(new Nn(this.name,i,s))}}class Ul extends Ga{constructor(t,e,n,r,i){super(t),this.location=t,this.typeName=e,this.target=n,this.motive=r,this.methods=i}findNames(){return[this.typeName].concat(this.target.findNames()).concat(this.motive.findNames()).concat(this.methods.flatMap(t=>t.findNames()))}prettyPrint(){const t=this.methods.map(t=>t.prettyPrint()).join(" ");return`(elim-${this.typeName} ${this.target.prettyPrint()} ${this.motive.prettyPrint()} ${t})`}synthHelper(t,e){return qa.synthGeneralEliminator(t,e,this)}}class ql extends Ga{constructor(t,e,n){super(t),this.location=t,this.constructorName=e,this.args=n}findNames(){return[this.constructorName].concat(this.args.flatMap(t=>t.findNames()))}prettyPrint(){const t=this.args.map(t=>t.prettyPrint()).join(" ");return`(${this.constructorName}${t.length>0?" "+t:""})`}synthHelper(t,e){throw new Error("Method not implemented.")}checkOut(t,e,n){const r=t.get(this.constructorName);if(!(r&&r instanceof ot))return new $n(this.location,new Un([`Unknown constructor: ${this.constructorName}`]));const i=r.constructorType,s=n.now();if(!(s instanceof Se))return new $n(this.location,new Un(["Expected inductive type constructor"]));const o=t.get(i.type);if(!(o&&o instanceof st))return new $n(this.location,new Un([`Unknown inductive type: ${i.type}`]));o.type;const a=i.resultType;let l=Q(t);for(let t=0;t<a.parameters.length;t++){const e=a.parameters[t];if(e instanceof An){l=ut(l,e.name,s.parameters[t].now())}}for(let t=0;t<a.indices.length;t++){const e=a.indices[t];if(e instanceof An){l=ut(l,e.name,s.indices[t].now())}}const u=r.type,c=[];u.indices.forEach(t=>{c.push(...Xn(t))}),console.log("Extracted index argument names:",c);let p=[],h=[];const d=[...i.argTypes,...i.rec_argTypes];if(this.args.length!==d.length)return new $n(this.location,new Un([`Constructor ${this.constructorName} expects ${d.length} arguments, but got ${this.args.length}`]));for(let n=0;n<i.argTypes.length;n++){const r=i.argTypes[n].valOf(l),s=this.args[n].check(t,e,r.now());if(s instanceof $n)return s;const o=s.result;if(p.push(o),n<c.length){l=ut(l,c[n],Y(t,o))}}const f=i.argTypes.length;for(let n=0;n<i.rec_argTypes.length;n++){const r=i.rec_argTypes[n].valOf(l),s=this.args[n+f].check(t,e,r.now());if(s instanceof $n)return s;const o=s.result;h.push(o);const a=f+n;if(a<c.length){l=ut(l,c[a],Y(t,o))}}return new Gn(new Sn(this.constructorName,i.index,i.type,p,h))}}function Gl(t,e){return t instanceof Za&&t.name===e||t instanceof Dl&&t.name===e}class $l{constructor(t,e,n,r,i,s){this.location=t,this.name=e,this.parameters=n,this.indices=r,this.constructors=i,this.eliminatorName=s}normalize_constructor(t,e){const n=new Ll(this.location,this.name,this.parameters,this.indices).isType(t,e);if(n instanceof $n)throw new Error(n.message.toString());const r=n.result;let i=t,s=e;for(const t of this.parameters){const e=t.binder.varName,n=t.type.isType(i,s);if(n instanceof $n)throw new Error(n.message.toString());const r=n.result,o=Yn(i,e);i=lt(i,o,Y(i,r)),s=Ra(s,e,o)}const o=Y(i,r);i=z(i,this.name,new st(this.name,o));let a=[];for(let t=0;t<this.constructors.length;t++)a.push(this.constructors[t].checkValid(i,s,o,t));let l=t,u=e;return l=z(l,this.name,new st(this.name,o)),a.forEach(t=>{const e=Yn(l,t.name),n=Y(i,t.resultType);l=z(l,e,new ot(e,t,n)),u=Ra(u,t.name,e)}),[l,u]}}class Bl{constructor(t,e,n,r){this.location=t,this.name=e,this.args=n,this.returnType=r}checkValid(t,e,n,r){let i=t,s=e,o=[],a=[];for(let t=0;t<this.args.length;t++){const e=this.args[t].binder.varName,n=Yn(i,e),r=this.args[t].type.isType(i,s);if(r instanceof $n)throw new Error(r.message.toString());const l=r.result;Gl(this.args[t].type,this.returnType.name)?a.push(l):o.push(l),i=lt(i,n,Y(i,l)),s=Ra(s,e,n)}const l=this.returnType.check(i,s,n);if(l instanceof $n)throw new Error(l.message.toString());const u=l.result;return new On(this.name,r,this.returnType.name,o,a,u)}}class Hl{constructor(t,e,n,r,i){this.id=t,this.type=e,this.context=n,this.renaming=r,this.term=i}clone(t={}){return new Hl(t.id??this.id,t.type??this.type,t.context??new Map(this.context),t.renaming??new Map(this.renaming),t.term??this.term)}addHypothesis(t,e){const n=Yn(this.context,t);z(this.context,n,new nt(e))}getVariableType(t){const e=this.context.get(t);return e?.type}prettyPrintWithContext(){const t=Array.from(this.context.entries()).map(([t,e])=>`${t} : ${e.type.readBackType(this.context).prettyPrint()}`).join("\n  "),e=this.type.readBackType(this.context).prettyPrint();return t?`Context:\n  ${t}\nโโโโโโโโโโโโโโโโ\nGoal: ${e}`:`Goal: ${e}`}}class Fl{constructor(t){this.goal=t,this.children=[],this.parent=null,this.isComplete=!1,this.childFocusIndex=-1}addChildren(t){t.forEach(t=>{t.parent=this}),this.children=t}findById(t){if(this.goal.id===t)return this;for(const e of this.children){const n=e.findById(t);if(n)return n}return null}}class Vl{constructor(t,e){this.location=t,this.goalTree=e,this.proofHistory=[],this.goalIdCounter=0,this.currentGoal=this.goalTree}static initialize(t,e,n){const r=new Hl("goal_0",e,new Map(t),new Map),i=new Vl(n,new Fl(r));return i.currentGoal=i.goalTree,i}generateGoalId(){return"goal_"+ ++this.goalIdCounter}isComplete(){return this.goalTree.isComplete}getCurrentGoal(){if(null===this.currentGoal)throw new Error("No current goal available.");return new Gn(this.currentGoal.goal)}visualizeTree(){return this.visualizeNode(this.goalTree,"",!0)}visualizeNode(t,e,n){let r=e+(n?"โโโ ":"โโโ ")+`${t.isComplete?"โ":t===this.currentGoal?"โ":"โ"} ${t.goal.id}`+"\n";const i=e+(n?"    ":"โ   ");for(let e=0;e<t.children.length;e++){const n=e===t.children.length-1;r+=this.visualizeNode(t.children[e],i,n)}return r}addGoal(t){this.currentGoal.addChildren(t),this.currentGoal.childFocusIndex=0,this.currentGoal=t[0]}nextGoal(){if(null===this.currentGoal.parent)return!0;const t=this.currentGoal.parent,e=this.nextGoalAux(t);return null===e||(this.currentGoal=e,!1)}nextGoalAux(t){return-1===t.childFocusIndex||t.childFocusIndex>=t.children.length-1?(t.isComplete=!0,null===t.parent?null:this.nextGoalAux(t.parent)):(t.childFocusIndex+=1,t.children[t.childFocusIndex])}previousGoal(){if(null===this.currentGoal.parent)throw new Error("No previous goal available at the root level.");const t=this.PreviousGoalAux(this.currentGoal);if(null===t)throw new Error("No previous goal found.");this.currentGoal=t}PreviousGoalAux(t){if(0===t.childFocusIndex)return t;{let e=!1,n=t.children[t.childFocusIndex-1];for(;!e;){if(-1===n.childFocusINdex)return e=!0,n;n=n.children[n.childFocusIndex]}}return null}}class jl{constructor(t){this.location=t}}class Jl extends jl{constructor(t,e){super(t),this.location=t,this.varName=e}getName(){return"intro"}toString(){return`intro ${this.varName||""}`}apply(t){const e=t.currentGoal.goal,n=e.type;if(!(n instanceof se))return new $n(t.location,new Un([`Cannot introduce a variable for non-function type: ${n.prettyPrint()}`]));const r=this.varName||n.argName||Yn(e.context,"x"),i=e.renaming;r!==n.argName&&Ra(i,n.argName,r);const s=z(e.context,r,new it(n.argType)),o=n.resultType.valOfClosure(new Ee(n.argType,new St(r))),a=new Fl(new Hl(t.generateGoalId(),o,s,i));return t.addGoal([a]),new Gn(t)}}class zl extends jl{constructor(t,e){super(t),this.location=t,this.term=e}toString(){return`exact ${this.term.prettyPrint()}`}apply(t){const e=t.getCurrentGoal().result,n=e.type;console.log("goalType:",n.prettyPrint()),console.log("term:",this.term.prettyPrint());const r=this.term.check(e.context,e.renaming,n);return r instanceof $n?r:(t.currentGoal.isComplete=!0,t.nextGoal(),new Gn(t))}}class Yl extends jl{constructor(t,e,n){super(t),this.location=t,this.value=e,this.varName=n}toString(){return`exists ${this.varName||""}`}apply(t){const e=t.getCurrentGoal().result,n=e.type;if(!(n instanceof ae))return new $n(t.location,new Un([`Cannot use exists on non-product type: ${n.prettyPrint()}`]));const r=this.varName||n.carName||Yn(e.context,"x"),i=e.renaming;r!==n.carName&&Ra(i,n.carName,r);const s=this.value.check(e.context,e.renaming,n.carType);if(s instanceof $n)return s;const o=s.result.valOf(Q(e.context)),a=z(e.context,r,new rt(n.carType,o)),l=n.cdrType.valOfClosure(o),u=new Fl(new Hl(t.generateGoalId(),l,a,i));return t.addGoal([u]),new Gn(t)}}class Kl extends jl{constructor(t,e){super(t),this.location=t,this.target=e}toString(){return`elim-nat ${this.target}`}apply(t){const e=t.getCurrentGoal().result,n=e.context.get(this.target);if(!n)return new $n(t.location,new Un([`target not found in current context: ${this.target}`]));let r;if(!(n instanceof it))throw new Error("Expected target to be a free variable");if(r=n.type.now(),!(r instanceof ne))return new $n(t.location,new Un([`Cannot eliminate non-Nat type: ${r.prettyPrint()}`]));let i=this.generateNatMotive(e.context,e.type,this.target);const s=this.eliminateNat(e.context,e.renaming,i);return t.addGoal(s.map(n=>new Fl(new Hl(t.generateGoalId(),n,e.context,e.renaming)))),new Gn(t)}generateNatMotive(t,e,n){const r=e.readBackType(t),i=new Map(t);i.delete(n);const s=Q(i);return new oe(n,new Vn(s,n,r))}eliminateNat(t,e,n){return[ct(n,new re),new se(Yn(t,"n-1"),new ne,new jn(e=>new se(Yn(t,"ih"),ct(n,e),new jn(t=>ct(n,new ie(e))))))]}}class Wl extends jl{constructor(t,e,n){super(t),this.location=t,this.target=e,this.motive=n}toString(){return this.motive?`elim-list ${this.target} to prove ${this.motive.prettyPrint()}`:`elim-list ${this.target}`}apply(t){const e=t.getCurrentGoal().result,n=e.context.get(this.target);if(!n)return new $n(t.location,new Un([`target not found in current context: ${this.target}`]));let r;if(!(n instanceof it))throw new Error("Expected target to be a free variable");if(r=n.type.now(),!(r instanceof ue))return new $n(t.location,new Un([`Cannot eliminate non-List type: ${r.prettyPrint()}`]));const i=r.entryType;let s;if(this.motive){const t=this.motive.check(e.context,e.renaming,new se("xs",new ue(i),new Vn(Q(e.context),"xs",new Re)));if(t instanceof $n)return t;s=t.result.valOf(Q(e.context))}else s=this.generateListMotive(e.context,e.type,this.target);const o=this.eliminateList(e.context,e.renaming,s,i);return t.addGoal(o.map(n=>new Fl(new Hl(t.generateGoalId(),n,e.context,e.renaming)))),new Gn(t)}generateListMotive(t,e,n){const r=e.readBackType(t),i=new Map(t);i.delete(n);const s=Q(i);return new oe(n,new Vn(s,n,r))}eliminateList(t,e,n,r){return[ct(n,new ce),new se(Yn(t,"x"),r,new jn(e=>new se(Yn(t,"xs"),new ue(r),new jn(r=>new se(Yn(t,"ih"),ct(n,r),new jn(t=>ct(n,new pe(e,r))))))))]}}class Xl extends jl{constructor(t,e,n,r){super(t),this.location=t,this.target=e,this.motive=n,this.length=r}toString(){return`elim-list ${this.target} to prove ${this.motive.prettyPrint()}`}apply(t){const e=t.getCurrentGoal().result,n=e.context.get(this.target);if(!n)return new $n(t.location,new Un([`target not found in current context: ${this.target}`]));let r;if(!(n instanceof it))throw new Error("Expected target to be a free variable");if(r=n.type.now(),!(r instanceof fe))return new $n(t.location,new Un([`Cannot eliminate non-Vec type: ${r.prettyPrint()}`]));const i=this.length.check(e.context,e.renaming,new ne);if(i instanceof $n)return i;const[s,o]=[r.entryType,r.length];Ma(e.context,this.location,new ne,Y(e.context,i.result),o),Yn(e.context,"motive");const a=this.motive.check(e.context,e.renaming,new se("k",new ne,new jn(t=>new se("es",new fe(s,t),new jn(t=>new Te)))));if(a instanceof $n)return a;{const n=a.result.valOf(Q(e.context)),r=this.eliminateVec(e.context,e.renaming,n,s);return t.addGoal(r.map(n=>new Fl(new Hl(t.generateGoalId(),n,e.context,e.renaming)))),new Gn(t)}}eliminateVec(t,e,n,r){return[ct(ct(n,new re),new me),vt(r,n)]}}class Ql extends jl{constructor(t,e,n){super(t),this.location=t,this.target=e,this.motive=n}toString(){return this.motive?`elim-equal ${this.target} with motive ${this.motive.prettyPrint()}`:`elim-equal ${this.target}`}apply(t){const e=t.getCurrentGoal().result,n=e.context.get(this.target);if(!n)return new $n(t.location,new Un([`target not found in current context: ${this.target}`]));let r;if(!(n instanceof it))throw new Error("Expected target to be a free variable");if(r=n.type.now(),!(r instanceof he))return new $n(t.location,new Un([`Cannot eliminate non-Equal type: ${r.prettyPrint()}`]));const[i,s]=[r.type,r.from,r.to];let o;if(!this.motive)return new $n(this.location,new Un(["Motive required for = elimination (too complex for auto-generation)"]));{const t=this.motive.check(e.context,e.renaming,new se("to",i,new jn(t=>new se("p",new he(i,s,t),new jn(t=>new Te)))));if(t instanceof $n)return t;o=t.result.valOf(Q(e.context))}const a=[ct(ct(o,s),new de(s))];return t.addGoal(a.map(n=>new Fl(new Hl(t.generateGoalId(),n,e.context,e.renaming)))),new Gn(t)}}class Zl extends jl{constructor(t){super(t),this.location=t}toString(){return"left"}apply(t){const e=t.getCurrentGoal().result;if(!(e.type.now()instanceof ge))return new $n(t.location,new Un([`"left" expected goal type to be Either, but got: ${e.type.prettyPrint()}`]));const n=e.type.leftType.now();return t.addGoal([new Fl(new Hl(t.generateGoalId(),n,e.context,e.renaming))]),new Gn(t)}}class tu extends jl{constructor(t){super(t),this.location=t}toString(){return"right"}apply(t){const e=t.getCurrentGoal().result;if(!(e.type.now()instanceof ge))return new $n(t.location,new Un([`"right" expected goal type to be Either, but got: ${e.type.prettyPrint()}`]));const n=e.type.rightType.now();return t.addGoal([new Fl(new Hl(t.generateGoalId(),n,e.context,e.renaming))]),new Gn(t)}}class eu extends jl{constructor(t,e,n){super(t),this.location=t,this.target=e,this.motive=n}toString(){return this.motive?`elim-either ${this.target} with motive ${this.motive.prettyPrint()}`:`elim-either ${this.target}`}apply(t){const e=t.getCurrentGoal().result,n=e.context.get(this.target);if(!n)return new $n(t.location,new Un([`target not found in current context: ${this.target}`]));let r;if(!(n instanceof it))throw new Error("Expected target to be a free variable");if(r=n.type.now(),!(r instanceof ge))return new $n(t.location,new Un([`Cannot eliminate non-Either type: ${r.prettyPrint()}`]));const[i,s]=[r.leftType,r.rightType];let o;if(this.motive){const t=this.motive.check(e.context,e.renaming,new se("x",new ge(i,s),new jn(t=>new Te)));if(t instanceof $n)return t;o=t.result.valOf(Q(e.context))}else o=this.generateEitherMotive(e.context,e.type,this.target);const a=new se("x",i,new jn(t=>ct(o,new we(t)))),l=new se("x",s,new jn(t=>ct(o,new ve(t))));return t.addGoal([new Fl(new Hl(t.generateGoalId(),a,e.context,e.renaming)),new Fl(new Hl(t.generateGoalId(),l,e.context,e.renaming))]),new Gn(t)}generateEitherMotive(t,e,n){const r=e.readBackType(t),i=new Map(t);i.delete(n);const s=Q(i);return new oe(n,new Vn(s,n,r))}}class nu extends jl{constructor(t){super(t)}toString(){return"split"}apply(t){const e=t.getCurrentGoal().result;if(!(e.type.now()instanceof ae))return new $n(t.location,new Un([`"split" expected goal type to be Sigma, but got: ${e.type.prettyPrint()}`]));const n=e.type.now(),r=n.carType.now(),i=n.cdrType.valOfClosure(n);return t.addGoal([new Fl(new Hl(t.generateGoalId(),r,e.context,e.renaming)),new Fl(new Hl(t.generateGoalId(),i,e.context,e.renaming))]),new Gn(t)}}class ru extends jl{constructor(t,e,n){super(t),this.location=t,this.target=e,this.motive=n}toString(){return this.motive?`elim-absurd ${this.target} with motive ${this.motive.prettyPrint()}`:`elim-absurd ${this.target}`}apply(t){const e=t.getCurrentGoal().result,n=e.context.get(this.target);if(!n)return new $n(t.location,new Un([`target not found in current context: ${this.target}`]));let r;if(!(n instanceof it))throw new Error("Expected target to be a free variable");if(r=n.type.now(),!(r instanceof be))return new $n(t.location,new Un([`Cannot eliminate non-Absurd type: ${r.prettyPrint()}`]));if(this.motive){const t=this.motive.check(e.context,e.renaming,new Te);if(t instanceof $n)return t}return t.currentGoal.isComplete=!0,t.nextGoal(),new Gn(t)}}function iu(t,e){return[t,...e]}function su(t,e,n,r){return new Ml(au(t),e,n,r)}function ou(t,e,n,r){return new Dl(au(t),e,n,r)}function au(t){return new j(t,!0)}function lu(t){return new Ln(au(t),t.source)}function uu(t){if(t instanceof G.Symbol)return t.value;if(t instanceof G.NumericLiteral)return t.value;if(t instanceof $.List)return uu(t.elements[0]);{const e=t;throw new Error(`Expected a Element, but got: ${JSON.stringify(e)} (type: ${typeof e}, constructor: ${e?.constructor?.name})`)}}function cu(t,e){return new V(e.start,e.end,t)}function pu(t,e){return cu(uu(t),e)}function hu(t){const e=new q(t);return new H("",e.scanTokens()).parse()}class du{static parsePie(t){return du.parseElements(hu(t)[0])}static parseElements(t){const e=uu(t);if("U"===e)return n=cu("U",t.location),new Ba(au(n));if("the"===e){const e=t.elements;return function(t,e,n){return new $a(au(t),e,n)}(cu("the",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("Nat"===e)return function(t){return new Ha(au(t))}(cu("Nat",t.location));if("zero"===e)return function(t){return new Fa(au(t))}(cu("zero",t.location));if("add1"===e)return function(t,e){return new Va(au(t),e)}(cu("add1",t.location),this.parseElements(t.elements[1]));if("->"===e||"โ"===e){const e=t.elements;return function(t,e){return new Ka(au(t),e[0],e[1],e[2])}(cu("->",t.location),[this.parseElements(e[1]),this.parseElements(e[2]),e.slice(3).map(t=>this.parseElements(t))])}if("lambda"===e||"ฮป"===e){const e=t.elements,n=t.location,r=e[1],i=e[2];return function(t,e,n){return new Xa(au(t),e,n)}(cu("ฮป",n),r.elements.map(e=>lu(pu(e,t.location))),this.parseElements(i))}if("Pi"===e||"ฮ"===e){const e=t.elements,n=e[1],r=e[2],i=n.elements[0],s=i.elements[0],o=i.elements[1],a=n.elements.slice(1).map(t=>{const e=t.elements[0],n=t.elements[1];return new Dn(lu(pu(e,t.location)),this.parseElements(n))});return function(t,e,n){return new Wa(au(t),e,n)}(cu("ฮ",t.location),iu(new Dn(lu(pu(s,i.location)),this.parseElements(o)),a),this.parseElements(r))}if("Sigma"===e||"ฮฃ"===e){const e=t.elements,n=e[1],r=e[2],i=n.elements[0],s=i.elements[0],o=i.elements[1],a=n.elements.slice(1).map(t=>{const e=t.elements[0],n=t.elements[1];return new Dn(lu(pu(e,t.location)),this.parseElements(n))});return function(t,e,n){return new Qa(au(t),e,n)}(cu("ฮ",t.location),iu(new Dn(lu(pu(s,i.location)),this.parseElements(o)),a),this.parseElements(r))}if("Pair"===e){const e=t.elements;return function(t,e,n){return new nl(au(t),e,n)}(cu("Pair",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("cons"===e){const e=t.elements;return function(t,e,n){return new rl(au(t),e,n)}(cu("Cons",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("car"===e)return function(t,e){return new il(au(t),e)}(cu("car",t.location),this.parseElements(t.elements[1]));if("cdr"===e)return function(t,e){return new sl(au(t),e)}(cu("cdr",t.location),this.parseElements(t.elements[1]));if("which-Nat"===e){const e=t.elements;return function(t,e,n,r){return new ja(au(t),e,n,r)}(cu("which-Nat",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]))}if("iter-Nat"===e){const e=t.elements;return function(t,e,n,r){return new Ja(au(t),e,n,r)}(cu("iter-Nat",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]))}if("rec-Nat"===e){const e=t.elements;return function(t,e,n,r){return new za(au(t),e,n,r)}(cu("rec-Nat",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]))}if("ind-Nat"===e){const e=t.elements;return function(t,e,n,r,i){return new Ya(au(t),e,n,r,i)}(cu("ind-Nat",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]),this.parseElements(e[4]))}if("Atom"===e)return function(t){return new tl(au(t))}(cu("Atom",t.location));if("quote"===e)return function(t,e){return new el(au(t),e)}(cu("Quote",t.location),uu(t.elements[1]));if("Trivial"===e)return function(t){return new ol(au(t))}(cu("Trivial",t.location));if("sole"===e)return function(t){return new al(au(t))}(cu("sole",t.location));if("List"===e)return function(t,e){return new cl(au(t),e)}(cu("List",t.location),this.parseElements(t.elements[1]));if("nil"===e)return function(t){return new ll(au(t))}(cu("nil",t.location));if("::"===e){const e=t.elements;return function(t,e,n){return new pl(au(t),e,n)}(cu("::",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("rec-List"===e){const e=t.elements;return function(t,e,n,r){return new hl(au(t),e,n,r)}(cu("rec-List",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]))}if("ind-List"===e){const e=t.elements;return function(t,e,n,r,i){return new dl(au(t),e,n,r,i)}(cu("ind-List",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]),this.parseElements(e[4]))}if("="===e){const e=t.elements;return function(t,e,n,r){return new yl(au(t),e,n,r)}(cu("=",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]))}if("same"===e)return function(t,e){return new gl(au(t),e)}(cu("same",t.location),this.parseElements(t.elements[1]));if("replace"===e){const e=t.elements;return function(t,e,n,r){return new wl(au(t),e,n,r)}(cu("replace",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]))}if("trans"===e){const e=t.elements;return function(t,e,n){return new vl(au(t),e,n)}(cu("trans",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("cong"===e){const e=t.elements;return function(t,e,n){return new El(au(t),e,n)}(cu("cong",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("ind-="===e){const e=t.elements;return function(t,e,n,r){return new Il(au(t),e,n,r)}(cu("ind-=",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]))}if("symm"===e)return function(t,e){return new Tl(au(t),e)}(cu("symm",t.location),this.parseElements(t.elements[1]));if("Vec"===e){const e=t.elements;return function(t,e,n){return new Al(au(t),e,n)}(cu("Vec",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("vecnil"===e)return function(t){return new Nl(au(t))}(cu("vecnil",t.location));if("vec::"===e){const e=t.elements;return function(t,e,n){return new bl(au(t),e,n)}(cu("vec::",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("head"===e)return function(t,e){return new Sl(au(t),e)}(cu("head",t.location),this.parseElements(t.elements[1]));if("tail"===e)return function(t,e){return new Ol(au(t),e)}(cu("tail",t.location),this.parseElements(t.elements[1]));if("ind-Vec"===e){const e=t.elements;return function(t,e,n,r,i,s){return new _l(au(t),e,n,r,i,s)}(cu("ind-Vec",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]),this.parseElements(e[4]),this.parseElements(e[5]))}if("Either"===e){const e=t.elements;return function(t,e,n){return new Pl(au(t),e,n)}(cu("Either",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("left"===e)return function(t,e){return new Cl(au(t),e)}(cu("left",t.location),this.parseElements(t.elements[1]));if("right"===e)return function(t,e){return new xl(au(t),e)}(cu("right",t.location),this.parseElements(t.elements[1]));if("ind-Either"===e){const e=t.elements;return function(t,e,n,r,i){return new Rl(au(t),e,n,r,i)}(cu("ind-Either",t.location),this.parseElements(e[1]),this.parseElements(e[2]),this.parseElements(e[3]),this.parseElements(e[4]))}if("Absurd"===e)return function(t){return new fl(au(t))}(cu("Absurd",t.location));if("ind-Absurd"===e){const e=t.elements;return function(t,e,n){return new ml(au(t),e,n)}(cu("ind-Absurd",t.location),this.parseElements(e[1]),this.parseElements(e[2]))}if("TODO"===e)return function(t){return new kl(au(t))}(cu("TODO",t.location));if(e.startsWith("type-")){const n=e.substring(5),r=t.elements;if(r.length<3)throw new Error(`Type constructor ${e} requires parameters and indices lists`);const i=r[1];let s=[];i instanceof $.List?s=(i.elements||[]).map(t=>this.parseElements(t)):i instanceof G.Nil&&(s=[]);const o=r[2];let a=[];return o instanceof $.List?a=(o.elements||[]).map(t=>this.parseElements(t)):o instanceof G.Nil&&(a=[]),ou(cu(n,t.location),n,s,a)}if(e.startsWith("data-")){const n=e.substring(5),r=t.elements.slice(1).map(t=>this.parseElements(t));return function(t,e,n){return new ql(au(t),e,n)}(cu(n,t.location),n,r)}if(e.startsWith("elim-")){const n=e.substring(5),r=t.elements;if(r.length<3)throw new Error(`Eliminator ${e} requires at least target and motive`);const i=this.parseElements(r[1]),s=this.parseElements(r[2]),o=r.slice(3).map(t=>this.parseElements(t));return function(t,e,n,r,i){return new Ul(au(t),e,n,r,i)}(cu(e,t.location),n,i,s,o)}if(t instanceof $.List&&t.elements.length>=3){let e=t.elements;const n=e[0];if(n instanceof G.Symbol){const r=n.value;if(r&&r[0]===r[0].toUpperCase()&&r[0]!==r[0].toLowerCase()&&3===e.length){const n=e[1],i=e[2];if((n instanceof $.List||n instanceof G.Nil)&&(i instanceof $.List||i instanceof G.Nil)){let e=[];n instanceof $.List&&(e=(n.elements||[]).map(t=>this.parseElements(t)));let s=[];return i instanceof $.List&&(s=(i.elements||[]).map(t=>this.parseElements(t))),ou(cu(r,t.location),r,e,s)}}}return su(cu("App",t.location),this.parseElements(e[0]),this.parseElements(e[1]),e.slice(2).map(t=>this.parseElements(t)))}if(t instanceof $.List&&t.elements.length>1){let e=t.elements;return su(cu("App",t.location),this.parseElements(e[0]),this.parseElements(e[1]),e.slice(2).map(t=>this.parseElements(t)))}if(Jn(e))return function(t,e){return new Za(au(t),e)}(cu(e,t.location),e);if(!isNaN(Number(e)))return function(t,e){return new ul(au(t),Number(e))}(cu(e,t.location),e);var n;throw new Error("Unexpected element: "+t)}static parseToTactics(t){const e=uu(t);if("exact"===e)return n=cu("exact",t.location),r=this.parseElements(t.elements[1]),new zl(au(n),r);if("intro"===e)return function(t,e){return new Jl(au(t),e)}(cu("intro",t.location),t.elements[1].value);if("exists"===e)return function(t,e,n){return new Yl(au(t),e,n)}(cu("exists",t.location),this.parseElements(t.elements[1]),t.elements[2].value);if("elimNat"===e)return function(t,e){return new Kl(au(t),e)}(cu("elimNat",t.location),t.elements[1].value);if("elimList"===e){const e=t;return function(t,e,n){return new Wl(au(t),e,n)}(cu("elimList",t.location),e.elements[1].value,e.elements[2]?this.parseElements(e.elements[2]):void 0)}if("elimVec"===e)return function(t,e,n,r){return new Xl(au(t),e,n,r)}(cu("elimVec",t.location),t.elements[1].value,this.parseElements(t.elements[2]),this.parseElements(t.elements[3]));if("elimEqual"===e){const e=t;return function(t,e,n){return new Ql(au(t),e,n)}(cu("elimEqual",t.location),e.elements[1].value,e.elements[2]?this.parseElements(e.elements[2]):void 0)}if("left"===e)return function(t){return new Zl(au(t))}(cu("left",t.location));if("right"===e)return function(t){return new tu(au(t))}(cu("right",t.location));if("elimEither"===e){const e=t;return function(t,e,n){return new eu(au(t),e,n)}(cu("elimEither",t.location),e.elements[1].value,e.elements[2]?this.parseElements(e.elements[2]):void 0)}if("split"===e)return function(t){return new nu(au(t))}(cu("split",t.location));if("elimAbsurd"===e){const e=t;return function(t,e,n){return new ru(au(t),e,n)}(cu("elimAbsurd",t.location),e.elements[1].value,e.elements[2]?this.parseElements(e.elements[2]):void 0)}var n,r;throw new Error("Unexpected tactic: "+t)}}class fu{constructor(t,e,n){this.location=t,this.name=e,this.type=n}}class mu{constructor(t,e,n){this.location=t,this.name=e,this.expr=n}}class yu{constructor(t,e,n,r){this.location=t,this.type=e,this.left=n,this.right=r}}class gu{constructor(t,e,n){this.location=t,this.name=e,this.tactics=n}}class wu{static parseDeclaration(t){const e=uu(t);if("claim"===e){const e=t.elements;return new fu(au(pu(e[0],t.location)),uu(e[1]),du.parseElements(e[2]))}if("define"===e){const e=t.elements;return new mu(au(pu(e[0],t.location)),uu(e[1]),du.parseElements(e[2]))}if("check-same"===e){const e=t.elements;return new yu(au(pu(e[0],t.location)),du.parseElements(e[1]),du.parseElements(e[2]),du.parseElements(e[3]))}if("define-tactically"===e){const e=t.elements;return new gu(au(pu(e[0],t.location)),uu(e[1]),e[2].elements.map(t=>du.parseToTactics(t)))}if("data"===e){let e=t.elements,n=t.location;const r=uu(e[1]),i=e[2].elements||[],s=e[3].elements||[],o=i.map(t=>{const e=t;return new Dn(lu(pu(e.elements[0],e.location)),du.parseElements(e.elements[1]))}),a=s.map(t=>{const e=t;return new Dn(lu(pu(e.elements[0],e.location)),du.parseElements(e.elements[1]))}),l=e[e.length-1],u=l instanceof G.Symbol,c=u?e.length-1:e.length,p=u?uu(l):void 0,h=[];for(let t=4;t<c;t++){const n=e[t],r=uu(n.elements[0]),i=n.elements[1].elements||[],s=n.elements[2],o=i.map(t=>{const e=t,n=e.elements[1],r=du.parseElements(n);return new Dn(lu(pu(e.elements[0],e.location)),r)}),a=s,l=uu(a.elements[0]);if(a.elements.length<3)throw new Error(`Constructor return type must specify parameters and indices: (${l} (params...) (indices...))`);const u=a.elements[1];let c=[];u instanceof $.List?c=(u.elements||[]).map(t=>du.parseElements(t)):u instanceof G.Nil&&(c=[]);const p=a.elements[2];let d=[];p instanceof $.List?d=(p.elements||[]).map(t=>du.parseElements(t)):p instanceof G.Nil&&(d=[]);const f=ou(pu(a.elements[0],a.location),l,c,d);h.push(new Bl(au(pu(n.elements[0],n.location)),r,o,f))}return new $l(au(pu(e[0],n)),r,o,a,h,p)}return du.parseElements(t)}}class vu{constructor(){this.currentState=null}startProof(t,e,n){const r=e.get(t);return r instanceof nt?(this.currentState=Vl.initialize(e,r.type,n),new Gn(`Started proof of ${t}\nCurrent goal: \n${r.type.readBackType(e).prettyPrint()}`)):new $n(n,new Un([`${t} is not a valid type or has already been proved`]))}applyTactic(t){if(!this.currentState)return new $n(t.location,new Un(["No proof has been initialized"]));const e=t.apply(this.currentState);if(e instanceof $n)return e;this.currentState=e.result;let n=`\nApplied tactic: ${t}`;const r=this.currentState.getCurrentGoal();if(this.currentState.isComplete())n+="\nAll goals have been solved!";else{const t=r.result;n+="\nCurrent goal: \n"+t.type.readBackType(t.context).prettyPrint()}return new Gn(n)}}function Eu(t){return t.prettyPrint()}function Tu(t){if(!t.trim())return{diagnostics:[],summary:"Waiting for inputโฆ"};const e=[],n=function(t){return new Map(t)}(tt);try{const r=hu(t);for(const t of r){const r=Iu(n,wu.parseDeclaration(t));if(r){e.push(r);break}}}catch(t){e.push(Nu(t))}const r=0===e.length?"No issues detected.":e.some(t=>"error"===t.severity)?"Errors detected.":"Warnings detected.";return{diagnostics:e,summary:r,pretty:0===e.length?_u(n):void 0}}function Iu(t,e){try{if(e instanceof fu){const n=W(t,e.name,e.location,e.type);return n instanceof Gn?(Ou(t,n.result),null):Au(n)}if(e instanceof mu){const n=X(t,e.name,e.location,e.expr);return n instanceof Gn?(Ou(t,n.result),null):Au(n)}if(e instanceof yu){const n=function(t,e,n,r,i){const s=new Bn("tOut"),o=new Bn("tv"),a=new Bn("aOut"),l=new Bn("bOut"),u=new Bn("av"),c=new Bn("bv");return Hn([[s,()=>n.isType(t,new Map)],[o,()=>Y(t,s.value).readBackType(t)],[a,()=>r.check(t,new Map,o.value)],[l,()=>i.check(t,new Map,o.value)],[u,()=>Y(t,a.value)],[c,()=>Y(t,l.value)]],()=>Ma(t,e,o.value,u.value,c.value))}(t,e.location,e.type,e.left,e.right);return n instanceof Gn?null:Au(n)}if(e instanceof gu)return function(t,e){const n=new vu,r=n.startProof(e.name,t,e.location);if(r instanceof $n)return Au(r);for(const t of e.tactics){const e=n.applyTactic(t);if(e instanceof $n)return Au(e)}return null}(t,e);if(e instanceof $l){const n=function(t,e,n){if(t.has(n.name))return new $n(n.location,new Un([`Name already in use: ${n.name}`]));let[r,i]=n.normalize_constructor(t,e);return new Gn(r)}(t,new Map,e);return n instanceof Gn?(Ou(t,n.result),null):Au(n)}{const n=function(t,e){const n=new Bn("outmeta");return Hn([[n,()=>e.synth(t,new Map)]],()=>{const e=Y(t,n.value.type),r=Y(t,n.value.expr);return new Gn(new xe(e.readBackType(t),At(t,e,r)))})}(t,e);return n instanceof Gn?null:Au(n)}}catch(t){return Nu(t)}}function Au(t){const e=t.where.locationToSrcLoc();return{message:(n=t.message,n.message.map(t=>"string"==typeof t?t:t.prettyPrint()).join(" ")),startLineNumber:e.startLine,startColumn:Math.max(1,e.startColumn),endLineNumber:e.endLine??e.startLine,endColumn:Math.max(e.endColumn??e.startColumn+1,e.startColumn+1),severity:"error"};var n}function Nu(t){if(t instanceof Error){const e=t.message||"Unknown error",n=function(t){const e=/Error message: (.*) at (.*):(\d+):(\d+)/s.exec(t);if(e){const[,t,,n,r]=e;return{message:Su(t),startLineNumber:Number(n),startColumn:Number(r),endLineNumber:Number(n),endColumn:Number(r)+1,severity:"error"}}const n=/(.*):(\d+):(\d+)(.*)/s.exec(t);if(n){const[,,e,r,i]=n;return{message:Su(t.replace(/^[^:]+:\d+:\d+/,"").trim()||i||"Error"),startLineNumber:Number(e),startColumn:Number(r),endLineNumber:Number(e),endColumn:Number(r)+1,severity:"error"}}return null}(e);return n??bu(e)}return bu("string"==typeof t?t:"Unknown error")}function bu(t){return{message:Su(t),startLineNumber:1,startColumn:1,endLineNumber:1,endColumn:2,severity:"error"}}function Su(t){return t.replace(/^\[|\]$/g,"").replace(/\s+/g," ").trim()}function Ou(t,e){t.clear();for(const[n,r]of e)t.set(n,r)}function _u(t){const e=[];for(const[n,r]of t)if(r instanceof rt){const i=Eu(r.type.readBackType(t)),s=Eu(At(t,r.type,r.value));e.push(`${n} : ${i}`),e.push(`${n} = ${s}`)}else if(r.type){const i=Eu(r.type.readBackType(t));e.push(`${n} : ${i}`)}return e.join("\n")}export{Tu as analyzePieSource};
//# sourceMappingURL=pie-worker-bundle.js.map
