class e{constructor(e,t){this.worker=null,this.disposables=[],this.debouncedValidate=null,this.diagnostics=[],this.monaco=e,this.editor=t}async start(){this.worker=new Worker(new URL("./pie-lsp-worker-bundle.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{this.handleWorkerMessage(e.data)},this.worker.onerror=e=>{console.error("LSP Worker error:",e)};const e=this.editor?.getModel?.();if(!e)return;this.debouncedValidate=this.debounce((()=>{if(!this.worker)return;const t=e.getValue();this.worker.postMessage({type:"validate",source:t})}),220);const t=this.editor?.onDidChangeModelContent?.((()=>{this.debouncedValidate&&this.debouncedValidate()}));t&&this.disposables.push(t);const n=this.monaco.languages.registerHoverProvider("pie",{provideHover:(e,t)=>this.provideHover(e,t)});this.disposables.push(n);const i=this.monaco.languages.registerCompletionItemProvider("pie",{provideCompletionItems:(e,t)=>this.provideCompletionItems(e,t)});this.disposables.push(i);const o=this.monaco.languages.registerDefinitionProvider("pie",{provideDefinition:(e,t)=>this.provideDefinition(e,t)});this.disposables.push(o),this.debouncedValidate&&this.debouncedValidate()}async stop(){this.clearMarkers(),this.disposables.forEach((e=>{e&&"function"==typeof e.dispose&&e.dispose()})),this.disposables=[],this.debouncedValidate=null,this.diagnostics=[],this.worker&&(this.worker.terminate(),this.worker=null)}isRunning(){return null!==this.worker}handleWorkerMessage(e){e&&("validation-result"===e.type?this.updateDiagnostics(e.diagnostics??[]):"validation-error"===e.type&&this.updateDiagnostics([{severity:"error",startLine:1,startColumn:1,endLine:1,endColumn:2,message:e.error}]))}updateDiagnostics(e){this.diagnostics=e;const t=this.editor?.getModel?.();if(!t)return;const n=e.map((e=>{const t=this.ensurePositiveNumber(e.startLine,1),n=this.ensurePositiveNumber(e.endLine,t),i=this.ensurePositiveNumber(e.startColumn,1);return{startLineNumber:t,startColumn:i,endLineNumber:n,endColumn:this.ensurePositiveNumber(e.endColumn,i+1),message:e.message,severity:"warning"===e.severity?this.monaco.MarkerSeverity.Warning:this.monaco.MarkerSeverity.Error}}));this.monaco.editor.setModelMarkers(t,"pie-lsp",n)}async provideHover(e,t){if(!this.worker)return null;const n=this.diagnostics.find((e=>{const n=this.ensurePositiveNumber(e.startLine,t.lineNumber),i=this.ensurePositiveNumber(e.endLine,n),o=this.ensurePositiveNumber(e.startColumn,1),s=this.ensurePositiveNumber(e.endColumn,o+1);return!(t.lineNumber<n||t.lineNumber>i)&&(!(t.lineNumber===n&&t.column<o)&&!(t.lineNumber===i&&t.column>s))}));if(n){const e=this.ensurePositiveNumber(n.startLine,t.lineNumber),i=this.ensurePositiveNumber(n.endLine,e),o=this.ensurePositiveNumber(n.startColumn,1),s=this.ensurePositiveNumber(n.endColumn,o+1);return{contents:[{value:`**${"warning"===n.severity?"Warning":"Error"}**\n\n${n.message}`}],range:{startLineNumber:e,startColumn:o,endLineNumber:i,endColumn:s}}}return new Promise((n=>{const i=e=>{const t=e.data;if("hover-result"===t.type){if(this.worker?.removeEventListener("message",i),!t.hoverInfo)return void n(null);const e=t.hoverInfo;let o=`**${e.title}**\n\n${e.summary}`;e.details&&(o+=`\n\n${e.details}`),e.examples&&(o+=`\n\n**Examples:**\n\`\`\`pie\n${e.examples}\n\`\`\``),n({contents:[{value:o}]})}};if(this.worker){this.worker.addEventListener("message",i);const n=e.getValue();this.worker.postMessage({type:"hover",source:n,line:t.lineNumber-1,column:t.column-1})}setTimeout((()=>{this.worker?.removeEventListener("message",i),n(null)}),1e3)}))}async provideCompletionItems(e,t){return this.worker?new Promise((n=>{const i=e=>{const o=e.data;if("completion-result"===o.type){this.worker?.removeEventListener("message",i);const e=o.wordRange,s=e?{startLineNumber:t.lineNumber,startColumn:e.start+1,endLineNumber:t.lineNumber,endColumn:e.end+1}:{startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:t.lineNumber,endColumn:t.column},a=o.completions.map((e=>{let t=this.monaco.languages.CompletionItemKind.Text;switch(e.kind){case"Keyword":t=this.monaco.languages.CompletionItemKind.Keyword;break;case"Function":t=this.monaco.languages.CompletionItemKind.Function;break;case"Variable":t=this.monaco.languages.CompletionItemKind.Variable;break;case"TypeParameter":t=this.monaco.languages.CompletionItemKind.Class;break;case"Value":t=this.monaco.languages.CompletionItemKind.Value;break;case"Snippet":t=this.monaco.languages.CompletionItemKind.Snippet}return{label:e.label,kind:t,detail:e.detail,insertText:e.label,range:s}}));n({suggestions:a})}};if(this.worker){this.worker.addEventListener("message",i);const n=e.getValue();this.worker.postMessage({type:"completion",source:n,line:t.lineNumber-1,column:t.column-1})}setTimeout((()=>{this.worker?.removeEventListener("message",i),n({suggestions:[]})}),1e3)})):{suggestions:[]}}async provideDefinition(e,t){return this.worker?new Promise((n=>{const i=t=>{const o=t.data;"definition-result"===o.type&&(this.worker?.removeEventListener("message",i),o.location?n({uri:e.uri,range:{startLineNumber:o.location.line+1,startColumn:o.location.startColumn+1,endLineNumber:o.location.line+1,endColumn:o.location.endColumn+1}}):n(null))};if(this.worker){this.worker.addEventListener("message",i);const n=e.getValue();this.worker.postMessage({type:"definition",source:n,line:t.lineNumber-1,column:t.column-1})}setTimeout((()=>{this.worker?.removeEventListener("message",i),n(null)}),1e3)})):null}clearMarkers(){const e=this.editor?.getModel?.();e&&this.monaco.editor.setModelMarkers(e,"pie-lsp",[])}ensurePositiveNumber(e,t){return"number"!=typeof e||Number.isNaN(e)||e<1?t:e}debounce(e,t){let n=null;return()=>{null!==n&&window.clearTimeout(n),n=window.setTimeout((()=>{n=null,e()}),t)}}}const t={nodeWidth:180,nodeHeight:60,horizontalSpacing:40,verticalSpacing:80,colors:{current:"#f59e0b",completed:"#34d399",pending:"#64748b",edge:"#475569",tacticLabel:"#94a3b8",background:"#0f172a"}};class n{constructor(e,n){this.svg=null,this.onGoalSelect=null,this.currentData=null,this.container=e,this.config={...t,...n}}setOnGoalSelect(e){this.onGoalSelect=e}render(e){this.currentData=e,this.clear();const t=this.calculateLayout(e.root);let n=1/0,i=-1/0,o=0;t.forEach((e=>{n=Math.min(n,e.x),i=Math.max(i,e.x+e.width),o=Math.max(o,e.y+this.config.nodeHeight)}));const s=i-n+40,a=o+40,l=20-n;this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",String(s)),this.svg.setAttribute("height",String(a)),this.svg.style.display="block";const r=document.createElementNS("http://www.w3.org/2000/svg","g"),p=document.createElementNS("http://www.w3.org/2000/svg","g");this.svg.appendChild(r),this.svg.appendChild(p),this.renderNodeRecursive(e.root,t,l,20,r,p),this.container.appendChild(this.svg)}renderNodeRecursive(e,t,n,i,o,s){const a=t.get(e.goal.id);if(!a)return;const l=a.x+n,r=a.y+i;for(const s of e.children){const a=t.get(s.goal.id);if(a){const t=a.x+n,s=a.y+i;this.renderEdge(o,l,r,t,s,e.appliedTactic)}}e.completedBy&&0===e.children.length&&this.renderSelfLoop(o,l,r,e.completedBy),this.renderNode(s,e.goal,l,r);for(const a of e.children)this.renderNodeRecursive(a,t,n,i,o,s)}renderNode(e,t,n,i){const{nodeWidth:o,nodeHeight:s,colors:a}=this.config,l=document.createElementNS("http://www.w3.org/2000/svg","g");l.setAttribute("class","goal-node"),l.setAttribute("data-goal-id",t.id),l.style.cursor="pointer";let r=a.pending,p="0.1";t.isCurrent?(r=a.current,p="0.2"):t.isComplete&&(r=a.completed,p="0.15");const c=document.createElementNS("http://www.w3.org/2000/svg","rect");c.setAttribute("x",String(n)),c.setAttribute("y",String(i)),c.setAttribute("width",String(o)),c.setAttribute("height",String(s)),c.setAttribute("rx","8"),c.setAttribute("ry","8"),c.setAttribute("fill",r),c.setAttribute("fill-opacity",p),c.setAttribute("stroke",r),c.setAttribute("stroke-width",t.isCurrent?"3":"2"),l.appendChild(c);const d=document.createElementNS("http://www.w3.org/2000/svg","text");d.setAttribute("x",String(n+10)),d.setAttribute("y",String(i+18)),d.setAttribute("fill",r),d.setAttribute("font-size","11"),d.setAttribute("font-family","monospace"),d.textContent=t.id,l.appendChild(d);const u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttribute("x",String(n+o-10)),u.setAttribute("y",String(i+18)),u.setAttribute("text-anchor","end"),u.setAttribute("fill",r),u.setAttribute("font-size","12"),console.log(`Goal ${t.id}: isComplete=${t.isComplete}, isCurrent=${t.isCurrent}`),t.isComplete?u.textContent="✓":t.isCurrent?u.textContent="→":u.textContent="○",l.appendChild(u);const h=document.createElementNS("http://www.w3.org/2000/svg","text");h.setAttribute("x",String(n+10)),h.setAttribute("y",String(i+40)),h.setAttribute("fill","#e2e8f0"),h.setAttribute("font-size","12"),h.setAttribute("font-family","monospace");const m=this.truncateText(t.type,o-20);h.textContent=m,l.appendChild(h),l.addEventListener("click",(()=>{this.onGoalSelect&&this.onGoalSelect(t)})),l.addEventListener("mouseenter",(()=>{c.setAttribute("fill-opacity",String(parseFloat(p)+.1))})),l.addEventListener("mouseleave",(()=>{c.setAttribute("fill-opacity",p)})),e.appendChild(l)}renderEdge(e,t,n,i,o,s){const{nodeWidth:a,nodeHeight:l,colors:r}=this.config,p=t+a/2,c=n+l,d=i+a/2,u=o,h=document.createElementNS("http://www.w3.org/2000/svg","path"),m=(c+u)/2,k=`M ${p} ${c} C ${p} ${m}, ${d} ${m}, ${d} ${u}`;if(h.setAttribute("d",k),h.setAttribute("fill","none"),h.setAttribute("stroke",r.edge),h.setAttribute("stroke-width","2"),e.appendChild(h),s){const t=(p+d)/2,n=m,i=document.createElementNS("http://www.w3.org/2000/svg","rect"),o=this.truncateText(s,100),a=Math.min(7*o.length+10,110);i.setAttribute("x",String(t-a/2)),i.setAttribute("y",String(n-10)),i.setAttribute("width",String(a)),i.setAttribute("height","20"),i.setAttribute("rx","4"),i.setAttribute("fill",r.background),i.setAttribute("fill-opacity","0.9"),e.appendChild(i);const l=document.createElementNS("http://www.w3.org/2000/svg","text");l.setAttribute("x",String(t)),l.setAttribute("y",String(n+4)),l.setAttribute("text-anchor","middle"),l.setAttribute("fill",r.tacticLabel),l.setAttribute("font-size","11"),l.setAttribute("font-family","monospace"),l.textContent=o,e.appendChild(l)}}renderSelfLoop(e,t,n,i){const{nodeWidth:o,nodeHeight:s,colors:a}=this.config,l=t+o/2,r=n+s,p=document.createElementNS("http://www.w3.org/2000/svg","path"),c=`M ${l-15} ${r}\n               C ${l-50} ${r+35},\n                 ${l+50} ${r+35},\n                 ${l+15} ${r}`;p.setAttribute("d",c),p.setAttribute("fill","none"),p.setAttribute("stroke",a.completed),p.setAttribute("stroke-width","2"),e.appendChild(p);const d=document.createElementNS("http://www.w3.org/2000/svg","polygon"),u=l+15,h=r;d.setAttribute("points",`${u},${h} ${u+6},${h+6} ${u-6},${h+6}`),d.setAttribute("fill",a.completed),e.appendChild(d);const m=r+35+5,k=this.truncateText(i,120),y=Math.min(6.5*k.length+12,130),f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttribute("x",String(l-y/2)),f.setAttribute("y",String(m-10)),f.setAttribute("width",String(y)),f.setAttribute("height","18"),f.setAttribute("rx","4"),f.setAttribute("fill",a.background),f.setAttribute("fill-opacity","0.9"),e.appendChild(f);const g=document.createElementNS("http://www.w3.org/2000/svg","text");g.setAttribute("x",String(l)),g.setAttribute("y",String(m+3)),g.setAttribute("text-anchor","middle"),g.setAttribute("fill",a.completed),g.setAttribute("font-size","10"),g.setAttribute("font-family","monospace"),g.textContent=k,e.appendChild(g)}calculateLayout(e){const t=new Map,n=new Map;return this.calculateSubtreeWidths(e,n),this.assignPositions(e,0,0,n,t),t}calculateSubtreeWidths(e,t){const{nodeWidth:n,horizontalSpacing:i}=this.config;if(0===e.children.length)return t.set(e.goal.id,n),n;let o=0;for(const n of e.children)o+=this.calculateSubtreeWidths(n,t);o+=(e.children.length-1)*i;const s=Math.max(n,o);return t.set(e.goal.id,s),s}assignPositions(e,t,n,i,o){const{nodeWidth:s,nodeHeight:a,horizontalSpacing:l,verticalSpacing:r}=this.config,p=t+((i.get(e.goal.id)||s)-s)/2;if(o.set(e.goal.id,{x:p,y:n,width:s}),e.children.length>0){const p=n+a+r;let c=t;for(const t of e.children){const e=i.get(t.goal.id)||s;this.assignPositions(t,c,p,i,o),c+=e+l}}}truncateText(e,t){const n=Math.floor(t/7);return e.length<=n?e:e.substring(0,n-3)+"..."}clear(){this.svg&&this.svg.parentNode&&this.svg.parentNode.removeChild(this.svg),this.svg=null}highlightGoal(e){if(!this.svg)return;this.svg.querySelectorAll(".goal-node").forEach((e=>{e.classList.remove("highlighted")}));const t=this.svg.querySelector(`[data-goal-id="${e}"]`);t&&t.classList.add("highlighted")}}class i{constructor(e){this.currentGoal=null,this.container=e,this.clear()}display(e){this.currentGoal=e,this.container.innerHTML="";const t=document.createElement("div");t.className="panel-header";const n=document.createElement("div");n.className="panel-label",n.textContent="Context",t.appendChild(n),this.container.appendChild(t);const i=document.createElement("div");if(i.className="panel-content",e.contextEntries.length>0){const t=document.createElement("div");t.className="context-list";for(const n of e.contextEntries){const e=document.createElement("div");e.className="context-entry";const i=document.createElement("span");i.className="context-entry-name",i.textContent=n.name,e.appendChild(i);const o=document.createElement("span");o.className="context-entry-colon",o.textContent=" : ",e.appendChild(o);const s=document.createElement("span");s.className="context-entry-type",s.textContent=n.type,e.appendChild(s),t.appendChild(e)}i.appendChild(t)}else{const e=document.createElement("div");e.className="panel-empty",e.textContent="(empty)",i.appendChild(e)}this.container.appendChild(i)}clear(){this.currentGoal=null,this.container.innerHTML='\n      <div class="panel-placeholder">\n        Select a goal\n      </div>\n    '}getCurrentGoal(){return this.currentGoal}}class o{constructor(e){this.pos=0,this.tokens=e}current(){return this.tokens[this.pos]||{type:"EOF"}}advance(){const e=this.current();return this.pos++,e}expect(e){const t=this.current();if(t.type!==e)throw new Error(`Expected ${e} but got ${t.type}`);return this.advance()}parse(){const e=this.current();if("LPAREN"===e.type)return this.parseList();if("ATOM"===e.type)return this.parseAtom();if("EOF"===e.type)return{kind:"",value:"",children:[],isAtom:!0,sourceText:"",abbreviation:""};throw new Error(`Unexpected token: ${e.type}`)}parseAtom(){const e=this.expect("ATOM");return{kind:e.value,value:e.value,children:[],isAtom:!0,sourceText:e.value,abbreviation:e.value}}parseList(){this.expect("LPAREN");const e=[],t=["("];for(;"RPAREN"!==this.current().type&&"EOF"!==this.current().type;){const n=this.parse();e.push(n),t.push(n.sourceText)}this.expect("RPAREN"),t.push(")");const n=e.length>0&&e[0].isAtom?e[0].kind:"list",i=t.join(" ").replace(/\( /g,"(").replace(/ \)/g,")"),o=function(e){const t=e.kind,n=e.children;switch(t){case"Π":case"Pi":if(n.length>=3){const e=n[1];if(!e.isAtom&&e.children.length>=2){return`Π (${e.children[0].abbreviation} : ${e.children[1].abbreviation}) ...`}}return"Π ...";case"Σ":case"Sigma":if(n.length>=3){const e=n[1];if(!e.isAtom&&e.children.length>=2){return`Σ (${e.children[0].abbreviation} : ${e.children[1].abbreviation}) ...`}}return"Σ ...";case"Either":return n.length>=3?`Either ${n[1].abbreviation} ${n[2].abbreviation}`:"Either ...";case"left":case"Left":return n.length>=2?`left ${n[1].abbreviation}`:"left ...";case"right":case"Right":return n.length>=2?`right ${n[1].abbreviation}`:"right ...";case"=":return n.length>=4?`= ${n[1].abbreviation} ...`:"= ...";case"λ":case"lambda":if(n.length>=3){const e=n[1];if(!e.isAtom&&e.children.length>=1)return`λ (${e.children[0].abbreviation}) ...`}return"λ ...";case"List":return n.length>=2?`List ${n[1].abbreviation}`:"List ...";case"Vec":return n.length>=3?`Vec ${n[1].abbreviation} ${n[2].abbreviation}`:"Vec ...";case"Pair":return n.length>=3?`Pair ${n[1].abbreviation} ${n[2].abbreviation}`:"Pair ...";case"cons":case"::":return":: ...";case"add1":return n.length>=2?`add1 ${n[1].abbreviation}`:"add1 ...";default:if(n.length>0){const e=n[0].isAtom?n[0].abbreviation:"?";return 1===n.length?`(${e})`:`(${e} ...)`}return"(...)"}}({kind:n,children:e});return{kind:n,children:e,isAtom:!1,sourceText:i,abbreviation:o}}}function s(e){const t=e.toLowerCase();return"Π"===e||"Pi"===e||"→"===e||"->"===e?"pi":"Σ"===e||"Sigma"===e?"sigma":"either"===t||"left"===t||"right"===t?"either":"="===e||"same"===t||"cong"===t||"symm"===t||"trans"===t||"replace"===t?"equality":"list"===t||"::"===e||"nil"===t||"cons"===t?"list":"vec"===t||"vec::"===t||"vecnil"===t||"head"===t||"tail"===t?"vec":"nat"===t||"zero"===t||"add1"===t?"nat":"U"===e||"atom"===t||"trivial"===t||"absurd"===t||"sole"===t?"universe":"λ"===e||"lambda"===t?"lambda":/^[a-z][a-z0-9_-]*$/i.test(e)&&e.length<=10&&e===e.toLowerCase()?"variable":"default"}class a{constructor(e){this.rootNode=null,this.nodeStates=new Map,this.nodeIdCounter=0,this.container=e,this.container.classList.add("type-tree")}render(e){this.clear(),this.nodeIdCounter=0;const t=e.trim();if(t)try{if(this.rootNode=function(e){const t=e.trim();if(!t)return{kind:"",value:"",children:[],isAtom:!0,sourceText:"",abbreviation:""};try{const e=function(e){const t=[];let n=0;for(;n<e.length;){const i=e[n];if(/\s/.test(i)){n++;continue}if("("===i){t.push({type:"LPAREN"}),n++;continue}if(")"===i){t.push({type:"RPAREN"}),n++;continue}let o="";for(;n<e.length&&!/[\s()]/.test(e[n]);)o+=e[n],n++;o&&t.push({type:"ATOM",value:o})}return t.push({type:"EOF"}),t}(t);return new o(e).parse()}catch(e){return{kind:"error",value:t,children:[],isAtom:!0,sourceText:t,abbreviation:t.length>20?t.slice(0,20)+"...":t}}}(t),"error"===this.rootNode.kind)return void this.showPlainText(t);const e=this.renderNode(this.rootNode,0);this.container.appendChild(e)}catch(e){this.showPlainText(t)}else this.showPlaceholder("No type to display")}clear(){this.container.innerHTML="",this.rootNode=null,this.nodeStates.clear(),this.nodeIdCounter=0}expandAll(){if(this.nodeStates.forEach(((e,t)=>this.nodeStates.set(t,!0))),this.rootNode){this.container.innerHTML="";const e=this.renderNode(this.rootNode,0);this.container.appendChild(e)}}collapseAll(){if(this.nodeStates.forEach(((e,t)=>this.nodeStates.set(t,!1))),this.rootNode){this.container.innerHTML="";const e=this.renderNode(this.rootNode,0);this.container.appendChild(e)}}showPlaceholder(e){const t=document.createElement("div");t.className="type-tree__placeholder",t.textContent=e,this.container.appendChild(t)}showPlainText(e){const t=document.createElement("pre");t.className="type-tree__fallback",t.textContent=e,this.container.appendChild(t)}renderNode(e,t){const n="n"+this.nodeIdCounter++;this.nodeStates.has(n)||this.nodeStates.set(n,t<3);const i=this.nodeStates.get(n)??!0;return e.isAtom?this.renderAtom(e):this.renderListNode(e,n,t,i)}renderAtom(e){const t=document.createElement("span");t.className="type-node type-node--atom";const n=document.createElement("span"),i=s(e.kind);return n.className=`type-node__kind type-kind--${i}`,n.textContent=e.value||e.kind,t.appendChild(n),t}renderListNode(e,t,n,i){const o=document.createElement("div");o.className="type-node type-node--list",o.dataset.nodeId=t;const a=e.children,l=a.length>0&&a[0].isAtom&&a[0].kind===e.kind?a.slice(1):a,r=l.length>0,p=document.createElement("div");if(p.className="type-node__header",r){const e=document.createElement("span");e.className="type-node__toggle",e.textContent=i?"▼":"▶",e.addEventListener("click",(e=>{e.stopPropagation(),this.toggleNode(t)})),p.appendChild(e)}else{const e=document.createElement("span");e.className="type-node__toggle-spacer",p.appendChild(e)}const c=document.createElement("span"),d=s(e.kind);if(c.className=`type-node__kind type-kind--${d}`,c.textContent=e.kind,p.appendChild(c),this.isBindingType(e.kind)&&l.length>=2){const e=l[0];if(!e.isAtom&&e.children.length>=2){const t=document.createElement("span");t.className="type-node__binding";const n=e.children[0].value||e.children[0].kind,i=e.children[1].abbreviation;t.textContent=` (${n} : ${i})`,p.appendChild(t)}else if(!e.isAtom&&1===e.children.length){const t=document.createElement("span");t.className="type-node__binding";const n=e.children[0].value||e.children[0].kind;t.textContent=` (${n})`,p.appendChild(t)}}if(!i&&r){const t=document.createElement("span");t.className="type-node__abbrev",t.textContent=" "+this.getCollapsedHint(e,l),p.appendChild(t)}if(o.appendChild(p),r&&i){const t=document.createElement("div");t.className="type-node__children";const i=this.getChildrenToRender(e,l);for(const e of i){const i=this.renderNode(e,n+1);t.appendChild(i)}o.appendChild(t)}return o}isBindingType(e){return"Π"===e||"Pi"===e||"Σ"===e||"Sigma"===e||"λ"===e||"lambda"===e}getChildrenToRender(e,t){return this.isBindingType(e.kind)&&t.length>=2?t.slice(1):t}getCollapsedHint(e,t){if(0===t.length)return"";if(this.isBindingType(e.kind)&&t.length>=2){const e=t[1];return e.isAtom?e.kind:`→ ${e.kind} ...`}return"..."}toggleNode(e){const t=this.nodeStates.get(e)??!0;if(this.nodeStates.set(e,!t),this.rootNode){this.nodeIdCounter=0,this.container.innerHTML="";const e=this.renderNode(this.rootNode,0);this.container.appendChild(e)}}}class l{constructor(e){this.currentGoal=null,this.goalTypeTree=null,this.container=e,this.clear()}display(e){this.currentGoal=e,this.container.innerHTML="";const t=document.createElement("div");t.className="panel-header";const n=document.createElement("div");n.className="panel-title-row";const i=document.createElement("div");i.className="panel-label",i.textContent="Goal",n.appendChild(i);const o=document.createElement("span");o.className="panel-goal-id",o.textContent=e.id,n.appendChild(o),t.appendChild(n);const s=document.createElement("span");s.className="panel-status",e.isComplete?(s.textContent="Completed",s.classList.add("status-completed")):e.isCurrent?(s.textContent="Ongoing",s.classList.add("status-ongoing")):(s.textContent="Pending",s.classList.add("status-pending")),t.appendChild(s),this.container.appendChild(t);const l=document.createElement("div");l.className="panel-content";const r=document.createElement("div");r.className="goal-type-tree",this.goalTypeTree=new a(r),this.goalTypeTree.render(e.type),l.appendChild(r),this.container.appendChild(l)}clear(){this.currentGoal=null,this.goalTypeTree=null,this.container.innerHTML='\n      <div class="panel-placeholder">\n        Select a goal\n      </div>\n    '}getCurrentGoal(){return this.currentGoal}}const r="#4ade80",p="#60a5fa",c="#a3e635",d="#fb923c",u="#f59e0b",h="#22d3ee";let m=null;function k(){return m||(m=new Blockly.Generator("Pie"),m.scrub_=function(e,t,n){const i=e.nextConnection&&e.nextConnection.targetBlock();return i&&!n?t+"\n"+m.blockToCode(i):t},m.scrubNakedValue=function(e){return e+"\n"},(e=m).forBlock.pie_nat=function(){return["Nat",0]},e.forBlock.pie_atom=function(){return["Atom",0]},e.forBlock.pie_trivial=function(){return["Trivial",0]},e.forBlock.pie_absurd=function(){return["Absurd",0]},e.forBlock.pie_u=function(){return["U",0]},e.forBlock.pie_list_type=function(t){return[`(List ${f(e,t,"ELEM_TYPE")||"Nat"})`,0]},e.forBlock.pie_vec_type=function(t){return[`(Vec ${f(e,t,"ELEM_TYPE")||"Nat"} ${f(e,t,"LENGTH")||"0"})`,0]},e.forBlock.pie_pair_type=function(t){return[`(Pair ${f(e,t,"LEFT_TYPE")||"Nat"} ${f(e,t,"RIGHT_TYPE")||"Nat"})`,0]},e.forBlock.pie_sigma_type=function(t){return[`(Sigma ((${t.getFieldValue("BINDING")||"x"} ${f(e,t,"BINDING_TYPE")||"Nat"})) ${f(e,t,"BODY_TYPE")||"Nat"})`,0]},e.forBlock.pie_either_type=function(t){return[`(Either ${f(e,t,"LEFT_TYPE")||"Nat"} ${f(e,t,"RIGHT_TYPE")||"Nat"})`,0]},e.forBlock.pie_arrow_type=function(t){return[`(-> ${f(e,t,"FROM_TYPE")||"Nat"} ${f(e,t,"TO_TYPE")||"Nat"})`,0]},e.forBlock.pie_pi_type=function(t){return[`(Pi ((${t.getFieldValue("BINDING")||"x"} ${f(e,t,"BINDING_TYPE")||"Nat"})) ${f(e,t,"BODY_TYPE")||"Nat"})`,0]},e.forBlock.pie_equal_type=function(t){return[`(= ${f(e,t,"BASE_TYPE")||"Nat"} ${f(e,t,"FROM")||"0"} ${f(e,t,"TO")||"0"})`,0]},e.forBlock.pie_zero=function(){return["zero",0]},e.forBlock.pie_add1=function(t){return[`(add1 ${f(e,t,"N")||"zero"})`,0]},e.forBlock.pie_nat_literal=function(e){const t=e.getFieldValue("VALUE")||0;return[String(t),0]},e.forBlock.pie_cons=function(t){return[`(cons ${f(e,t,"LEFT")||"zero"} ${f(e,t,"RIGHT")||"zero"})`,0]},e.forBlock.pie_car=function(t){return[`(car ${f(e,t,"PAIR")||"p"})`,0]},e.forBlock.pie_cdr=function(t){return[`(cdr ${f(e,t,"PAIR")||"p"})`,0]},e.forBlock.pie_same=function(t){return[`(same ${f(e,t,"VALUE")||"zero"})`,0]},e.forBlock.pie_sole=function(){return["sole",0]},e.forBlock.pie_nil=function(){return["nil",0]},e.forBlock.pie_list_cons=function(t){return[`(:: ${f(e,t,"HEAD")||"zero"} ${f(e,t,"TAIL")||"nil"})`,0]},e.forBlock.pie_vecnil=function(){return["vecnil",0]},e.forBlock.pie_vec_cons=function(t){return[`(vec:: ${f(e,t,"HEAD")||"zero"} ${f(e,t,"TAIL")||"vecnil"})`,0]},e.forBlock.pie_left=function(t){return[`(left ${f(e,t,"VALUE")||"zero"})`,0]},e.forBlock.pie_right=function(t){return[`(right ${f(e,t,"VALUE")||"zero"})`,0]},e.forBlock.pie_quote=function(e){return[`'${e.getFieldValue("SYMBOL")||"symbol"}`,0]},e.forBlock.pie_variable=function(e){return[e.getFieldValue("NAME")||"x",0]},e.forBlock.pie_lambda=function(t){return[`(lambda (${t.getFieldValue("PARAM")||"x"}) ${f(e,t,"BODY")||"x"})`,0]},e.forBlock.pie_lambda_multi=function(t){return[`(lambda (${t.getFieldValue("PARAMS")||"x"}) ${f(e,t,"BODY")||"x"})`,0]},e.forBlock.pie_application=function(t){return[`(${f(e,t,"FUNC")||"f"} ${f(e,t,"ARG")||"x"})`,0]},e.forBlock.pie_application_multi=function(t){return[`(${f(e,t,"FUNC")||"f"} ${f(e,t,"ARG1")||"x"} ${f(e,t,"ARG2")||"y"})`,0]},e.forBlock.pie_the=function(t){return[`(the ${f(e,t,"TYPE")||"Nat"} ${f(e,t,"VALUE")||"zero"})`,0]},e.forBlock.pie_cong=function(t){return[`(cong ${f(e,t,"PROOF")||"eq"} ${f(e,t,"FUNC")||"f"})`,0]},e.forBlock.pie_claim=function(t){return`(claim ${t.getFieldValue("NAME")||"name"} ${f(e,t,"TYPE")||"Nat"})`},e.forBlock.pie_define=function(t){return`(define ${t.getFieldValue("NAME")||"name"} ${f(e,t,"VALUE")||"zero"})`},e.forBlock.pie_define_tactically=function(t){const n=t.getFieldValue("NAME")||"name",i=function(e,t,n){return e.statementToCode(t,n)}(e,t,"TACTICS")||"";return`(define-tactically ${n}\n  (\n${i.split("\n").filter((e=>e.trim())).map((e=>"  "+e.trim())).join("\n")}\n  ))`},e.forBlock.pie_check_same=function(t){return`(check-same ${f(e,t,"TYPE")||"Nat"} ${f(e,t,"LEFT")||"zero"} ${f(e,t,"RIGHT")||"zero"})`},e.forBlock.pie_tactic_intro=function(e){return`(intro ${e.getFieldValue("NAME")||"x"})`},e.forBlock.pie_tactic_exact=function(t){return`(exact ${f(e,t,"EXPR")||"x"})`},e.forBlock.pie_tactic_exists=function(t){return`(exists ${f(e,t,"WITNESS")||"x"})`},e.forBlock.pie_tactic_left=function(e){return"(left)"},e.forBlock.pie_tactic_right=function(e){return"(right)"},e.forBlock.pie_tactic_split=function(e){return"(split)"},e.forBlock.pie_tactic_elimNat=function(e){return`(elimNat ${e.getFieldValue("TARGET")||"n"})`},e.forBlock.pie_tactic_elimList=function(e){return`(elimList ${e.getFieldValue("TARGET")||"xs"})`},e.forBlock.pie_tactic_elimVec=function(e){return`(elimVec ${e.getFieldValue("TARGET")||"vs"})`},e.forBlock.pie_tactic_elimEqual=function(e){return`(elimEqual ${e.getFieldValue("TARGET")||"eq"})`},e.forBlock.pie_tactic_elimEither=function(e){return`(elimEither ${e.getFieldValue("TARGET")||"e"})`},e.forBlock.pie_tactic_elimAbsurd=function(e){return`(elimAbsurd ${e.getFieldValue("TARGET")||"x"})`},e.forBlock.pie_which_nat=function(t){return[`(which-Nat ${f(e,t,"TARGET")||"n"} ${f(e,t,"BASE")||"zero"} ${f(e,t,"STEP")||"f"})`,0]},e.forBlock.pie_iter_nat=function(t){return[`(iter-Nat ${f(e,t,"TARGET")||"n"} ${f(e,t,"BASE")||"zero"} ${f(e,t,"STEP")||"f"})`,0]},e.forBlock.pie_rec_nat=function(t){return[`(rec-Nat ${f(e,t,"TARGET")||"n"} ${f(e,t,"BASE")||"zero"} ${f(e,t,"STEP")||"f"})`,0]},e.forBlock.pie_ind_nat=function(t){return[`(ind-Nat ${f(e,t,"TARGET")||"n"} ${f(e,t,"MOTIVE")||"mot"} ${f(e,t,"BASE")||"zero"} ${f(e,t,"STEP")||"f"})`,0]},e.forBlock.pie_rec_list=function(t){return[`(rec-List ${f(e,t,"TARGET")||"xs"} ${f(e,t,"BASE")||"nil"} ${f(e,t,"STEP")||"f"})`,0]},e.forBlock.pie_ind_list=function(t){return[`(ind-List ${f(e,t,"TARGET")||"xs"} ${f(e,t,"MOTIVE")||"mot"} ${f(e,t,"BASE")||"nil"} ${f(e,t,"STEP")||"f"})`,0]},e.forBlock.pie_ind_vec=function(t){return[`(ind-Vec ${f(e,t,"LENGTH")||"n"} ${f(e,t,"TARGET")||"vs"} ${f(e,t,"MOTIVE")||"mot"} ${f(e,t,"BASE")||"vecnil"} ${f(e,t,"STEP")||"f"})`,0]},e.forBlock.pie_ind_either=function(t){return[`(ind-Either ${f(e,t,"TARGET")||"e"} ${f(e,t,"MOTIVE")||"mot"} ${f(e,t,"LEFT_CASE")||"fl"} ${f(e,t,"RIGHT_CASE")||"fr"})`,0]},e.forBlock.pie_ind_equal=function(t){return[`(ind-= ${f(e,t,"TARGET")||"eq"} ${f(e,t,"MOTIVE")||"mot"} ${f(e,t,"BASE")||"b"})`,0]},e.forBlock.pie_ind_absurd=function(t){return[`(ind-Absurd ${f(e,t,"TARGET")||"x"} ${f(e,t,"MOTIVE")||"Nat"})`,0]},e.forBlock.pie_head=function(t){return[`(head ${f(e,t,"LIST")||"vs"})`,0]},e.forBlock.pie_tail=function(t){return[`(tail ${f(e,t,"LIST")||"vs"})`,0]},m);var e}const y={get instance(){return k()},workspaceToCode:e=>k().workspaceToCode(e)};function f(e,t,n){return e.valueToCode(t,n,0)||""}const g={kind:"categoryToolbox",contents:[{kind:"category",name:"Definitions",colour:d,contents:[{kind:"label",text:"Top-level declarations"},{kind:"block",type:"pie_claim"},{kind:"block",type:"pie_define"},{kind:"sep",gap:"16"},{kind:"label",text:"Tactical proofs"},{kind:"block",type:"pie_define_tactically"},{kind:"sep",gap:"16"},{kind:"label",text:"Assertions"},{kind:"block",type:"pie_check_same"}]},{kind:"category",name:"Types",colour:r,contents:[{kind:"label",text:"Basic Types"},{kind:"block",type:"pie_nat"},{kind:"block",type:"pie_atom"},{kind:"block",type:"pie_trivial"},{kind:"block",type:"pie_absurd"},{kind:"block",type:"pie_u"},{kind:"sep",gap:"16"},{kind:"label",text:"Collection Types"},{kind:"block",type:"pie_list_type"},{kind:"block",type:"pie_vec_type"},{kind:"sep",gap:"16"},{kind:"label",text:"Product Types"},{kind:"block",type:"pie_pair_type"},{kind:"block",type:"pie_sigma_type"},{kind:"sep",gap:"16"},{kind:"label",text:"Sum Types"},{kind:"block",type:"pie_either_type"},{kind:"sep",gap:"16"},{kind:"label",text:"Function Types"},{kind:"block",type:"pie_arrow_type"},{kind:"block",type:"pie_pi_type"},{kind:"sep",gap:"16"},{kind:"label",text:"Equality Type"},{kind:"block",type:"pie_equal_type"}]},{kind:"category",name:"Values",colour:p,contents:[{kind:"label",text:"Natural Numbers"},{kind:"block",type:"pie_zero"},{kind:"block",type:"pie_add1"},{kind:"block",type:"pie_nat_literal"},{kind:"sep",gap:"16"},{kind:"label",text:"Pairs"},{kind:"block",type:"pie_cons"},{kind:"block",type:"pie_car"},{kind:"block",type:"pie_cdr"},{kind:"sep",gap:"16"},{kind:"label",text:"Lists"},{kind:"block",type:"pie_nil"},{kind:"block",type:"pie_list_cons"},{kind:"sep",gap:"16"},{kind:"label",text:"Vectors"},{kind:"block",type:"pie_vecnil"},{kind:"block",type:"pie_vec_cons"},{kind:"sep",gap:"16"},{kind:"label",text:"Either"},{kind:"block",type:"pie_left"},{kind:"block",type:"pie_right"},{kind:"sep",gap:"16"},{kind:"label",text:"Other Values"},{kind:"block",type:"pie_sole"},{kind:"block",type:"pie_same"},{kind:"block",type:"pie_quote"},{kind:"block",type:"pie_variable"}]},{kind:"category",name:"Functions",colour:c,contents:[{kind:"label",text:"Lambda Expressions"},{kind:"block",type:"pie_lambda"},{kind:"block",type:"pie_lambda_multi"},{kind:"sep",gap:"16"},{kind:"label",text:"Application"},{kind:"block",type:"pie_application"},{kind:"block",type:"pie_application_multi"},{kind:"sep",gap:"16"},{kind:"label",text:"Type Annotation"},{kind:"block",type:"pie_the"},{kind:"sep",gap:"16"},{kind:"label",text:"Equality"},{kind:"block",type:"pie_cong"}]},{kind:"category",name:"Eliminators",colour:h,contents:[{kind:"label",text:"Natural Number Eliminators"},{kind:"block",type:"pie_which_nat"},{kind:"block",type:"pie_iter_nat"},{kind:"block",type:"pie_rec_nat"},{kind:"block",type:"pie_ind_nat"},{kind:"sep",gap:"16"},{kind:"label",text:"List Eliminators"},{kind:"block",type:"pie_rec_list"},{kind:"block",type:"pie_ind_list"},{kind:"sep",gap:"16"},{kind:"label",text:"Vector Eliminators"},{kind:"block",type:"pie_ind_vec"},{kind:"block",type:"pie_head"},{kind:"block",type:"pie_tail"},{kind:"sep",gap:"16"},{kind:"label",text:"Either Eliminator"},{kind:"block",type:"pie_ind_either"},{kind:"sep",gap:"16"},{kind:"label",text:"Equality Eliminator"},{kind:"block",type:"pie_ind_equal"},{kind:"sep",gap:"16"},{kind:"label",text:"Absurd Eliminator"},{kind:"block",type:"pie_ind_absurd"}]},{kind:"category",name:"Tactics",colour:u,contents:[{kind:"label",text:"Basic Tactics"},{kind:"block",type:"pie_tactic_intro"},{kind:"block",type:"pie_tactic_exact"},{kind:"block",type:"pie_tactic_exists"},{kind:"sep",gap:"16"},{kind:"label",text:"Either Tactics"},{kind:"block",type:"pie_tactic_left"},{kind:"block",type:"pie_tactic_right"},{kind:"sep",gap:"16"},{kind:"label",text:"Split"},{kind:"block",type:"pie_tactic_split"},{kind:"sep",gap:"16"},{kind:"label",text:"Elimination Tactics"},{kind:"block",type:"pie_tactic_elimNat"},{kind:"block",type:"pie_tactic_elimList"},{kind:"block",type:"pie_tactic_elimVec"},{kind:"block",type:"pie_tactic_elimEqual"},{kind:"block",type:"pie_tactic_elimEither"},{kind:"block",type:"pie_tactic_elimAbsurd"}]}]};class T{constructor(e){this.workspace=null,this.lastGeneratedCode="",this.changeListener=null,this.initialized=!1,this.codePreview=e.codePreview,this.onCodeChange=e.onCodeChange,Blockly.Blocks.pie_nat={init:function(){this.appendDummyInput().appendField("Nat"),this.setOutput(!0,"Type"),this.setColour(r),this.setTooltip("Natural number type")}},Blockly.Blocks.pie_atom={init:function(){this.appendDummyInput().appendField("Atom"),this.setOutput(!0,"Type"),this.setColour(r),this.setTooltip("Atom (symbol) type")}},Blockly.Blocks.pie_trivial={init:function(){this.appendDummyInput().appendField("Trivial"),this.setOutput(!0,"Type"),this.setColour(r),this.setTooltip("Trivial type (unit type)")}},Blockly.Blocks.pie_absurd={init:function(){this.appendDummyInput().appendField("Absurd"),this.setOutput(!0,"Type"),this.setColour(r),this.setTooltip("Absurd type (empty type)")}},Blockly.Blocks.pie_u={init:function(){this.appendDummyInput().appendField("U"),this.setOutput(!0,"Type"),this.setColour(r),this.setTooltip("Universe type (type of types)")}},Blockly.Blocks.pie_list_type={init:function(){this.appendValueInput("ELEM_TYPE").setCheck("Type").appendField("List"),this.setOutput(!0,"Type"),this.setColour(r),this.setTooltip("List type")}},Blockly.Blocks.pie_vec_type={init:function(){this.appendValueInput("ELEM_TYPE").setCheck("Type").appendField("Vec"),this.appendValueInput("LENGTH").setCheck(["Expression","Type"]).appendField("length"),this.setInputsInline(!0),this.setOutput(!0,"Type"),this.setColour(r),this.setTooltip("Vector type with fixed length")}},Blockly.Blocks.pie_pair_type={init:function(){this.appendValueInput("LEFT_TYPE").setCheck("Type").appendField("Pair"),this.appendValueInput("RIGHT_TYPE").setCheck("Type"),this.setInputsInline(!0),this.setOutput(!0,"Type"),this.setColour(r),this.setTooltip("Pair type (non-dependent product)")}},Blockly.Blocks.pie_sigma_type={init:function(){this.appendDummyInput().appendField("Sigma (").appendField(new Blockly.FieldTextInput("x"),"BINDING").appendField(":"),this.appendValueInput("BINDING_TYPE").setCheck("Type"),this.appendDummyInput().appendField(")"),this.appendValueInput("BODY_TYPE").setCheck("Type"),this.setInputsInline(!0),this.setOutput(!0,"Type"),this.setColour(r),this.setTooltip("Sigma type (dependent pair)")}},Blockly.Blocks.pie_either_type={init:function(){this.appendValueInput("LEFT_TYPE").setCheck("Type").appendField("Either"),this.appendValueInput("RIGHT_TYPE").setCheck("Type"),this.setInputsInline(!0),this.setOutput(!0,"Type"),this.setColour(r),this.setTooltip("Either type (sum type)")}},Blockly.Blocks.pie_arrow_type={init:function(){this.appendValueInput("FROM_TYPE").setCheck("Type").appendField("->"),this.appendValueInput("TO_TYPE").setCheck("Type"),this.setInputsInline(!0),this.setOutput(!0,"Type"),this.setColour(r),this.setTooltip("Arrow type (function type)")}},Blockly.Blocks.pie_pi_type={init:function(){this.appendDummyInput().appendField("Pi (").appendField(new Blockly.FieldTextInput("x"),"BINDING").appendField(":"),this.appendValueInput("BINDING_TYPE").setCheck("Type"),this.appendDummyInput().appendField(")"),this.appendValueInput("BODY_TYPE").setCheck("Type"),this.setInputsInline(!0),this.setOutput(!0,"Type"),this.setColour(r),this.setTooltip("Pi type (dependent function type)")}},Blockly.Blocks.pie_equal_type={init:function(){this.appendValueInput("BASE_TYPE").setCheck("Type").appendField("="),this.appendValueInput("FROM").setCheck(["Expression","Type"]),this.appendValueInput("TO").setCheck(["Expression","Type"]),this.setInputsInline(!0),this.setOutput(!0,"Type"),this.setColour(r),this.setTooltip("Equality type")}},Blockly.Blocks.pie_zero={init:function(){this.appendDummyInput().appendField("zero"),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("Natural number zero")}},Blockly.Blocks.pie_add1={init:function(){this.appendValueInput("N").setCheck(["Expression","Type"]).appendField("add1"),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("Successor of a natural number")}},Blockly.Blocks.pie_nat_literal={init:function(){this.appendDummyInput().appendField(new Blockly.FieldNumber(0,0,1/0,1),"VALUE"),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("Natural number literal")}},Blockly.Blocks.pie_cons={init:function(){this.appendValueInput("LEFT").setCheck(["Expression","Type"]).appendField("cons"),this.appendValueInput("RIGHT").setCheck(["Expression","Type"]),this.setInputsInline(!0),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("Pair constructor")}},Blockly.Blocks.pie_car={init:function(){this.appendValueInput("PAIR").setCheck(["Expression","Type"]).appendField("car"),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("First element of a pair")}},Blockly.Blocks.pie_cdr={init:function(){this.appendValueInput("PAIR").setCheck(["Expression","Type"]).appendField("cdr"),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("Second element of a pair")}},Blockly.Blocks.pie_same={init:function(){this.appendValueInput("VALUE").setCheck(["Expression","Type"]).appendField("same"),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("Reflexivity proof")}},Blockly.Blocks.pie_sole={init:function(){this.appendDummyInput().appendField("sole"),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("The sole element of Trivial")}},Blockly.Blocks.pie_nil={init:function(){this.appendDummyInput().appendField("nil"),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("Empty list")}},Blockly.Blocks.pie_list_cons={init:function(){this.appendValueInput("HEAD").setCheck(["Expression","Type"]).appendField("::"),this.appendValueInput("TAIL").setCheck(["Expression","Type"]),this.setInputsInline(!0),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("List constructor")}},Blockly.Blocks.pie_vecnil={init:function(){this.appendDummyInput().appendField("vecnil"),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("Empty vector")}},Blockly.Blocks.pie_vec_cons={init:function(){this.appendValueInput("HEAD").setCheck(["Expression","Type"]).appendField("vec::"),this.appendValueInput("TAIL").setCheck(["Expression","Type"]),this.setInputsInline(!0),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("Vector constructor")}},Blockly.Blocks.pie_left={init:function(){this.appendValueInput("VALUE").setCheck(["Expression","Type"]).appendField("left"),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("Left injection into Either")}},Blockly.Blocks.pie_right={init:function(){this.appendValueInput("VALUE").setCheck(["Expression","Type"]).appendField("right"),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("Right injection into Either")}},Blockly.Blocks.pie_quote={init:function(){this.appendDummyInput().appendField("'").appendField(new Blockly.FieldTextInput("symbol"),"SYMBOL"),this.setOutput(!0,"Expression"),this.setColour(p),this.setTooltip("Atom literal (quoted symbol)")}},Blockly.Blocks.pie_variable={init:function(){this.appendDummyInput().appendField(new Blockly.FieldTextInput("x"),"NAME"),this.setOutput(!0,["Expression","Type"]),this.setColour(p),this.setTooltip("Variable reference")}},Blockly.Blocks.pie_lambda={init:function(){this.appendDummyInput().appendField("lambda (").appendField(new Blockly.FieldTextInput("x"),"PARAM").appendField(")"),this.appendValueInput("BODY").setCheck(["Expression","Type"]),this.setInputsInline(!0),this.setOutput(!0,"Expression"),this.setColour(c),this.setTooltip("Lambda expression")}},Blockly.Blocks.pie_lambda_multi={init:function(){this.appendDummyInput().appendField("lambda (").appendField(new Blockly.FieldTextInput("x y"),"PARAMS").appendField(")"),this.appendValueInput("BODY").setCheck(["Expression","Type"]),this.setInputsInline(!0),this.setOutput(!0,"Expression"),this.setColour(c),this.setTooltip("Lambda expression with multiple parameters (space-separated)")}},Blockly.Blocks.pie_application={init:function(){this.appendValueInput("FUNC").setCheck(["Expression","Type"]).appendField("("),this.appendValueInput("ARG").setCheck(["Expression","Type"]),this.appendDummyInput().appendField(")"),this.setInputsInline(!0),this.setOutput(!0,"Expression"),this.setColour(c),this.setTooltip("Function application")}},Blockly.Blocks.pie_application_multi={init:function(){this.appendValueInput("FUNC").setCheck(["Expression","Type"]).appendField("("),this.appendValueInput("ARG1").setCheck(["Expression","Type"]),this.appendValueInput("ARG2").setCheck(["Expression","Type"]),this.appendDummyInput().appendField(")"),this.setInputsInline(!0),this.setOutput(!0,"Expression"),this.setColour(c),this.setTooltip("Function application with two arguments")}},Blockly.Blocks.pie_the={init:function(){this.appendValueInput("TYPE").setCheck("Type").appendField("the"),this.appendValueInput("VALUE").setCheck(["Expression","Type"]),this.setInputsInline(!0),this.setOutput(!0,"Expression"),this.setColour(c),this.setTooltip("Type annotation")}},Blockly.Blocks.pie_cong={init:function(){this.appendValueInput("PROOF").setCheck(["Expression","Type"]).appendField("cong"),this.appendValueInput("FUNC").setCheck(["Expression","Type"]),this.setInputsInline(!0),this.setOutput(!0,"Expression"),this.setColour(c),this.setTooltip("Congruence (apply function to both sides of equality)")}},Blockly.Blocks.pie_claim={init:function(){this.appendDummyInput().appendField("claim").appendField(new Blockly.FieldTextInput("name"),"NAME"),this.appendValueInput("TYPE").setCheck("Type").appendField(":"),this.setPreviousStatement(!0,"Statement"),this.setNextStatement(!0,"Statement"),this.setColour(d),this.setTooltip("Declare a type for a name")}},Blockly.Blocks.pie_define={init:function(){this.appendDummyInput().appendField("define").appendField(new Blockly.FieldTextInput("name"),"NAME"),this.appendValueInput("VALUE").setCheck(["Expression","Type"]).appendField("="),this.setPreviousStatement(!0,"Statement"),this.setNextStatement(!0,"Statement"),this.setColour(d),this.setTooltip("Define a value for a claimed name")}},Blockly.Blocks.pie_define_tactically={init:function(){this.appendDummyInput().appendField("define-tactically").appendField(new Blockly.FieldTextInput("name"),"NAME"),this.appendStatementInput("TACTICS").setCheck("Tactic"),this.setPreviousStatement(!0,"Statement"),this.setNextStatement(!0,"Statement"),this.setColour(d),this.setTooltip("Define using tactics")}},Blockly.Blocks.pie_check_same={init:function(){this.appendValueInput("TYPE").setCheck("Type").appendField("check-same"),this.appendValueInput("LEFT").setCheck(["Expression","Type"]),this.appendValueInput("RIGHT").setCheck(["Expression","Type"]),this.setPreviousStatement(!0,"Statement"),this.setNextStatement(!0,"Statement"),this.setColour(d),this.setTooltip("Check that two expressions are the same")}},Blockly.Blocks.pie_tactic_intro={init:function(){this.appendDummyInput().appendField("intro").appendField(new Blockly.FieldTextInput("x"),"NAME"),this.setPreviousStatement(!0,"Tactic"),this.setNextStatement(!0,"Tactic"),this.setColour(u),this.setTooltip("Introduce a variable")}},Blockly.Blocks.pie_tactic_exact={init:function(){this.appendValueInput("EXPR").setCheck(["Expression","Type"]).appendField("exact"),this.setPreviousStatement(!0,"Tactic"),this.setNextStatement(!0,"Tactic"),this.setColour(u),this.setTooltip("Provide exact proof term")}},Blockly.Blocks.pie_tactic_exists={init:function(){this.appendValueInput("WITNESS").setCheck(["Expression","Type"]).appendField("exists"),this.setPreviousStatement(!0,"Tactic"),this.setNextStatement(!0,"Tactic"),this.setColour(u),this.setTooltip("Provide witness for existential")}},Blockly.Blocks.pie_tactic_left={init:function(){this.appendDummyInput().appendField("left"),this.setPreviousStatement(!0,"Tactic"),this.setNextStatement(!0,"Tactic"),this.setColour(u),this.setTooltip("Choose left branch of Either")}},Blockly.Blocks.pie_tactic_right={init:function(){this.appendDummyInput().appendField("right"),this.setPreviousStatement(!0,"Tactic"),this.setNextStatement(!0,"Tactic"),this.setColour(u),this.setTooltip("Choose right branch of Either")}},Blockly.Blocks.pie_tactic_split={init:function(){this.appendDummyInput().appendField("split"),this.setPreviousStatement(!0,"Tactic"),this.setNextStatement(!0,"Tactic"),this.setColour(u),this.setTooltip("Split a goal into subgoals")}},Blockly.Blocks.pie_tactic_elimNat={init:function(){this.appendDummyInput().appendField("elimNat").appendField(new Blockly.FieldTextInput("n"),"TARGET"),this.setPreviousStatement(!0,"Tactic"),this.setNextStatement(!0,"Tactic"),this.setColour(u),this.setTooltip("Eliminate (induct on) a natural number")}},Blockly.Blocks.pie_tactic_elimList={init:function(){this.appendDummyInput().appendField("elimList").appendField(new Blockly.FieldTextInput("xs"),"TARGET"),this.setPreviousStatement(!0,"Tactic"),this.setNextStatement(!0,"Tactic"),this.setColour(u),this.setTooltip("Eliminate (induct on) a list")}},Blockly.Blocks.pie_tactic_elimVec={init:function(){this.appendDummyInput().appendField("elimVec").appendField(new Blockly.FieldTextInput("vs"),"TARGET"),this.setPreviousStatement(!0,"Tactic"),this.setNextStatement(!0,"Tactic"),this.setColour(u),this.setTooltip("Eliminate (induct on) a vector")}},Blockly.Blocks.pie_tactic_elimEqual={init:function(){this.appendDummyInput().appendField("elimEqual").appendField(new Blockly.FieldTextInput("eq"),"TARGET"),this.setPreviousStatement(!0,"Tactic"),this.setNextStatement(!0,"Tactic"),this.setColour(u),this.setTooltip("Eliminate an equality proof")}},Blockly.Blocks.pie_tactic_elimEither={init:function(){this.appendDummyInput().appendField("elimEither").appendField(new Blockly.FieldTextInput("e"),"TARGET"),this.setPreviousStatement(!0,"Tactic"),this.setNextStatement(!0,"Tactic"),this.setColour(u),this.setTooltip("Eliminate an Either value")}},Blockly.Blocks.pie_tactic_elimAbsurd={init:function(){this.appendDummyInput().appendField("elimAbsurd").appendField(new Blockly.FieldTextInput("x"),"TARGET"),this.setPreviousStatement(!0,"Tactic"),this.setNextStatement(!0,"Tactic"),this.setColour(u),this.setTooltip("Eliminate an Absurd value (ex falso)")}},Blockly.Blocks.pie_which_nat={init:function(){this.appendValueInput("TARGET").setCheck(["Expression","Type"]).appendField("which-Nat"),this.appendValueInput("BASE").setCheck(["Expression","Type"]).appendField("base"),this.appendValueInput("STEP").setCheck(["Expression","Type"]).appendField("step"),this.setInputsInline(!1),this.setOutput(!0,"Expression"),this.setColour(h),this.setTooltip("Case analysis on Nat (zero or add1)")}},Blockly.Blocks.pie_iter_nat={init:function(){this.appendValueInput("TARGET").setCheck(["Expression","Type"]).appendField("iter-Nat"),this.appendValueInput("BASE").setCheck(["Expression","Type"]).appendField("base"),this.appendValueInput("STEP").setCheck(["Expression","Type"]).appendField("step"),this.setInputsInline(!1),this.setOutput(!0,"Expression"),this.setColour(h),this.setTooltip("Iterate over Nat")}},Blockly.Blocks.pie_rec_nat={init:function(){this.appendValueInput("TARGET").setCheck(["Expression","Type"]).appendField("rec-Nat"),this.appendValueInput("BASE").setCheck(["Expression","Type"]).appendField("base"),this.appendValueInput("STEP").setCheck(["Expression","Type"]).appendField("step"),this.setInputsInline(!1),this.setOutput(!0,"Expression"),this.setColour(h),this.setTooltip("Recursion over Nat with predecessor")}},Blockly.Blocks.pie_ind_nat={init:function(){this.appendValueInput("TARGET").setCheck(["Expression","Type"]).appendField("ind-Nat"),this.appendValueInput("MOTIVE").setCheck(["Expression","Type"]).appendField("motive"),this.appendValueInput("BASE").setCheck(["Expression","Type"]).appendField("base"),this.appendValueInput("STEP").setCheck(["Expression","Type"]).appendField("step"),this.setInputsInline(!1),this.setOutput(!0,"Expression"),this.setColour(h),this.setTooltip("Induction over Nat")}},Blockly.Blocks.pie_rec_list={init:function(){this.appendValueInput("TARGET").setCheck(["Expression","Type"]).appendField("rec-List"),this.appendValueInput("BASE").setCheck(["Expression","Type"]).appendField("base"),this.appendValueInput("STEP").setCheck(["Expression","Type"]).appendField("step"),this.setInputsInline(!1),this.setOutput(!0,"Expression"),this.setColour(h),this.setTooltip("Recursion over List")}},Blockly.Blocks.pie_ind_list={init:function(){this.appendValueInput("TARGET").setCheck(["Expression","Type"]).appendField("ind-List"),this.appendValueInput("MOTIVE").setCheck(["Expression","Type"]).appendField("motive"),this.appendValueInput("BASE").setCheck(["Expression","Type"]).appendField("base"),this.appendValueInput("STEP").setCheck(["Expression","Type"]).appendField("step"),this.setInputsInline(!1),this.setOutput(!0,"Expression"),this.setColour(h),this.setTooltip("Induction over List")}},Blockly.Blocks.pie_ind_vec={init:function(){this.appendValueInput("LENGTH").setCheck(["Expression","Type"]).appendField("ind-Vec"),this.appendValueInput("TARGET").setCheck(["Expression","Type"]).appendField("vec"),this.appendValueInput("MOTIVE").setCheck(["Expression","Type"]).appendField("motive"),this.appendValueInput("BASE").setCheck(["Expression","Type"]).appendField("base"),this.appendValueInput("STEP").setCheck(["Expression","Type"]).appendField("step"),this.setInputsInline(!1),this.setOutput(!0,"Expression"),this.setColour(h),this.setTooltip("Induction over Vec")}},Blockly.Blocks.pie_ind_either={init:function(){this.appendValueInput("TARGET").setCheck(["Expression","Type"]).appendField("ind-Either"),this.appendValueInput("MOTIVE").setCheck(["Expression","Type"]).appendField("motive"),this.appendValueInput("LEFT_CASE").setCheck(["Expression","Type"]).appendField("left"),this.appendValueInput("RIGHT_CASE").setCheck(["Expression","Type"]).appendField("right"),this.setInputsInline(!1),this.setOutput(!0,"Expression"),this.setColour(h),this.setTooltip("Induction over Either")}},Blockly.Blocks.pie_ind_equal={init:function(){this.appendValueInput("TARGET").setCheck(["Expression","Type"]).appendField("ind-="),this.appendValueInput("MOTIVE").setCheck(["Expression","Type"]).appendField("motive"),this.appendValueInput("BASE").setCheck(["Expression","Type"]).appendField("base"),this.setInputsInline(!1),this.setOutput(!0,"Expression"),this.setColour(h),this.setTooltip("Induction over equality")}},Blockly.Blocks.pie_ind_absurd={init:function(){this.appendValueInput("TARGET").setCheck(["Expression","Type"]).appendField("ind-Absurd"),this.appendValueInput("MOTIVE").setCheck("Type").appendField("motive"),this.setInputsInline(!0),this.setOutput(!0,"Expression"),this.setColour(h),this.setTooltip("Eliminate Absurd (ex falso quodlibet)")}},Blockly.Blocks.pie_head={init:function(){this.appendValueInput("LIST").setCheck(["Expression","Type"]).appendField("head"),this.setOutput(!0,"Expression"),this.setColour(h),this.setTooltip("First element of a vector")}},Blockly.Blocks.pie_tail={init:function(){this.appendValueInput("LIST").setCheck(["Expression","Type"]).appendField("tail"),this.setOutput(!0,"Expression"),this.setColour(h),this.setTooltip("Tail of a vector")}},this.workspace=Blockly.inject(e.container,{toolbox:g,theme:this.createDarkTheme(),grid:{spacing:20,length:3,colour:"#1a2520",snap:!0},zoom:{controls:!0,wheel:!0,startScale:1,maxScale:3,minScale:.3,scaleSpeed:1.2},trashcan:!0,move:{scrollbars:!0,drag:!0,wheel:!0},renderer:"zelos"}),this.setupChangeListener(),this.initialized=!0}createDarkTheme(){return Blockly.Theme.defineTheme("pie-dark",{name:"pie-dark",base:Blockly.Themes.Classic,componentStyles:{workspaceBackgroundColour:"#1a2520",toolboxBackgroundColour:"#0f1a14",toolboxForegroundColour:"#e8f4ed",flyoutBackgroundColour:"#152119",flyoutForegroundColour:"#e8f4ed",flyoutOpacity:.95,scrollbarColour:"#3d8b5f",scrollbarOpacity:.5,insertionMarkerColour:"#4ade80",insertionMarkerOpacity:.5,markerColour:"#4ade80",cursorColour:"#4ade80"},fontStyle:{family:"Menlo, 'Fira Code', 'JetBrains Mono', monospace",weight:"500",size:12},startHats:!1})}setupChangeListener(){this.workspace&&(this.changeListener=()=>{this.generateCode()},this.workspace.addChangeListener(this.changeListener))}generateCode(){if(this.workspace)try{const e=y.instance.workspaceToCode(this.workspace);this.lastGeneratedCode=e,this.updateCodePreview(e),this.onCodeChange&&this.onCodeChange(e)}catch(e){console.error("Error generating code:",e),this.updateCodePreview(`; Error generating code: ${e}`)}}updateCodePreview(e){this.codePreview&&(this.codePreview.textContent=e||"; (empty workspace)")}getCode(){return this.lastGeneratedCode}clear(){this.workspace&&this.workspace.clear()}resize(){this.workspace&&Blockly.svgResize(this.workspace)}isInitialized(){return this.initialized}loadStarterExample(){if(!this.workspace)return;this.clear();const e=this.workspace.newBlock("pie_claim");e.setFieldValue("myZero","NAME"),e.initSvg(),e.render(),e.moveBy(50,50);const t=this.workspace.newBlock("pie_nat");t.initSvg(),t.render();const n=e.getInput("TYPE");n&&n.connection&&t.outputConnection&&n.connection.connect(t.outputConnection);const i=this.workspace.newBlock("pie_define");i.setFieldValue("myZero","NAME"),i.initSvg(),i.render(),e.nextConnection&&i.previousConnection&&e.nextConnection.connect(i.previousConnection);const o=this.workspace.newBlock("pie_zero");o.initSvg(),o.render();const s=i.getInput("VALUE");s&&s.connection&&o.outputConnection&&s.connection.connect(o.outputConnection),this.generateCode()}dispose(){this.workspace&&(this.changeListener&&this.workspace.removeChangeListener(this.changeListener),this.workspace.dispose(),this.workspace=null),this.initialized=!1}getWorkspace(){return this.workspace}serializeToXml(){if(!this.workspace)return"";const e=Blockly.Xml.workspaceToDom(this.workspace);return Blockly.Xml.domToText(e)}loadFromXml(e){if(!this.workspace)return;this.clear();const t=Blockly.utils.xml.textToDom(e);Blockly.Xml.domToWorkspace(t,this.workspace)}serializeToJson(){return this.workspace?Blockly.serialization.workspaces.save(this.workspace):{}}loadFromJson(e){this.workspace&&Blockly.serialization.workspaces.load(e,this.workspace)}}const E={"Hello World":"(claim zero Nat)\n(define zero zero)\n\n(claim add1zero Nat)\n(define add1zero (add1 zero))","Natural Number Addition":"(claim +\n  (→ Nat Nat Nat))\n\n(claim step-plus\n  (→ Nat Nat))\n\n(define step-plus\n  (λ (n-1)\n    (add1 n-1)))\n\n(define +\n  (λ (n j)\n    (iter-Nat n\n      j\n      step-plus)))\n\n(claim result Nat)\n(define result (+ 2 3))","List Length":"(claim length\n  (Π ((E U))\n    (→ (List E) Nat)))\n\n(claim step-length\n  (Π ((E U))\n    (→ E (List E) Nat Nat)))\n\n(define step-length\n  (λ (E)\n    (λ (e es length-es)\n      (add1 length-es))))\n\n(define length\n  (λ (E)\n    (λ (es)\n      (rec-List es\n        0\n        (step-length E)))))\n\n(claim my-list (List Nat))\n(define my-list (:: 1 (:: 2 (:: 3 nil))))\n\n(claim list-len Nat)\n(define list-len (length Nat my-list))","Either Type":"(claim either-swap\n  (Pi ((A U) (B U))\n    (-> (Either A B)\n        (Either B A))))\n\n(define either-swap\n  (lambda (A B)\n    (lambda (e)\n      (ind-Either e\n        (lambda (x) (Either B A))\n        (lambda (a) (right a))\n        (lambda (b) (left b))))))\n\n(claim test-either (Either Nat Nat))\n(define test-either (left zero))\n\n(claim swapped (Either Nat Nat))\n(define swapped (either-swap Nat Nat test-either))","Vector Map":"(claim vec-map\n  (Π ((A U) (B U) (n Nat))\n     (-> (-> A B) (Vec A n)\n         (Vec B n))))\n\n(define vec-map\n  (λ (A B n)\n    (λ (f vs)\n      (ind-Vec n vs\n        (λ (k xs) (Vec B k))\n        vecnil\n        (λ (k x xs ih) (vec:: (f x) ih))))))\n\n(claim nat-vec (Vec Nat 3))\n(define nat-vec (vec:: 1 (vec:: 2 (vec:: 3 vecnil))))\n\n(claim add1-fn (-> Nat Nat))\n(define add1-fn (λ (n) (add1 n)))\n\n(claim incremented-vec (Vec Nat 3))\n(define incremented-vec (vec-map Nat Nat 3 add1-fn nat-vec))","Tactics: Even or Odd":'\n(claim +\n  (→ Nat Nat\n    Nat))\n\n(claim step-plus\n  (→ Nat\n    Nat))\n\n(define step-plus\n  (λ (n-1)\n    (add1 n-1 ) ))\n\n(define +\n  (λ (n j)\n    (iter-Nat n\n      j\n      step-plus )))\n\n(claim double\n  (→ Nat\n    Nat))\n\n(define double\n  (λ (n)\n    (iter-Nat n\n      0\n      (+ 2))))\n\n(claim Even\n  (→ Nat\n    U ))\n\n(define Even\n  (λ (n)\n    (Σ ((half Nat))\n      (= Nat n (double half )))))\n\n(claim Odd\n  (→ Nat\n    U ))\n\n(define Odd\n  (λ (n)\n    (Σ ((haf Nat))\n      (= Nat n (add1 (double haf )))))) \n\n(claim zero-is-even\n  (Even 0))\n\n(define zero-is-even\n  (cons 0\n    (same 0)))\n\n(claim add1-even->odd\n  (Π ((n Nat))\n    (→ (Even n)\n    (Odd (add1 n)))))\n\n(define add1-even->odd\n  (λ (n en)\n    (cons (car en)\n    (cong (cdr en) (+ 1)))))\n\n(claim add1-odd->even\n  (Π ((n Nat))\n    (→ (Odd n)\n      (Even (add1 n)))))\n\n(define add1-odd->even\n  (λ (n on)\n    (cons (add1 (car on))\n      (cong (cdr on) (+ 1)))))\n\n(claim even-or-odd\n  (Π ((n Nat))\n    (Either (Even n) (Odd n))))\n\n;; This is the proof in The Little Typer\n;; (claim mot-even-or-odd\n;;   (→ Nat U )) \n\n;; (define mot-even-or-odd\n;;   (λ (k) (Either (Even k) (Odd k))))\n\n;; (claim step-even-or-odd\n;;   (Π ((n-1 Nat))\n;;      (→ (mot-even-or-odd n-1)\n;;      (mot-even-or-odd (add1 n-1)))))\n\n;; (define step-even-or-odd\n;;   (λ (n-1)\n;;     (λ (e-or-on-1)\n;;        (ind-Either e-or-on-1\n;;     (λ (e-or-on-1)\n;;        (mot-even-or-odd (add1 n-1)))\n;;        (λ (en-1)\n;;          (right\n;;            (add1-even->odd\n;;              n-1 en-1)))\n;;        (λ (on-1)\n;;          (left\n;;            (add1-odd->even\n;;              n-1 on-1)))))))\n\n;; (define even-or-odd\n;;   (λ (n)\n;;     (ind-Nat n\n;;        mot-even-or-odd\n;;        (left zero-is-even)\n;;        step-even-or-odd)))\n\n\n;; This is the proof using our new tactic system\n(define-tactically even-or-odd\n  ( (intro n)\n    (elimNat n)\n    (left)\n    (exact zero-is-even)\n    (intro n-1)\n    (intro e-or-on-1)\n    (elimEither e-or-on-1)\n    (intro xr)\n    (right)\n    (exact ((add1-even->odd n-1) xr))\n    (intro x1)\n    (left)\n    ;; finish the proof with "(exact ((add1-odd->even n-1) x1))"\n   ))',"Inductive Type: Less Than":";; Define Less Than relation using our new inductive type definiton\n    (data Less-Than () ((j Nat) (k Nat))\n      (zero-smallest ((n Nat)) (Less-Than () (zero (add1 n))))\n      (add1-smaller ((j Nat) (k Nat) (j<k (Less-Than () (j k)))) (Less-Than () ((add1 j) (add1 k))))\n      ind-Less-Than)\n\n    (claim proof-0<1 (Less-Than () (zero (add1 zero))))\n    (define proof-0<1 (zero-smallest zero))\n\n    (claim proof-1<2 (Less-Than () ((add1 zero) (add1 (add1 zero)))))\n    (define proof-1<2 (add1-smaller zero (add1 zero) proof-0<1))\n\n    (claim extract-smaller\n      (Pi ((j Nat) (k Nat))\n        (-> (Less-Than () (j k)) Nat)))\n    (define extract-smaller\n      (lambda (j k proof)\n        (ind-Less-Than proof\n          (lambda (j-idx k-idx p) Nat)\n          (lambda (n) zero)\n          (lambda (j-arg k-arg j<k-arg ih) (add1 ih)))))\n\n    (claim result Nat)\n    (define result (extract-smaller zero (add1 zero) proof-0<1))\n    ","Inductive Type: Subtype":"\n(data Subtype () ((T1 U) (T2 U))\n  (refl ((T U))\n    (Subtype () (T T)))\n  (trans ((T1 U) (T2 U) (T3 U)\n          (p1 (Subtype () (T1 T2)))\n          (p2 (Subtype () (T2 T3))))\n    (Subtype () (T1 T3)))\n  ;; Generic injection: if there exists a function A -> B, then A <: B\n  (inject ((A U) (B U) (f (-> A B)))\n    (Subtype () (A B)))\n  ind-Subtype)\n\n(claim coerce\n  (Pi ((A U) (B U))\n    (-> (Subtype () (A B)) A B)))\n(define coerce\n  (lambda (A B proof val)\n    ((ind-Subtype proof\n      (lambda (t1 t2 sub) (-> t1 t2))\n      (lambda (TT x) x)\n      (lambda (T11 T22 T33 p1 p2 ih1 ih2 x)\n        (ih2 (ih1 x)))\n      (lambda (AA BB ff x) (ff x))\n      )\n      val)))\n\n(data Even () ((n Nat))\n  (zero-even ()\n    (Even () (zero)))\n  (add2-even ((k Nat) (k-even (Even () (k))))\n    (Even () ((add1 (add1 k)))))\n  ind-Even)\n\n(claim even-to-nat\n  (Pi ((n Nat))\n    (-> (Even () (n)) Nat)))\n(define even-to-nat\n  (lambda (n proof)\n    (ind-Even proof\n      (lambda (m ev) Nat)\n      zero\n      (lambda (k prev ih) (add1 (add1 ih))))))\n\n(claim even-subtype-nat\n  (Pi ((n Nat))\n    (Subtype () ((Even () (n)) Nat))))\n(define even-subtype-nat\n  (lambda (n)\n    (inject (Even () (n)) Nat (even-to-nat n))))\n\n(claim + (-> Nat Nat Nat))\n(define +\n  (lambda (a b)\n    (rec-Nat a\n      b\n      (lambda (pred ih) (add1 ih)))))\n\n(claim double (-> Nat Nat))\n(define double\n  (lambda (n)\n    (+ n n)))\n\n;; Use Even with double\n(claim double-even\n  (Pi ((n Nat))\n    (-> (Even () (n)) Nat)))\n(define double-even\n  (lambda (n ev)\n    (double (coerce (Even () (n)) Nat\n                    (even-subtype-nat n)\n                    ev))))\n\n\n(claim even-four (Even () ((add1 (add1 (add1 (add1 zero)))))))\n(define even-four\n  (add2-even (add1 (add1 zero))\n    (add2-even zero\n      (zero-even))))\n\n(claim result2 Nat)\n(define result2 (double-even (add1 (add1 (add1 (add1 zero)))) even-four))\n        "},b=E["Hello World"],v=document.getElementById("preview-summary"),C=document.getElementById("preview-output");let _=null,x=null,B=null,N=null,I=null,w=null,A=null,S="text";function F(e,t="neutral"){v&&(v.textContent=e,v.dataset.tone=t)}function L(e,t){t?C.dataset.tone=t:delete C.dataset.tone,C.textContent=void 0===e?"Program is empty.":e}function V(e,t,n){const{diagnostics:i,pretty:o,proofTree:s}=n,a=t.getModel();if(!a)return;const l=i.map((t=>({startLineNumber:t.startLineNumber,startColumn:t.startColumn,endLineNumber:t.endLineNumber,endColumn:t.endColumn,message:t.message,severity:"warning"===t.severity?e.MarkerSeverity.Warning:e.MarkerSeverity.Error})));if(e.editor.setModelMarkers(a,"pie-playground",l),function(e){const t=document.getElementById("proof-tree-container");if(t){if(!e)return t.style.display="none",N&&N.clear(),I&&I.clear(),void(w&&w.clear());t.style.display="flex",N&&N.render(e),I&&I.clear(),w&&w.clear()}}(s),0===i.length)return F("SUCCESS","success"),void L(o?.trim()??void 0,"success");const r=i[0],p="warning"===r.severity?"warning":"error";F("warning"===p?"WARNING":"ERROR",p);L(`${`Line ${r.startLineNumber}, Col ${r.startColumn}`}\n${r.message}`,p)}function $(e){const t=document.getElementById("mode-text"),n=document.getElementById("mode-blocks"),i=document.getElementById("editor"),o=document.getElementById("blockly-container"),s=document.getElementById("example-picker");t&&n&&i&&o?(t.addEventListener("click",(function(){if("text"!==S&&(S="text",t.classList.add("mode-btn--active"),n.classList.remove("mode-btn--active"),i.style.display="",o.style.display="none",s&&(s.style.display=""),_)){const t=e.getValue();0===t.trim().length?(F("Waiting for input…","neutral"),L(void 0)):(F("Running checks…","warning"),_.postMessage({type:"analyze",payload:{source:t}}))}})),n.addEventListener("click",(function(){if("blocks"!==S&&(S="blocks",n.classList.add("mode-btn--active"),t.classList.remove("mode-btn--active"),i.style.display="none",o.style.display="",s&&(s.style.display="none"),A||(A=function(){const e=document.getElementById("blockly-workspace"),t=document.getElementById("blockly-code-preview");if(!e||!t)return console.error("Blockly container elements not found"),null;const n=new T({container:e,codePreview:t,onCodeChange:e=>{"blocks"===S&&_&&(0===e.trim().length?(F("Waiting for blocks…","neutral"),L("; (empty workspace)")):(F("Running checks…","warning"),_.postMessage({type:"analyze",payload:{source:e}})))}});return n.loadStarterExample(),n}()),A)){A.resize();const e=A.getCode();_&&(0===e.trim().length?(F("Waiting for blocks…","neutral"),L("; (empty workspace)")):(F("Running checks…","warning"),_.postMessage({type:"analyze",payload:{source:e}})))}}))):console.error("Mode toggle elements not found")}function P(e,t){let n;return function(...i){window.clearTimeout(n),n=window.setTimeout((()=>e.apply(this,i)),t)}}!async function(){window.require?(window.require.config({paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.0/min/vs"}}),window.require(["vs/editor/editor.main"],(async()=>{B=window.monaco;const t=function(e){!function(e){e.languages.register({id:"pie"}),e.languages.setLanguageConfiguration("pie",{comments:{lineComment:";",blockComment:["#|","|#"]},brackets:[["(",")"],["[","]"],["{","}"]],autoClosingPairs:[{open:"(",close:")"},{open:"[",close:"]"},{open:"{",close:"}"},{open:'"',close:'"'}],surroundingPairs:[{open:"(",close:")"},{open:"[",close:"]"},{open:"{",close:"}"},{open:'"',close:'"'}]}),e.languages.setMonarchTokensProvider("pie",{defaultToken:"",tokenPostfix:".pie",keywords:["lambda","λ","Pi","Π","Sigma","Σ","define","claim","the","check-same","define-tactically","TODO","U","Universe","Nat","Atom","List","Vec","Either","zero","add1","nil","cons","car","cdr","ind-Nat","rec-Nat","iter-Nat","ind-List","rec-List","ind-Vec","rec-Vec","ind-Either","replace","trans","cong","symm","same","left","right","ind-Either","vecnil","vec::"],operators:["->","→","=","::"],symbols:/[=><!~?:&|+\-*/^%]+/,tokenizer:{root:[{include:"@whitespace"},[/\((?:lambda|λ|Pi|Π|Sigma|Σ|define|claim|the|check-same|define-tactically)\b/,"keyword"],[/[a-zA-Z][a-zA-Z0-9\-_!?*+=<>λΠΣ→]*/,{cases:{"@keywords":"keyword","@default":"identifier"}}],[/\d+/,"number"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string"],[/'[a-zA-Z][a-zA-Z0-9\-_!?*+=<>]*/,"string.quoted"],[/[()[\]]/,"@brackets"],[/@symbols/,{cases:{"@operators":"operator","@default":""}}]],whitespace:[[/[ \t\r\n]+/,"white"],[/;.*$/,"comment"],[/#\|/,"comment","@comment"]],comment:[[/[^#|]+/,"comment"],[/\|#/,"comment","@pop"],[/[#|]/,"comment"]],string:[[/[^\\"]+/,"string"],[/\\./,"string.escape"],[/"/,"string","@pop"]]}})}(e);const t=e.editor.create(document.getElementById("editor"),{value:b,language:"pie",theme:"vs-dark",automaticLayout:!0,minimap:{enabled:!1},scrollbar:{vertical:"auto",horizontal:"auto",useShadows:!1,verticalScrollbarSize:6,verticalSliderSize:4},padding:{top:16},fontSize:14,fontFamily:"Menlo, 'Fira Code', 'JetBrains Mono', monospace",smoothScrolling:!0});L(b.trim()),F("Ready for analysis.","neutral");const n=P((e=>{0===e.trim().length?(F("Waiting for input…","neutral"),L(void 0)):(F("Running checks…","warning"),L("Analyzing…"))}),120),i=P((e=>{F("Running checks…","warning"),_&&_.postMessage({type:"analyze",payload:{source:e}})}),220);return t.onDidChangeModelContent((()=>{const e=t.getValue();n(e),i(e)})),t}(B);_=function(e){if(!("Worker"in window))return F("Diagnostics unavailable in this browser.","warning"),null;const t=new Worker("diagnostics-worker.js",{type:"module"});return t.onmessage=t=>{const{type:n,payload:i}=t.data;"diagnostics"===n&&B&&V(B,e,i)},t.onerror=e=>{console.error("Worker error event:",e),console.error("Error details:",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno}),F("Diagnostics worker crashed.","error"),L(`Worker failed to load. Check browser console for details.\nError: ${e.message||"Unknown error"}`,"error")},t}(t),function(e){const t=document.getElementById("example-picker");t&&(Object.keys(E).forEach((e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)})),t.value="Hello World",t.addEventListener("change",(t=>{const n=t.target.value;n&&E[n]&&e.setValue(E[n])})))}(t),function(e){const t=document.getElementById("copy-btn");t&&t.addEventListener("click",(async()=>{const n=e.getValue();try{await navigator.clipboard.writeText(n),t.textContent="Copied!",t.dataset.copied="true",setTimeout((()=>{t.textContent="Copy",delete t.dataset.copied}),1500)}catch(e){console.error("Failed to copy:",e),t.textContent="Failed",setTimeout((()=>{t.textContent="Copy"}),1500)}}))}(t),function(){const e=document.getElementById("proof-tree-canvas"),t=document.getElementById("proof-context-panel"),o=document.getElementById("proof-goal-panel"),s=document.getElementById("proof-tree-toggle"),a=document.getElementById("proof-tree-container");e&&t&&o?(N=new n(e),I=new i(t),w=new l(o),N.setOnGoalSelect((e=>{I&&I.display(e),w&&w.display(e),N&&N.highlightGoal(e.id)})),s&&a&&s.addEventListener("click",(()=>{const e=a.querySelector(".proof-tree-content");e&&("none"===e.style.display?(e.style.display="flex",s.textContent="Hide"):(e.style.display="none",s.textContent="Show"))}))):console.warn("Proof tree containers not found")}(),$(t),B&&await async function(t,n){try{x&&x.isRunning()&&await x.stop(),x=new e(t,n),await x.start(),console.log("LSP client initialized successfully")}catch(e){console.error("Failed to initialize LSP client:",e),F("LSP features unavailable","warning")}}(B,t),_&&_.postMessage({type:"analyze",payload:{source:t.getValue()}}),window.__pieEditor=t}))):console.error("Monaco loader not available")}();
//# sourceMappingURL=app.bundle.js.map
